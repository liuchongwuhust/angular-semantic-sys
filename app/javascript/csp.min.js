/*! csp 2017-03-06 */
function cspManageProductFileChange(a){var b=a.value;if(""===b)document.getElementById("csp_manage_product_delete_button").click();else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"jpg"!==d&&"png"!==d&&"bmp"!==d?document.getElementById("csp_manage_product_error_button").click():document.getElementById("csp_manage_product_right_button").click()}}function cspManageSelectFile(){document.getElementById("csp_manage_file_input").click()}function cspManageanalogProductFileChange(a){var b=a.value;if(""===b)document.getElementById("csp_manage_analogProduct_delete_button").click();else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"jpg"!==d&&"png"!==d&&"bmp"!==d?document.getElementById("csp_manage_analogProduct_error_button").click():document.getElementById("csp_manage_analogProduct_right_button").click()}}function cspModuleFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"jpg"!==d&&"png"!==d&&"bmp"!==d?document.getElementById("csp_module_file_tips_label").innerText="仅支持JPG,PNG,BMP格式的图片":document.getElementById("csp_module_file_commit").click()}}function cspManageImportLoadFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"csv"!==d&&"xlsx"!==d&&"xls"!==d?document.getElementById("csp_manage_import_file_error_btn").click():document.getElementById("csp_manage_import_file_load_btn").click()}}function cspCustomerImportLoadFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase(),console.log("yyyyyyyyyy",d)),"csv"!==d&&"xlsx"!==d&&"xls"!==d&&document.getElementById("csp_customer_import_file_error_btn").click()}}function cspModuleImgLoad(a){a.width>a.height?(a.style.width="auto",a.style.height="150px"):(a.style.width="150px",a.style.height="auto");var b=(150-a.width)/2+"px",c=(150-a.height)/2+"px";a.style.marginLeft=b,a.style.marginTop=c}function cspModuleBigImgLoad(a){console.log(window.innerWidth,window.innerHeight),console.log(a.src,a.width,a.height),a.width>=window.innerWidth&&a.height<window.innerHeight&&(console.log("宽缩小，高自动"),a.style.width="100%",a.style.height="auto"),a.width>=window.innerWidth&&a.height>=window.innerHeight&&(1e3*a.width/window.innerWidth>1e3*a.height/window.innerHeight?(console.log("宽缩小，高自动"),a.style.width="100%",a.style.height="auto"):(console.log("高缩小，宽自动"),a.style.width="auto",a.style.height="100%")),a.width<window.innerWidth&&a.height>=window.innerHeight&&(console.log("高缩小，宽自动"),a.style.width="auto",a.style.height="100%");var b=-a.width/2+"px",c=-a.height/2+"px";console.log(b,c),a.style.marginLeft=b,a.style.marginTop=c}function cspManageThemesMouseOver(a){a.style.backgroundColor="#d5d5d5"}function cspManageThemesMouseOut(a){a.style.backgroundColor="white"}function getMinimum(a){for(var b=a[0],c=1;c<a.length;c++)b>a[c]&&(b=a[c]);return b}function getMaximum(a){for(var b=a[0],c=1;c<a.length;c++)b<a[c]&&(b=a[c]);return b}function cspManageSpotLoadFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"csv"!==d&&"xlsx"!==d&&"xls"!==d?document.getElementById("csp_manage_spot_file_error_btn").click():document.getElementById("csp_manage_spot_file_load_btn").click()}}function cspManageFuturesLoadFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"csv"!==d&&"xlsx"!==d&&"xls"!==d?document.getElementById("csp_manage_futures_file_error_btn").click():document.getElementById("csp_manage_futures_file_load_btn").click()}}function loadStockFileChange(a){var b=a.value;if(""===b)document.getElementById("stockfile_error_btn").click();else{var c=b.split("."),d="";c.length>1?d=c[c.length-1].toLowerCase():document.getElementById("stockfile_error_btn").click(),"csv"!==d&&"xlsx"!==d&&"xls"!==d?document.getElementById("stockfile_error_btn").click():document.getElementById("stockfile_load_btn").click()}}function calculateIndexes(a,b,c){var d=[];a=a>b?b:a;var e=Math.round(a-c/2),f=Math.round(a+c/2);console.log("start",e,"end",f),e<1&&(e=1),f!=e+c-1&&(f=e+c-1),f>b&&(f=b),f-c+1<e&&(e=f-c+1>0?f-c+1:1);for(var g=e;g<=f;g++){var h={};h.page=g,g==a?h.select=!0:h.select=!1,d.push(h)}return console.log(d),d}function cspOperLoginBgChange(){window.innerHeight<=400?document.getElementById("csp_oper_login_html").style.height="400px":document.getElementById("csp_oper_login_html").style.height="100%"}function cspManageNewNoticeFileChange(a){var b=a.value;if(""===b)document.getElementById("csp_manage_newnotice_file_delete_button").click();else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase(),"pdf"===d&&document.getElementById("csp_manage_newnotice_file_right_button").click())}}function cspManageLoadUserLoadFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"csv"!==d&&"xlsx"!==d&&"xls"!==d?document.getElementById("csp_manage_futures_file_error_btn").click():document.getElementById("csp_manage_futures_file_load_btn").click()}}function cspManageLoadBoughtLoadFileChange(a){var b=a.value;if(""===b);else{var c=(b.substring(12),b.split(".")),d="";c.length>1&&(d=c[c.length-1].toLowerCase()),"csv"!==d&&"xlsx"!==d&&"xls"!==d?document.getElementById("csp_manage_loadbought_file_error_btn").click():document.getElementById("csp_manage_loadbought_file_load_btn").click()}}var cspApp=angular.module("cspApp",["cspRouters","cspCtrls","cspServices","cspFilters","oc.lazyLoad"]),cspCtrls=angular.module("cspCtrls",[]);cspCtrls.controller("AppCtrl",["$scope","$state","UserInfoService",function(a,b,c){a.currentUser=null,a.setCurrentUser=function(b){a.currentUser=b},a.$on("$stateChangeStart",function(a,b,c,d,e){"home"===b.name?($("#loginModal").remove(),$("#orderModal").remove()):"allProducts"===b.name?$("#allPro_orderModal").remove():"usercenter"===b.name&&$("#wechat_modal").remove()})}]),cspCtrls.controller("allocateStockCtrl",function(a,b){a.goTradeTeamManage=function(){b.go("tradeTeamManage")},a.allocateStockCtrlInit=function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",window.scrollTo(0,0)},a.goOperManage=function(){b.go("opermanage")}}),cspCtrls.controller("CommentCtrl",function(a,b,c,d,e,f,g,h){a.themes=[],a.showstate=0,a.commentpath="",a.currentTheme={},a.publishVersionData=[],a.publishTopic={},a.currentBigImg={},a.showBigImage=!1,a.timePromise=void 0,a.modulePages=[],a.moduleTotalPage=1,a.modulePageCount=10,a.moduleItemCount=10,a.moduleCurrentPage=1,a.moduleShowPrev=!1,a.moduleShowNext=!1,a.topicEdit=void 0,a.cspCommentInit=function(){var b=document.createElement("script");b.src="lib/ueditor.config.js",document.getElementsByTagName("head")[0].appendChild(b);var d=document.createElement("script");d.src="lib/editor_api.js",document.getElementsByTagName("head")[0].appendChild(d),document.getElementById("csp_header_comment_label").className="csp_header_label csp_header_active_label",document.getElementById("csp_header_comment_label2").className="csp_header_label2 csp_header_active_label2",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_home_label2").className="csp_header_label2",document.getElementById("csp_header_product_label2").className="csp_header_label2",document.getElementById("csp_header_product0_label").className="csp_header_label",document.getElementById("csp_header_product0_label2").className="csp_header_label2",document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",g.cspCheckLoginState({},function(b){"succeed"===b.result&&b.loginState===!0?(a.setHeaderName(b),g.cspCheckRiskState({},function(b){"succeed"===b.result?b.riskstate===!1?c.go("risklevel"):(a.commentpath="tpls/comment/themes.html",a.showstate=0):($("#loginModal").remove(),c.go("home"))})):($("#loginModal").remove(),c.go("home"))})},a.setHeaderName=function(a){h.getUserInfo(a,function(a){0!=a&&(7!=a.conlevel&&2!=a.conlevel&&1!=a.conlevel||(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display=""),document.getElementById("header_username").innerHTML=a.tel)})},a.cspcommentload=function(){if(window.scrollTo(0,0),0===a.showstate){a.themes=[{name:"csp",id:"1",description:"客服服务平台，贴心为您服务。您可以在这里留下您对CSP平台的意见及建议",piclink:"images/VCS.png",versions:[]},{name:"cms",id:"2",description:"您可以在这里留下您在使用CMS软件过程中遇到的问题或困难，以及您对CMS的意见及建议",piclink:"images/VCS.png",versions:[]},{name:"twd",id:"3",description:"您可以在这里留下您在使用TWD软件过程中遇到的问题或困难，以及您对TWD的意见及建议",piclink:"images/VCS.png",versions:[]}],document.getElementById("csp_comment_themes_waiting").style.display="none",document.getElementById("csp_comment_themes_content").style.display="block";var b=.8*document.documentElement.clientHeight,c=b+"px";document.getElementById("csp_comment_themes").style.minHeight=c}if(1===a.showstate){var b=.8*document.documentElement.clientHeight,c=b+"px";document.getElementById("csp_module_page").style.minHeight=c;var f={};f.modulename=a.currentTheme.name,a.moduleCurrentPage=1,f.page=a.moduleCurrentPage,f.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(f,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block";for(var e=[],f=0;f<b.data.length;f++){for(k=0;k<e.length&&e[k]!=b.data[f].version;k++);k>=e.length&&e.push(b.data[f].version)}a.currentTheme.versions=e,a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var g=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?g=1:(g=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-g+1<a.moduleItemCount&&(g=a.moduleTotalPage-a.moduleItemCount+1));for(var h=g;h<g+10&&!(h>a.moduleTotalPage||a.moduleTotalPage<=1);h++){var i={};i.num=h,h===a.moduleCurrentPage?i.select=!0:i.select=!1,a.modulePages.push(i)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"}),a.publishTopic.publishModule=a.currentTheme.name,a.publishTopic.loadimg=!1,a.publishTopic.pictures=[],a.publishTopic.publishVersion="",a.publishTopic.content="",a.publishTopic.versionerror=!1,void 0!==UE.delEditor?(UE.delEditor("topicEditor"),a.topicEdit=void 0,a.topicEdit=UE.getEditor("topicEditor",{toolbars:[["Undo","Redo","insertimage"]],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!0,elementPathEnabled:!1,maximumWords:1e3,initialFrameWidth:"100%",initialFrameHeight:300,zIndex:0,autoHeightEnabled:!1}),a.topicEdit.ready(function(){a.topicEdit.setContent("请输入您的意见或建议")}),a.topicEdit.addListener("contentChange",function(){a.publishTopic.content=a.topicEdit.getContent()})):(document.getElementById("editload").style.display="block",a.timePromise=void 0,a.timePromise=d(function(){void 0!==UE.delEditor&&(d.cancel(a.timePromise),a.timePromise=void 0,document.getElementById("editload").style.display="none",UE.delEditor("topicEditor"),a.topicEdit=void 0,a.topicEdit=UE.getEditor("topicEditor",{toolbars:[["Undo","Redo","insertimage"]],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!0,elementPathEnabled:!1,maximumWords:1e3,initialFrameWidth:"100%",initialFrameHeight:300,zIndex:0,autoHeightEnabled:!1}),a.topicEdit.ready(function(){a.topicEdit.setContent("请输入您的意见或建议")}),a.topicEdit.addListener("contentChange",function(){a.publishTopic.content=a.topicEdit.getContent()}))},1,1e6))}},a.cspCommentGoOpion=function(b){a.currentTheme=b,a.currentTheme.currentVersion="",a.commentpath="tpls/comment/module.html",a.showstate=1},a.cspBackToTheme=function(){a.currentTheme={},a.commentpath="tpls/comment/themes.html",a.showstate=0},a.cspReply=function(b){if(a.opions[b].show===!0)a.opions[b].show=!1;else{var c={};c.tid=a.opions[b].tid,e.cspCommentGetReplysByTid(c,function(c){if("succeed"===c.result){a.opions[b].rcount=c.data.length,a.opions[b].replys=c.data;for(var d=0;d<c.data.length;d++)""===c.data[d].rto?a.opions[b].replys[d].replyposter=!0:a.opions[b].replys[d].replyposter=!1;a.opions[b].show=!0,a.opions[b].currentReply.tid=a.opions[b].tid,a.opions[b].currentReply.reply_to="",a.opions[b].currentReply.error=!0,document.getElementById("replyarea"+b).placeholder=" 回复 ",document.getElementById("replyarea"+b).value=""}else alert("网络连接错误，请检查网络")})}},a.cspReplyTo=function(b,c){document.getElementById("replyarea"+b).placeholder=" 回复 "+a.opions[b].replys[c].rfrom,a.opions[b].currentReply.reply_to=a.opions[b].replys[c].uid,a.opions[b].currentReply.error=!0,document.getElementById("replyarea"+b).value=""},a.cspModuleReplyReady=function(b){a.opions[b].currentReply.error=!0},a.cspModuleReplayCommit=function(b){""===document.getElementById("replyarea"+b).value?a.opions[b].currentReply.error=!1:(a.opions[b].currentReply.content=document.getElementById("replyarea"+b).value,e.cspModuleAddReply(a.opions[b].currentReply,function(c){if("succeed"===c.result){var d={};d.tid=a.opions[b].tid,e.cspCommentGetReplysByTid(d,function(c){"succeed"===c.result?(a.opions[b].rcount=c.data.length,a.opions[b].replys=c.data,a.opions[b].show=!0,a.opions[b].currentReply.tid=a.opions[b].tid,a.opions[b].currentReply.reply_to=a.opions[b].uid,a.opions[b].currentReply.error=!0,document.getElementById("replyarea"+b).placeholder=" 回复 "+a.opions[b].username,document.getElementById("replyarea"+b).value=""):alert("网络连接错误，请检查网络")})}else alert("回复失败")}))},a.cspModuleSelectOpionsByVersion=function(b){if(window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候","undefined"==typeof b||""===b){var c={};c.modulename=a.currentTheme.name,a.moduleCurrentPage=1,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else{a.currentTheme.currentVersion=b;var d={};d.modulename=a.currentTheme.name,d.moduleversion=a.currentTheme.currentVersion,a.moduleCurrentPage=1,d.page=a.moduleCurrentPage,d.pageCount=a.modulePageCount,e.cspCommentSelectOpionsByVersion(d,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}},a.cspModulePublishOpion=function(){var a=document.getElementById("csp_module_publish_div").offsetTop;window.scrollTo(0,a-100)},a.cspModulePublishCancel=function(){var b={};b.filepath=a.publishTopic.pictures,b.count=a.publishTopic.pictures.length,e.cspCommentDeleteFile(b,function(a){}),$(".ui.long.small.modal.csp_module_publish_modal").modal("hide")},a.cspModuleSelectFile=function(){a.publishTopic.pictures.length>=6?document.getElementById("csp_module_file_tips_label").innerText="您最多只能上传6张图片":document.getElementById("csp_module_file_input").click()},a.cspModuleFileChange=function(){a.publishTopic.loadimg=!0,document.getElementById("csp_module_file_tips_label").innerText="";var b=new FormData,c=document.getElementById("csp_module_file_input").files[0];b.append("file",c),e.cspCommentUploadFile(b,function(b){document.getElementById("csp_module_file_form").reset(),"succeed"===b.result?(a.publishTopic.pictures.push(b.piclink),a.publishTopic.loadimg=!1):(a.publishTopic.loadimg=!1,document.getElementById("csp_module_file_tips_label").innerText="文件上传失败")})},a.cspDeletePic=function(b){var c={};c.filepath=a.publishTopic.pictures[b],c.count=1,e.cspCommentDeleteFile(c,function(c){"succeed"===c.result?a.publishTopic.pictures.splice(b,1):alert("删除文件失败，请检查网络连接")})},a.cspModulePublishVersionChange=function(){a.publishTopic.versionerror=!1},a.cspModulePublishCommit=function(){var b=!1;if("undefined"!=typeof a.publishTopic.content&&""!==a.publishTopic.content||(b=!0),"undefined"!=typeof a.publishTopic.publishVersion&&""!==a.publishTopic.publishVersion||(b=!0,a.publishTopic.versionerror=!0),b===!0);else{var c=a.publishTopic.content.match(/src=\"([^\"]*)\"/gi);if(null!==c)for(var d=0;d<c.length;d++)a.publishTopic.pictures[d]=c[d].substring(5,c[d].length-1);var f={};f.content=a.topicEdit.getContentTxt(),f.anonymous="0",f.app=a.publishTopic.publishModule,f.version=a.publishTopic.publishVersion,f.imglink=a.publishTopic.pictures.join(","),e.cspCommentAddOpion(f,function(b){if("succeed"===b.result){a.publishTopic.publishModule=a.currentTheme.name,a.publishTopic.loadimg=!1,a.publishTopic.pictures=[],a.publishTopic.publishVersion="",a.publishTopic.content="",a.publishTopic.versionerror=!1,a.topicEdit.setContent("请输入您的问题或建议"),window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var c={};c.modulename=a.currentTheme.name,a.moduleCurrentPage=1,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else alert("发布失败")})}},a.cspModuleAddLike=function(b){var c={};c.tid=a.opions[b].tid,e.cspCommentAddLike(c,function(c){"succeed"===c.result?(a.opions[b].uplike=!a.opions[b].uplike,a.opions[b].ucount=a.opions[b].ucount+1,a.opions[b].likeid=c.likeid):alert("操作失败")})},a.cspModuleCancelLike=function(b){var c={};c.likeid=a.opions[b].likeid,e.cspCommentCancelLike(c,function(c){"succeed"===c.result?(a.opions[b].uplike=!a.opions[b].uplike,a.opions[b].ucount=a.opions[b].ucount-1):alert("操作失败")})},a.cspModuleShowBigImg=function(b,c){console.log(b,c),document.getElementById("csp_module_big_img_show").style.width="auto",document.getElementById("csp_module_big_img_show").style.height="auto",a.currentBigImg.count=a.opions[b].pictures.length,a.currentBigImg.nowindex=c,a.currentBigImg.pictures=a.opions[b].pictures,a.currentBigImg.bigImgSrc=a.opions[b].pictures[c],a.currentBigImg.tipShow=!1,a.currentBigImg.tipContent="",0===c?a.currentBigImg.prevTitle="当前已经是第一张":a.currentBigImg.prevTitle="上一张",a.currentBigImg.count===c+1?a.currentBigImg.nextTitle="当前已经是最后一张":a.currentBigImg.nextTitle="下一张",a.showBigImage=!0},a.cspModuleShowPreImg=function(){0===a.currentBigImg.nowindex?(a.currentBigImg.tipContent="当前已经是第一张",a.currentBigImg.tipShow=!0,a.timePromise=void 0,a.timePromise=d(function(){d.cancel(a.timePromise),a.timePromise=void 0,a.currentBigImg.tipShow=!1},1e3,100)):(document.getElementById("csp_module_big_img_show").style.width="auto",document.getElementById("csp_module_big_img_show").style.height="auto",a.currentBigImg.nowindex=a.currentBigImg.nowindex-1,a.currentBigImg.bigImgSrc=a.currentBigImg.pictures[a.currentBigImg.nowindex],0===a.currentBigImg.nowindex?a.currentBigImg.prevTitle="当前已经是第一张":a.currentBigImg.prevTitle="上一张",a.currentBigImg.count===a.currentBigImg.nowindex+1?a.currentBigImg.nextTitle="当前已经是最后一张":a.currentBigImg.nextTitle="下一张")},a.cspModuleShowNextImg=function(){a.currentBigImg.nowindex===a.currentBigImg.count-1?(a.currentBigImg.tipContent="当前已经是最后一张",a.currentBigImg.tipShow=!0,a.timePromise=void 0,a.timePromise=d(function(){d.cancel(a.timePromise),a.timePromise=void 0,a.currentBigImg.tipShow=!1},1e3,100)):(document.getElementById("csp_module_big_img_show").style.width="auto",document.getElementById("csp_module_big_img_show").style.height="auto",a.currentBigImg.nowindex=a.currentBigImg.nowindex+1,a.currentBigImg.bigImgSrc=a.currentBigImg.pictures[a.currentBigImg.nowindex],0===a.currentBigImg.nowindex?a.currentBigImg.prevTitle="当前已经是第一张":a.currentBigImg.prevTitle="上一张",a.currentBigImg.count===a.currentBigImg.nowindex+1?a.currentBigImg.nextTitle="当前已经是最后一张":a.currentBigImg.nextTitle="下一张")},a.cspModuleShowBackClick=function(){a.showBigImage=!1},a.cspModuleShowContentClick=function(a){a.stopPropagation()},a.cspModuleShowBigClose=function(b){a.showBigImage=!1,b.stopPropagation()},a.cspModuleLoopToPage=function(b){if(b.num===a.moduleCurrentPage);else if(""===a.currentTheme.currentVersion){window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var c={};c.modulename=a.currentTheme.name,a.moduleCurrentPage=b.num,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else{window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var d={};d.modulename=a.currentTheme.name,d.moduleversion=a.currentTheme.currentVersion,a.moduleCurrentPage=b.num,d.page=a.moduleCurrentPage,d.pageCount=a.modulePageCount,e.cspCommentSelectOpionsByVersion(d,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}},a.cspModuleLoopToFirst=function(){if(1===a.moduleCurrentPage);else if(""===a.currentTheme.currentVersion){window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var b={};b.modulename=a.currentTheme.name,a.moduleCurrentPage=1,b.page=a.moduleCurrentPage,b.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(b,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else{window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var c={};c.modulename=a.currentTheme.name,c.moduleversion=a.currentTheme.currentVersion,a.moduleCurrentPage=1,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionsByVersion(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}},a.cspModuleLoopPrev=function(){if(1===a.moduleCurrentPage);else if(""===a.currentTheme.currentVersion){window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var b={};b.modulename=a.currentTheme.name,a.moduleCurrentPage=a.moduleCurrentPage-1,b.page=a.moduleCurrentPage,b.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(b,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];
var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else{window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var c={};c.modulename=a.currentTheme.name,c.moduleversion=a.currentTheme.currentVersion,a.moduleCurrentPage=a.moduleCurrentPage-1,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionsByVersion(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}},a.cspModuleLoopNext=function(){if(a.moduleCurrentPage===a.moduleTotalPage);else if(""===a.currentTheme.currentVersion){window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var b={};b.modulename=a.currentTheme.name,a.moduleCurrentPage=a.moduleCurrentPage+1,b.page=a.moduleCurrentPage,b.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(b,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else{window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var c={};c.modulename=a.currentTheme.name,c.moduleversion=a.currentTheme.currentVersion,a.moduleCurrentPage=a.moduleCurrentPage+1,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionsByVersion(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}},a.cspModuleLoopLast=function(){if(a.moduleCurrentPage===a.moduleTotalPage);else if(""===a.currentTheme.currentVersion){window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var b={};b.modulename=a.currentTheme.name,a.moduleCurrentPage=a.moduleTotalPage,b.page=a.moduleCurrentPage,b.pageCount=a.modulePageCount,e.cspCommentSelectOpionByModule(b,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}else{window.scrollTo(0,0),document.getElementById("csp_module_waiting").style.display="block",document.getElementById("csp_module_show").style.display="none",document.getElementById("csp_module_waiting_label").innerText="数据加载中，请稍候";var c={};c.modulename=a.currentTheme.name,c.moduleversion=a.currentTheme.currentVersion,a.moduleCurrentPage=a.moduleTotalPage,c.page=a.moduleCurrentPage,c.pageCount=a.modulePageCount,e.cspCommentSelectOpionsByVersion(c,function(b){if("succeed"===b.result)if(0===b.data.length)document.getElementById("csp_module_waiting_label").innerText="未查询到相关数据";else{a.opions=b.data;for(var c=0;c<b.data.length;c++){var d=b.data[c].imglink.split(",");1===d.length&&""===d[0]?a.opions[c].pictures=[]:a.opions[c].pictures=d,b.data[c].likeid===-1?a.opions[c].uplike=!1:a.opions[c].uplike=!0,a.opions[c].replys=[],a.opions[c].show=!1,a.opions[c].currentReply={}}document.getElementById("csp_module_waiting").style.display="none",document.getElementById("csp_module_show").style.display="block",a.moduleTotalPage=Math.ceil(b.count/a.modulePageCount),a.modulePages=[];var e=1;a.moduleCurrentPage<=Math.ceil(a.moduleItemCount/2)||a.moduleTotalPage<=a.moduleItemCount?e=1:(e=a.moduleCurrentPage-Math.ceil(a.moduleItemCount/2)+1,a.moduleTotalPage-e+1<a.moduleItemCount&&(e=a.moduleTotalPage-a.moduleItemCount+1));for(var f=e;f<e+10&&!(f>a.moduleTotalPage||a.moduleTotalPage<=1);f++){var g={};g.num=f,f===a.moduleCurrentPage?g.select=!0:g.select=!1,a.modulePages.push(g)}a.moduleTotalPage<=1?(a.moduleShowPrev=!1,a.moduleShowNext=!1):(a.moduleShowPrev=!0,a.moduleShowNext=!0)}else document.getElementById("csp_module_waiting_label").innerText="查询失败，请检查网络连接"})}}}),cspCtrls.filter("htmlContent",function(a){return function(b){return a.trustAsHtml(b)}}),cspCtrls.controller("customerGroupCtrl",function(a,b,c,d,e,f){function g(){console.log(this.title,a.newGroupName)}a.customerAmount=0,a.customerStatus={customerAddInfo:1,customerGroupInfo:0,addSuccess:0},a.groups=[],a.selectedGroups=[],a.operCustomerid=[],a.operCustomerGroupid=[],a.selectedGroupsBack=[],a.newCustomerInfo={tel:"",email:"",tname:""},a.editCustomerInfo={tel:"",email:"",tname:""},a.editCustomerInfoBack={tel:"",email:"",tname:""},a.ctrlScope=a,a.cspCustomerLoadPath="",a.cspAddCustomerLoadPath="",a.customerInfo=[],a.newGroupName="",a.newGroupDesc="",a.selectedCustomers=[],a.currGroupID="",a.currGroupCustomers=[],a.editingGroup=!1,a.selectImportGroup={},a.fileError=!1,a.errorTip="",a.cspBackManage=function(){b.go("managecenter")},a.overGroup=function(a){a.showArrowRight=!0},a.outGroup=function(a){a.showArrowRight=!1},a.overCustomer=function(a){a.showArrowRight=!0},a.outCustomer=function(a){a.showArrowRight=!1},a.goCustomer=function(b){$(".groupDiv2").removeClass("activeItem"),$(b.target).parent().addClass("activeItem"),e.getCustomerInfo({},function(b){a.customerInfo=b,a.customerAmount=a.customerInfo.length,a.operCustomerid=[],a.operCustomerGroupid=[],a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html",$(".groupOper").css("display","none")})},a.showError=function(b){$("html,body").scrollTop(0),document.getElementById("errorReason").innerHTML=b,document.getElementById("errorMessage").style.display="",a.timeout&&c.cancel(a.timeout),a.timeout=c(function(){document.getElementById("errorMessage").style.display="none"},5e3)},a.clickGroup=function(b,c){if($(".groupDiv2").removeClass("activeItem"),$(c.target).parent().addClass("activeItem"),$(".groupDiv2").removeClass("activeItem"),$(c.target).parent().addClass("activeItem"),b==-1){var d={gid:b};e.getCustomers(d,function(b){a.customerInfo=b,a.operCustomerid=[],a.operCustomerGroupid=[],a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html",$(".groupOper").css("display","block")})}else{a.currGroupID=b;var f={gid:""};f.gid=b,e.getSpecialGroupCus(f,function(b){a.customerInfo=b,a.operCustomerid=[],a.operCustomerGroupid=[],a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html",$(".groupOper").css("display","block")})}a.getAllGroup()},a.importCustomer=function(){e.getAllGroup("",function(b){if(0!=b){a.groups=b;var c={};c.gid=-1,c.gname="默认未分组",a.groups.push(c),a.selectImportGroup=a.groups[a.groups.length-1],a.cspCustomerLoadPath="tpls/customerGroup/customerImport.html"}})},a.outPut=function(b){console.log("output",b),a.selectImportGroup=b},a.cspCustomerImportFileError=function(){a.fileError=!0,a.errorTip="选择文件格式错误"},a.cspCustomerImportSubmit=function(){var b=new FormData,c=document.getElementById("csp_customer_import_file_load_input").files[0];b.append("file",c),e.customerImport(b,function(b){if("succeed"===b.result)if(b.file===!0){for(var c=0,d=1;d<b.data.length;d++)b.data[d].tname||(c=1);if(c)a.fileError=!0,a.errorTip="文件中有姓名为空，无法录入";else{console.log("res.data.length",b.data.length);for(var d=0;d<b.data.length;d++)!function(a){var c={tname:"",tel:"",email:""};c.tname=b.data[a].tname,c.tel=b.data[a].tel,c.email=b.data[a].email,e.addNewCustomerSure(c,function(a){})}(d);a.selectImportGroup.gid>0&&e.getNewestCustomerid("",function(c){for(var d=0;d<b.data.length;d++)!function(b){var d={customerid:"",gid:""};d.customerid=c.id-b,d.gid=a.selectImportGroup.gid,e.addNewCustomerGroup(d,function(a){})}(d)})}a.fileError=!0,a.errorTip="数据上传成功",setTimeout(function(){a.fileError=!1,a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},1e3)}else a.fileError=!0,a.errorTip="文件内容格式错误";else a.fileError=!0,a.errorTip="文件上传失败"})},a.cspCustomerImportUnload=function(){a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},a.addNewCustomer=function(){a.cspCustomerLoadPath="tpls/customerGroup/addNewCustomer.html",a.selectedGroups=[],a.customerStatus.customerAddInfo=1,a.customerStatus.customerGroupInfo=0,a.customerStatus.addSuccess=0},a.newCustomerGroup=function(){a.customerStatus.customerAddInfo=0,a.customerStatus.customerGroupInfo=1,e.getAllGroup("",function(b){0!=b&&(a.groups=b)})},a.isChecked=function(b){return a.selectedGroups.indexOf(b)>=0},a.updateSelection=function(b,c){var d=b.target,e=d.checked;if(e)a.selectedGroups.push(c);else{var f=a.selectedGroups.indexOf(c);a.selectedGroups.splice(f,1)}},a.isCheckedCustomer=function(b){return a.operCustomerid.indexOf(b)>=0},a.updateSelectionCustomer=function(b,c){var d=b.target,e=d.checked;if(e)a.operCustomerid.push(c);else{var f=a.operCustomerid.indexOf(c);a.operCustomerid.splice(f,1)}},a.isCheckedAll=function(b,c){var d=b.target,e=d.checked;if(e)for(var f=0;f<c.length;f++)a.operCustomerid.push(c[f].customerid);else a.operCustomerid=[],a.operCustomerGroupid=[]},a.copToGroup=function(){a.operCustomerid.length?e.getAllGroup("",function(b){0!=b&&(a.groups=b,a.cspCustomerLoadPath="tpls/customerGroup/groupInfo.html",a.selectedGroups=[])}):($(".unChooseTips").css("display","block"),setTimeout(function(){$(".unChooseTips").css("display","none")},2e3))},a.copyToGroup=function(){if(a.selectedGroups.length){for(var b=0;b<a.operCustomerid.length;b++)for(var c=0;c<a.selectedGroups.length;c++){var d={customerid:"",gid:""};d.customerid=a.operCustomerid[b],d.gid=a.selectedGroups[c],console.log("999999",d),e.addNewCustomerGroup(d,function(a){})}a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"}},a.notCopyandBack=function(){a.operCustomerid=[],a.operCustomerGroupid=[],a.selectedGroups=[],a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},a.ediCustomer=function(){if(a.operCustomerid.length)if(1!=a.operCustomerid.length)$(".errorChooseTips").css("display","block"),setTimeout(function(){$(".errorChooseTips").css("display","none")},2e3);else{var b={customerid:""};b.customerid=a.operCustomerid[0],e.getEditCustomerInfo(b,function(b){a.editCustomerInfo.tname=b.tname,a.editCustomerInfo.tel=b.tel,a.editCustomerInfo.email=b.email,a.editCustomerInfoBack.tname=b.tname,a.editCustomerInfoBack.tel=b.tel,a.editCustomerInfoBack.email=b.email,a.cspCustomerLoadPath="tpls/customerGroup/editCustomerInfo.html"})}else $(".unChooseTips").css("display","block"),setTimeout(function(){$(".unChooseTips").css("display","none")},2e3)},a.delCustomer=function(){a.operCustomerid.length?jQuery(".csp_delete").modal("show"):($(".unChooseTips").css("display","block"),setTimeout(function(){$(".unChooseTips").css("display","none")},2e3))},a.noDelete=function(){jQuery(".csp_delete").modal("hide")},a.deleteConfirm=function(){for(var b=0;b<a.operCustomerid.length;b++)!function(b){var c={customerid:""};c.customerid=a.operCustomerid[b],e.delCustomer(c,function(a){})}(b);jQuery(".csp_delete").modal("hide"),a.refreshCustomer()},a.editCustomerGroup=function(){var b={customerid:""};b.customerid=a.operCustomerid[0],e.getEditCustomerGroupInfo(b,function(b){e.getAllGroup("",function(c){if(0!=b){a.groups=c,a.cspCustomerLoadPath="tpls/customerGroup/editCustomerGroupInfo.html",a.selectedGroups=[],a.selectedGroupsBack=[];for(var d=0;d<b.length;d++)a.selectedGroups.push(b[d].gid),a.selectedGroupsBack.push(b[d].gid)}})})},a.editGroupSure=function(){a.cspCustomerLoadPath="tpls/customerGroup/editCustomerInfo.html"},a.unEditGroupandBack=function(){if(a.selectedGroups=[],a.selectedGroupsBack.length)for(var b=0;b<a.selectedGroupsBack.length;b++)a.selectedGroups.push(a.selectedGroupsBack[b]);a.cspCustomerLoadPath="tpls/customerGroup/editCustomerInfo.html"},a.editCustomerSure=function(){var b={customerid:"",tel:"",tname:"",email:""};b.customerid=a.operCustomerid[0],b.tel=a.editCustomerInfo.tel,b.tname=a.editCustomerInfo.tname,b.email=a.editCustomerInfo.email;var c=a.selectedGroups.sort().toString(),d=a.selectedGroupsBack.sort().toString();if(b.tel!=a.editCustomerInfoBack.tel||b.tname!=a.editCustomerInfoBack.tname||b.email!=a.editCustomerInfoBack.email)c==d?e.editCustomerSure(b,function(a){}):e.editCustomerSure(b,function(b){for(var c=0;c<a.selectedGroupsBack.length;c++)!function(b){var c=a.selectedGroups.indexOf(a.selectedGroupsBack[b]);if(c<0){var d={customerid:"",gid:""};d.customerid=a.operCustomerid[0],d.gid=a.selectedGroupsBack[b],console.log("gid0000000",d.gid),e.deleteCustomerGroupInfo(d,function(a){})}}(c);for(var d=0;d<a.selectedGroups.length;d++)!function(b){var c=a.selectedGroupsBack.indexOf(a.selectedGroups[b]);if(c<0){var d={customerid:"",gid:""};d.customerid=a.operCustomerid[0],d.gid=a.selectedGroups[b],console.log("gid0000000dd",d.gid),e.addNewCustomerGroup(d,function(a){})}}(d)});else if(c!=d){for(var f=0;f<a.selectedGroupsBack.length;f++)!function(b){var c=a.selectedGroups.indexOf(a.selectedGroupsBack[b]);if(c<0){var d={customerid:"",gid:""};d.customerid=a.operCustomerid[0],d.gid=a.selectedGroupsBack[b],console.log("gid0000000",d.gid),e.deleteCustomerGroupInfo(d,function(a){})}}(f);for(var g=0;g<a.selectedGroups.length;g++)!function(b){var c=a.selectedGroupsBack.indexOf(a.selectedGroups[b]);if(c<0){var d={customerid:"",gid:""};d.customerid=a.operCustomerid[0],d.gid=a.selectedGroups[b],console.log("gid0000000dd",d.gid),e.addNewCustomerGroup(d,function(a){})}}(g)}a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},a.unEditGroupandBack=function(){a.selectedGroups=[],a.selectedGroupsBack=[],a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},a.groupSave=function(){a.customerStatus.customerAddInfo=1,a.customerStatus.customerGroupInfo=0},a.groupNotSave=function(){a.selectedGroups=[],a.customerStatus.customerAddInfo=1,a.customerStatus.customerGroupInfo=0},a.checkField=function(){$(".addNewCustomerTip").css("display","none")},a.addNewCustomerSure=function(b){""==a.newCustomerInfo.tname?$(".addNewCustomerTip").css("display","inline-block"):e.addNewCustomerSure(a.newCustomerInfo,function(b){console.log(a.selectedGroups.length),a.selectedGroups.length?e.getNewestCustomerid("",function(b){for(var c=0;c<a.selectedGroups.length;c++){var d={customerid:"",gid:""};d.customerid=b.id,d.gid=a.selectedGroups[c],console.log("999999",d),e.addNewCustomerGroup(d,function(a){})}a.customerStatus.customerAddInfo=0,a.customerStatus.customerGroupInfo=0,a.customerStatus.addSuccess=1}):(a.customerStatus.customerAddInfo=0,a.customerStatus.customerGroupInfo=0,a.customerStatus.addSuccess=1)})},a.cancelAddNewCustomer=function(){a.newCustomerInfo={tel:"",email:"",tname:""},a.selectedGroups=[],a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},a.refreshCustomer=function(){e.getCustomerInfo({},function(b){a.customerInfo=b,a.customerAmount=a.customerInfo.length,a.operCustomerid=[]})},a.sendMessage=function(){var c={};c.messageType="sendMessage",e.selectedCustomers=a.operCustomerid,console.log("messageService 选中的人员",e.selectedCustomers),f.setMessageType(c,function(a){0!=a.result&&b.go("sendMessage")})},a.newGroup=function(){a.editingGroup=!1,a.cspCustomerLoadPath="tpls/customerGroup/groupDetails.html",a.newGroupName="",a.newGroupDesc="",a.selectedCustomers=[],a.currGroupCustomers=[]},a.clearSelectedCustomer=function(){a.selectedCustomers=[]},a.goEditGroup=function(b){if(b!=-1){a.editingGroup=!0,a.cspCustomerLoadPath="tpls/customerGroup/groupDetails.html",a.selectedCustomers=[],a.getGroupinfo(b);var c={gid:b};e.getCustomers(c,function(b){0!=b&&(a.selectedCustomers=b,a.currGroupCustomers=b.slice(0,b.length),console.log("$scope.currGroupCustomers",a.currGroupCustomers))})}},a.saveCreateGroup=function(){var b={};b.gname=a.newGroupName,b.gdesc=a.newGroupDesc,b.customers=a.selectedCustomers,console.log(b),e.createGroup(b,function(b){return 0==b.result?void a.showError(b.reason):(a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html",void console.log("saveCreateGroup",b))})},a.saveEditGroup=function(){if(0!=a.currGroupID){var b={};b.gname=a.newGroupName,b.gdesc=a.newGroupDesc,b.gid=a.currGroupID,b.addCustomers=[],b.delCustomers=[];a.selectedCustomers;console.log("$scope.currGroupCustomers",a.currGroupCustomers);for(var c=0;c<a.selectedCustomers.length;c++){for(var d=!1,f=0;f<a.currGroupCustomers.length;f++)if(a.currGroupCustomers[f].customerid==a.selectedCustomers[c].customerid){d=!0;break}d||b.addCustomers.push(a.selectedCustomers[c].customerid)}for(var f=0;f<a.currGroupCustomers.length;f++){for(var g=!1,c=0;c<a.selectedCustomers.length;c++)if(a.currGroupCustomers[f].customerid==a.selectedCustomers[c].customerid){g=!0;break}g||b.delCustomers.push(a.currGroupCustomers[f].customerid)}b.addLength=b.addCustomers.length,b.delLength=b.delCustomers.length,e.saveEditGroup(b,function(b){return 0==b.result?void a.showError(b.reason):(a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html",void console.log(b))})}},a.cancelCreateGroup=function(){a.newGroupName="",a.newGroupDesc="",a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html"},a.removeGroup=function(b){var c={gid:b};console.log(b),e.removeGroup(c,function(b){return 0==b?void a.showError(b.reason):(a.getAllGroup(),void console.log("removeGroup",b))})},a.editGroup=function(a){var b={gid:a};console.log(a),e.editGroup(b,function(a){0!=a&&console.log("editGroup",a)})},a.getAllGroup=function(){e.getAllGroup("",function(b){if(0!=b){console.log("getAllGroup",b),a.allGroup=b;var c={};c.gid=-1,c.gname="未分组",e.getUngroupedAmount("",function(b){console.log("getAllGroup",b,0==b.result),0!=b.result&&(c.customerAmount=b.customerAmount,a.allGroup.push(c),console.log(a.allGroup))})}})},a.getGroupinfo=function(b){var c={gid:b};console.log("getGroupinfo",c),e.getGroupinfo(c,function(b){0!=b&&(a.newGroupName=b.gname,a.newGroupDesc=b.gdesc)})},a.getCustomersToDetail=function(b){for(var c=0;c<a.allGroup.length;c++)if(a.allGroup[c].gid==b){if(1==a.allGroup[c].show)return void(a.allGroup[c].show=!1);a.allGroup[c].show=!0;break}if(!a.allGroup[c].haveData){var d={gid:b};e.getCustomers(d,function(c){if(0!=c)for(var d=0;d<a.allGroup.length;d++)if(a.allGroup[d].gid==b){a.allGroup[d].customers=[];for(var e=0;e<c.length;e++)a.allGroup[d].customers.push(c[e]);a.allGroup[d].haveData=!0;break}})}},a.createCustomerList=function(a,b){var c={gid:a};e.getCustomers(c,function(a){if(0!=a){console.log(b.target);var c=$(b.target).parent()[0];console.log(c);for(var d=document.createElement("ul"),e=0;e<a.length;e++){var f=document.createElement("li"),h=document.createElement("div");h.innerHTML=a[e].tname,h.title='"'+a[e].tname+'"<'+a[e].tel+">",h.onclick=g,f.appendChild(h),d.appendChild(f)}c.appendChild(d)}})},a.addSelectedCustomer=function(b){for(var c=0;c<a.selectedCustomers.length;c++)if(a.selectedCustomers[c].customerid==b.customerid)return;a.selectedCustomers.push(b)},a.addSelectedGroup=function(b,c){c.stopPropagation();var d={};d.gid=b,console.log(d,b),e.getCustomers(d,function(b){if(0!=b.result)for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.selectedCustomers.length;e++)if(a.selectedCustomers[e].customerid==b[c].customerid){d=!0;break}d||a.selectedCustomers.push(b[c])}})},a.removeSelectedCustomer=function(b){for(var c=0;c<a.selectedCustomers.length;c++)if(a.selectedCustomers[c].customerid==b){a.selectedCustomers.splice(c,1);break}console.log(a.selectedCustomers,a.currGroupCustomers)},a.customerGroupCtrlInit=function(){document.getElementById("homeSpaceDiv_37px").style.display="none",d.cspCheckLoginState({},function(c){"succeed"===c.result&&c.loginState?d.cspCheckAuth({},function(c){"succeed"===c.result?a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html":b.go("usercenter")}):($("#loginModal").remove(),b.go("home"))})},$(document).ready(function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",a.getAllGroup(),console.log(e.selectedCustomers),e.getCustomerInfo({},function(b){a.customerInfo=b,a.customerAmount=a.customerInfo.length,a.operCustomerid=[],a.operCustomerGroupid=[]})})}),cspCtrls.controller("cspGroupExchangeCtrl",function(a,b,c,d,e){a.cookieinfo={},a.groupchangestate=-1,a.groupchangepath="",a.groupchangepage={},a.gidgroups=[],a.gidtreegroups=[],a.groupchangemodalpath="",a.groupchangemodalstate=0,a.groupmodalmenu={},a.showmodal=!1,a.loadinginfo={},a.groupchangeinfo={},a.exchangeNews=[],a.allocateSecurities=[],a.changeSecurities=[],a.allocate_total_amt=0,a.available_total_amt=0,a.total_heaver_bp=0,a.exchangeSecuritiesIndex=-1,a.gid=-1,a.cspGroupExchangeInit=function(){if(document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",a.groupchangepage.groupExchange=1,document.cookie||navigator.cookieEnabled){a.cookieinfo.exist=!1;for(var c="cspOperLoginInfo=",e=document.cookie.split(";"),f=0;f<e.length;f++){var g=e[f].trim();if(0==g.indexOf(c)){a.cookieinfo.cookieExist=!0;var h=JSON.parse(unescape(g.substring(c.length,g.length)));a.cookieinfo.login_maid=h.maid,a.cookieinfo.login_oid=h.oid,a.cookieinfo.login_pass=h.password;break}}d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?(a.loadinginfo.loading=!1,a.loadinginfo.error=!1,a.loadinginfo.errorString="",a.groupmodalmenu.tipsmodal=1,a.groupmodalmenu.tipsmodalpath="tpls/groupexchange/groupexchangetip.html",a.groupmodalmenu.askchangemodal=2,a.groupmodalmenu.askchangemodalpath="tpls/groupexchange/askchange.html",a.groupmodalmenu.readchangenews=3,a.groupmodalmenu.readchangemodalpath="tpls/groupexchange/readchangenews.html",d.cspOperCheckGroupAndGetList({useparams:0},function(b){"succeed"==b.result?(a.gidgroups.splice(0,a.gidgroups.length),a.gidgroups=b.data,a.groupchangestate=a.groupchangepage.groupExchange,a.groupchangepath="tpls/groupexchange/groupexchange.html"):alert(b.reason)})):b.go("operlogin")})}else alert("浏览器未开启cookie,网站可能无法正常使用"),b.go("operlogin")},a.cspGroupExchangeLoadReady=function(){switch(a.groupchangestate){case a.groupchangepage.groupExchange:jQuery("#csp_group_change_table").droppable({drop:function(b,c){a.$apply(function(){a.cspGroupExchangeShowModal(a.groupmodalmenu.tipsmodal),a.loadinginfo.error=!1,a.loadinginfo.errorString="操作中...";var b={};b.gid=a.allocateSecurities[a.exchangeSecuritiesIndex].gid,b.gname=a.allocateSecurities[a.exchangeSecuritiesIndex].gname,b.cid=a.allocateSecurities[a.exchangeSecuritiesIndex].cid,b.code=a.allocateSecurities[a.exchangeSecuritiesIndex].code,b.cname=a.allocateSecurities[a.exchangeSecuritiesIndex].cname,b.last=a.allocateSecurities[a.exchangeSecuritiesIndex].last,b.post_exchange_vol=a.allocateSecurities[a.exchangeSecuritiesIndex].available_vol,b.post_exchange_amt=a.allocateSecurities[a.exchangeSecuritiesIndex].available_amt,b.stat=a.allocateSecurities[a.exchangeSecuritiesIndex].stat,b.trid=a.allocateSecurities[a.exchangeSecuritiesIndex].trid,a.cspTableDrop(b)})}}),a.exchangeSecuritiesIndex=-1;for(var c=0;c<a.gidgroups.length;c++){var f=0;for(f=0;f<a.gidtreegroups.length&&a.gidtreegroups[f].caid!=a.gidgroups[c].caid;f++);if(f>=a.gidtreegroups.length){var g={};g.caid=a.gidgroups[c].caid,g.caname=a.gidgroups[c].caname,a.gidtreegroups.push(g)}}for(var h=0;h<a.gidtreegroups.length;h++){a.gidtreegroups[h].children=[];for(var i=0;i<a.gidgroups.length;i++)a.gidtreegroups[h].caid==a.gidgroups[i].caid&&a.gidtreegroups[h].children.push(a.gidgroups[i])}jQuery("#csp_group_exchange_float_dropdown").dropdown({onChange:function(c,f,g){""!=c&&d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){a.gid=c;var f={};f.gid=c,f.trid=a.cspGetTrid(c),e.cspGroupExchangeGetGroupInfoAndStock(f,function(b){"succeed"==b.result?(a.allocateSecurities.splice(0,a.allocateSecurities.length),a.changeSecurities.splice(0,a.changeSecurities.length),a.allocateSecurities=b.allocate_data,a.changeSecurities=b.exchange_data,a.allocate_total_amt=b.allocate_total_amt,a.available_total_amt=b.available_total_amt,a.total_heaver_bp=b.total_heaver_bp):alert("获取数据失败")})}else b.go("operlogin")})},on:"hover"})}},a.cspGetTrid=function(b){for(var c=0;c<a.gidgroups.length;c++)if(b==a.gidgroups[c].gid)return a.gidgroups[c].trid;return""},a.cspGroupExchangeShowModal=function(b){switch(b){case a.groupmodalmenu.tipsmodal:a.groupchangemodalpath=a.groupmodalmenu.tipsmodalpath;break;case a.groupmodalmenu.askchangemodal:a.groupchangemodalpath=a.groupmodalmenu.askchangemodalpath;break;case a.groupmodalmenu.readchangenews:a.groupchangemodalpath=a.groupmodalmenu.readchangemodalpath}a.groupchangemodalstate=b,a.showmodal=!0},a.cspGroupExchangeHideModal=function(){a.showmodal=!0,a.groupchangemodalpath="",a.groupchangemodalstate=0},a.cspGroupexchangeModalLoad=function(){switch(a.groupchangemodalstate){case a.groupmodalmenu.tipsmodal:break;case a.groupmodalmenu.askchangemodal:}},a.drapaa=function(){if(a.gid!=-1){var b={};b.data=[];for(var c=0;c<10;c++){var d={gid:a.gid,cid:String(Math.ceil(1e6*Math.random())),cname:"股票"+c,available_vol:Math.ceil(1e4*Math.random()),post_allocated_vol:Math.ceil(1e4*Math.random()),value:Math.ceil(10*Math.random()),stat:0,trid:a.cspGetTrid(a.gid)};b.data.push(d)}e.writedb(b,function(a){console.log(a)})}},a.cspHoldtr=function(b){var c="#as_"+b;$(c).draggable({cursor:"move",cursorAt:{top:-2,left:-2},helper:"clone",start:function(){a.exchangeSecuritiesIndex=b}})},a.cspGetStockAndPool=function(b){var c={};c.gid=b,c.trid=a.cspGetTrid(b),e.cspGroupExchangeGetGroupStock(c,function(b){"succeed"==b.result?(a.allocateSecurities.splice(0,a.allocateSecurities.length),a.changeSecurities.splice(0,a.changeSecurities.length),a.allocateSecurities=b.data,a.changeSecurities=b.data1):alert("获取数据失败")})},a.cspCheckDrop=function(b){for(var c=0;c<a.changeSecurities.length;c++)if(a.changeSecurities[c].gid==b.gid&&a.changeSecurities[c].cid==b.cid)return!0;return!1},a.cspTableDrop=function(f){if(1==a.cspCheckDrop(f)){a.loadinginfo.error=!0,a.loadinginfo.errorString="已经在券池中了";var g=1,h=c(function(){g<=0?(c.cancel(h),a.cspGroupExchangeHideModal()):g--},500,100)}else d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspGroupExchangeAddExchange(f,function(b){if("succeed"==b.result)a.changeSecurities.push(f),a.cspGroupExchangeHideModal(),a.cspGetStockAndPool(a.gid);else{a.loadinginfo.error=!0,a.loadinginfo.errorString=b.reason;var d=1,e=c(function(){d<=0?(c.cancel(e),a.cspGroupExchangeHideModal()):d--},500,100)}}):b.go("operlogin")})},a.cspGroupExchangeDeleteExchange=function(f){a.cspGroupExchangeShowModal(a.groupmodalmenu.tipsmodal),a.loadinginfo.error=!1,a.loadinginfo.errorString="操作中...",d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){var g={};g.gid=a.changeSecurities[f].gid,g.cid=a.changeSecurities[f].cid,e.cspGroupExchangeDeleteExchange(g,function(b){if("succeed"==b.result)a.changeSecurities.splice(f,1),a.cspGroupExchangeHideModal(),a.cspGetStockAndPool(a.gid);else{a.loadinginfo.error=!0,a.loadinginfo.errorString=b.reason;var d=1,e=c(function(){d<=0?(c.cancel(e),a.cspGroupExchangeHideModal()):d--},500,100)}})}else b.go("operlogin")})},a.cspGroupExchangeAskChange=function(b){a.allocateSecurities.length>0?(a.groupchangeinfo.ask_gid=a.allocateSecurities[0].gid,
a.groupchangeinfo.ask_cid=a.allocateSecurities[0].cid,a.groupchangeinfo.ask_code=a.allocateSecurities[0].code,a.groupchangeinfo.ask_cname=a.allocateSecurities[0].cname,a.groupchangeinfo.ask_last=a.allocateSecurities[0].last,a.groupchangeinfo.ask_volume=a.allocateSecurities[0].available_vol,a.groupchangeinfo.ask_value=a.allocateSecurities[0].available_amt):(a.groupchangeinfo.ask_gid=-1,a.groupchangeinfo.ask_cid="",a.groupchangeinfo.ask_code="",a.groupchangeinfo.ask_cname="",a.groupchangeinfo.ask_last=0,a.groupchangeinfo.ask_volume=0,a.groupchangeinfo.ask_value=0),a.groupchangeinfo.asked_gid=a.changeSecurities[b].gid,a.groupchangeinfo.asked_gname=a.changeSecurities[b].gname,a.groupchangeinfo.asked_cid=a.changeSecurities[b].cid,a.groupchangeinfo.asked_code=a.changeSecurities[b].code,a.groupchangeinfo.asked_last=a.changeSecurities[b].last,a.groupchangeinfo.asked_cname=a.changeSecurities[b].cname,a.groupchangeinfo.asked_volume=a.changeSecurities[b].post_exchange_vol,a.groupchangeinfo.asked_value=a.changeSecurities[b].post_exchange_amt,a.groupchangeinfo.loading=!1,a.groupchangeinfo.error=!1,a.groupchangeinfo.errorString="",a.cspGroupExchangeShowModal(a.groupmodalmenu.askchangemodal)},a.cspGroupExchangeGetIndexByCode=function(b){for(var c=0;c<a.allocateSecurities.length;c++)return c;return-1},a.cspGroupExchangeAskCodeChange=function(){var b=/^[0-9]{6}$/,c=/^[0-9]+$/;if(b.test(a.groupchangeinfo.ask_code)){var d=a.cspGroupExchangeGetIndexByCode(a.groupchangeinfo.ask_code);d!=-1?(a.groupchangeinfo.ask_gid=a.allocateSecurities[0].gid,a.groupchangeinfo.ask_cid=a.allocateSecurities[0].cid,a.groupchangeinfo.ask_cname=a.allocateSecurities[0].cname,a.groupchangeinfo.ask_last=a.allocateSecurities[0].last,c.test(a.groupchangeinfo.ask_volume)?a.groupchangeinfo.ask_value=a.groupchangeinfo.ask_volume*a.groupchangeinfo.ask_last:a.groupchangeinfo.ask_value=0):(a.groupchangeinfo.ask_gid=-1,a.groupchangeinfo.ask_cid="",a.groupchangeinfo.ask_cname="",a.groupchangeinfo.ask_last=0,a.groupchangeinfo.ask_value=0)}else a.groupchangeinfo.ask_gid=-1,a.groupchangeinfo.ask_cid="",a.groupchangeinfo.ask_cname="",a.groupchangeinfo.ask_last=0,a.groupchangeinfo.ask_value=0},a.cspGroupExchangeAskNumberChange=function(){var b=/^[0-9]+$/;b.test(a.groupchangeinfo.ask_volume)?a.groupchangeinfo.ask_value=a.groupchangeinfo.ask_volume*a.groupchangeinfo.ask_last:a.groupchangeinfo.ask_value=0},a.cspGroupExchangeAskedNumberChange=function(){var b=/^[0-9]+$/;b.test(a.groupchangeinfo.asked_volume)?a.groupchangeinfo.asked_value=a.groupchangeinfo.asked_volume*a.groupchangeinfo.asked_last:a.groupchangeinfo.asked_value=0},a.cspGroupExchangeAskChangeSure=function(){var f=1,g=void 0,h=/^[0-9]+$/;a.groupchangeinfo.loading=!0,a.groupchangeinfo.error=!1,a.groupchangeinfo.errorString="正在提交",a.groupchangeinfo.ask_gid==-1?(a.groupchangeinfo.error=!0,a.groupchangeinfo.errorString="请输入申请交换的证券代码",g=c(function(){f<=0?(c.cancel(g),a.groupchangeinfo.loading=!1):f--},500,100)):h.test(a.groupchangeinfo.ask_volume)?h.test(a.groupchangeinfo.asked_volume)?d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){var h={};h.ask_gid=a.groupchangeinfo.ask_gid,h.ask_cid=a.groupchangeinfo.ask_cid,h.ask_cname=a.groupchangeinfo.ask_cname,h.ask_volume=a.groupchangeinfo.ask_volume,h.ask_value=a.groupchangeinfo.ask_value,h.asked_gid=a.groupchangeinfo.asked_gid,h.asked_cid=a.groupchangeinfo.asked_cid,h.asked_cname=a.groupchangeinfo.asked_cname,h.asked_volume=a.groupchangeinfo.asked_volume,h.asked_value=a.groupchangeinfo.asked_value,console.log(h),e.cspGroupExchangeAddAskExchange(h,function(b){"succeed"==b.result?(a.groupchangeinfo.error=!0,a.groupchangeinfo.errorString="提交申请成功，等待对方处理",g=c(function(){f<=0?(c.cancel(g),a.cspGroupExchangeHideModal()):f--},500,100)):(a.groupchangeinfo.error=!0,a.groupchangeinfo.errorString=b.reason,g=c(function(){f<=0?(c.cancel(g),a.groupchangeinfo.loading=!1):f--},500,100))})}else b.go("operlogin")}):(a.groupchangeinfo.error=!0,a.groupchangeinfo.errorString="请输入申请得到的数量",g=c(function(){f<=0?(c.cancel(g),a.groupchangeinfo.loading=!1):f--},500,100)):(a.groupchangeinfo.error=!0,a.groupchangeinfo.errorString="请输入申请交换的数量",g=c(function(){f<=0?(c.cancel(g),a.groupchangeinfo.loading=!1):f--},500,100))},a.cspGroupExchangeReadNews=function(f){var g={};g.gid=a.allocateSecurities[f].gid,g.cid=a.allocateSecurities[f].cid,a.exchangeNews.splice(0,a.exchangeNews.length);var h=1,i=void 0;a.loadinginfo.loading=!0,a.loadinginfo.error=!1,a.loadinginfo.errorString="正在加载数据",a.cspGroupExchangeShowModal(a.groupmodalmenu.readchangenews),d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspGroupExchangeGetExchangeNews(g,function(b){"succeed"==b.result?(a.exchangeNews=b.data,a.loadinginfo.loading=!1):(a.loadinginfo.error=!0,a.loadinginfo.errorString=b.reason,i=c(function(){h<=0?(c.cancel(i),a.cspGroupExchangeHideModal()):h--},500,100))}):b.go("operlogin")})}}),cspCtrls.controller("cspHeaderCtrl",function(a,b,c,d,e){$(document).ready(function(){$("a.item1").hover(function(){$(".item1").css("background-color","#fff")})}),$(window).scroll(function(){$(this).scrollTop()>=80?$(".csp_header_menu_container2").show():$(".csp_header_menu_container2").hide()}),a.goUserCenter=function(a){$(".csp_header_dropdown_menu").css("display","none"),d.cspCheckLoginState("",function(f){return f.loginState!==!0?("/home"!=c.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void d.cspCheckRiskState({},function(c){if("succeed"!==c.result||c.riskstate!==!0)event.preventDefault(),b.go("risklevel");else{var d={};d.centerData={},d.centerData.page=a,e.setCenterData(d,function(c){b.go("usercenter"),0===a?(document.getElementById("user_dataform").style.display="",document.getElementById("user_passform").style.display="none",$("#user_databutton").addClass("active"),$("#user_passbutton").removeClass("active")):($("#user_passbutton").addClass("active"),$("#user_databutton").removeClass("active"),document.getElementById("user_dataform").style.display="none",document.getElementById("user_passform").style.display="",document.getElementById("user_oldpass").value="",document.getElementById("user_firstnewpass").value="",document.getElementById("user_secondnewpass").value="")})}})})},a.goToComment=function(){d.cspCheckLoginState({},function(a){"succeed"===a.result&&a.loginState===!0?d.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0?b.go("comment"):b.go("risklevel")}):("/home"!=c.path()&&$("#loginModal").remove(),b.go("home"),jQuery("#loginModal").modal("show"))})},a.cspGoHome=function(){d.cspCheckLoginState({},function(a){"succeed"===a.result&&a.loginState===!0?d.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0?("/home"!=c.path()&&$("#loginModal").remove(),b.go("home")):b.go("risklevel")}):("/home"!=c.path()&&$("#loginModal").remove(),b.go("home"),jQuery("#loginModal").modal("show"))})},a.cspGoProducts=function(){d.cspCheckLoginState("",function(a){return a.loginState!==!0?("/home"!=c.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void d.cspCheckRiskState({},function(a){"succeed"!==a.result||a.riskstate!==!0?(event.preventDefault(),b.go("risklevel")):b.go("allProducts")})})},a.cspGoOtherProducts=function(){d.cspCheckLoginState("",function(a){return a.loginState!==!0?("/home"!=c.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void d.cspCheckRiskState({},function(a){"succeed"!==a.result||a.riskstate!==!0?(event.preventDefault(),b.go("risklevel")):b.go("allProducts0")})})},a.cspHeaderDropMenuMove=function(){$(".csp_header_dropdown_menu").css("display","block")},a.cspHeaderDropMenuOut=function(){$(".csp_header_dropdown_menu").css("display","none")},a.cspLoginOut=function(){$(".csp_header_dropdown_menu").css("display","none"),d.cspCheckLoginState({},function(a){"succeed"===a.result&&a.loginState&&(document.getElementById("header_username").innerHTML="用户中心",b.go("loginout"))})},a.cspHomeOver=function(){jQuery("#csp_header_home_label").addClass("csp_header_over_label")},a.cspHomeOut=function(){jQuery("#csp_header_home_label").removeClass("csp_header_over_label")},a.cspProductOver=function(){jQuery("#csp_header_product_label").addClass("csp_header_over_label")},a.cspProductOver0=function(){jQuery("#csp_header_product0_label").addClass("csp_header_over_label")},a.cspProductOut=function(){jQuery("#csp_header_product_label").removeClass("csp_header_over_label")},a.cspProductOut0=function(){jQuery("#csp_header_product0_label").removeClass("csp_header_over_label")},a.cspCommentOver=function(){jQuery("#csp_header_comment_label").addClass("csp_header_over_label")},a.cspCommentOut=function(){jQuery("#csp_header_comment_label").removeClass("csp_header_over_label")},a.cspHomeOver2=function(){jQuery("#csp_header_home_label2").addClass("csp_header_over_label2")},a.cspHomeOut2=function(){jQuery("#csp_header_home_label2").removeClass("csp_header_over_label2")},a.cspProductOver2=function(){jQuery("#csp_header_product_label2").addClass("csp_header_over_label2")},a.cspProductOut2=function(){jQuery("#csp_header_product_label2").removeClass("csp_header_over_label2")},a.cspCommentOver2=function(){jQuery("#csp_header_comment_label2").addClass("csp_header_over_label2")},a.cspCommentOut2=function(){jQuery("#csp_header_comment_label2").removeClass("csp_header_over_label2")},a.cspProductOver02=function(){jQuery("#csp_header_product0_label2").addClass("csp_header_over_label2")},a.cspProductOut02=function(){jQuery("#csp_header_product0_label2").removeClass("csp_header_over_label2")}}),cspCtrls.controller("HomeCtrl",function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.cookieInfo={},a.status={login:0,register:1,loginsucess:0,loginerror:0,registersuccess:0,registersuccess1:0,registererror1:0,registererror2:0,wechatLogin:0},a.currentUser={},a.inputAccountChange=!1,a.products=[],a.products0=[],a.timePromise=void 0,a.codeState=!0,a.userInfo={info:"",password:""},window.WebSocket){var m=new WebSocket("ws://localhost:8181");m.onopen=function(a){console.log("Connection to server opened",a)},m.onmessage=function(a){console.log("onmessage",a)},m.onerror=function(a){console.log("WebSocket Error: ",a)},m.onclose=function(a){console.log("Connection closed",a)}}else alert("您的浏览器不支持webSocket,将无法接收到系统推送,请使用更新的浏览器.");a.getWechatAccess_token=function(a){c.get(a).success(function(a){console.log(a)}).error(function(a){console.log(a)})},a.OverBtn=function(a){$(a.target).addClass("btnActive")},a.OutBtn=function(a){$(a.target).removeClass("btnActive")},a.saveUserAndPass=function(a,b){var c=new Date;c.setTime(c.getTime()+6048e5),console.log(document.cookie);var d={};d.username=a,d.password=b;var e=JSON.stringify(d),f="userinfo="+escape(e)+";expires="+c.toGMTString();document.cookie=f},a.getCookie=function(){for(var a={},b="userinfo=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0==e.indexOf(b)){var f=JSON.parse(unescape(e.substring(b.length,e.length)));a.userAccount=f.username,a.value=f.password;break}}return a},a.deleteCookie=function(){document.cookie="userinfo=; expires=Thu, 01 Jan 1970 00:00:00 GMT",console.log("document.cookie",document.cookie)},a.setHeaderName=function(b){l.getUserInfo(b,function(b){0!=b&&(a.currentUser=b,7!=b.conlevel&&2!=b.conlevel&&1!=b.conlevel||(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display="",a.getCardsProduct0()),document.getElementById("header_username").innerText=b.tel)})},jQuery(document).ready(function(){if(document.getElementById("csp_header_home_label").className="csp_header_label csp_header_active_label",document.getElementById("csp_header_home_label2").className="csp_header_label2 csp_header_active_label2",document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label ",document.getElementById("csp_header_comment_label2").className="csp_header_label2",document.getElementById("csp_header_product_label2").className="csp_header_label2",document.getElementById("csp_header_product0_label2").className="csp_header_label2 ",document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",document.cookie||navigator.cookieEnabled){a.cookieInfo.exist=!1,console.log(document.cookie);for(var c="userinfo=",d=document.cookie.split(";"),f=0;f<d.length;f++){var g=d[f].trim();if(0==g.indexOf(c)){a.cookieInfo.exist=!0;var h=JSON.parse(unescape(g.substring(c.length,g.length)));a.cookieInfo.username=h.username,a.cookieInfo.password=h.password;break}}i.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){if("succeed"==c.result)1==c.gorisk?b.go("risklevel"):a.setHeaderName({});else if("undefined"==typeof e.search().code)jQuery("#loginModal").modal("show");else{var d={};d.code=e.search().code,i.cspCheckWechatCode(d,function(c){if(c.result===!1)jQuery("#loginModal").modal("show");else{var d={};d.openid=c.openid,d.unionid=c.unionid,d.nickname=c.nickname,i.WechatLogin(d,function(c){return c.result===!1?(console.log("登录微信失败"),void(0==c.length?b.go("wchatreg"):jQuery("#loginModal").modal("show"))):(a.setHeaderName(c),void console.log("登录微信成功",c))})}})}})}else alert("浏览器未开启cookie,网站可能无法正常使用");$(".flexslider").flexslider({animation:"slide",directionNav:!0,slideshowSpeed:3e3,prevText:"",nextText:"",pauseOnHover:!1,pauseOnAction:!1,customDirectionNav:$(".custom-navigation a")});var j=function(a){var b=/\d+/,c=a.match(b)[0];return c};$("#lunbobanner").mouseenter(function(){var a=$("#lunbobanner").css("height"),b=j(a);b=b/2+35;var c="-"+b+"px";$(".custom-navigation").css("top",c),document.getElementById("customNavigation").style.visibility="visible"}),$("#lunbobanner").mouseleave(function(){document.getElementById("customNavigation").style.visibility="hidden"});var k={};k.page=1,k.pageRows=3,a.getCardsProduct()}),a.cspHomeInit=function(){},a.getCardsProduct=function(){var b={};b.protype=1,j.getCardsProduct(b,function(b){if(0!=b.result){a.products=b;for(var c=0;c<b.length;c++)"undefined"==typeof b[c].date||null===b[c].date?(b[c].net="--",b[c].accrate="--"):(b[c].net=b[c].net.toFixed(3),b[c].accrate=(100*(b[c].totalnet-1)).toFixed(2)+"%")}})},a.getCardsProduct0=function(){var b={};b.protype=2,k.getCardsProduct(b,function(b){if(0!=b.result){a.products0=b;for(var c=0;c<b.length;c++)"undefined"==typeof b[c].date||null===b[c].date?(b[c].net="--",b[c].accrate="--"):(b[c].net=b[c].net.toFixed(3),b[c].accrate=(100*(b[c].totalnet-1)).toFixed(2)+"%")}})},a.getWechatLogin=function(){console.log("getWechatLogin")},a.checkField=function(){a.inputAccountChange=!0,console.log("inputAccountChange",a.inputAccountChange)},a.goProductView=function(a){console.log("productID",a),i.cspCheckLoginState("",function(c){return c.loginState!==!0?("/home"!=e.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void i.cspCheckRiskState({},function(c){if("succeed"!==c.result||c.riskstate!==!0)b.go("risklevel");else{var d={};d.productID=a,j.setProductID(d,function(a){a.result===!1?console.log("产品界面设置当前productid失败"):b.go("productView")})}})})},a.goProductView0=function(a){i.cspCheckLoginState("",function(c){return c.loginState!==!0?("/home"!=e.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void i.cspCheckRiskState({},function(c){if("succeed"!==c.result||c.riskstate!==!0)b.go("risklevel");else{var d={};d.productID=a,k.setProductID(d,function(a){a.result===!1?console.log("产品界面设置当前productid失败"):b.go("productView0")})}})})},a.subscribeProduct=function(c){i.cspCheckLoginState("",function(d){return d.loginState!==!0?("/home"!=e.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void i.cspCheckRiskState({},function(d){if("succeed"!==d.result||d.riskstate!==!0)b.go("risklevel");else{var e={};e.productID=c,j.setProductID(e,function(b){b.result===!1?console.log("产品界面设置当前productid失败"):(a.$broadcast("userBuyProduct","name"),jQuery("#allPro_orderModal").remove(),jQuery("#orderModal").modal("show"))})}})})},a.cspGoProducts=function(){i.cspCheckLoginState("",function(a){return a.loginState!==!0?("/home"!=e.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void i.cspCheckRiskState({},function(a){"succeed"!==a.result||a.riskstate!==!0?b.go("risklevel"):b.go("allProducts")})})},a.cspGoProducts0=function(){i.cspCheckLoginState("",function(a){return a.loginState!==!0?("/home"!=e.path()&&$("#loginModal").remove(),b.go("home"),void jQuery("#loginModal").modal("show")):void i.cspCheckRiskState({},function(a){"succeed"!==a.result||a.riskstate!==!0?b.go("risklevel"):b.go("allProducts0")})})},a.autoLogin=function(c){""==c.info||"undefined"==typeof c.info||""==c.password||"undefined"==typeof c.password||f.athen(c,function(c){if("undefined"===c[0]||"[]"===JSON.stringify(c))console.log("登录失败"),f.reset(a.status,"loginerror");else{var d={time:"",uid:""};d.time=h("date")(new Date,"yyyy-MM-dd HH:mm:ss"),console.log("time",d.time),d.uid=c.uid,f.lastLoginTime(d,function(c){console.log("登录成功");var e={uid:""};e.uid=d.uid,a.setHeaderName(d),a.setCurrentUser(e),jQuery("#loginModal").modal("hide"),i.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||b.go("risklevel")})})}})},a.autoLogin=function(c){""!=c.info&&"undefined"!=typeof c.info&&""!=c.password&&"undefined"!=typeof c.password&&i.checkAutoLogin("",function(d){return console.log("checkAutoLogin",d),0==d.result?void console.log("不允许自动登录"):void f.athen(c,function(c){if(console.log("允许自动登录"),"undefined"===c[0]||"[]"===JSON.stringify(c))console.log("登录失败"),f.reset(a.status,"loginerror");else{var d={time:"",uid:""};d.time=h("date")(new Date,"yyyy-MM-dd HH:mm:ss"),console.log("time",d.time),d.uid=c.uid,f.lastLoginTime(d,function(c){console.log("登录成功");var e={uid:""};e.uid=d.uid,a.setHeaderName(d),a.setCurrentUser(e),jQuery("#loginModal").modal("hide"),i.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||b.go("risklevel")})})}})})},a.login=function(c){if(document.getElementById("loginCheckBoxTips").style.display="none",console.log("login checked",document.getElementById("treatyCheckBox").checked),document.getElementById("treatyCheckBox").checked===!1)return void(document.getElementById("loginCheckBoxTips").style.display="");if(""==c.info||"undefined"==typeof c.info)document.getElementById("csp_password_tips").style.display="none",document.getElementById("csp_login_tips").style.display="block";else if(""==c.info||""!=c.password&&"undefined"!=typeof c.password){document.getElementById("csp_login_tips").style.display="none",document.getElementById("csp_password_tips").style.display="none";var d=!1;d=jQuery(".ui.log.checkbox").checkbox("is checked"),console.log("remember",d),f.athen(c,function(e){if("undefined"===e[0]||"[]"===JSON.stringify(e))console.log("登录失败"),f.reset(a.status,"loginerror");else{var g={};g.autoLogin=2,i.setAutoLoginState(g,function(a){}),d&&a.inputAccountChange?a.saveUserAndPass(c.info,c.password):d||a.deleteCookie();var j={time:"",uid:""};j.time=h("date")(new Date,"yyyy-MM-dd HH:mm:ss"),console.log("time",j.time),j.uid=e.uid,f.lastLoginTime(j,function(c){console.log("登录成功");var d={uid:""};d.uid=j.uid,a.setHeaderName(j),a.setCurrentUser(d),jQuery("#loginModal").modal("hide"),i.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||b.go("risklevel")})})}})}else document.getElementById("csp_login_tips").style.display="none",document.getElementById("csp_password_tips").style.display="block"},a.cspCheckStateToRegister=function(){console.log("cspCheckStateToRegister"),f.reset(a.status,"register")},a.cspCheckStateToWeChatLogin=function(){document.getElementById("loginCheckBoxTips").style.display="none",f.reset(a.status,"wechatLogin")},a.goBackLogin=function(){f.reset(a.status,"login")},a.readTreatyChange=function(){console.log(a.status.wechatLogin,typeof a.status.wechatLogin),document.getElementById("treatyCheckBox").checked?(document.getElementById("loginCheckBoxTips").style.display="none",1===a.status.wechatLogin&&(document.getElementById("login_container2").style.display="",document.getElementById("wechatLoginCheckBoxTips").style.display="none")):1===a.status.wechatLogin&&(document.getElementById("login_container2").style.display="none",document.getElementById("wechatLoginCheckBoxTips").style.display="")},a.getUser=function(){},a.cspRegisterPhoneFocus=function(){document.getElementById("csp_register_tips").style.visibility="hidden"},a.cspRegisterCodeFocus=function(){document.getElementById("csp_register_tips").style.visibility="hidden"},a.cspRegisterGetCode=function(b){if(a.codeState===!0)if(void 0!==b&&""!==b&&/^1[34578]\d{9}$/.test(b)){var c={};c.phone=b,g.cspRegisterCheckPhone(c,function(b){"succeed"===b.result?g.cspRegisterSendCode(c,function(b){if("succeed"===b.result){a.codeState=!1,document.getElementById("csp_register_code_button").style.border="1px solid rgb(205,127,50)",document.getElementById("csp_register_code_button").style.backgroundColor="#ffffff",document.getElementById("csp_register_code_button_label").style.color="rgb(205,127,50)",document.getElementById("csp_register_code_button_label").innerHTML="60秒后重新获取";var c=59;a.timePromise=void 0,a.timePromise=d(function(){if(c<=0)d.cancel(a.timePromise),a.timePromise=void 0,c=59,document.getElementById("csp_register_code_button").style.border="0",document.getElementById("csp_register_code_button").style.backgroundColor="rgb(205,127,50)",document.getElementById("csp_register_code_button_label").style.color="#ffffff",document.getElementById("csp_register_code_button_label").innerHTML="获取验证码",a.codeState=!0;else{c--;var b=c+1;document.getElementById("csp_register_code_button_label").innerHTML=b+"秒后重新获取"}},1e3,100),alert("我们已向您的手机发送了验证码，五分钟有效")}else document.getElementById("csp_register_tips").innerHTML=b.reason,document.getElementById("csp_register_tips").style.visibility="visible"}):(document.getElementById("csp_register_tips").innerHTML=b.reason,document.getElementById("csp_register_tips").style.visibility="visible")})}else document.getElementById("csp_register_tips").innerHTML="请输入正确的手机号码",document.getElementById("csp_register_tips").style.visibility="visible"},a.cspRegisterCommit=function(c,e){if(console.log(document.getElementById("treatyCheckBox").checked),document.getElementById("loginCheckBoxTips").style.display="none",1!=document.getElementById("treatyCheckBox").checked)document.getElementById("loginCheckBoxTips").style.display="";else if(void 0===c||""===c)document.getElementById("csp_register_tips").innerHTML="请输入正确的手机号码",document.getElementById("csp_register_tips").style.visibility="visible";else if(void 0===e||""===e)document.getElementById("csp_register_tips").innerHTML="请输入短信验证码",document.getElementById("csp_register_tips").style.visibility="visible";else{var h={};h.phone=c,h.code=e,g.cspRegisterCommit(h,function(c){"succeed"===c.result?g.cspRegisterDeleteSession({},function(c){if("succeed"===c.result){d.cancel(a.timePromise),a.timePromise=void 0,f.reset(a.status,"registersuccess1");var e=4;a.timePromise=d(function(){e<0?(d.cancel(a.timePromise),a.timePromise=void 0,e=4,document.getElementById("csp_register_success_time1").innerHTML=e,jQuery("#loginModal").modal("hide"),b.go("risklevel")):(e--,document.getElementById("csp_register_success_time1").innerHTML=e+1)},1e3,100)}else{d.cancel(a.timePromise),a.timePromise=void 0,f.reset(a.status,"registersuccess");var e=4;a.timePromise=d(function(){e<0?(d.cancel(a.timePromise),a.timePromise=void 0,e=4,document.getElementById("csp_register_success_time").innerHTML=e,f.reset(a.status,"login")):(e--,document.getElementById("csp_register_success_time").innerHTML=e+1)},1e3,100)}}):(document.getElementById("csp_register_tips").innerHTML=c.reason,document.getElementById("csp_register_tips").style.visibility="visible")})}},a.cspCheckStateToLogin=function(){d.cancel(a.timePromise),a.timePromise=void 0,f.reset(a.status,"login")},a.cspRegAndLogin=function(){d.cancel(a.timePromise),a.timePromise=void 0,b.go("risklevel")}}),cspCtrls.controller("importStockDataCtrl",function(a,b,c,d,e,f){a.status=0,a.tradeUnitStocks=[],a.importingData=!1,a.currentSelectTrid="",a.importingStocks=[],a.maxPageSize=3,a.pageRows=4,a.stockAmount=0,a.allPage=0,a.currentpage=1,a.pageArr=[],a.filterCondition={pageRows:a.pageRows,page:1,trid:""},a.createSingleStock=!1,a.newSingleStock={cid:"",cname:"",totalsa:0,allocatedsa:0,importdate:"",stat:"0"},a.cookieinfo={},$(document).ready(function(){document.getElementById("homeSpaceDiv_37px").style.display="none",document.getElementById("csp_footer").style.display="none",a.status=0,a.cspTradeTeamManageLoadReady()}),a.importStockInit=function(){if(document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",document.cookie||navigator.cookieEnabled){a.cookieinfo.exist=!1;for(var c="cspOperLoginInfo=",d=document.cookie.split(";"),e=0;e<d.length;e++){var g=d[e].trim();if(0==g.indexOf(c)){a.cookieinfo.cookieExist=!0;var h=JSON.parse(unescape(g.substring(c.length,g.length)));a.cookieinfo.login_maid=h.maid,a.cookieinfo.login_oid=h.oid,a.cookieinfo.login_pass=h.password;break}}console.log("开始自动登录"),f.cspOperCheckAndLogin(a.cookieinfo,function(a){"succeed"==a.result||b.go("operlogin")})}else alert("浏览器未开启cookie,网站可能无法正常使用"),b.go("operlogin")},a.cspTradeTeamManageLoadReady=function(){if(a.status){if(1==a.status){var b={maid:""};b.maid=1,d.getModel(b,function(b){a.model=b,$(".js-trid-add-new-team").dropdown({onChange:function(b,c,d){a.$apply(function(){a.currentTridTeam=b.split("(")[1].replace(")","")}),console.log("trid-changed:",b),console.log("$scope.currentTridTeam:",a.currentTridTeam)},on:"hover"})})}}else{var b={maid:""};b.maid=1,a.editGid="",a.currentSelectTrid&&$(".js_trid").text(a.currentSelectTridName),d.getModel(b,function(b){a.model=b,$(".js-trid").dropdown({onChange:function(b,c,d){a.currentSelectTrid=b.split("(")[1].replace(")",""),a.currentSelectTridName=b,a.importing=!0,a.filterCondition.page=1,a.currentpage=1,a.getStockAmountByTrade(a.currentSelectTrid),console.log("trid-changed:",b),console.log("$scope.currentSelectTrid:",a.currentSelectTrid)},on:"hover"}),console.log("99999",b)})}},a.getStocksByTrade=function(){e.getStocksByTrade(a.filterCondition,function(b){if(0!=b.result){a.tradeUnitStocks=b;for(var c=0;c<b.length;c++)b[c].editcname=b[c].cname,b[c].edittotalsa=b[c].totalsa,b[c].editallocatedsa=b[c].allocatedsa,b[c].editimportdate=b[c].importdate,b[c].editstat=b[c].stat}})},a.getStockAmountByTrade=function(b){""!=b&&(a.filterCondition.trid=b,a.tradeUnitStocks=[],e.getStockAmountByTrade(a.filterCondition,function(b){b.result!==!1&&(a.stockAmount=b.stockAmount,a.stockAmount>0?(a.allPage=Math.ceil(a.stockAmount/a.pageRows),a.currentpage=a.currentpage>a.allPage?a.allPage:a.currentpage,a.filterCondition.page=a.currentpage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.getStocksByTrade(),document.getElementById("pageList").style.display=""):document.getElementById("pageList").style.display="none")}))},a.selectStockFile=function(){document.getElementById("file_load_form").reset(),document.getElementById("file_load_input").click(),document.getElementById("fileLabel").innerHTML="未选择任何文件"},a.loadStockFile=function(){var b=new FormData,c=document.getElementById("file_load_input").files[0];console.log(c.name),document.getElementById("fileLabel").innerHTML=c.name,b.append("file",c),e.loadStockFile(b,function(b){if(console.log(b),0!=b.result){a.importingStocks=[];var c=new Date;c=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();for(var d=0;d<b.length;d++){var e={};e.cid=b[d][0],e.cname=b[d][1],e.totalsa=b[d][2],e.allocatedsa=0,e.stat=0,e.importdate=c,e.trid=a.currentSelectTrid,a.importingStocks.push(e)}console.log(a.tradeUnitStocks)}})},a.loadStockFileAndImport=function(){var a=new FormData,b=document.getElementById("file_load_input").files[0];a.append("file",b),e.loadStockFileAndImport(a,function(a){console.log(a),0==a.result})},a.loadStockFileError=function(){console.log("您选择的文件不符合条件,导入格式只支持CSV、xls、xlsx三种格式"),a.showErrorLabel("您选择的文件不符合条件,导入格式只支持CSV、xls、xlsx三种格式")},a.importStock=function(){if(0==a.importingStocks.length)return console.log("当前没有数据,请选择文件导入"),void a.showErrorLabel("当前没有数据,请选择文件导入");for(var b=/^\d{6,}\.[A-z]*$/,c=0;c<a.importingStocks.length;c++)if(0==b.test(a.importingStocks[c].cid)){console.log(a.importingStocks[c].cid,b.test(a.importingStocks[c].cid)),c++;var d="您在第"+c+"行股票代码数据有错误,请修改符合条件";return void a.showErrorLabel(d)}var f={};f.stocks=a.importingStocks,f.stocksCount=a.importingStocks.length,f.trid=a.currentSelectTrid,console.log(f),e.importStock(f,function(b){b.result!==!1&&(a.importingStocks=[],a.importingData=!1,a.importingStocks=[],a.getStockAmountByTrade(a.currentSelectTrid),document.getElementById("fileLabel").innerHTML="未选择任何文件",console.log("importStock成功"))})},a.openImportDiv=function(){return document.getElementById("fileLabel").innerHTML="未选择任何文件",document.getElementById("file_load_form").reset(),""==a.currentSelectTrid?(a.importingData=!1,a.createSingleStock=!1,a.importingStocks=[],void a.showError("请先选择交易单元")):(a.importingData=!0,a.importingStocks=[],void(a.createSingleStock=!1))},a.cancelImport=function(){a.importingData=!1,a.importingStocks=[],document.getElementById("fileLabel").innerHTML="未选择任何文件"},a.clearStockData=function(){a.importingStocks=[]},a.showError=function(b){$("html,body").scrollTop(0),document.getElementById("errorReason").innerHTML=b,document.getElementById("errorMessage").style.display="",a.timeout&&c.cancel(a.timeout),a.timeout=c(function(){document.getElementById("errorMessage").style.display="none"},5e3)},a.showErrorLabel=function(b){document.getElementById("errorLabel").innerHTML=b,document.getElementById("errorLabel").style.display="",a.timeoutlabel&&c.cancel(a.timeoutlabel),a.timeoutlabel=c(function(){document.getElementById("errorLabel").style.display="none"},2e3)},a.editStock=function(a){a.edit=!0},a.delStock=function(b,c){var d={trid:b.trid,cid:b.cid};e.delStock(d,function(b){return b.result===!1?void a.showError(b.reason):(a.filterCondition.page=a.currentpage,void a.getStockAmountByTrade(a.currentSelectTrid))})},a.saveEditStock=function(b){var c={};c.cid=b.cid,c.trid=b.trid,c.cname=b.editcname,c.totalsa=b.edittotalsa,c.allocatedsa=b.editallocatedsa,c.importdate=b.editimportdate,c.stat=b.editstat,console.log(b.editstat),e.saveEditStock(c,function(c){return c.result===!1?void a.showError(c.reason):(b.edit=!1,b.cname=b.editcname,b.totalsa=b.edittotalsa,b.allocatedsa=b.editallocatedsa,b.importdate=b.editimportdate,void(b.stat=b.editstat))})},a.checkStock=function(b){var c=/\d{6,}\.[A-z]*/g;return!!c.test(b.cid)||(a.showError("您输入的证券代码不符合规范,请重新输入"),!1)},a.createStock=function(){if(a.checkStock(a.newSingleStock)){var b={};for(var c in a.newSingleStock)b[c]=a.newSingleStock[c];b.trid=a.currentSelectTrid,console.log(b),e.createStock(b,function(b){return b.result===!1?void a.showError(b.reason):(a.createSingleStock=!1,a.filterCondition.page=a.currentpage,void a.getStockAmountByTrade(a.currentSelectTrid))})}},a.cancelEdit=function(a){a.edit=!1,a.editcname=a.cname,a.edittotalsa=a.totalsa,a.editallocatedsa=a.allocatedsa,a.editimportdate=a.importdate},a.clickCreate=function(){return a.importingData=!1,a.importingStocks=[],""==a.currentSelectTrid?(a.createSingleStock=!1,void a.showError("请先选择交易单元")):(a.newSingleStock={cid:"",cname:"",totalsa:0,allocatedsa:0,importdate:"",stat:"0"},void(a.createSingleStock=!a.createSingleStock))},a.cancelCreate=function(){a.createSingleStock=!1},a.gotoPage=function(b){a.currentpage=b,console.log("$scope.currentpage",a.currentpage),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),
a.filterCondition.page=b,a.getStocksByTrade(a.filterCondition)},a.goFirstPage=function(){a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=1,a.getStocksByTrade(a.filterCondition)},a.goLastPage=function(){a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.allPage,a.getStocksByTrade(a.filterCondition)},a.goPreviousPage=function(){a.currentpage>1?a.currentpage-=1:a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getStocksByTrade(a.filterCondition)},a.goNextPage=function(){a.currentpage<a.allPage?a.currentpage+=1:a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getStocksByTrade(a.filterCondition)},a.getProductsByPage=function(b){a.filterCondition.page=b,a.getStocksByTrade(a.filterCondition)}}),cspCtrls.controller("layoutCtrl",function(a,b,c,d){a.cookieInfo={},a.layoutstate=0,a.layoutpath="",a.showProducts=[],a.showProducts_2=[],a.showProdutEditing=!1,a.showPeodut_2Editing=!1,a.editShowProduct={},a.editShowProduct_2={},a.selectProducts=[],a.selectProducts_2=[],a.cspLayoutManageInit=function(){if(document.cookie||navigator.cookieEnabled){a.cookieInfo.exist=!1,console.log(document.cookie);for(var d="userinfo=",e=document.cookie.split(";"),f=0;f<e.length;f++){var g=e[f].trim();if(0==g.indexOf(d)){a.cookieInfo.exist=!0;var h=JSON.parse(unescape(g.substring(d.length,g.length)));a.cookieInfo.username=h.username,a.cookieInfo.password=h.password;break}}a.layoutstate=0,a.layoutpath="tpls/layoutmanage/layoutmanage.html",c.cspUserCheckAndLoginByCookie(a.cookieInfo,function(a){"succeed"==a.result?1==a.gorisk&&b.go("risklevel"):b.go("home")})}else alert("浏览器未开启cookie,网站可能无法正常使用"),b.go("home")},a.cspLayoutManageLoadReady=function(){switch(document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",a.layoutstate){case 0:var b=document.documentElement.clientHeight-70,c=b+"px";document.getElementById("csp_layout_manage_body").style.minHeight=c,window.scrollTo(0,0),a.showProducts.splice(0,a.showProducts.length),a.showProducts_2.splice(0,a.showProducts_2.length),d.cspLayoutManageGetShowProduct({},function(b){if("succeed"==b.result){var c=b.data,d=b.data_2,e=0,f=0;for(console.log(a.showProducts,a.showProducts.length),e=0;e<3;e++){for(f=0;f<c.length;f++)if(c[f].priority==e+1){a.showProducts.push(c[f]);break}if(f>=c.length){var g={};g.protype=1,g.proid=0,g.priority=e+1,g.caption="点击添加产品",g.piclink="images/place.jpg",g.prostatus="未发行",a.showProducts_2.push(g)}}for(console.log("fdsfsdfd",d.length),e=0;e<3;e++){for(f=0;f<d.length;f++)if(d[f].priority==e+1){a.showProducts_2.push(d[f]);break}if(f>=d.length){var g={};g.protype=1,g.proid=0,g.priority=e+1,g.caption="点击添加产品",g.piclink="images/place.jpg",g.prostatus="未发行",a.showProducts_2.push(g)}console.log(a.showProducts_2)}}else alert("获取数据失败，请刷新页面重试")})}},a.cspManageBack=function(){b.go("managecenter")},a.cspLayoutManageChangeShowProduct=function(b){a.showProdutEditing=!0,a.editShowProduct.protype=a.showProducts[b].protype,a.editShowProduct.proid=a.showProducts[b].proid,a.editShowProduct.priority=a.showProducts[b].priority,a.editShowProduct.caption=a.showProducts[b].caption,a.editShowProduct.piclink=a.showProducts[b].piclink,a.editShowProduct.prostatus=a.showProducts[b].prostatus,a.selectProducts.splice(0,a.selectProducts.length),console.log(a.editShowProduct);var c={};c.protype=1,d.cspLayoutManageGetAllProducts(c,function(b){"succeed"==b.result?a.selectProducts=b.data:alert("获取数据失败，请刷新重试")}),$("#csp_layout_manage_product_edit_dropdown").dropdown({onChange:function(b,c,d){for(var e=0;e<a.selectProducts.length;e++)if(a.selectProducts[e].proid==b){a.$apply(function(){a.editShowProduct.proid=a.selectProducts[e].proid,a.editShowProduct.caption=a.selectProducts[e].caption,a.editShowProduct.piclink=a.selectProducts[e].piclink,a.editShowProduct.prostatus=a.selectProducts[e].prostatus});break}},on:"click"})},a.cspLayoutManageChangeShowProductCancel=function(){a.showProdutEditing=!1},a.cspLayoutManageChangeShowProductSure=function(){a.editShowProduct.proid==a.showProducts[a.editShowProduct.priority-1].proid?a.showProdutEditing=!1:c.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){if("succeed"==c.result)if(1==c.gorisk)b.go("risklevel");else{var e={};e.proid=a.editShowProduct.proid,e.protype=1,e.priority=a.editShowProduct.priority,d.cspLayoutManageUpdateLayout(e,function(b){"succeed"==b.result?(a.showProducts[a.editShowProduct.priority-1].protype=a.editShowProduct.protype,a.showProducts[a.editShowProduct.priority-1].proid=a.editShowProduct.proid,a.showProducts[a.editShowProduct.priority-1].priority=a.editShowProduct.priority,a.showProducts[a.editShowProduct.priority-1].caption=a.editShowProduct.caption,a.showProducts[a.editShowProduct.priority-1].piclink=a.editShowProduct.piclink,a.showProducts[a.editShowProduct.priority-1].prostatus=a.editShowProduct.prostatus,a.showProdutEditing=!1):alert("操作失败，请刷新重试")})}else b.go("home")})},a.cspLayoutManageChangeShowProduct_2=function(b){a.showProdut_2Editing=!0,a.editShowProduct_2.protype=a.showProducts_2[b].protype,a.editShowProduct_2.proid=a.showProducts_2[b].proid,a.editShowProduct_2.priority=a.showProducts_2[b].priority,a.editShowProduct_2.caption=a.showProducts_2[b].caption,a.editShowProduct_2.piclink=a.showProducts_2[b].piclink,a.editShowProduct_2.prostatus=a.showProducts_2[b].prostatus,a.selectProducts_2.splice(0,a.selectProducts_2.length),console.log(a.editShowProduct_2);var c={};c.protype=2,d.cspLayoutManageGetAllProducts(c,function(b){"succeed"==b.result?(console.log(b.data),a.selectProducts_2=b.data):alert("获取数据失败，请刷新重试")}),$("#csp_layout_manage_product_2_edit_dropdown").dropdown({onChange:function(b,c,d){console.log("fdsfkldj");for(var e=0;e<a.selectProducts_2.length;e++)if(a.selectProducts_2[e].proid==b){a.$apply(function(){a.editShowProduct_2.proid=a.selectProducts_2[e].proid,a.editShowProduct_2.caption=a.selectProducts_2[e].caption,a.editShowProduct_2.piclink=a.selectProducts_2[e].piclink,a.editShowProduct_2.prostatus=a.selectProducts_2[e].prostatus});break}},on:"click"})},a.cspLayoutManageChangeShowProduct_2Cancel=function(){a.showProdut_2Editing=!1},a.cspLayoutManageChangeShowProduct_2Sure=function(){a.editShowProduct_2.proid==a.showProducts_2[a.editShowProduct_2.priority-1].proid?a.showProdut_2Editing=!1:c.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){if("succeed"==c.result)if(1==c.gorisk)b.go("risklevel");else{var e={};e.proid=a.editShowProduct_2.proid,e.protype=1,e.priority=a.editShowProduct_2.priority,d.cspLayoutManageUpdateLayout(e,function(b){"succeed"==b.result?(a.showProducts_2[a.editShowProduct_2.priority-1].protype=a.editShowProduct_2.protype,a.showProducts_2[a.editShowProduct_2.priority-1].proid=a.editShowProduct_2.proid,a.showProducts_2[a.editShowProduct_2.priority-1].priority=a.editShowProduct_2.priority,a.showProducts_2[a.editShowProduct_2.priority-1].caption=a.editShowProduct_2.caption,a.showProducts_2[a.editShowProduct_2.priority-1].piclink=a.editShowProduct_2.piclink,a.showProducts_2[a.editShowProduct_2.priority-1].prostatus=a.editShowProduct_2.prostatus,a.showProdut_2Editing=!1):alert("操作失败，请刷新重试")})}else b.go("home")})}}),cspCtrls.controller("logCtrl",function(a,b){a.toRegister=function(){b.go("home.register")}}),cspCtrls.controller("cspLogOutCtrl",function(a,b,c,d){a.labelCount=4,a.cspLoginOutInit=function(){a.timePromise=void 0,console.log("退出登录"),document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label "},a.cspLoginOutLoad=function(){d.cspLoginOut({},function(d){"succeed"===d.result&&d.loginout&&(document.cookie="userinfo=; expires=Thu, 01 Jan 1970 00:00:00 GMT",console.log("document.cookie",document.cookie),a.labelCount=4,a.timePromise=void 0,a.timePromise=b(function(){a.labelCount<=0?(b.cancel(a.timePromise),a.timePromise=void 0,a.labelCount=4,$("#loginModal").remove(),c.go("home")):a.labelCount--},1e3,100))})},a.cspLoginOutLink=function(){b.cancel(a.timePromise),a.timePromise=void 0,$("#loginModal").remove(),c.go("home")}}),cspCtrls.controller("manageCtrl",function(a,b,c,d,e,f){a.cspManageLoadPath="",a.cspManageState=-1,a.cspManageMenuState={},a.currentTactics={},a.tacticsList=[],a.products=[],a.users=[],a.timePromise=void 0,a.currentProduct={},a.currentUserKind="1",a.orderKinds=[],a.orderSelectKinds=[],a.orders=[],a.orderEditIndex=-1,a.pageCount=10,a.itemCount=10,a.productPages=[],a.productTotalPage=1,a.productCurrentPage=1,a.productShowPrev=!1,a.productShowNext=!1,a.tacticsPages=[],a.tacticsTotalPage=1,a.tacticsCurrentPage=1,a.tacticsShowPrev=!1,a.tacticsShowNext=!1,a.userPages=[],a.userTotalPage=1,a.userCurrentPage=1,a.userShowPrev=!1,a.userShowNext=!1,a.netPages=[],a.netTotalPage=1,a.netCurrentPage=1,a.netShowPrev=!1,a.netShowNext=!1,a.tacticsEdit=void 0,a.productEdit=void 0,a.currentanalogTactics={},a.analogTacticsList=[],a.analogProducts=[],a.currentanalogProduct={},a.analogProductPages=[],a.analogProductTotalPage=1,a.analogProductCurrentPage=1,a.analogProductShowPrev=!1,a.analogProductShowNext=!1,a.analogTacticsPages=[],a.analogTacticsTotalPage=1,a.analogTacticsCurrentPage=1,a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1,a.analogNetPages=[],a.analogNetTotalPage=1,a.analogNetCurrentPage=1,a.analogNetShowPrev=!1,a.analogNetShowNext=!1,a.orderPages=[],a.orderTotalPage=1,a.orderCurrentPage=1,a.orderShowPrev=!1,a.orderShowNext=!1,a.productType=1,a.spotPages=[],a.spotTotalPage=1,a.spotCurrentPage=1,a.spotShowPrev=!1,a.spotShowNext=!1,a.futuresPages=[],a.futuresTotalPage=1,a.futuresCurrentPage=1,a.futuresShowPrev=!1,a.futuresShowNext=!1,a.futuresDealTypes=[{type:0,desc:"买"},{type:1,desc:"卖"}],a.productRisklevels=[],a.homeProducts=[],a.homeProductsThree=!1,a.homeAnalogProducts=[],a.homeAnalogProductsThree=!1,a.cookieInfo={},a.productSeries=[],a.loadingtime=void 0,a.series=[],a.newSeries=!1,a.nowSeries={},a.seriesLoading={},a.seriesPages=[],a.seriesTotalPage=1,a.seriesCurrentPage=1,a.seriesShowPrev=!1,a.seriesShowNext=!1,a.notices=[],a.currentNotice={},a.noticeLoading={},a.noticeDeleteLoading={},a.noticeModal=!1,a.noticeModalPath="",a.noticestate=0,a.noticeSelect={},a.noticeproduct=[],a.noticeseries=[],a.noticeselectproduct=[],a.noticePages=[],a.noticeTotalPage=1,a.noticeCurrentPage=1,a.noticeShowPrev=!1,a.noticeShowNext=!1,a.showloadUserTips=!1,a.loadUserOperInfo={},a.loadUserResInfo={},a.loadUsers=[],a.loadUserCheckAll=!1,a.loadUserCheckOnce=!1,a.conlevelInfo=[],a.boughts=[],a.boughtSearch={},a.boughtShowModal=!1,a.boughtNextInfo={},a.loadBoughts=[],a.simpleProducts=[],a.loadBoughtOperInfo={},a.loadBoughtResInfo={},a.showloadBoughtTips=!1,a.loadBoughtCheckAll=!1,a.loadBoughtCheckOnce=!1,a.loadBoughtRoleInfo={},a.boughtSeries=[],a.boughtProducts=[],a.boughtDeleteLoading={},a.boughtPages=[],a.boughtTotalPage=1,a.boughtCurrentPage=1,a.boughtShowPrev=!1,a.boughtShowNext=!1,a.analogTacticsEdit=void 0,a.analogProductEdit=void 0,a.cspManageInit=function(){var c=document.createElement("script");c.src="lib/ueditor.config.js",document.getElementsByTagName("head")[0].appendChild(c);var f=document.createElement("script");if(f.src="lib/editor_api.js",document.getElementsByTagName("head")[0].appendChild(f),a.products=[],a.cspManageMenuState.productManage=0,a.cspManageMenuState.productInfo=2,a.cspManageMenuState.analogProductManage=5,a.cspManageMenuState.analogProductInfo=6,a.cspManageMenuState.tacticsManage=1,a.cspManageMenuState.tacticsInfo=3,a.cspManageMenuState.analogTacticsManage=7,a.cspManageMenuState.analogTacticsInfo=8,a.cspManageMenuState.userManage=4,a.cspManageMenuState.userLoad=12,a.cspManageMenuState.orderManage=9,a.cspManageMenuState.seriesManage=10,a.cspManageMenuState.noticeManage=11,a.cspManageMenuState.boughtManage=13,a.cspManageMenuState.boughtLoad=14,document.cookie||navigator.cookieEnabled){a.cookieInfo.exist=!1,console.log(document.cookie);for(var g="userinfo=",h=document.cookie.split(";"),i=0;i<h.length;i++){var j=h[i].trim();if(0==j.indexOf(g)){a.cookieInfo.exist=!0;var k=JSON.parse(unescape(j.substring(g.length,j.length)));a.cookieInfo.username=k.username,a.cookieInfo.password=k.password;break}}d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){"succeed"==c.result?1==c.gorisk?b.go("risklevel"):e.cspManageGetProductRisklevels({},function(b){"succeed"==b.result?(console.log(b.data),a.productRisklevels=b.data,a.cspManageLoadPath="tpls/managecenter/productManage.html",a.cspManageState=0):alert("获取数据失败")}):b.go("home")})}else alert("浏览器未开启cookie,网站可能无法正常使用"),b.go("home")},a.cspManageLoadReady=function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none";var f=document.documentElement.clientHeight-50,g=f+"px";if(document.getElementById("csp_manage_content_div").style.minHeight=g,window.scrollTo(0,0),a.cspManageState===a.cspManageMenuState.productManage&&a.cspManageGetPageProducts(1,1,function(a){"succeed"!=a.result&&alert("获取数据失败")}),a.cspManageState===a.cspManageMenuState.tacticsManage){var h={};a.tacticsCurrentPage=1,h.page=a.tacticsCurrentPage,h.pageCount=a.pageCount,e.cspGetAllTactics(h,function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"");a.tacticsTotalPage=Math.ceil(b.count/a.pageCount),a.tacticsPages=[];var e=1;a.tacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.tacticsTotalPage<=a.itemCount?e=1:(e=a.tacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.tacticsTotalPage-e+1<a.itemCount&&(e=a.tacticsTotalPage-a.itemCount+1));for(var f=e;f<e+a.itemCount&&!(f>a.tacticsTotalPage||a.tacticsTotalPage<=1);f++){var g={};g.num=f,f===a.tacticsCurrentPage?g.select=!0:g.select=!1,a.tacticsPages.push(g)}a.tacticsTotalPage<=1?(a.tacticsShowPrev=!1,a.tacticsShowNext=!1):(a.tacticsShowPrev=!0,a.tacticsShowNext=!0)}else alert("数据更新失败")})}if(a.cspManageState===a.cspManageMenuState.productInfo&&d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){"succeed"==d.result?1==d.gorisk?b.go("risklevel"):(jQuery("#csp_manage_product_series_select").dropdown({onChange:function(b,c,d){""!=b&&(a.currentProduct.seriesid=b,console.log("选择",a.currentProduct.seriesid))}}),jQuery("#csp_manage_product_risklevel_select").dropdown({onChange:function(b,c,d){""!=b&&(a.currentProduct.risklevelid=b)}}),void 0!=UE.delEditor?(UE.delEditor("productEditor"),a.productEdit=void 0,a.productEdit=UE.getEditor("productEditor",{toolbars:[["Undo","Redo","indent","paragraph","fontfamily","fontsize","forecolor","backcolor","Bold","italic","underline","strikethrough","subscript","superscript","fontborder","formatmatch","blockquote","link","selectall","removeformat"],["simpleupload","inserttable","deletetable","edittable","edittd","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells"]],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!1,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:500,zIndex:0,autoHeightEnabled:!1}),a.productEdit.ready(function(){""===a.currentProduct.contentshtml?a.productEdit.setContent("请输入产品详情"):a.productEdit.setContent(a.currentProduct.contentshtml)}),a.productEdit.addListener("contentChange",function(){a.currentProduct.conError=!1,a.currentProduct.contentshtml=a.productEdit.getContent()})):(a.timePromise=void 0,a.timePromise=c(function(){c.cancel(a.timePromise),a.timePromise=void 0,UE.delEditor("productEditor"),a.productEdit=void 0,a.productEdit=UE.getEditor("productEditor",{toolbars:[["Undo","Redo","indent","paragraph","fontfamily","fontsize","forecolor","backcolor","Bold","italic","underline","strikethrough","subscript","superscript","fontborder","formatmatch","blockquote","link","selectall","removeformat"],["simpleupload","inserttable","deletetable","edittable","edittd","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells"]],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!1,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:500,zIndex:0,autoHeightEnabled:!1}),a.productEdit.ready(function(){""===a.currentProduct.contentshtml?a.productEdit.setContent("请输入产品详情"):a.productEdit.setContent(a.currentProduct.contentshtml)}),a.productEdit.addListener("contentChange",function(){a.currentProduct.conError=!1,a.currentProduct.contentshtml=a.productEdit.getContent()})},1,1e6))):b.go("home")}),a.cspManageState===a.cspManageMenuState.tacticsInfo&&(void 0!=UE.delEditor?(UE.delEditor("tacticsEditor"),a.tacticsEdit=void 0,a.tacticsEdit=UE.getEditor("tacticsEditor",{toolbars:[],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!0,maximumWords:200,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:300,zIndex:0,autoHeightEnabled:!1}),a.tacticsEdit.ready(function(){""===a.currentTactics.des?a.tacticsEdit.setContent("请输入策略描述"):a.tacticsEdit.setContent(a.currentTactics.des)}),a.tacticsEdit.addListener("contentChange",function(){a.currentTactics.desError=!1,a.currentTactics.des=a.tacticsEdit.getContentTxt()})):(a.timePromise=void 0,a.timePromise=c(function(){c.cancel(a.timePromise),a.timePromise=void 0,UE.delEditor("tacticsEditor"),a.tacticsEdit=void 0,a.tacticsEdit=UE.getEditor("tacticsEditor",{toolbars:[],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!0,maximumWords:200,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:300,zIndex:0,autoHeightEnabled:!1}),a.tacticsEdit.ready(function(){""===a.currentTactics.des?a.tacticsEdit.setContent("请输入策略描述"):a.tacticsEdit.setContent(a.currentTactics.des)}),a.tacticsEdit.addListener("contentChange",function(){a.currentTactics.desError=!1,a.currentTactics.des=a.tacticsEdit.getContentTxt()})},1,1e6))),a.cspManageState===a.cspManageMenuState.userManage){var i={};i.kind="1",a.userCurrentPage=1,i.page=a.userCurrentPage,i.pageCount=a.pageCount,e.cspManageGetAllUser(i,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}if(a.cspManageState===a.cspManageMenuState.analogProductManage&&a.cspManageGetPageProducts(2,1,function(a){"succeed"!=a.result&&alert("获取数据失败")}),a.cspManageState===a.cspManageMenuState.analogProductInfo&&(jQuery("#csp_manage_analogProduct_series_select").dropdown({onChange:function(b,c,d){""!=b&&(a.currentanalogProduct.seriesid=b)}}),jQuery("#csp_manage_analogProduct_risklevel_select").dropdown({onChange:function(b,c,d){""!=b&&(a.currentanalogProduct.risklevelid=b)}}),void 0!=UE.delEditor?(UE.delEditor("analogProductEditor"),a.analogProductEdit=void 0,a.analogProductEdit=UE.getEditor("analogProductEditor",{toolbars:[["Undo","Redo","indent","paragraph","fontfamily","fontsize","forecolor","backcolor","Bold","italic","underline","strikethrough","subscript","superscript","fontborder","formatmatch","blockquote","link","selectall","removeformat"],["simpleupload","inserttable","deletetable","edittable","edittd","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells"]],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!1,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:500,zIndex:0,autoHeightEnabled:!1}),a.analogProductEdit.ready(function(){""===a.currentanalogProduct.contentshtml?a.analogProductEdit.setContent("请输入产品详情"):a.analogProductEdit.setContent(a.currentanalogProduct.contentshtml)}),a.analogProductEdit.addListener("contentChange",function(){a.currentanalogProduct.conError=!1,a.currentanalogProduct.contentshtml=a.analogProductEdit.getContent()})):(a.timePromise=void 0,a.timePromise=c(function(){c.cancel(a.timePromise),a.timePromise=void 0,UE.delEditor("analogProductEditor"),a.analogProductEdit=void 0,a.analogProductEdit=UE.getEditor("analogProductEditor",{toolbars:[["Undo","Redo","indent","paragraph","fontfamily","fontsize","forecolor","backcolor","Bold","italic","underline","strikethrough","subscript","superscript","fontborder","formatmatch","blockquote","link","selectall","removeformat"],["simpleupload","inserttable","deletetable","edittable","edittd","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells"]],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!1,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:500,zIndex:0,autoHeightEnabled:!1}),a.analogProductEdit.ready(function(){""===a.currentanalogProduct.contentshtml?a.analogProductEdit.setContent("请输入产品详情"):a.analogProductEdit.setContent(a.currentanalogProduct.contentshtml)}),a.analogProductEdit.addListener("contentChange",function(){a.currentanalogProduct.conError=!1,a.currentanalogProduct.contentshtml=a.analogProductEdit.getContent()})},1,1e6))),a.cspManageState===a.cspManageMenuState.analogTacticsManage){var j={};a.analogTacticsCurrentPage=1,j.page=a.analogTacticsCurrentPage,j.pageCount=a.pageCount,e.cspGetAllanalogTactics(j,function(b){if(b.result="succeed"){a.analogTacticsList=b.data,a.analogTacticsTotalPage=Math.ceil(b.count/a.pageCount),a.analogTacticsPages=[];var c=1;a.analogTacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.analogTacticsTotalPage<=a.itemCount?c=1:(c=a.analogTacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogTacticsTotalPage-c+1<a.itemCount&&(c=a.analogTacticsTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.analogTacticsTotalPage||a.analogTacticsTotalPage<=1);d++){var e={};e.num=d,d===a.analogTacticsCurrentPage?e.select=!0:e.select=!1,a.analogTacticsPages.push(e)}a.analogTacticsTotalPage<=1?(a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1):(a.analogTacticsShowPrev=!0,a.analogTacticsShowNext=!0)}else alert("数据更新失败")})}if(a.cspManageState===a.cspManageMenuState.analogTacticsInfo&&(UE.delEditor("analogTacticsEditor"),a.analogTacticsEdit=void 0,a.analogTacticsEdit=UE.getEditor("analogTacticsEditor",{toolbars:[],autoClearinitialContent:!0,enableAutoSave:!1,wordCount:!1,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:300,zIndex:0,autoHeightEnabled:!1}),a.analogTacticsEdit.ready(function(){""===a.currentanalogTactics.des?a.analogTacticsEdit.setContent("请输入策略描述"):a.analogTacticsEdit.setContent(a.currentanalogTactics.des)}),a.analogTacticsEdit.addListener("contentChange",function(){a.currentanalogTactics.desError=!1,a.currentanalogTactics.des=a.analogTacticsEdit.getContentTxt()})),a.cspManageState===a.cspManageMenuState.orderManage){var k={};a.orderCurrentPage=1,k.page=a.orderCurrentPage,k.pageCount=a.pageCount,k.stats=-1,e.cspManageGetAllOrder(k,function(b){if("succeed"===b.result){a.orderSelectKinds=[];var c={};c.osid=-1,c.osdesc="查询全部",a.orderKinds=b.ostate,a.orderSelectKinds.push(c);for(var d=0;d<a.orderKinds.length;d++)a.orderSelectKinds.push(a.orderKinds[d]);a.orderCurrentKind=a.orderSelectKinds[0],a.orders=b.data;for(var e=0;e<a.orders.length;e++)a.orders[e].edit=!1,a.orders[e].editKind={},a.orders[e].editmarks=a.orders[e].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var f=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?f=1:(f=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-f+1<a.itemCount&&(f=a.orderTotalPage-a.itemCount+1));for(var g=f;g<f+a.itemCount&&!(g>a.orderTotalPage||a.orderTotalPage<=1);g++){var h={};h.num=g,g===a.orderCurrentPage?h.select=!0:h.select=!1,a.orderPages.push(h)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}if(a.cspManageState===a.cspManageMenuState.seriesManage&&a.cspManageRefreshSeries(1),a.cspManageState===a.cspManageMenuState.noticeManage&&(a.noticeSelect.protype=0,a.noticeSelect.proid=0,a.noticeSelect.seriesid=-1,a.noticeSelect.caption="",jQuery("#csp_manage_notice_protype_dropdown").dropdown({onChange:function(b,c,d){a.$apply(function(){if(a.noticeSelect.protype=b,0!=b){a.noticeSelect.seriesid=-1,a.noticeSelect.caption="",a.noticeproduct.splice(0,a.noticeproduct.length);var c={};c.protype=b,e.cspManageGetNoticeProduct(c,function(b){"succeed"==b.result&&(a.noticeproduct=b.data,jQuery("#csp_manage_notice_proid_dropdown").dropdown("clear"),jQuery("#csp_manage_notice_proid_dropdown").dropdown({onChange:function(b,c,d){""==b||(a.noticeSelect.caption=jQuery("#csp_manage_notice_proid_dropdown").dropdown("get text"),a.noticeSelect.proid=b,a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,1))},on:"click"}))})}else 0==b&&(a.noticeSelect.proid=0,a.noticeSelect.seriesid=-1,a.noticeSelect.caption="",a.noticeseries.splice(0,a.noticeseries.length),e.cspManageGetAllSeries({},function(b){"succeed"==b.result&&(a.noticeseries=b.data,jQuery("#csp_manage_notice_series_dropdown").dropdown("restore defaults"))}))})},on:"click"}),e.cspManageGetAllSeries({},function(b){"succeed"==b.result&&(a.noticeseries=b.data,jQuery("#csp_manage_notice_series_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.noticeSelect.seriesid=b,a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,1))},on:"click"}))}),a.cspManageGetPageNotices(0,0,-1,1)),a.cspManageState===a.cspManageMenuState.userLoad){var l=document.documentElement.clientHeight-100,m=l+"px";document.getElementById("csp_manage_load_user_body").style.minHeight=m,window.scrollTo(0,0),a.showloadUserTips=!1,a.loadUserOperInfo.loading=!1,a.loadUserOperInfo.fileRight=!1,a.loadUserResInfo.loading=!1,a.loadUserCheckAll=!1,a.loadUserCheckOnce=!1,a.loadUsers.splice(0,a.loadUsers.length),d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){"succeed"==c.result?1==c.gorisk?b.go("risklevel"):(a.conlevelInfo.splice(0,a.conlevelInfo.length),e.cspManageGetConlevel({},function(b){"succeed"==b.result?a.conlevelInfo=b.data:alert("获取数据失败，请刷新页面重试")})):b.go("home")})}if(a.cspManageState===a.cspManageMenuState.boughtManage&&(a.boughtSearch.type=1,a.boughtSearch.seriesid=-1,a.boughtSearch.proid=0,a.boughtSearch.userinfo="",a.boughts.splice(0,a.boughts.length),a.boughtSeries.splice(0,a.boughtSeries.length),a.boughtDeleteLoading.loading=!1,a.boughtDeleteLoading.error=!1,a.boughtDeleteLoading.errorString="",e.cspManageGetAllSeries({},function(b){"succeed"==b.result?a.boughtSeries=b.data:alert("获取数据失败")}),jQuery("#csp_manage_bought_search_type_dropdown").dropdown({onChange:function(b,c,d){switch(b){case"1":a.$apply(function(){a.boughtSearch.type=1}),a.boughtSearch.seriesid=-1,jQuery("#csp_manage_bought_search_series_dropdown").dropdown("clear"),a.boughtSeries.splice(0,a.boughtSeries.length),e.cspManageGetAllSeries({},function(b){"succeed"==b.result?a.boughtSeries=b.data:alert("获取数据失败")});break;case"2":a.$apply(function(){a.boughtSearch.type=2}),a.boughtSearch.proid=0,jQuery("#csp_manage_bought_search_product_dropdown").dropdown("clear"),a.boughtProducts.splice(0,a.boughtProducts.length);var f={};f.protype=1,e.cspManageGetNoticeProduct(f,function(b){console.log(b),"succeed"==b.result?a.boughtProducts=b.data:alert("获取数据失败")});break;case"3":a.$apply(function(){a.boughtSearch.type=3}),a.boughtSearch.userinfo=""}},on:"click"}),jQuery("#csp_manage_bought_search_series_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.boughtSearch.seriesid=b)},on:"click"}),jQuery("#csp_manage_bought_search_product_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.boughtSearch.proid=b)},on:"click"})),a.cspManageState===a.cspManageMenuState.boughtLoad){var n=document.documentElement.clientHeight-100,o=n+"px";document.getElementById("csp_manage_load_bought_body").style.minHeight=o,window.scrollTo(0,0),a.loadBoughts.splice(0,a.loadBoughts.length)}},a.cspUserAndGroup=function(){b.go("customerGroup")},a.sendMessage=function(){var a={};a.messageType="sendMessage",f.setMessageType(a,function(a){0!=a.result&&b.go("sendMessage")})},a.editMessage=function(){var a={};a.messageType="editMessage",f.setMessageType(a,function(a){0!=a.result&&b.go("sendMessage")})},a.cspManageClickProduct=function(){a.cspManageMenuChange(a.cspManageState,0)},a.cspManageClickanalogProduct=function(){a.cspManageMenuChange(a.cspManageState,5)},a.cspManageClickTactics=function(){a.cspManageMenuChange(a.cspManageState,1)},a.cspManageClickanalogTactics=function(){a.cspManageMenuChange(a.cspManageState,7)},a.cspManageClickOrder=function(){a.cspManageMenuChange(a.cspManageState,9)},a.cspManageClickUser=function(){a.cspManageMenuChange(a.cspManageState,4)},a.cspManageClickSeries=function(){a.cspManageMenuChange(a.cspManageState,10)},a.cspManageClickNotice=function(){a.cspManageMenuChange(a.cspManageState,11)},a.cspManageClickExit=function(){document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",b.go("usercenter")},a.cspManageClickBuy=function(){a.cspManageMenuChange(a.cspManageState,a.cspManageMenuState.boughtManage)},a.cspManageMenuChange=function(b,c){switch(b){case a.cspManageMenuState.productManage:case a.cspManageMenuState.productInfo:document.getElementById("csp_manage_product").className="teal item";break;case a.cspManageMenuState.tacticsManage:case a.cspManageMenuState.tacticsInfo:document.getElementById("csp_manage_tactics").className="teal item";break;case a.cspManageMenuState.userManage:case a.cspManageMenuState.userLoad:document.getElementById("csp_manage_user").className="teal item";break;case a.cspManageMenuState.analogProductManage:case a.cspManageMenuState.analogProductInfo:document.getElementById("csp_manage_analogproduct").className="teal item";break;case a.cspManageMenuState.analogTacticsManage:case a.cspManageMenuState.analogTacticsInfo:document.getElementById("csp_manage_analogtactics").className="teal item";break;case a.cspManageMenuState.orderManage:document.getElementById("csp_manage_order").className="teal item";break;case a.cspManageMenuState.seriesManage:document.getElementById("csp_manage_series").className="teal item";break;case a.cspManageMenuState.noticeManage:document.getElementById("csp_manage_notice").className="teal item";break;case a.cspManageMenuState.boughtManage:case a.cspManageMenuState.boughtLoad:document.getElementById("csp_manage_buy").className="teal item"}switch(c){case 0:document.getElementById("csp_manage_product").className="active teal item",a.cspManageLoadPath="tpls/managecenter/productManage.html",a.cspManageState=0;break;case 1:document.getElementById("csp_manage_tactics").className="active teal item",a.cspManageLoadPath="tpls/managecenter/tacticsManage.html",a.cspManageState=1;break;case 4:document.getElementById("csp_manage_user").className="active teal item",a.cspManageLoadPath="tpls/managecenter/usermanage.html",a.cspManageState=4;break;case 5:document.getElementById("csp_manage_analogproduct").className="active teal item",a.cspManageLoadPath="tpls/managecenter/analogproductmanage.html",a.cspManageState=5;break;case 7:document.getElementById("csp_manage_analogtactics").className="active teal item",
a.cspManageLoadPath="tpls/managecenter/analogtacticsmanage.html",a.cspManageState=7;break;case 9:document.getElementById("csp_manage_order").className="active teal item",a.cspManageLoadPath="tpls/managecenter/ordermanage.html",a.cspManageState=9;break;case 10:document.getElementById("csp_manage_series").className="active teal item",a.cspManageLoadPath="tpls/managecenter/seriesmanage.html",a.cspManageState=10;break;case 11:document.getElementById("csp_manage_notice").className="active teal item",a.cspManageLoadPath="tpls/managecenter/noticemanage.html",a.cspManageState=11;break;case a.cspManageMenuState.boughtManage:document.getElementById("csp_manage_buy").className="active teal item",a.cspManageLoadPath="tpls/managecenter/boughtmanage.html",a.cspManageState=a.cspManageMenuState.boughtManage}},a.cspManageGetPageProducts=function(b,c,d){var f={};f.protype=b,f.page=c,f.pageCount=a.pageCount,e.cspManageGetPageProducts(f,function(f){if("succeed"==f.result){var g={};g.protype=b,e.cspManageGetShowProducts(g,function(e){if("succeed"==e.result){if(1==b){a.productType=b,a.productCurrentPage=c,a.products=f.data_product;for(var g=0;g<f.data_product.length;g++)if(""!==f.data_product[g]){for(var h="",i=f.data_product[g].tacticsList.split(","),j=0;j<i.length;j++)for(var k=0;k<f.data_tactics.length;k++)i[j]==f.data_tactics[k].tsid&&(h+=""!==h?" ， "+f.data_tactics[k].tsname:f.data_tactics[k].tsname);a.products[g].tacticsName=h}a.productTotalPage=Math.ceil(f.count/a.pageCount),a.productPages=[];var l=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?l=1:(l=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-l+1<a.itemCount&&(l=a.productTotalPage-a.itemCount+1));for(var m=l;m<l+a.itemCount&&!(m>a.productTotalPage||a.productTotalPage<=1);m++){var n={};n.num=m,m===a.productCurrentPage?n.select=!0:n.select=!1,a.productPages.push(n)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0),a.homeProducts.splice(0,a.homeProducts.length);var o=0,p=0;for(o=0;o<3;o++){for(p=0;p<e.data.length;p++)if(e.data[p].priority==o+1){a.homeProducts.push(e.data[p]);break}if(p>=e.data.length){var q={};q.protype=1,q.proid=-1,q.priority=o+1,q.caption="请选择产品",q.piclink="images/addpro.png",a.homeProducts.push(q)}}e.data.length<3?a.homeProductsThree=!1:a.homeProductsThree=!0}else{console.log(f),a.productType=2,a.analogProductCurrentPage=c,a.analogProducts=f.data_product;for(var g=0;g<f.data_product.length;g++)if(""!==f.data_product[g]){for(var r="",s=f.data_product[g].analogTacticsList.split(","),j=0;j<s.length;j++)for(var k=0;k<f.data_tactics.length;k++)s[j]==f.data_tactics[k].tsid&&(r+=""!==r?" ， "+f.data_tactics[k].tsname:f.data_tactics[k].tsname);a.analogProducts[g].analogTacticsName=r}a.analogProductTotalPage=Math.ceil(f.count/a.pageCount),a.analogProductPages=[];var l=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?l=1:(l=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-l+1<a.itemCount&&(l=a.analogProductTotalPage-a.itemCount+1));for(var m=l;m<l+a.itemCount&&!(m>a.analogProductTotalPage||a.analogProductTotalPage<=1);m++){var n={};n.num=m,m===a.analogProductCurrentPage?n.select=!0:n.select=!1,a.analogProductPages.push(n)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0),a.homeAnalogProducts.splice(0,a.homeAnalogProducts.length),console.log(e.data);var o=0,p=0;for(o=0;o<3;o++){for(p=0;p<e.data.length;p++)if(e.data[p].priority==o+1){a.homeAnalogProducts.push(e.data[p]);break}if(p>=e.data.length){var q={};q.protype=2,q.proid=-1,q.priority=o+1,q.caption="请选择产品",q.piclink="images/addpro.png",a.homeAnalogProducts.push(q)}}e.data.length<3?a.homeAnalogProductsThree=!1:a.homeAnalogProductsThree=!0}d({result:"succeed"})}else d({result:"failed"})})}else d({result:"failed"})})},a.cspManageClearProductErrorTips=function(b){switch(b){case 1:a.currentProduct.capError=!1,a.currentProduct.conError=!1,a.currentProduct.tsidError=!1,a.currentProduct.funError=!1,a.currentProduct.picError=!1,a.currentProduct.proError=!1,a.currentProduct.bpError=!1,a.currentProduct.spError=!1,a.currentProduct.srError=!1,a.currentProduct.mrError=!1,a.currentProduct.rrError=!1,a.currentProduct.mpError=!1,a.currentProduct.serError=!1,a.currentProduct.risError=!1;break;case 2:a.currentanalogProduct.capError=!1,a.currentanalogProduct.conError=!1,a.currentanalogProduct.tsidError=!1,a.currentanalogProduct.funError=!1,a.currentanalogProduct.picError=!1,a.currentanalogProduct.proError=!1,a.currentanalogProduct.bpError=!1,a.currentanalogProduct.spError=!1,a.currentanalogProduct.srError=!1,a.currentanalogProduct.mrError=!1,a.currentanalogProduct.rrError=!1,a.currentanalogProduct.mpError=!1,a.currentanalogProduct.serError=!1,a.currentanalogProduct.risError=!1}},a.cspManageAddClick=function(){a.currentProduct.caption="",a.currentProduct.capError=!1,a.currentProduct.contentshtml="",a.currentProduct.conError=!1,a.currentProduct.tsid="",a.currentProduct.tsname="",a.currentProduct.tsidError=!1,a.currentProduct.tsidArray=[],a.currentProduct.fundmanager="",a.currentProduct.funError=!1,a.currentProduct.piclink="",a.currentProduct.picError=!1,a.currentProduct.picErrorTip="",a.currentProduct.prostatus="",a.currentProduct.proError=!1,a.currentProduct.fileLoading=!1,a.currentProduct.edit=!1,a.currentProduct.addNet=!1,a.currentProduct.importNet=!1,a.currentProduct.selectTactics=!1,a.currentProduct.seriesid=-1,a.currentProduct.serError=!1,a.currentProduct.seridDefault="请选择产品系列",a.currentProduct.risklevelid=0,a.currentProduct.riskDefault="请选择风险等级",a.currentProduct.risError=!1,a.currentProduct.priority=0,a.currentProduct.addhome=!1,a.currentProduct.blackout_period="",a.currentProduct.bpError=!1,a.currentProduct.subscribe_point="",a.currentProduct.spError=!1,a.currentProduct.subscribe_rate="",a.currentProduct.srError=!1,a.currentProduct.manage_rate="",a.currentProduct.mrError=!1,a.currentProduct.redeem_rate="",a.currentProduct.rrError=!1,a.currentProduct.merit_pay="",a.currentProduct.mpError=!1,e.cspGetAllTactics({},function(b){"succeed"===b.result?(a.currentProduct.tsidList=b.data,e.cspManageGetAllSeries({},function(b){"succeed"==b.result?(a.productSeries.splice(0,a.productSeries.length),a.productSeries=b.data,a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2):alert("获取数据失败")})):alert("数据库异常")})},a.cspManageAddCancel=function(){a.cspManageLoadPath="tpls/managecenter/productManage.html",a.cspManageState=0},a.cspManageAddSure=function(){a.cspManageClearProductErrorTips(1);var b=!1,c=/^(([1-9][0-9]{0,13})|0)(.([0-9]{0,2}))?$/;""===a.currentProduct.caption&&(b=!0,a.currentProduct.capError=!0),""===a.currentProduct.contentshtml&&(b=!0,a.currentProduct.conError=!0),""===a.currentProduct.fundmanager&&(b=!0,a.currentProduct.funError=!0),""===a.currentProduct.prostatus&&(b=!0,a.currentProduct.proError=!0),a.currentProduct.tsidArray=[];for(var d=0;d<a.currentProduct.tsidList.length;d++)a.currentProduct.tsidList[d].selected===!0&&a.currentProduct.tsidArray.push(a.currentProduct.tsidList[d]);if(0===a.currentProduct.tsidArray.length&&(b=!0,a.currentProduct.tsidError=!0),a.currentProduct.seriesid==-1&&(b=!0,a.currentProduct.serError=!0),0==a.currentProduct.risklevelid&&(b=!0,a.currentProduct.risError=!0),""==a.currentProduct.blackout_period&&(b=!0,a.currentProduct.bpError=!0),c.test(a.currentProduct.subscribe_point)||(b=!0,a.currentProduct.spError=!0),c.test(a.currentProduct.subscribe_rate)||(b=!0,a.currentProduct.srError=!0),c.test(a.currentProduct.manage_rate)||(b=!0,a.currentProduct.mrError=!0),c.test(a.currentProduct.redeem_rate)||(b=!0,a.currentProduct.rrError=!0),c.test(a.currentProduct.merit_pay)||(b=!0,a.currentProduct.mpError=!0),b===!1){console.log("提交",a.currentProduct.seriesid),a.currentProduct.tsid="";for(var f=0;f<a.currentProduct.tsidArray.length;f++)0===f?a.currentProduct.tsid+=a.currentProduct.tsidArray[f].tsid:a.currentProduct.tsid+=","+a.currentProduct.tsidArray[f].tsid;if(a.currentProduct.edit===!1){if(1==a.currentProduct.addhome){var g=0;for(g=0;g<3&&a.homeProducts[g].proid!=-1;g++);a.currentProduct.priority=a.homeProducts[g].priority,a.currentProduct.toaddhome=1}else a.currentProduct.toaddhome=0;e.cspAddProduct(a.currentProduct,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/productManage.html",a.cspManageState=0):alert("数据库异常")})}else{if(1==a.currentProduct.addhome&&0==a.currentProduct.priority){var g=0;for(g=0;g<3&&a.homeProducts[g].proid!=-1;g++);a.currentProduct.priority=a.homeProducts[g].priority,a.currentProduct.toaddhome=1}else 0==a.currentProduct.addhome&&0!=a.currentProduct.priority?a.currentProduct.toaddhome=2:a.currentProduct.toaddhome=0;e.cspUpdateProduct(a.currentProduct,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/productManage.html",a.cspManageState=0):alert("数据库异常")})}}else window.scrollTo(0,0)},a.cspManageAddTactics=function(){a.currentTactics.name="",a.currentTactics.des="",a.currentTactics.nameError=!1,a.currentTactics.desError=!1,a.currentTactics.edit=!1,a.cspManageLoadPath="tpls/managecenter/tacticsinfo.html",a.cspManageState=3},a.cspManageEditTactics=function(b){a.currentTactics.tsid=a.tacticsList[b].tsid,a.currentTactics.title="编辑策略",a.currentTactics.name=a.tacticsList[b].tsname,a.currentTactics.des=a.tacticsList[b].tsdesc,a.currentTactics.nameError=!1,a.currentTactics.desError=!1,a.currentTactics.edit=!0,a.currentTactics.index=b,a.cspManageLoadPath="tpls/managecenter/tacticsinfo.html",a.cspManageState=3},a.cspManageTacticsAddCancel=function(){a.cspManageLoadPath="tpls/managecenter/tacticsManage.html",a.cspManageState=1},a.cspManageTscticsNameAccept=function(){a.currentTactics.nameError=!1},a.cspManageTscticsDesAccept=function(){a.currentTactics.desError=!1},a.cspManageTacticsAddCommit=function(){var b=!1;if(""===a.currentTactics.name&&(a.currentTactics.nameError=!0,a.currentTactics.nameTips="策略名称不能为空",b=!0),""===a.currentTactics.des&&(a.currentTactics.desError=!0,a.currentTactics.desTips="策略名称不能为空",b=!0),b===!1)if(a.currentTactics.edit===!1){var c={};c.tacticsName=a.currentTactics.name,c.tacticsDes=a.currentTactics.des,e.cspAddTactics(c,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/tacticsManage.html",a.cspManageState=1,e.cspGetAllTactics({},function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"")}else alert("数据更新失败")})):alert("数据库异常")})}else{var d={};d.tsid=a.currentTactics.tsid,d.tsname=a.currentTactics.name,d.tsdesc=a.currentTactics.des,e.cspUpdateTactics(d,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/tacticsManage.html",a.cspManageState=1,a.tacticsList[a.currentTactics.index]=d,e.cspGetAllTactics({},function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"")}else alert("数据更新失败")})):alert("数据库异常")})}},a.cspManageDeleteTactics=function(b){console.log(a.tacticsList[b]);var c={};c.tsid=a.tacticsList[b].tsid,e.cspDeleteTactics(c,function(c){"succeed"===c.result?(a.tacticsList.splice(b,1),e.cspGetAllTactics({},function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"")}else alert("数据更新失败")})):alert("数据库异常")})},a.cspManageDeleteProduct=function(b){console.log(a.products[b].id);var c={};c.id=a.products[b].id,c.contents=a.products[b].contents,e.cspDeleteProduct(c,function(c){if("succeed"===c.result){a.products.splice(b,1);var d={};d.page=a.productCurrentPage,d.pageCount=a.pageCount,e.cspGetAllProduct(d,function(b){if("succeed"===b.result){a.products=b.data_product;for(var c=0;c<b.data_product.length;c++)if(""!==b.data_product[c]){for(var d="",e=b.data_product[c].tacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_tactics.length;g++)e[f]==b.data_tactics[g].tsid&&(d+=""!==d?","+b.data_tactics[g].tsname:b.data_tactics[g].tsname);a.products[c].tacticsName=d}a.productTotalPage=Math.ceil(b.count/a.pageCount),a.productPages=[];var h=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?h=1:(h=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-h+1<a.itemCount&&(h=a.productTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.productTotalPage||a.productTotalPage<=1);i++){var j={};j.num=i,i===a.productCurrentPage?j.select=!0:j.select=!1,a.productPages.push(j)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0)}else alert("获取数据失败，请重试")})}else alert("数据库异常")})},a.cspManageProductAddImag=function(){a.currentProduct.picError=!1,document.getElementById("cspManageProductFile").click()},a.cspManageProductDeletePic=function(){if(""===a.currentProduct.piclink);else{var b={};b.filepath=a.currentProduct.piclink,a.currentProduct.fileLoading=!0,e.cspManageDeleteFile(b,function(b){"succeed"===b.result?(a.currentProduct.piclink="",a.currentProduct.fileLoading=!1):(a.currentProduct.fileLoading=!1,a.currentProduct.picError=!0,a.currentProduct.picErrorTip="文件删除失败")})}},a.cspManageProductUploadPic=function(){a.currentProduct.fileLoading=!0;var b=new FormData,c=document.getElementById("cspManageProductFile").files[0];b.append("file",c),e.cspManageUploadFile(b,function(b){"succeed"===b.result?(a.currentProduct.piclink=b.piclink,a.currentProduct.fileLoading=!1):(a.currentProduct.fileLoading=!1,a.currentProduct.picError=!0,a.currentProduct.picErrorTip="文件上传失败")})},a.cspManageProductErrorPic=function(){a.currentProduct.picError=!0,a.currentProduct.picErrorTip="仅支持jpg/png/bmp格式"},a.cspManageAddSingleData=function(){a.currentProduct.addSingleData={},a.currentProduct.addNet=!0,a.currentProduct.importNet=!1;var b=new Date;a.currentProduct.addSingleData.date=b.toLocaleDateString().replace(/\//g,"-"),a.currentProduct.addSingleData.net="",a.currentProduct.addSingleData.totalnet="",a.currentProduct.addSingleData.accrate="",a.currentProduct.addSingleData.yearrate="",a.currentProduct.addSingleData.edit=!1,a.currentProduct.addSingleData.netError=!1,a.currentProduct.addSingleData.tolError=!1,a.currentProduct.addSingleData.accError=!1,a.currentProduct.addSingleData.yearError=!1,a.currentProduct.addSingleData.dateError=!1},a.cspManageAddNetDataCancel=function(){a.currentProduct.addNet=!1},a.cspManageAddNetDataSure=function(){var b=!1,c=/^\d+(\.\d+)?$/,d=/^(\d{4})-(\d{1,2})-(\d{1,2})$/;if(""!==a.currentProduct.addSingleData.net&&c.test(a.currentProduct.addSingleData.net)||(b=!0,a.currentProduct.addSingleData.netError=!0),""!==a.currentProduct.addSingleData.totalnet&&c.test(a.currentProduct.addSingleData.totalnet)||(b=!0,a.currentProduct.addSingleData.tolError=!0),""!==a.currentProduct.addSingleData.accrate&&c.test(a.currentProduct.addSingleData.accrate)||(b=!0,a.currentProduct.addSingleData.accError=!0),""!==a.currentProduct.addSingleData.yearrate&&c.test(a.currentProduct.addSingleData.yearrate)||(b=!0,a.currentProduct.addSingleData.yearError=!0),""!==a.currentProduct.addSingleData.date&&d.test(a.currentProduct.addSingleData.date)||(b=!0,a.currentProduct.addSingleData.dateError=!0),b===!1){var f={};f.date=a.currentProduct.addSingleData.date,f.proid=a.currentProduct.id,e.cspManageCheckNetExist(f,function(b){if("succeed"===b.result)if(b.exist===!0)a.currentProduct.addSingleData.dateError=!0;else{var c={};c.net=a.currentProduct.addSingleData.net,c.totalnet=a.currentProduct.addSingleData.totalnet,c.accrate=a.currentProduct.addSingleData.accrate,c.yearrate=a.currentProduct.addSingleData.yearrate,c.date=a.currentProduct.addSingleData.date,c.proid=a.currentProduct.id,e.cspAddSingleNet(c,function(b){if("succeed"===b.result){a.currentProduct.addNet=!1;var c={};c.proid=a.currentProduct.id,a.netCurrentPage=1,c.page=a.netCurrentPage,c.pageCount=a.pageCount,e.cspGetNetByProductId(c,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}else alert("数据库异常")})}},a.cspManageHideNetError=function(){""!==a.currentProduct.addSingleData.net&&(a.currentProduct.addSingleData.netError=!1),""!==a.currentProduct.addSingleData.totalnet&&(a.currentProduct.addSingleData.tolError=!1),""!==a.currentProduct.addSingleData.accrate&&(a.currentProduct.addSingleData.accError=!1),""!==a.currentProduct.addSingleData.yearrate&&(a.currentProduct.addSingleData.yearError=!1),""!==a.currentProduct.addSingleData.date&&(a.currentProduct.addSingleData.dateError=!1)},a.cspManageEditNetData=function(b){a.currentProduct.nets[b].editNet=a.currentProduct.nets[b].net,a.currentProduct.nets[b].editTotalNet=a.currentProduct.nets[b].totalnet,a.currentProduct.nets[b].editAccrate=a.currentProduct.nets[b].accrate,a.currentProduct.nets[b].editYearrate=a.currentProduct.nets[b].yearrate,a.currentProduct.nets[b].edit=!0},a.cspManageDeleteNetData=function(b){var c={};c.ID=a.currentProduct.nets[b].ID,e.cspDeleteSingleNet(c,function(c){if("succeed"===c.result){a.currentProduct.nets.splice(b,1);var d={};d.proid=a.currentProduct.id,a.netCurrentPage=1,d.page=a.netCurrentPage,d.pageCount=a.pageCount,e.cspGetNetByProductId(d,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0)}else alert("刷新数据失败")})}else alert("数据库异常")})},a.importExcel=function(){a.currentProduct.addNet=!1,a.currentProduct.importNet=!0,a.currentProduct.loaddata={},a.currentProduct.loaddata.loading=!1,a.currentProduct.loaddata.fileRight=!1,a.currentProduct.loaddata.fileError=!1,a.currentProduct.loaddata.errorTip="",a.currentProduct.loaddata.nets=[],a.timePromise=void 0;var b=1;a.timePromise=c(function(){if(b<=0){c.cancel(a.timePromise),a.timePromise=void 0;var d=document.getElementById("csp_manage_product_import_net_div").offsetTop;window.scrollTo(0,d-300)}else b--},1,1e3)},a.cspManageImportDataSelectFile=function(){a.currentProduct.loaddata.fileError=!1,a.currentProduct.loaddata.errorTip="",document.getElementById("csp_manage_import_file_load_form").reset(),document.getElementById("csp_manage_import_file_load_input").click()},a.cspManageImportLoadFileReady=function(){a.currentProduct.loaddata.loading=!0;var b=new FormData,c=document.getElementById("csp_manage_import_file_load_input").files[0];b.append("file",c),e.cspManageImportLoadFile(b,function(b){if(a.currentProduct.loaddata.loading=!1,"succeed"===b.result)if(b.file===!0){a.currentProduct.loaddata.fileRight=!0;for(var c=0;c<b.data.length;c++)a.currentProduct.loaddata.nets.push(b.data[c])}else a.currentProduct.loaddata.fileError=!0,a.currentProduct.loaddata.errorTip="文件内容格式错误";else a.currentProduct.loaddata.fileError=!0,a.currentProduct.loaddata.errorTip="文件上传失败"})},a.cspManageImportFileError=function(){a.currentProduct.loaddata.fileError=!0,a.currentProduct.loaddata.errorTip="请选择csv/xls/xlsx格式的文件"},a.cspManageImportClearTable=function(){a.currentProduct.loaddata.fileRight=!1,a.currentProduct.loaddata.nets=[]},a.cspManageImportLoadTable=function(){var b=/^\d+(\.\d+)?$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,d=0,f=[],g=!1;for(d=0;d<a.currentProduct.loaddata.nets.length;d++){if(void 0===a.currentProduct.loaddata.nets[d].date||!c.test(a.currentProduct.loaddata.nets[d].date)){g=!0;break}if(void 0===a.currentProduct.loaddata.nets[d].net||!b.test(a.currentProduct.loaddata.nets[d].net)){g=!0;break}if(void 0===a.currentProduct.loaddata.nets[d].totalnet||!b.test(a.currentProduct.loaddata.nets[d].totalnet)){g=!0;break}if(void 0===a.currentProduct.loaddata.nets[d].accrate||!b.test(a.currentProduct.loaddata.nets[d].accrate)){g=!0;break}if(void 0===a.currentProduct.loaddata.nets[d].yearrate||!b.test(a.currentProduct.loaddata.nets[d].yearrate)){g=!0;break}var h=0;for(h=0;h<f.length;h++)if(a.currentProduct.loaddata.nets[d].date===f[h]){g=!0;break}h>=f.length&&f.push(a.currentProduct.loaddata.nets[d].date)}if(g===!0)a.currentProduct.loaddata.fileError=!0,a.currentProduct.loaddata.errorTip="请检查数据格式及日期是否重复";else{var i={};i.proid=a.currentProduct.id,i.nets=a.currentProduct.loaddata.nets,i.count=a.currentProduct.loaddata.nets.length,e.cspManageImportInsertToDb(i,function(b){if("succeed"===b.result){a.currentProduct.importNet=!1;var c={};c.proid=a.currentProduct.id,a.netCurrentPage=1,c.page=a.netCurrentPage,c.pageCount=a.pageCount,e.cspGetNetByProductId(c,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}},a.cspManageImportDeleteData=function(b){a.currentProduct.loaddata.nets.splice(b,1),0===a.currentProduct.loaddata.nets.length&&(a.currentProduct.loaddata.fileRight=!1)},a.cspManageEditProduct=function(b){a.currentProduct.id=a.products[b].id,a.currentProduct.caption=a.products[b].caption,a.currentProduct.capError=!1,a.currentProduct.contents=a.products[b].contents,a.currentProduct.conError=!1,a.currentProduct.tsid=a.products[b].tacticsList,a.currentProduct.tsname=a.products[b].tacticsName,a.currentProduct.tsidError=!1,a.currentProduct.tsidArray=[],a.currentProduct.tsidList=[],a.currentProduct.fundmanager=a.products[b].fundmanager,a.currentProduct.funError=!1,a.currentProduct.piclink=a.products[b].piclink,a.currentProduct.picError=!1,a.currentProduct.picErrorTip="",a.currentProduct.prostatus=a.products[b].prostatus,a.currentProduct.proError=!1,a.currentProduct.fileLoading=!1,a.currentProduct.edit=!0,a.currentProduct.addNet=!1,a.currentProduct.importNet=!1,a.currentProduct.nets=[],a.currentProduct.selectTactics=!1,a.currentProduct.snetdate=a.products[b].snetdate,a.currentProduct.snet=a.products[b].snet,a.currentProduct.netError=!1,a.currentProduct.loadExcel=!1,a.currentProduct.seriesid=a.products[b].serid,a.currentProduct.seriesid==-1?a.currentProduct.seridDefault="请选择产品系列":a.currentProduct.seridDefault=a.products[b].sername,a.currentProduct.serError=!1,a.currentProduct.risklevelid=a.products[b].risklevelid,a.currentProduct.riskDefault=0==a.products[b].risklevelid?"请选择风险等级":a.products[b].rname,a.currentProduct.risError=!1,a.currentProduct.blackout_period=a.products[b].blackout_period,a.currentProduct.bpError=!1,a.currentProduct.subscribe_point=a.products[b].subscribe_point,a.currentProduct.spError=!1,a.currentProduct.subscribe_rate=100*a.products[b].subscribe_rate,a.currentProduct.srError=!1,a.currentProduct.manage_rate=100*a.products[b].manage_rate,a.currentProduct.mrError=!1,a.currentProduct.redeem_rate=100*a.products[b].redeem_rate,a.currentProduct.rrError=!1,a.currentProduct.merit_pay=100*a.products[b].merit_pay,a.currentProduct.mpError=!1,a.currentProduct.priority=a.products[b].priority,a.currentProduct.addhome=0!=a.products[b].priority,a.currentProduct.spotload=!1,a.currentProduct.showLoadSpot=!0,a.currentProduct.spotadd=!1,a.currentProduct.spotcheckall=!1;var c={};c.contents=a.products[b].contents,e.cspManageGetProductDes(c,function(c){"succeed"===c.result?a.currentProduct.contentshtml=c.data:a.currentProduct.contentshtml="",e.cspGetAllTactics({},function(c){if("succeed"===c.result){var d=a.currentProduct.tsid.split(",");console.log(a.currentProduct.tsid,d),a.currentProduct.tsidList=c.data;for(var f=0;f<c.data.length;f++){for(var g=0;g<d.length;g++)if(d[g]==c.data[f].tsid){a.currentProduct.tsidList[f].selected=!0;break}g>=d.length&&(a.currentProduct.tsidList[f].selected=!1)}var h={};h.proid=a.products[b].id,a.netCurrentPage=1,h.page=a.netCurrentPage,h.pageCount=a.pageCount,e.cspGetNetByProductId(h,function(c){if("succeed"===c.result){a.currentProduct.nets=c.data,a.currentProduct.checkall=!1;for(var d=0;d<a.currentProduct.nets.length;d++)a.currentProduct.nets[d].edit=!1,a.currentProduct.nets[d].checked=!1;0===c.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,console.log(c.count),a.netTotalPage=Math.ceil(c.count/a.pageCount),a.netPages=[];var f=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?f=1:(f=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-f+1<a.itemCount&&(f=a.netTotalPage-a.itemCount+1));for(var g=f;g<f+a.itemCount&&!(g>a.netTotalPage||a.netTotalPage<=1);g++){var h={};h.num=g,g===a.netCurrentPage?h.select=!0:h.select=!1,a.netPages.push(h)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0);var i={};i.proid=a.products[b].id,i.protype=a.productType,a.spotCurrentPage=1,i.page=a.spotCurrentPage,i.pageCount=a.pageCount,e.cspManageGetSpot(i,function(c){if("succeed"===c.result){a.currentProduct.spots=c.data,a.currentProduct.checkallspot=!1;for(var d=0;d<a.currentProduct.spots.length;d++)a.currentProduct.spots[d].edit=!1,a.currentProduct.spots[d].checked=!1;0===c.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1,console.log(c.count),a.spotTotalPage=Math.ceil(c.count/a.pageCount),a.spotPages=[];var f=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?f=1:(f=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-f+1<a.itemCount&&(f=a.spotTotalPage-a.itemCount+1));for(var g=f;g<f+a.itemCount&&!(g>a.spotTotalPage||a.spotTotalPage<=1);g++){var h={};h.num=g,g===a.spotCurrentPage?h.select=!0:h.select=!1,a.spotPages.push(h)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0);var i={};i.proid=a.products[b].id,i.protype=a.productType,a.futuresCurrentPage=1,i.page=a.futuresCurrentPage,i.pageCount=a.pageCount,e.cspManageGetFutures(i,function(b){if("succeed"===b.result){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1,console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var f=d;f<d+a.itemCount&&!(f>a.futuresTotalPage||a.futuresTotalPage<=1);f++){var g={};g.num=f,f===a.futuresCurrentPage?g.select=!0:g.select=!1,a.futuresPages.push(g)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0),e.cspManageGetAllSeries({},function(b){"succeed"==b.result?(a.productSeries.splice(0,a.productSeries.length),a.productSeries=b.data,a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2):alert("获取数据失败")})}else alert("获取数据失败")})}else alert("获取数据失败")})}else alert("获取数据失败")})}else alert("数据库异常")})})},a.cspManageEditNetDataCancel=function(b){a.currentProduct.nets[b].edit=!1},a.cspManageSaveNetData=function(b){var c=!1,d=/^\d+(\.\d+)?$/;if(""!==a.currentProduct.nets[b].editNet&&d.test(a.currentProduct.nets[b].editNet)||(c=!0),""!==a.currentProduct.nets[b].editTotalNet&&d.test(a.currentProduct.nets[b].editTotalNet)||(c=!0),""!==a.currentProduct.nets[b].editAccrate&&d.test(a.currentProduct.nets[b].editAccrate)||(c=!0),""!==a.currentProduct.nets[b].editYearrate&&d.test(a.currentProduct.nets[b].editYearrate)||(c=!0),c===!0)alert("请正确输入编辑的信息");else{var f={};f.net=a.currentProduct.nets[b].editNet,f.totalnet=a.currentProduct.nets[b].editTotalNet,f.accrate=a.currentProduct.nets[b].editAccrate,f.yearrate=a.currentProduct.nets[b].editYearrate,f.ID=a.currentProduct.nets[b].ID,e.cspUpdateSingleNet(f,function(c){if("succeed"===c.result){a.currentProduct.nets[b].edit=!1;var d={};d.proid=a.currentProduct.id,d.page=a.netCurrentPage,d.pageCount=a.pageCount,e.cspGetNetByProductId(d,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0)}else alert("获取数据失败")})}else a.currentProduct.nets[b].edit=!1,alert("数据库异常")})}},a.cspManageProductSelectTactics=function(b){a.currentProduct.selectTactics=!0,a.currentProduct.tsidError=!1,document.getElementById("csp_manage_product_tactics_select").style.width=document.getElementById("csp_manage_product_tactics_result").offsetWidth+"px",b.stopPropagation()},a.cspManageProductCloseTactics=function(){a.currentProduct.selectTactics=!1},a.cspManageProductStop=function(a){console.log("dfdf"),a.stopPropagation()},a.cspManageProductSelectTacticsSure=function(b){a.currentProduct.tsidList[b].selected=!a.currentProduct.tsidList[b].selected;var c=0;a.currentProduct.tsname="";for(var d=0;d<a.currentProduct.tsidList.length;d++)a.currentProduct.tsidList[d].selected===!0&&(0===c?(c=1,a.currentProduct.tsname+=a.currentProduct.tsidList[d].tsname):a.currentProduct.tsname+=" ， "+a.currentProduct.tsidList[d].tsname)},a.cspManageSelectUserChange=function(){var b=document.getElementById("csp_manage_user_kind").value;if(b===a.currentUserKind);else{a.currentUserKind=b;var c={};c.kind=a.currentUserKind,a.userCurrentPage=1,
c.page=a.userCurrentPage,c.pageCount=a.pageCount,e.cspManageGetAllUser(c,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageEditUser=function(b){a.users[b].memberlevels=[],e.cspManageGetMemberLevel({},function(c){if("succeed"===c.result){a.users[b].memberlevels=c.data,a.users[b].edit=!0;for(var d=0;d<c.data.length;d++)if(a.users[b].conlevel===c.data[d].id){a.users[b].selectMemLevel=c.data[d];break}}else alert("数据库异常")})},a.cspManageEditUserSave=function(b){if(a.users[b].conlevel===a.users[b].selectMemLevel.id)a.users[b].edit=!1;else{var c={};c.uid=a.users[b].uid,c.conlevel=a.users[b].selectMemLevel.id,e.cspManageChangeUserLevel(c,function(c){if("succeed"===c.result){a.users[b].edit=!1;var d={};d.kind=a.currentUserKind,d.page=a.userCurrentPage,d.pageCount=a.pageCount,e.cspManageGetAllUser(d,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}else alert("数据库异常")})}},a.cspManageEditUserCancel=function(b){a.users[b].edit=!1},a.cspManageFinishCheck=function(b){var c={};c.uid=a.users[b].uid,e.cspManageChangeUserCheckState(c,function(b){if("succeed"===b.result){var c={};c.kind=a.currentUserKind,c.page=a.userCurrentPage,c.pageCount=a.pageCount,e.cspManageGetAllUser(c,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}else alert("数据库异常")})},a.cspManageCheckAllNets=function(){if(a.currentProduct.checkall===!1){a.currentProduct.checkall=!0;for(var b=0;b<a.currentProduct.nets.length;b++)a.currentProduct.nets[b].checked=!0}else{a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].checked=!1}},a.cspManageNetCheckClick=function(){a.currentProduct.checkall=!0;for(var b=0;b<a.currentProduct.nets.length;b++)a.currentProduct.nets[b].checked===!1&&(a.currentProduct.checkall=!1)},a.cspManageMultipleDeleteNets=function(){for(var b=[],c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].checked===!0&&b.push(a.currentProduct.nets[c].ID);if(0===b.length);else if(1===b.length){var d={};d.count=1,d.data=b,e.cspManageMultipleDeleteNets(d,function(b){if("succeed"===b.result){var c={};c.proid=a.currentProduct.id,a.netCurrentPage=1,c.page=a.netCurrentPage,c.pageCount=a.pageCount,e.cspGetNetByProductId(c,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}else{var f={};f.count=b.length,f.data=b,e.cspManageMultipleDeleteNets(f,function(b){if("succeed"===b.result){var c={};c.proid=a.currentProduct.id,a.netCurrentPage=1,c.page=a.netCurrentPage,c.pageCount=a.pageCount,e.cspGetNetByProductId(c,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}},a.cspManageProductLoopToFirst=function(){if(1===a.productCurrentPage);else{window.scrollTo(0,0);var b={};a.productCurrentPage=1,b.page=a.productCurrentPage,b.pageCount=a.pageCount,e.cspGetAllProduct(b,function(b){if("succeed"===b.result){a.products=b.data_product;for(var c=0;c<b.data_product.length;c++)if(""!==b.data_product[c]){for(var d="",e=b.data_product[c].tacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_tactics.length;g++)e[f]==b.data_tactics[g].tsid&&(d+=""!==d?" ， "+b.data_tactics[g].tsname:b.data_tactics[g].tsname);a.products[c].tacticsName=d}a.productTotalPage=Math.ceil(b.count/a.pageCount),a.productPages=[];var h=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?h=1:(h=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-h+1<a.itemCount&&(h=a.productTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.productTotalPage||a.productTotalPage<=1);i++){var j={};j.num=i,i===a.productCurrentPage?j.select=!0:j.select=!1,a.productPages.push(j)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageProductLoopPrev=function(){if(1===a.productCurrentPage);else{window.scrollTo(0,0);var b={};a.productCurrentPage=a.productCurrentPage-1,b.page=a.productCurrentPage,b.pageCount=a.pageCount,e.cspGetAllProduct(b,function(b){if("succeed"===b.result){a.products=b.data_product;for(var c=0;c<b.data_product.length;c++)if(""!==b.data_product[c]){for(var d="",e=b.data_product[c].tacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_tactics.length;g++)e[f]==b.data_tactics[g].tsid&&(d+=""!==d?" ， "+b.data_tactics[g].tsname:b.data_tactics[g].tsname);a.products[c].tacticsName=d}a.productTotalPage=Math.ceil(b.count/a.pageCount),a.productPages=[];var h=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?h=1:(h=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-h+1<a.itemCount&&(h=a.productTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.productTotalPage||a.productTotalPage<=1);i++){var j={};j.num=i,i===a.productCurrentPage?j.select=!0:j.select=!1,a.productPages.push(j)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageProductLoopToPage=function(b){if(b.select===!0);else{window.scrollTo(0,0);var c={};a.productCurrentPage=b.num,c.page=a.productCurrentPage,c.pageCount=a.pageCount,e.cspGetAllProduct(c,function(b){if("succeed"===b.result){a.products=b.data_product;for(var c=0;c<b.data_product.length;c++)if(""!==b.data_product[c]){for(var d="",e=b.data_product[c].tacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_tactics.length;g++)e[f]==b.data_tactics[g].tsid&&(d+=""!==d?" ， "+b.data_tactics[g].tsname:b.data_tactics[g].tsname);a.products[c].tacticsName=d}a.productTotalPage=Math.ceil(b.count/a.pageCount),a.productPages=[];var h=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?h=1:(h=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-h+1<a.itemCount&&(h=a.productTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.productTotalPage||a.productTotalPage<=1);i++){var j={};j.num=i,i===a.productCurrentPage?j.select=!0:j.select=!1,a.productPages.push(j)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0)}else alert("获取数据失败，请重试")})}};a.cspManageProductLoopNext=function(){if(a.productCurrentPage===a.productTotalPage);else{window.scrollTo(0,0);var b={};a.productCurrentPage=a.productCurrentPage+1,b.page=a.productCurrentPage,b.pageCount=a.pageCount,e.cspGetAllProduct(b,function(b){if("succeed"===b.result){a.products=b.data_product;for(var c=0;c<b.data_product.length;c++)if(""!==b.data_product[c]){for(var d="",e=b.data_product[c].tacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_tactics.length;g++)e[f]==b.data_tactics[g].tsid&&(d+=""!==d?" ， "+b.data_tactics[g].tsname:b.data_tactics[g].tsname);a.products[c].tacticsName=d}a.productTotalPage=Math.ceil(b.count/a.pageCount),a.productPages=[];var h=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?h=1:(h=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-h+1<a.itemCount&&(h=a.productTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.productTotalPage||a.productTotalPage<=1);i++){var j={};j.num=i,i===a.productCurrentPage?j.select=!0:j.select=!1,a.productPages.push(j)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0)}else alert("获取数据失败，请重试")})}};a.cspManageProductLoopLast=function(){if(a.productCurrentPage===a.productTotalPage);else{window.scrollTo(0,0);var b={};a.productCurrentPage=a.productTotalPage,b.page=a.productCurrentPage,b.pageCount=a.pageCount,e.cspGetAllProduct(b,function(b){if("succeed"===b.result){a.products=b.data_product;for(var c=0;c<b.data_product.length;c++)if(""!==b.data_product[c]){for(var d="",e=b.data_product[c].tacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_tactics.length;g++)e[f]==b.data_tactics[g].tsid&&(d+=""!==d?" ， "+b.data_tactics[g].tsname:b.data_tactics[g].tsname);a.products[c].tacticsName=d}a.productTotalPage=Math.ceil(b.count/a.pageCount),a.productPages=[];var h=1;a.productCurrentPage<=Math.ceil(a.itemCount/2)||a.productTotalPage<=a.itemCount?h=1:(h=a.productCurrentPage-Math.ceil(a.itemCount/2)+1,a.productTotalPage-h+1<a.itemCount&&(h=a.productTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.productTotalPage||a.productTotalPage<=1);i++){var j={};j.num=i,i===a.productCurrentPage?j.select=!0:j.select=!1,a.productPages.push(j)}a.productTotalPage<=1?(a.productShowPrev=!1,a.productShowNext=!1):(a.productShowPrev=!0,a.productShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageTacticsLoopToFirst=function(){if(1===a.tacticsCurrentPage);else{window.scrollTo(0,0);var b={};a.tacticsCurrentPage=1,b.page=a.tacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllTactics(b,function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"");a.tacticsTotalPage=Math.ceil(b.count/a.pageCount),a.tacticsPages=[];var e=1;a.tacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.tacticsTotalPage<=a.itemCount?e=1:(e=a.tacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.tacticsTotalPage-e+1<a.itemCount&&(e=a.tacticsTotalPage-a.itemCount+1));for(var f=e;f<e+a.itemCount&&!(f>a.tacticsTotalPage||a.tacticsTotalPage<=1);f++){var g={};g.num=f,f===a.tacticsCurrentPage?g.select=!0:g.select=!1,a.tacticsPages.push(g)}a.tacticsTotalPage<=1?(a.tacticsShowPrev=!1,a.tacticsShowNext=!1):(a.tacticsShowPrev=!0,a.tacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageTacticsLoopPrev=function(){if(1===a.tacticsCurrentPage);else{window.scrollTo(0,0);var b={};a.tacticsCurrentPage=a.tacticsCurrentPage-1,b.page=a.tacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllTactics(b,function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"");a.tacticsTotalPage=Math.ceil(b.count/a.pageCount),a.tacticsPages=[];var e=1;a.tacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.tacticsTotalPage<=a.itemCount?e=1:(e=a.tacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.tacticsTotalPage-e+1<a.itemCount&&(e=a.tacticsTotalPage-a.itemCount+1));for(var f=e;f<e+a.itemCount&&!(f>a.tacticsTotalPage||a.tacticsTotalPage<=1);f++){var g={};g.num=f,f===a.tacticsCurrentPage?g.select=!0:g.select=!1,a.tacticsPages.push(g)}a.tacticsTotalPage<=1?(a.tacticsShowPrev=!1,a.tacticsShowNext=!1):(a.tacticsShowPrev=!0,a.tacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageTacticsLoopToPage=function(b){if(b.select===!0);else{window.scrollTo(0,0);var c={};a.tacticsCurrentPage=b.num,c.page=a.tacticsCurrentPage,c.pageCount=a.pageCount,e.cspGetAllTactics(c,function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"");a.tacticsTotalPage=Math.ceil(b.count/a.pageCount),a.tacticsPages=[];var e=1;a.tacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.tacticsTotalPage<=a.itemCount?e=1:(e=a.tacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.tacticsTotalPage-e+1<a.itemCount&&(e=a.tacticsTotalPage-a.itemCount+1));for(var f=e;f<e+a.itemCount&&!(f>a.tacticsTotalPage||a.tacticsTotalPage<=1);f++){var g={};g.num=f,f===a.tacticsCurrentPage?g.select=!0:g.select=!1,a.tacticsPages.push(g)}a.tacticsTotalPage<=1?(a.tacticsShowPrev=!1,a.tacticsShowNext=!1):(a.tacticsShowPrev=!0,a.tacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageTacticsLoopNext=function(){if(a.tacticsCurrentPage===a.tacticsTotalPage);else{window.scrollTo(0,0);var b={};a.tacticsCurrentPage=a.tacticsCurrentPage+1,b.page=a.tacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllTactics(b,function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"");a.tacticsTotalPage=Math.ceil(b.count/a.pageCount),a.tacticsPages=[];var e=1;a.tacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.tacticsTotalPage<=a.itemCount?e=1:(e=a.tacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.tacticsTotalPage-e+1<a.itemCount&&(e=a.tacticsTotalPage-a.itemCount+1));for(var f=e;f<e+a.itemCount&&!(f>a.tacticsTotalPage||a.tacticsTotalPage<=1);f++){var g={};g.num=f,f===a.tacticsCurrentPage?g.select=!0:g.select=!1,a.tacticsPages.push(g)}a.tacticsTotalPage<=1?(a.tacticsShowPrev=!1,a.tacticsShowNext=!1):(a.tacticsShowPrev=!0,a.tacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageTacticsLoopLast=function(){if(a.tacticsCurrentPage===a.tacticsTotalPage);else{window.scrollTo(0,0);var b={};a.tacticsCurrentPage=a.tacticsTotalPage,b.page=a.tacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllTactics(b,function(b){if(b.result="succeed"){a.tacticsList=b.data;for(var c=new RegExp("<.+?>","g"),d=0;d<b.data.length;d++)a.tacticsList[d].descriptText=b.data[d].tsdeschtml.replace(c,"");a.tacticsTotalPage=Math.ceil(b.count/a.pageCount),a.tacticsPages=[];var e=1;a.tacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.tacticsTotalPage<=a.itemCount?e=1:(e=a.tacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.tacticsTotalPage-e+1<a.itemCount&&(e=a.tacticsTotalPage-a.itemCount+1));for(var f=e;f<e+a.itemCount&&!(f>a.tacticsTotalPage||a.tacticsTotalPage<=1);f++){var g={};g.num=f,f===a.tacticsCurrentPage?g.select=!0:g.select=!1,a.tacticsPages.push(g)}a.tacticsTotalPage<=1?(a.tacticsShowPrev=!1,a.tacticsShowNext=!1):(a.tacticsShowPrev=!0,a.tacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageUserLoopToFirst=function(){if(1===a.userCurrentPage);else{var b={};b.kind=a.currentUserKind,a.userCurrentPage=1,b.page=a.userCurrentPage,b.pageCount=a.pageCount,e.cspManageGetAllUser(b,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageUserLoopPrev=function(){if(1===a.userCurrentPage);else{var b={};b.kind=a.currentUserKind,a.userCurrentPage=a.userCurrentPage-1,b.page=a.userCurrentPage,b.pageCount=a.pageCount,e.cspManageGetAllUser(b,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageUserLoopToPage=function(b){if(console.log(b),b.select===!0);else{var c={};c.kind=a.currentUserKind,a.userCurrentPage=b.num,c.page=a.userCurrentPage,c.pageCount=a.pageCount,e.cspManageGetAllUser(c,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageUserLoopNext=function(){if(a.userCurrentPage===a.userTotalPage);else{var b={};b.kind=a.currentUserKind,a.userCurrentPage=a.userCurrentPage+1,b.page=a.userCurrentPage,b.pageCount=a.pageCount,e.cspManageGetAllUser(b,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageUserLoopLast=function(){if(a.userCurrentPage===a.userTotalPage);else{var b={};b.kind=a.currentUserKind,a.userCurrentPage=a.userTotalPage,b.page=a.userCurrentPage,b.pageCount=a.pageCount,e.cspManageGetAllUser(b,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageNetLoopToFirst=function(){if(1===a.netCurrentPage);else{var b={};b.proid=a.currentProduct.id,a.netCurrentPage=1,b.page=a.netCurrentPage,b.pageCount=a.pageCount,e.cspGetNetByProductId(b,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0),a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageNetLoopPrev=function(){if(1===a.netCurrentPage);else{var b={};b.proid=a.currentProduct.id,a.netCurrentPage=a.netCurrentPage-1,b.page=a.netCurrentPage,b.pageCount=a.pageCount,e.cspGetNetByProductId(b,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0),a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageNetLoopToPage=function(b){if(b.select===!0);else{var c={};c.proid=a.currentProduct.id,a.netCurrentPage=b.num,c.page=a.netCurrentPage,c.pageCount=a.pageCount,e.cspGetNetByProductId(c,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0),a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageNetLoopNext=function(){if(a.netCurrentPage===a.netTotalPage);else{var b={};b.proid=a.currentProduct.id,a.netCurrentPage=a.netCurrentPage+1,b.page=a.netCurrentPage,b.pageCount=a.pageCount,e.cspGetNetByProductId(b,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0),a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageNetLoopLast=function(){if(a.netCurrentPage===a.netTotalPage);else{var b={};b.proid=a.currentProduct.id,a.netCurrentPage=a.netTotalPage,b.page=a.netCurrentPage,b.pageCount=a.pageCount,e.cspGetNetByProductId(b,function(b){if("succeed"===b.result){a.currentProduct.nets=b.data,a.currentProduct.checkall=!1;for(var c=0;c<a.currentProduct.nets.length;c++)a.currentProduct.nets[c].edit=!1,a.currentProduct.nets[c].checked=!1;0===b.data.length?a.currentProduct.loadExcel=!0:a.currentProduct.loadExcel=!1,a.netTotalPage=Math.ceil(b.count/a.pageCount),a.netPages=[];var d=1;a.netCurrentPage<=Math.ceil(a.itemCount/2)||a.netTotalPage<=a.itemCount?d=1:(d=a.netCurrentPage-Math.ceil(a.itemCount/2)+1,a.netTotalPage-d+1<a.itemCount&&(d=a.netTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.netTotalPage||a.netTotalPage<=1);e++){var f={};f.num=e,e===a.netCurrentPage?f.select=!0:f.select=!1,a.netPages.push(f)}a.netTotalPage<=1?(a.netShowPrev=!1,a.netShowNext=!1):(a.netShowPrev=!0,a.netShowNext=!0),a.cspManageLoadPath="tpls/managecenter/productinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageAddanalogClick=function(){a.currentanalogProduct.caption="",a.currentanalogProduct.capError=!1,a.currentanalogProduct.contentshtml="",a.currentanalogProduct.conError=!1,a.currentanalogProduct.tsid="",a.currentanalogProduct.tsname="",a.currentanalogProduct.tsidError=!1,a.currentanalogProduct.tsidArray=[],a.currentanalogProduct.fundmanager="",a.currentanalogProduct.funError=!1,a.currentanalogProduct.piclink="",a.currentanalogProduct.picError=!1,a.currentanalogProduct.picErrorTip="",a.currentanalogProduct.prostatus="",a.currentanalogProduct.proError=!1,a.currentanalogProduct.fileLoading=!1,a.currentanalogProduct.edit=!1,a.currentanalogProduct.addanalogNet=!1,a.currentanalogProduct.importanalogNet=!1,a.currentanalogProduct.selectanalogTactics=!1,a.currentanalogProduct.seriesid=-1,a.currentanalogProduct.seridDefault="请选择产品系列",a.currentanalogProduct.risklevelid=0,a.currentanalogProduct.riskDefault="请选择风险等级",a.currentanalogProduct.risError=!1,a.currentanalogProduct.priority=0,a.currentanalogProduct.addhome=!1,a.currentanalogProduct.blackout_period="",a.currentanalogProduct.bpError=!1,a.currentanalogProduct.subscribe_point="",a.currentanalogProduct.spError=!1,a.currentanalogProduct.subscribe_rate="",a.currentanalogProduct.srError=!1,a.currentanalogProduct.manage_rate="",a.currentanalogProduct.mrError=!1,a.currentanalogProduct.redeem_rate="",a.currentanalogProduct.rrError=!1,a.currentanalogProduct.merit_pay="",a.currentanalogProduct.mpError=!1,e.cspGetAllTactics({},function(b){"succeed"===b.result?(a.currentanalogProduct.tsidList=b.data,e.cspManageGetAllSeries({},function(b){"succeed"==b.result?(a.productSeries.splice(0,a.productSeries.length),a.productSeries=b.data,a.cspManageLoadPath="tpls/managecenter/analogproductinfo.html",a.cspManageState=6):alert("获取数据失败")})):alert("数据库异常")})},a.cspManageEditanalogProduct=function(b){a.currentanalogProduct.id=a.analogProducts[b].id,a.currentanalogProduct.caption=a.analogProducts[b].caption,a.currentanalogProduct.capError=!1,a.currentanalogProduct.contents=a.analogProducts[b].contents,a.currentanalogProduct.conError=!1,a.currentanalogProduct.tsid=a.analogProducts[b].analogTacticsList,a.currentanalogProduct.tsname=a.analogProducts[b].analogTacticsName,a.currentanalogProduct.tsidError=!1,a.currentanalogProduct.tsidArray=[],a.currentanalogProduct.tsidList=[],a.currentanalogProduct.fundmanager=a.analogProducts[b].fundmanager,a.currentanalogProduct.funError=!1,a.currentanalogProduct.piclink=a.analogProducts[b].piclink,a.currentanalogProduct.picError=!1,a.currentanalogProduct.picErrorTip="",a.currentanalogProduct.prostatus=a.analogProducts[b].prostatus,a.currentanalogProduct.proError=!1,a.currentanalogProduct.fileLoading=!1,a.currentanalogProduct.edit=!0,a.currentanalogProduct.addanalogNet=!1,a.currentanalogProduct.importanalogNet=!1,a.currentanalogProduct.analogNets=[],a.currentanalogProduct.selectanalogTactics=!1,a.currentanalogProduct.analogNetError=!1,a.currentanalogProduct.seriesid=a.analogProducts[b].serid,a.currentanalogProduct.seriesid==-1?a.currentanalogProduct.seridDefault="请选择产品系列":a.currentanalogProduct.seridDefault=a.analogProducts[b].sername,a.currentanalogProduct.serError=!1,a.currentanalogProduct.priority=a.analogProducts[b].priority,a.currentanalogProduct.addhome=0!=a.analogProducts[b].priority,a.currentanalogProduct.risklevelid=a.analogProducts[b].risklevelid,a.currentanalogProduct.riskDefault=0==a.analogProducts[b].risklevelid?"请选择风险等级":a.products[b].rname,a.currentanalogProduct.risError=!1,a.currentanalogProduct.blackout_period=a.analogProducts[b].blackout_period,a.currentanalogProduct.bpError=!1,a.currentanalogProduct.subscribe_point=a.analogProducts[b].subscribe_point,a.currentanalogProduct.spError=!1,a.currentanalogProduct.subscribe_rate=100*a.analogProducts[b].subscribe_rate,a.currentanalogProduct.srError=!1,a.currentanalogProduct.manage_rate=100*a.analogProducts[b].manage_rate,a.currentanalogProduct.mrError=!1,a.currentanalogProduct.redeem_rate=100*a.analogProducts[b].redeem_rate,a.currentanalogProduct.rrError=!1,a.currentanalogProduct.merit_pay=100*a.analogProducts[b].merit_pay,a.currentanalogProduct.mpError=!1,a.currentanalogProduct.spotload=!1,a.currentanalogProduct.showLoadSpot=!0,a.currentanalogProduct.spotadd=!1,a.currentanalogProduct.spotcheckall=!1;var c={};c.contents=a.analogProducts[b].contents,e.cspManageGetanalogProductDes(c,function(c){"succeed"===c.result?a.currentanalogProduct.contentshtml=c.data:a.currentanalogProduct.contentshtml="",e.cspGetAllTactics({},function(c){if("succeed"===c.result){var d=a.currentanalogProduct.tsid.split(",");console.log(a.currentanalogProduct.tsid,d),a.currentanalogProduct.tsidList=c.data;for(var f=0;f<c.data.length;f++){for(var g=0;g<d.length;g++)if(d[g]==c.data[f].tsid){a.currentanalogProduct.tsidList[f].selected=!0;break}g>=d.length&&(a.currentanalogProduct.tsidList[f].selected=!1)}var h={};h.proid=a.analogProducts[b].id,
a.analogNetCurrentPage=1,h.page=a.analogNetCurrentPage,h.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(h,function(c){if("succeed"===c.result){a.currentanalogProduct.analogNets=c.data,a.currentanalogProduct.checkall=!1;for(var d=0;d<a.currentanalogProduct.analogNets.length;d++)a.currentanalogProduct.analogNets[d].edit=!1,a.currentanalogProduct.analogNets[d].checked=!1;0===c.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,console.log(c.count),a.analogNetTotalPage=Math.ceil(c.count/a.pageCount),a.analogNetPages=[];var f=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?f=1:(f=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-f+1<a.itemCount&&(f=a.analogNetTotalPage-a.itemCount+1));for(var g=f;g<f+a.itemCount&&!(g>a.analogNetTotalPage||a.analogNetTotalPage<=1);g++){var h={};h.num=g,g===a.analogNetCurrentPage?h.select=!0:h.select=!1,a.analogNetPages.push(h)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0);var i={};i.proid=a.products[b].id,i.protype=a.productType,a.spotCurrentPage=1,i.page=a.spotCurrentPage,i.pageCount=a.pageCount,e.cspManageGetSpot(i,function(c){if("succeed"===c.result){a.currentanalogProduct.spots=c.data,a.currentanalogProduct.checkallspot=!1;for(var d=0;d<a.currentanalogProduct.spots.length;d++)a.currentanalogProduct.spots[d].edit=!1,a.currentanalogProduct.spots[d].checked=!1;0===c.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1,console.log(c.count),a.spotTotalPage=Math.ceil(c.count/a.pageCount),a.spotPages=[];var f=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?f=1:(f=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-f+1<a.itemCount&&(f=a.spotTotalPage-a.itemCount+1));for(var g=f;g<f+a.itemCount&&!(g>a.spotTotalPage||a.spotTotalPage<=1);g++){var h={};h.num=g,g===a.spotCurrentPage?h.select=!0:h.select=!1,a.spotPages.push(h)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0);var i={};i.proid=a.analogProducts[b].id,i.protype=a.productType,a.futuresCurrentPage=1,i.page=a.futuresCurrentPage,i.pageCount=a.pageCount,e.cspManageGetFutures(i,function(b){if("succeed"===b.result){a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1,console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var f=d;f<d+a.itemCount&&!(f>a.futuresTotalPage||a.futuresTotalPage<=1);f++){var g={};g.num=f,f===a.futuresCurrentPage?g.select=!0:g.select=!1,a.futuresPages.push(g)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0),e.cspManageGetAllSeries({},function(b){"succeed"==b.result?(a.productSeries.splice(0,a.productSeries.length),a.productSeries=b.data,a.cspManageLoadPath="tpls/managecenter/analogproductinfo.html",a.cspManageState=6):alert("获取数据失败")})}else alert("获取数据失败")})}else alert("获取数据失败")})}else alert("获取数据失败")})}else alert("数据库异常")})})},a.cspManageDeleteanalogProduct=function(b){console.log(a.analogProducts[b].id);var c={};c.id=a.analogProducts[b].id,c.contents=a.analogProducts[b].contents,e.cspDeleteanalogProduct(c,function(c){if("succeed"===c.result){a.analogProducts.splice(b,1);var d={};d.page=a.analogProductCurrentPage,d.pageCount=a.pageCount,e.cspGetAllanalogProduct(d,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?","+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}else alert("数据库异常")})},a.cspManageAddanalogCancel=function(){a.cspManageLoadPath="tpls/managecenter/analogproductmanage.html",a.cspManageState=5},a.cspManageAddanalogSure=function(){a.cspManageClearProductErrorTips(2);var b=/^(([1-9][0-9]{0,13})|0)(.([0-9]{0,2}))?$/,c=!1;""===a.currentanalogProduct.caption&&(c=!0,a.currentanalogProduct.capError=!0),""===a.currentanalogProduct.contentshtml&&(c=!0,a.currentanalogProduct.conError=!0),""===a.currentanalogProduct.fundmanager&&(c=!0,a.currentanalogProduct.funError=!0),""===a.currentanalogProduct.prostatus&&(c=!0,a.currentanalogProduct.proError=!0),a.currentanalogProduct.tsidArray=[];for(var d=0;d<a.currentanalogProduct.tsidList.length;d++)a.currentanalogProduct.tsidList[d].selected===!0&&a.currentanalogProduct.tsidArray.push(a.currentanalogProduct.tsidList[d]);if(0===a.currentanalogProduct.tsidArray.length&&(c=!0,a.currentanalogProduct.tsidError=!0),a.currentanalogProduct.seriesid==-1&&(c=!0,a.currentanalogProduct.serError=!0),0==a.currentanalogProduct.risklevelid&&(c=!0,a.currentanalogProduct.risError=!0),""==a.currentanalogProduct.blackout_period&&(c=!0,a.currentanalogProduct.bpError=!0),b.test(a.currentanalogProduct.subscribe_point)||(c=!0,a.currentanalogProduct.spError=!0),b.test(a.currentanalogProduct.subscribe_rate)||(c=!0,a.currentanalogProduct.srError=!0),b.test(a.currentanalogProduct.manage_rate)||(c=!0,a.currentanalogProduct.mrError=!0),b.test(a.currentanalogProduct.redeem_rate)||(c=!0,a.currentanalogProduct.rrError=!0),b.test(a.currentanalogProduct.merit_pay)||(c=!0,a.currentanalogProduct.mpError=!0),c===!1){a.currentanalogProduct.tsid="";for(var f=0;f<a.currentanalogProduct.tsidArray.length;f++)0===f?a.currentanalogProduct.tsid+=a.currentanalogProduct.tsidArray[f].tsid:a.currentanalogProduct.tsid+=","+a.currentanalogProduct.tsidArray[f].tsid;if(a.currentanalogProduct.edit===!1){if(1==a.currentanalogProduct.addhome){var g=0;for(g=0;g<3&&a.homeAnalogProducts[g].proid!=-1;g++);a.currentanalogProduct.priority=a.homeAnalogProducts[g].priority,a.currentanalogProduct.toaddhome=1}else a.currentanalogProduct.toaddhome=0;e.cspAddanalogProduct(a.currentanalogProduct,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/analogProductManage.html",a.cspManageState=5):alert("数据库异常")})}else{if(1==a.currentanalogProduct.addhome&&0==a.currentanalogProduct.priority){var g=0;for(g=0;g<3&&a.homeAnalogProducts[g].proid!=-1;g++);a.currentanalogProduct.priority=a.homeAnalogProducts[g].priority,a.currentanalogProduct.toaddhome=1}else 0==a.currentanalogProduct.addhome&&0!=a.currentanalogProduct.priority?a.currentanalogProduct.toaddhome=2:a.currentanalogProduct.toaddhome=0;console.log("sdjlfjsdlfjl",a.currentanalogProduct,a.currentanalogProduct.toaddhome),e.cspUpdateanalogProduct(a.currentanalogProduct,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/analogProductManage.html",a.cspManageState=5):alert("数据库异常")})}}else window.scrollTo(0,0)},a.cspManageAddanalogTactics=function(){a.currentanalogTactics.name="",a.currentanalogTactics.des="",a.currentanalogTactics.nameError=!1,a.currentanalogTactics.desError=!1,a.currentanalogTactics.edit=!1,a.cspManageLoadPath="tpls/managecenter/analogtacticsinfo.html",a.cspManageState=8},a.cspManageEditanalogTactics=function(b){a.currentanalogTactics.tsid=a.analogTacticsList[b].tsid,a.currentanalogTactics.title="编辑策略",a.currentanalogTactics.name=a.analogTacticsList[b].tsname,a.currentanalogTactics.des=a.analogTacticsList[b].tsdesc,a.currentanalogTactics.nameError=!1,a.currentanalogTactics.desError=!1,a.currentanalogTactics.edit=!0,a.currentanalogTactics.index=b,a.cspManageLoadPath="tpls/managecenter/analogtacticsinfo.html",a.cspManageState=8},a.cspManageanalogTacticsAddCancel=function(){a.cspManageLoadPath="tpls/managecenter/analogtacticsmanage.html",a.cspManageState=7},a.cspManageTscticsNameAccept=function(){a.currentanalogTactics.nameError=!1},a.cspManageTscticsDesAccept=function(){a.currentanalogTactics.desError=!1},a.cspManageanalogTacticsAddCommit=function(){var b=!1;if(""===a.currentanalogTactics.name&&(a.currentanalogTactics.nameError=!0,a.currentanalogTactics.nameTips="策略名称不能为空",b=!0),""===a.currentanalogTactics.des&&(a.currentanalogTactics.desError=!0,a.currentanalogTactics.desTips="策略名称不能为空",b=!0),b===!1)if(a.currentanalogTactics.edit===!1){var c={};c.analogTacticsName=a.currentanalogTactics.name,c.analogTacticsDes=a.currentanalogTactics.des,e.cspAddanalogTactics(c,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/analogtacticsmanage.html",a.cspManageState=7,e.cspGetAllanalogTactics({},function(b){(b.result="succeed")?a.analogTacticsList=b.data:alert("数据更新失败")})):alert("数据库异常")})}else{var d={};d.tsid=a.currentanalogTactics.tsid,d.tsname=a.currentanalogTactics.name,d.tsdesc=a.currentanalogTactics.des,e.cspUpdateanalogTactics(d,function(b){"succeed"===b.result?(a.cspManageLoadPath="tpls/managecenter/analogtacticsmanage.html",a.cspManageState=7,a.analogTacticsList[a.currentanalogTactics.index]=d,e.cspGetAllanalogTactics({},function(b){(b.result="succeed")?a.analogTacticsList=b.data:alert("数据更新失败")})):alert("数据库异常")})}},a.cspManageDeleteanalogTactics=function(b){console.log(a.analogTacticsList[b]);var c={};c.tsid=a.analogTacticsList[b].tsid,e.cspDeleteanalogTactics(c,function(c){"succeed"===c.result?(a.analogTacticsList.splice(b,1),e.cspGetAllanalogTactics({},function(b){(b.result="succeed")?a.analogTacticsList=b.data:alert("数据更新失败")})):alert("数据库异常")})},a.cspManageDeleteanalogProduct=function(b){console.log(a.analogProducts[b].id);var c={};c.id=a.analogProducts[b].id,c.contents=a.analogProducts[b].contents,e.cspDeleteanalogProduct(c,function(c){if("succeed"===c.result){a.analogProducts.splice(b,1);var d={};d.page=a.analogProductCurrentPage,d.pageCount=a.pageCount,e.cspGetAllanalogProduct(d,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?","+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}else alert("数据库异常")})},a.cspManageanalogProductAddImag=function(){a.currentanalogProduct.picError=!1,document.getElementById("cspManageanalogProductFile").click()},a.cspManageanalogProductDeletePic=function(){if(""===a.currentanalogProduct.piclink);else{var b={};b.filepath=a.currentanalogProduct.piclink,a.currentanalogProduct.fileLoading=!0,e.cspManageDeleteFile(b,function(b){"succeed"===b.result?(a.currentanalogProduct.piclink="",a.currentanalogProduct.fileLoading=!1):(a.currentanalogProduct.fileLoading=!1,a.currentanalogProduct.picError=!0,a.currentanalogProduct.picErrorTip="文件删除失败")})}},a.cspManageanalogProductUploadPic=function(){a.currentanalogProduct.fileLoading=!0;var b=new FormData,c=document.getElementById("cspManageanalogProductFile").files[0];b.append("file",c),e.cspManageUploadFile(b,function(b){"succeed"===b.result?(a.currentanalogProduct.piclink=b.piclink,a.currentanalogProduct.fileLoading=!1):(a.currentanalogProduct.fileLoading=!1,a.currentanalogProduct.picError=!0,a.currentanalogProduct.picErrorTip="文件上传失败")})},a.cspManageanalogProductErrorPic=function(){a.currentanalogProduct.picError=!0,a.currentanalogProduct.picErrorTip="仅支持jpg/png/bmp格式"},a.cspManageanalogProductCaptionChange=function(){a.currentanalogProduct.capError=!1},a.cspManageanalogProductTsnameChange=function(){a.currentanalogProduct.tsidError=!1},a.cspManageanalogProductFundmanagerChange=function(){a.currentanalogProduct.funError=!1},a.cspManageanalogProductProstatusChange=function(){a.currentanalogProduct.proError=!1},a.cspManageanalogProductcontentshtmlChange=function(){a.currentanalogProduct.conError=!1},a.cspManageAddSingleanalogData=function(){a.currentanalogProduct.addSingleData={},a.currentanalogProduct.addanalogNet=!0,a.currentanalogProduct.importanalogNet=!1;var b=new Date;a.currentanalogProduct.addSingleData.date=b.toLocaleDateString().replace(/\//g,"-"),a.currentanalogProduct.addSingleData.analogNet="",a.currentanalogProduct.addSingleData.totalanalogNet="",a.currentanalogProduct.addSingleData.accrate="",a.currentanalogProduct.addSingleData.yearrate="",a.currentanalogProduct.addSingleData.edit=!1,a.currentanalogProduct.addSingleData.analogNetError=!1,a.currentanalogProduct.addSingleData.tolError=!1,a.currentanalogProduct.addSingleData.accError=!1,a.currentanalogProduct.addSingleData.yearError=!1,a.currentanalogProduct.addSingleData.dateError=!1},a.cspManageAddanalogNetDataCancel=function(){a.currentanalogProduct.addanalogNet=!1},a.cspManageAddanalogNetDataSure=function(){var b=!1,c=/^\d+(\.\d+)?$/,d=/^(\d{4})-(\d{1,2})-(\d{1,2})$/;if(""!==a.currentanalogProduct.addSingleData.analogNet&&c.test(a.currentanalogProduct.addSingleData.analogNet)||(b=!0,a.currentanalogProduct.addSingleData.analogNetError=!0),""!==a.currentanalogProduct.addSingleData.totalanalogNet&&c.test(a.currentanalogProduct.addSingleData.totalanalogNet)||(b=!0,a.currentanalogProduct.addSingleData.tolError=!0),""!==a.currentanalogProduct.addSingleData.accrate&&c.test(a.currentanalogProduct.addSingleData.accrate)||(b=!0,a.currentanalogProduct.addSingleData.accError=!0),""!==a.currentanalogProduct.addSingleData.yearrate&&c.test(a.currentanalogProduct.addSingleData.yearrate)||(b=!0,a.currentanalogProduct.addSingleData.yearError=!0),""!==a.currentanalogProduct.addSingleData.date&&d.test(a.currentanalogProduct.addSingleData.date)||(b=!0,a.currentanalogProduct.addSingleData.dateError=!0),b===!1){var f={};f.date=a.currentanalogProduct.addSingleData.date,f.proid=a.currentanalogProduct.id,e.cspManageCheckanalogNetExist(f,function(b){if("succeed"===b.result)if(b.exist===!0)a.currentanalogProduct.addSingleData.dateError=!0;else{var c={};c.analogNet=a.currentanalogProduct.addSingleData.analogNet,c.totalanalogNet=a.currentanalogProduct.addSingleData.totalanalogNet,c.accrate=a.currentanalogProduct.addSingleData.accrate,c.yearrate=a.currentanalogProduct.addSingleData.yearrate,c.date=a.currentanalogProduct.addSingleData.date,c.proid=a.currentanalogProduct.id,e.cspAddSingleanalogNet(c,function(b){if("succeed"===b.result){a.currentanalogProduct.addanalogNet=!1;var c={};c.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=1,c.page=a.analogNetCurrentPage,c.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(c,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}else alert("数据库异常")})}},a.cspManageHideanalogNetError=function(){""!==a.currentanalogProduct.addSingleData.analogNet&&(a.currentanalogProduct.addSingleData.analogNetError=!1),""!==a.currentanalogProduct.addSingleData.totalanalogNet&&(a.currentanalogProduct.addSingleData.tolError=!1),""!==a.currentanalogProduct.addSingleData.accrate&&(a.currentanalogProduct.addSingleData.accError=!1),""!==a.currentanalogProduct.addSingleData.yearrate&&(a.currentanalogProduct.addSingleData.yearError=!1),""!==a.currentanalogProduct.addSingleData.date&&(a.currentanalogProduct.addSingleData.dateError=!1)},a.cspManageEditanalogNetData=function(b){a.currentanalogProduct.analogNets[b].editanalogNet=a.currentanalogProduct.analogNets[b].net,a.currentanalogProduct.analogNets[b].editTotalanalogNet=a.currentanalogProduct.analogNets[b].totalnet,a.currentanalogProduct.analogNets[b].editAccrate=a.currentanalogProduct.analogNets[b].accrate,a.currentanalogProduct.analogNets[b].editYearrate=a.currentanalogProduct.analogNets[b].yearrate,a.currentanalogProduct.analogNets[b].edit=!0},a.cspManageDeleteanalogNetData=function(b){var c={};c.ID=a.currentanalogProduct.analogNets[b].ID,e.cspDeleteSingleanalogNet(c,function(c){if("succeed"===c.result){a.currentanalogProduct.analogNets.splice(b,1);var d={};d.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=1,d.page=a.analogNetCurrentPage,d.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(d,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0)}else alert("刷新数据失败")})}else alert("数据库异常")})},a.importanalogExcel=function(){a.currentanalogProduct.addanalogNet=!1,a.currentanalogProduct.importanalogNet=!0,a.currentanalogProduct.loaddata={},a.currentanalogProduct.loaddata.loading=!1,a.currentanalogProduct.loaddata.fileRight=!1,a.currentanalogProduct.loaddata.fileError=!1,a.currentanalogProduct.loaddata.errorTip="",a.currentanalogProduct.loaddata.analogNets=[],console.log("$scope.currentanalogProduct.loaddata.fileError",a.currentanalogProduct.loaddata.fileError),a.timePromise=void 0;var b=1;a.timePromise=c(function(){if(b<=0){c.cancel(a.timePromise),a.timePromise=void 0;var d=document.getElementById("csp_manage_analogProduct_import_analogNet_div").offsetTop;window.scrollTo(0,d-300)}else b--},1,1e3)},a.cspManageImportanalogDataSelectFile=function(){console.log("$scope.currentanalogProduct.loaddata.fileError1",a.currentanalogProduct.loaddata.fileError),a.currentanalogProduct.loaddata.fileError=!1,a.currentanalogProduct.loaddata.errorTip="",document.getElementById("csp_manage_import_file_load_form").reset(),document.getElementById("csp_manage_import_file_load_input").click()},a.cspManageImportanalogLoadFileReady=function(){a.currentanalogProduct.loaddata.loading=!0;var b=new FormData,c=document.getElementById("csp_manage_import_file_load_input").files[0];b.append("file",c),e.cspManageImportanalogLoadFile(b,function(b){if(a.currentanalogProduct.loaddata.loading=!1,"succeed"===b.result)if(b.file===!0){a.currentanalogProduct.loaddata.fileRight=!0;for(var c=0;c<b.data.length;c++)a.currentanalogProduct.loaddata.analogNets.push(b.data[c]);console.log(a.currentanalogProduct.loaddata.analogNets)}else a.currentanalogProduct.loaddata.fileError=!0,a.currentanalogProduct.loaddata.errorTip="文件内容格式错误";else a.currentanalogProduct.loaddata.fileError=!0,a.currentanalogProduct.loaddata.errorTip="文件上传失败"})},a.cspManageImportanalogFileError=function(){a.currentanalogProduct.loaddata.fileError=!0,a.currentanalogProduct.loaddata.errorTip="请选择csv/xls/xlsx格式的文件"},a.cspManageImportanalogClearTable=function(){a.currentanalogProduct.loaddata.fileRight=!1,a.currentanalogProduct.loaddata.analogNets=[]},a.cspManageImportanalogLoadTable=function(){var b=/^\d+(\.\d+)?$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,d=0,f=[],g=!1;for(d=0;d<a.currentanalogProduct.loaddata.analogNets.length;d++){if(void 0===a.currentanalogProduct.loaddata.analogNets[d].date||!c.test(a.currentanalogProduct.loaddata.analogNets[d].date)){g=!0;break}if(void 0===a.currentanalogProduct.loaddata.analogNets[d].analogNet||!b.test(a.currentanalogProduct.loaddata.analogNets[d].analogNet)){g=!0;break}if(void 0===a.currentanalogProduct.loaddata.analogNets[d].totalanalogNet||!b.test(a.currentanalogProduct.loaddata.analogNets[d].totalanalogNet)){g=!0;break}if(void 0===a.currentanalogProduct.loaddata.analogNets[d].accrate||!b.test(a.currentanalogProduct.loaddata.analogNets[d].accrate)){g=!0;break}if(void 0===a.currentanalogProduct.loaddata.analogNets[d].yearrate||!b.test(a.currentanalogProduct.loaddata.analogNets[d].yearrate)){g=!0;break}var h=0;for(h=0;h<f.length;h++)if(a.currentanalogProduct.loaddata.analogNets[d].date===f[h]){g=!0;break}h>=f.length&&f.push(a.currentanalogProduct.loaddata.analogNets[d].date)}if(g===!0)a.currentanalogProduct.loaddata.fileError=!0,a.currentanalogProduct.loaddata.errorTip="请检查数据格式及日期是否重复";else{var i={};i.proid=a.currentanalogProduct.id,i.analogNets=a.currentanalogProduct.loaddata.analogNets,i.count=a.currentanalogProduct.loaddata.analogNets.length,e.cspManageImportanalogInsertToDb(i,function(b){if("succeed"===b.result){a.currentanalogProduct.importanalogNet=!1;var c={};c.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=1,c.page=a.analogNetCurrentPage,c.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(c,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}},a.cspManageImportanalogDeleteData=function(b){a.currentanalogProduct.loaddata.analogNets.splice(b,1),0===a.currentanalogProduct.loaddata.analogNets.length&&(a.currentanalogProduct.loaddata.fileRight=!1)},a.cspManageEditanalogNetDataCancel=function(b){a.currentanalogProduct.analogNets[b].edit=!1},a.cspManageSaveanalogNetData=function(b){var c=!1,d=/^\d+(\.\d+)?$/;if(""!==a.currentanalogProduct.analogNets[b].editanalogNet&&d.test(a.currentanalogProduct.analogNets[b].editanalogNet)||(c=!0),""!==a.currentanalogProduct.analogNets[b].editTotalanalogNet&&d.test(a.currentanalogProduct.analogNets[b].editTotalanalogNet)||(c=!0),""!==a.currentanalogProduct.analogNets[b].editAccrate&&d.test(a.currentanalogProduct.analogNets[b].editAccrate)||(c=!0),""!==a.currentanalogProduct.analogNets[b].editYearrate&&d.test(a.currentanalogProduct.analogNets[b].editYearrate)||(c=!0),c===!0)alert("请正确输入编辑的信息");else{var f={};f.analogNet=a.currentanalogProduct.analogNets[b].editanalogNet,f.totalanalogNet=a.currentanalogProduct.analogNets[b].editTotalanalogNet,f.accrate=a.currentanalogProduct.analogNets[b].editAccrate,f.yearrate=a.currentanalogProduct.analogNets[b].editYearrate,f.ID=a.currentanalogProduct.analogNets[b].ID,e.cspUpdateSingleanalogNet(f,function(c){if("succeed"===c.result){a.currentanalogProduct.analogNets[b].edit=!1;var d={};d.proid=a.currentanalogProduct.id,d.page=a.analogNetCurrentPage,d.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(d,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0)}else alert("获取数据失败")})}else a.currentanalogProduct.analogNets[b].edit=!1,alert("数据库异常")})}},a.cspManageanalogProductSelectanalogTactics=function(b){a.currentanalogProduct.selectanalogTactics=!0,document.getElementById("csp_manage_analogProduct_analogTactics_select").style.width=document.getElementById("csp_manage_analogProduct_analogTactics_result").offsetWidth+"px",b.stopPropagation()},a.cspManageanalogProductCloseanalogTactics=function(){a.currentanalogProduct.selectanalogTactics=!1},a.cspManageanalogProductStop=function(a){a.stopPropagation()},a.cspManageanalogProductSelectanalogTacticsSure=function(b){a.currentanalogProduct.tsidList[b].selected=!a.currentanalogProduct.tsidList[b].selected;var c=0;a.currentanalogProduct.tsname="";for(var d=0;d<a.currentanalogProduct.tsidList.length;d++)a.currentanalogProduct.tsidList[d].selected===!0&&(0===c?(c=1,a.currentanalogProduct.tsname+=a.currentanalogProduct.tsidList[d].tsname):a.currentanalogProduct.tsname+=" ， "+a.currentanalogProduct.tsidList[d].tsname)},a.cspManageSelectUserChange=function(){var b=document.getElementById("csp_manage_user_kind").value;if(b===a.currentUserKind);else{a.currentUserKind=b;var c={};c.kind=a.currentUserKind,a.userCurrentPage=1,c.page=a.userCurrentPage,c.pageCount=a.pageCount,e.cspManageGetAllUser(c,function(b){if("succeed"===b.result){a.users=b.data;for(var c=0;c<b.data.length;c++)0==b.data[c].au_stat?a.users[c].checkState="未验证":a.users[c].checkState="已验证",a.users[c].edit=!1;a.userTotalPage=Math.ceil(b.count/a.pageCount),a.userPages=[];var d=1;a.userCurrentPage<=Math.ceil(a.itemCount/2)||a.userTotalPage<=a.itemCount?d=1:(d=a.userCurrentPage-Math.ceil(a.itemCount/2)+1,a.userTotalPage-d+1<a.itemCount&&(d=a.userTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.userTotalPage||a.userTotalPage<=1);e++){var f={};f.num=e,e===a.userCurrentPage?f.select=!0:f.select=!1,a.userPages.push(f)}a.userTotalPage<=1?(a.userShowPrev=!1,a.userShowNext=!1):(a.userShowPrev=!0,a.userShowNext=!0)}else alert("数据库异常")})}},a.cspManageCheckAllanalogNets=function(){if(a.currentanalogProduct.checkall===!1){a.currentanalogProduct.checkall=!0;for(var b=0;b<a.currentanalogProduct.analogNets.length;b++)a.currentanalogProduct.analogNets[b].checked=!0}else{a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].checked=!1}},a.cspManageanalogNetCheckClick=function(){a.currentanalogProduct.checkall=!0;for(var b=0;b<a.currentanalogProduct.analogNets.length;b++)a.currentanalogProduct.analogNets[b].checked===!1&&(a.currentanalogProduct.checkall=!1)},a.cspManageMultipleDeleteanalogNets=function(){for(var b=[],c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].checked===!0&&b.push(a.currentanalogProduct.analogNets[c].ID);if(0===b.length);else if(1===b.length){var d={};d.count=1,d.data=b,e.cspManageMultipleDeleteanalogNets(d,function(b){if("succeed"===b.result){var c={};c.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=1,c.page=a.analogNetCurrentPage,c.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(c,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}else{var f={};f.count=b.length,f.data=b,e.cspManageMultipleDeleteanalogNets(f,function(b){if("succeed"===b.result){var c={};c.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=1,c.page=a.analogNetCurrentPage,c.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(c,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,
a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}},a.cspManageanalogProductLoopToFirst=function(){if(1===a.analogProductCurrentPage);else{window.scrollTo(0,0);var b={};a.analogProductCurrentPage=1,b.page=a.analogProductCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogProduct(b,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?" ， "+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageanalogProductLoopPrev=function(){if(1===a.analogProductCurrentPage);else{window.scrollTo(0,0);var b={};a.analogProductCurrentPage=a.analogProductCurrentPage-1,b.page=a.analogProductCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogProduct(b,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?" ， "+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageanalogProductLoopToPage=function(b){if(b.select===!0);else{window.scrollTo(0,0);var c={};a.analogProductCurrentPage=b.num,c.page=a.analogProductCurrentPage,c.pageCount=a.pageCount,e.cspGetAllanalogProduct(c,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?" ， "+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageanalogProductLoopNext=function(){if(a.analogProductCurrentPage===a.analogProductTotalPage);else{window.scrollTo(0,0);var b={};a.analogProductCurrentPage=a.analogProductCurrentPage+1,b.page=a.analogProductCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogProduct(b,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?" ， "+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageanalogProductLoopLast=function(){if(a.analogProductCurrentPage===a.analogProductTotalPage);else{window.scrollTo(0,0);var b={};a.analogProductCurrentPage=a.analogProductTotalPage,b.page=a.analogProductCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogProduct(b,function(b){if("succeed"===b.result){a.analogProducts=b.data_analogProduct;for(var c=0;c<b.data_analogProduct.length;c++)if(""!==b.data_analogProduct[c]){for(var d="",e=b.data_analogProduct[c].analogTacticsList.split(","),f=0;f<e.length;f++)for(var g=0;g<b.data_analogTactics.length;g++)e[f]==b.data_analogTactics[g].tsid&&(d+=""!==d?" ， "+b.data_analogTactics[g].tsname:b.data_analogTactics[g].tsname);a.analogProducts[c].analogTacticsName=d}a.analogProductTotalPage=Math.ceil(b.count/a.pageCount),a.analogProductPages=[];var h=1;a.analogProductCurrentPage<=Math.ceil(a.itemCount/2)||a.analogProductTotalPage<=a.itemCount?h=1:(h=a.analogProductCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogProductTotalPage-h+1<a.itemCount&&(h=a.analogProductTotalPage-a.itemCount+1));for(var i=h;i<h+a.itemCount&&!(i>a.analogProductTotalPage||a.analogProductTotalPage<=1);i++){var j={};j.num=i,i===a.analogProductCurrentPage?j.select=!0:j.select=!1,a.analogProductPages.push(j)}a.analogProductTotalPage<=1?(a.analogProductShowPrev=!1,a.analogProductShowNext=!1):(a.analogProductShowPrev=!0,a.analogProductShowNext=!0)}else alert("获取数据失败，请重试")})}},a.cspManageanalogTacticsLoopToFirst=function(){if(1===a.analogTacticsCurrentPage);else{window.scrollTo(0,0);var b={};a.analogTacticsCurrentPage=1,b.page=a.analogTacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogTactics(b,function(b){if(b.result="succeed"){a.analogTacticsList=b.data,a.analogTacticsTotalPage=Math.ceil(b.count/a.pageCount),a.analogTacticsPages=[];var c=1;a.analogTacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.analogTacticsTotalPage<=a.itemCount?c=1:(c=a.analogTacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogTacticsTotalPage-c+1<a.itemCount&&(c=a.analogTacticsTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.analogTacticsTotalPage||a.analogTacticsTotalPage<=1);d++){var e={};e.num=d,d===a.analogTacticsCurrentPage?e.select=!0:e.select=!1,a.analogTacticsPages.push(e)}a.analogTacticsTotalPage<=1?(a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1):(a.analogTacticsShowPrev=!0,a.analogTacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageanalogTacticsLoopPrev=function(){if(1===a.analogTacticsCurrentPage);else{window.scrollTo(0,0);var b={};a.analogTacticsCurrentPage=a.analogTacticsCurrentPage-1,b.page=a.analogTacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogTactics(b,function(b){if(b.result="succeed"){a.analogTacticsList=b.data,a.analogTacticsTotalPage=Math.ceil(b.count/a.pageCount),a.analogTacticsPages=[];var c=1;a.analogTacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.analogTacticsTotalPage<=a.itemCount?c=1:(c=a.analogTacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogTacticsTotalPage-c+1<a.itemCount&&(c=a.analogTacticsTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.analogTacticsTotalPage||a.analogTacticsTotalPage<=1);d++){var e={};e.num=d,d===a.analogTacticsCurrentPage?e.select=!0:e.select=!1,a.analogTacticsPages.push(e)}a.analogTacticsTotalPage<=1?(a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1):(a.analogTacticsShowPrev=!0,a.analogTacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageanalogTacticsLoopToPage=function(b){if(b.select===!0);else{window.scrollTo(0,0);var c={};a.analogTacticsCurrentPage=b.num,c.page=a.analogTacticsCurrentPage,c.pageCount=a.pageCount,e.cspGetAllanalogTactics(c,function(b){if(b.result="succeed"){a.analogTacticsList=b.data,a.analogTacticsTotalPage=Math.ceil(b.count/a.pageCount),a.analogTacticsPages=[];var c=1;a.analogTacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.analogTacticsTotalPage<=a.itemCount?c=1:(c=a.analogTacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogTacticsTotalPage-c+1<a.itemCount&&(c=a.analogTacticsTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.analogTacticsTotalPage||a.analogTacticsTotalPage<=1);d++){var e={};e.num=d,d===a.analogTacticsCurrentPage?e.select=!0:e.select=!1,a.analogTacticsPages.push(e)}a.analogTacticsTotalPage<=1?(a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1):(a.analogTacticsShowPrev=!0,a.analogTacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageanalogTacticsLoopNext=function(){if(a.analogTacticsCurrentPage===a.analogTacticsTotalPage);else{window.scrollTo(0,0);var b={};a.analogTacticsCurrentPage=a.analogTacticsCurrentPage+1,b.page=a.analogTacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogTactics(b,function(b){if(b.result="succeed"){a.analogTacticsList=b.data,a.analogTacticsTotalPage=Math.ceil(b.count/a.pageCount),a.analogTacticsPages=[];var c=1;a.analogTacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.analogTacticsTotalPage<=a.itemCount?c=1:(c=a.analogTacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogTacticsTotalPage-c+1<a.itemCount&&(c=a.analogTacticsTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.analogTacticsTotalPage||a.analogTacticsTotalPage<=1);d++){var e={};e.num=d,d===a.analogTacticsCurrentPage?e.select=!0:e.select=!1,a.analogTacticsPages.push(e)}a.analogTacticsTotalPage<=1?(a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1):(a.analogTacticsShowPrev=!0,a.analogTacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageanalogTacticsLoopLast=function(){if(a.analogTacticsCurrentPage===a.analogTacticsTotalPage);else{window.scrollTo(0,0);var b={};a.analogTacticsCurrentPage=a.analogTacticsTotalPage,b.page=a.analogTacticsCurrentPage,b.pageCount=a.pageCount,e.cspGetAllanalogTactics(b,function(b){if(b.result="succeed"){a.analogTacticsList=b.data,a.analogTacticsTotalPage=Math.ceil(b.count/a.pageCount),a.analogTacticsPages=[];var c=1;a.analogTacticsCurrentPage<=Math.ceil(a.itemCount/2)||a.analogTacticsTotalPage<=a.itemCount?c=1:(c=a.analogTacticsCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogTacticsTotalPage-c+1<a.itemCount&&(c=a.analogTacticsTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.analogTacticsTotalPage||a.analogTacticsTotalPage<=1);d++){var e={};e.num=d,d===a.analogTacticsCurrentPage?e.select=!0:e.select=!1,a.analogTacticsPages.push(e)}a.analogTacticsTotalPage<=1?(a.analogTacticsShowPrev=!1,a.analogTacticsShowNext=!1):(a.analogTacticsShowPrev=!0,a.analogTacticsShowNext=!0)}else alert("数据更新失败")})}},a.cspManageanalogNetLoopToFirst=function(){if(1===a.analogNetCurrentPage);else{var b={};b.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=1,b.page=a.analogNetCurrentPage,b.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(b,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0),a.cspManageLoadPath="tpls/managecenter/analogProductinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageanalogNetLoopPrev=function(){if(1===a.analogNetCurrentPage);else{var b={};b.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=a.analogNetCurrentPage-1,b.page=a.analogNetCurrentPage,b.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(b,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0),a.cspManageLoadPath="tpls/managecenter/analogProductinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageanalogNetLoopToPage=function(b){if(b.select===!0);else{var c={};c.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=b.num,c.page=a.analogNetCurrentPage,c.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(c,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0),a.cspManageLoadPath="tpls/managecenter/analogProductinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageanalogNetLoopNext=function(){if(a.analogNetCurrentPage===a.analogNetTotalPage);else{var b={};b.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=a.analogNetCurrentPage+1,b.page=a.analogNetCurrentPage,b.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(b,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0),a.cspManageLoadPath="tpls/managecenter/analogProductinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageanalogNetLoopLast=function(){if(a.analogNetCurrentPage===a.analogNetTotalPage);else{var b={};b.proid=a.currentanalogProduct.id,a.analogNetCurrentPage=a.analogNetTotalPage,b.page=a.analogNetCurrentPage,b.pageCount=a.pageCount,e.cspGetanalogNetByanalogProductId(b,function(b){if("succeed"===b.result){a.currentanalogProduct.analogNets=b.data,a.currentanalogProduct.checkall=!1;for(var c=0;c<a.currentanalogProduct.analogNets.length;c++)a.currentanalogProduct.analogNets[c].edit=!1,a.currentanalogProduct.analogNets[c].checked=!1;0===b.data.length?a.currentanalogProduct.loadExcel=!0:a.currentanalogProduct.loadExcel=!1,a.analogNetTotalPage=Math.ceil(b.count/a.pageCount),a.analogNetPages=[];var d=1;a.analogNetCurrentPage<=Math.ceil(a.itemCount/2)||a.analogNetTotalPage<=a.itemCount?d=1:(d=a.analogNetCurrentPage-Math.ceil(a.itemCount/2)+1,a.analogNetTotalPage-d+1<a.itemCount&&(d=a.analogNetTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.analogNetTotalPage||a.analogNetTotalPage<=1);e++){var f={};f.num=e,e===a.analogNetCurrentPage?f.select=!0:f.select=!1,a.analogNetPages.push(f)}a.analogNetTotalPage<=1?(a.analogNetShowPrev=!1,a.analogNetShowNext=!1):(a.analogNetShowPrev=!0,a.analogNetShowNext=!0),a.cspManageLoadPath="tpls/managecenter/analogProductinfo.html",a.cspManageState=2}else alert("获取数据失败")})}},a.cspManageEditOrder=function(b){a.orderEditIndex!==-1&&(a.orders[a.orderEditIndex].edit=!1),a.orders[b].edit=!0,a.orderEditIndex=b;for(var c=0;c<a.orderKinds.length;c++)if(a.orders[b].stats===a.orderKinds[c].osid){a.orders[b].editKind=a.orderKinds[c];break}},a.cspManageEditOrderSave=function(b){if(console.log(a.orders[b].editKind),a.orders[b].editKind.osid!==a.orders[b].stats||a.orders[b].editmarks!==a.orders[b].Remarks){var c={};c.oid=a.orders[b].oid,c.stats=a.orders[b].editKind.osid,c.Remarks=a.orders[b].editmarks,e.cspManageUpdateOrder(c,function(c){if("succeed"===c.result){var d={};d.page=a.orderCurrentPage,d.pageCount=a.pageCount,d.stats=a.orderCurrentKind.osid,a.orders[b].edit=!1,e.cspManageGetAllOrder(d,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editkind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})}},a.cspManageEditOrderCancel=function(b){a.orders[b].edit=!1,a.orderEditIndex=-1},a.cspManageSelectOrder=function(){console.log(a.orderCurrentKind),a.orderCurrentPage=1;var b={};b.page=a.orderCurrentPage,b.pageCount=a.pageCount,b.stats=a.orderCurrentKind.osid,e.cspManageGetAllOrder(b,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editKind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),console.log(b.count,a.pageCount,a.orderTotalPage),a.orderPages.splice(0,a.orderPages.length),console.log(a.orderPages);var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})},a.cspManageOrderSelectChange=function(b){a.orderCurrentKind=b},a.cspManageorderLoopToFirst=function(){if(1===a.orderCurrentPage);else{var b={};a.orderCurrentPage=1,b.page=a.orderCurrentPage,b.pageCount=a.pageCount,b.stats=a.orderCurrentKind.osid,e.cspManageGetAllOrder(b,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editKind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}},a.cspManageorderLoopPrev=function(){if(1===a.orderCurrentPage);else{var b={};a.orderCurrentPage=a.orderCurrentPage-1,b.page=a.orderCurrentPage,b.pageCount=a.pageCount,b.stats=a.orderCurrentKind.osid,e.cspManageGetAllOrder(b,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editKind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}},a.cspManageorderLoopToPage=function(b){if(b.select===!0);else{var c={};a.orderCurrentPage=b.num,c.page=a.orderCurrentPage,c.pageCount=a.pageCount,c.stats=a.orderCurrentKind.osid,e.cspManageGetAllOrder(c,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editKind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}},a.cspManageorderLoopNext=function(){if(a.orderCurrentPage===a.orderTotalPage);else{var b={};a.orderCurrentPage=a.orderCurrentPage+1,b.page=a.orderCurrentPage,b.pageCount=a.pageCount,b.stats=a.orderCurrentKind.osid,e.cspManageGetAllOrder(b,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editKind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}},a.cspManageorderLoopLast=function(){if(a.orderCurrentPage===a.orderTotalPage);else{var b={};a.orderCurrentPage=a.orderTotalPage,b.page=a.orderCurrentPage,b.pageCount=a.pageCount,b.stats=a.orderCurrentKind.osid,e.cspManageGetAllOrder(b,function(b){if("succeed"===b.result){a.orderKinds=b.ostate,a.orders=b.data;for(var c=0;c<a.orders.length;c++)a.orders[c].edit=!1,a.orders[c].editKind={},a.orders[c].editmarks=a.orders[c].Remarks;a.orderEditIndex=-1,a.orderTotalPage=Math.ceil(b.count/a.pageCount),a.orderPages=[];var d=1;a.orderCurrentPage<=Math.ceil(a.itemCount/2)||a.orderTotalPage<=a.itemCount?d=1:(d=a.orderCurrentPage-Math.ceil(a.itemCount/2)+1,a.orderTotalPage-d+1<a.itemCount&&(d=a.orderTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.orderTotalPage||a.orderTotalPage<=1);e++){var f={};f.num=e,e===a.orderCurrentPage?f.select=!0:f.select=!1,a.orderPages.push(f)}a.orderTotalPage<=1?(a.orderShowPrev=!1,a.orderShowNext=!1):(a.orderShowPrev=!0,a.orderShowNext=!0)}else alert("获取数据失败")})}},a.cspManageLoadSpot=function(){1===a.productType?(a.currentProduct.spotload=!0,a.currentProduct.spotadd=!1,a.currentProduct.loadspot={},a.currentProduct.loadspot.loading=!1,a.currentProduct.loadspot.fileRight=!1,a.currentProduct.loadspot.fileError=!1,a.currentProduct.loadspot.errorTip="",a.currentProduct.loadspot.spots=[]):(a.currentanalogProduct.spotload=!0,a.currentanalogProduct.spotadd=!1,a.currentanalogProduct.loadspot={},a.currentanalogProduct.loadspot.loading=!1,a.currentanalogProduct.loadspot.fileRight=!1,a.currentanalogProduct.loadspot.fileError=!1,a.currentanalogProduct.loadspot.errorTip="",a.currentanalogProduct.loadspot.spots=[]),a.timePromise=void 0;var b=1;a.timePromise=c(function(){if(b<=0){c.cancel(a.timePromise),a.timePromise=void 0;var d=document.getElementById("csp_manage_spot_load_data_div").offsetTop;window.scrollTo(0,d-300)}else b--},1,1e3)},a.cspManageSpotLoadDataSelectFile=function(){1===a.productType?(a.currentProduct.loadspot.fileError=!1,a.currentProduct.loadspot.errorTip="",document.getElementById("csp_manage_spot_file_load_form").reset(),document.getElementById("csp_manage_spot_file_load_input").click()):(a.currentanalogProduct.loadspot.fileError=!1,a.currentanalogProduct.loadspot.errorTip="",document.getElementById("csp_manage_spot_file_load_form").reset(),document.getElementById("csp_manage_spot_file_load_input").click())},a.cspManageSpotLoadFileReady=function(){if(1===a.productType){a.currentProduct.loadspot.loading=!0;var b=new FormData,c=document.getElementById("csp_manage_spot_file_load_input").files[0];b.append("file",c),e.cspManageSpotLoadFile(b,function(b){if(a.currentProduct.loadspot.loading=!1,"succeed"===b.result)if(b.file===!0){a.currentProduct.loadspot.fileRight=!0;for(var c=0;c<b.data.length;c++)a.currentProduct.loadspot.spots.push(b.data[c])}else a.currentProduct.loadspot.fileError=!0,a.currentProduct.loadspot.errorTip="文件内容格式错误";else a.currentProduct.loadspot.fileError=!0,a.currentProduct.loadspot.errorTip="文件上传失败"})}else{a.currentanalogProduct.loadspot.loading=!0;var b=new FormData,c=document.getElementById("csp_manage_spot_file_load_input").files[0];b.append("file",c),e.cspManageSpotLoadFile(b,function(b){if(a.currentanalogProduct.loadspot.loading=!1,"succeed"===b.result)if(b.file===!0){a.currentanalogProduct.loadspot.fileRight=!0;for(var c=0;c<b.data.length;c++)a.currentanalogProduct.loadspot.spots.push(b.data[c])}else a.currentanalogProduct.loadspot.fileError=!0,a.currentanalogProduct.loadspot.errorTip="文件内容格式错误";else a.currentanalogProduct.loadspot.fileError=!0,a.currentanalogProduct.loadspot.errorTip="文件上传失败"})}},a.cspManageSpotFileError=function(){1===a.productType?(a.currentproduct.loadspot.fileError=!0,a.currentproduct.loadspot.errorTip="文件格式错误"):(a.currentanalogProduct.loadspot.fileError=!0,a.currentanalogProduct.loadspot.errorTip="文件格式错误")},a.cspManageSpotLoadDeleteData=function(b){1===a.productType?(a.currentProduct.loadspot.spots.splice(b,1),0===a.currentProduct.loadspot.spots.length&&(a.currentProduct.loadspot.fileRight=!1)):(a.currentanalogProduct.loadspot.spots.splice(b,1),0===a.currentanalogProduct.loadspot.spots.length&&(a.currentanalogProduct.loadspot.fileRight=!1))},a.cspManageLoadSpotClearTable=function(){1===a.productType?(a.currentProduct.loadspot.spots=[],a.currentProduct.loadspot.fileRight=!1):(a.currentanalogProduct.loadspot.spots=[],a.currentanalogProduct.loadspot.fileRight=!1)},a.cspManageLoadSpotLoadTable=function(){var b=!1,c=/^(\d{1,14})+(\.\d+)?$/,d=/^(\d{1,11})$/,f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g={};if(1===a.productType){var h=0;for(h=0;h<a.currentProduct.loadspot.spots.length;h++)for(h=0;h<a.currentProduct.loadspot.spots.length;h++){if(void 0===a.currentProduct.loadspot.spots[h].date||!f.test(a.currentProduct.loadspot.spots[h].date)){b=!0;break}if(void 0===a.currentProduct.loadspot.spots[h].code||a.currentProduct.loadspot.spots[h].code.length<=0||a.currentProduct.loadspot.spots[h].code.length>32){b=!0;break}if(void 0===a.currentProduct.loadspot.spots[h].cname||a.currentProduct.loadspot.spots[h].cname.length<=0||a.currentProduct.loadspot.spots[h].cname.length>50){b=!0;break}if(void 0===a.currentProduct.loadspot.spots[h].volume||!d.test(a.currentProduct.loadspot.spots[h].volume)){b=!0;break}if(void 0===a.currentProduct.loadspot.spots[h].volamt||!c.test(a.currentProduct.loadspot.spots[h].volamt)){b=!0;break}if(void 0===a.currentProduct.loadspot.spots[h].last||!c.test(a.currentProduct.loadspot.spots[h].last)){b=!0;break}}g.count=a.currentProduct.loadspot.spots.length,g.spots=a.currentProduct.loadspot.spots,g.proid=a.currentProduct.id}else{var h=0;for(h=0;h<a.currentanalogProduct.loadspot.spots.length;h++)for(h=0;h<a.currentanalogProduct.loadspot.spots.length;h++){if(void 0===a.currentanalogProduct.loadspot.spots[h].date||!f.test(a.currentanalogProduct.loadspot.spots[h].date)){b=!0;break}if(void 0===a.currentanalogProduct.loadspot.spots[h].code||a.currentanalogProduct.loadspot.spots[h].code.length<=0||a.currentanalogProduct.loadspot.spots[h].code.length>32){b=!0;break}if(void 0===a.currentanalogProduct.loadspot.spots[h].cname||a.currentanalogProduct.loadspot.spots[h].cname.length<=0||a.currentanalogProduct.loadspot.spots[h].cname.length>50){b=!0;break}if(void 0===a.currentanalogProduct.loadspot.spots[h].volume||!d.test(a.currentanalogProduct.loadspot.spots[h].volume)){b=!0;break}if(void 0===a.currentanalogProduct.loadspot.spots[h].volamt||!c.test(a.currentanalogProduct.loadspot.spots[h].volamt)){
b=!0;break}if(void 0===a.currentanalogProduct.loadspot.spots[h].last||!c.test(a.currentanalogProduct.loadspot.spots[h].last)){b=!0;break}}g.count=a.currentanalogProduct.loadspot.spots.length,g.spots=a.currentanalogProduct.loadspot.spots,g.proid=a.currentanalogProduct.id}b===!0?1===a.productType?(a.currentProduct.loadspot.fileError=!0,a.currentProduct.loadspot.errorTip="请检查数据格式是否正确"):(a.currentanalogProduct.loadspot.fileError=!0,a.currentanalogProduct.loadspot.errorTip="请检查数据格式是否正确"):(g.protype=a.productType,e.cspManageLoadSpotToDb(g,function(b){if("succeed"===b.result){var c={};1===a.productType?(a.currentProduct.spotload=!1,c.proid=a.currentProduct.id):(a.currentanalogProduct.spotload=!1,c.proid=a.currentanalogProduct.id),c.protype=a.productType,a.spotCurrentPage=1,c.page=a.spotCurrentPage,c.pageCount=a.pageCount,e.cspManageGetSpot(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")}))},a.cspManageAddSpotSingleData=function(){var b=new Date;1===a.productType?(a.currentProduct.spotadd=!0,a.currentProduct.spotload=!1,a.currentProduct.spotSingleData={},a.currentProduct.spotSingleData.codeErr=!1,a.currentProduct.spotSingleData.code="",a.currentProduct.spotSingleData.nameErr=!1,a.currentProduct.spotSingleData.cname="",a.currentProduct.spotSingleData.volumeErr=!1,a.currentProduct.spotSingleData.volume="",a.currentProduct.spotSingleData.volamtErr=!1,a.currentProduct.spotSingleData.volamt="",a.currentProduct.spotSingleData.lastErr=!1,a.currentProduct.spotSingleData.last="",a.currentProduct.spotSingleData.dateErr=!1,a.currentProduct.spotSingleData.date=b.toLocaleDateString().replace(/\//g,"-")):(a.currentanalogProduct.spotadd=!0,a.currentanalogProduct.spotload=!1,a.currentanalogProduct.spotSingleData={},a.currentanalogProduct.spotSingleData.codeErr=!1,a.currentanalogProduct.spotSingleData.code="",a.currentanalogProduct.spotSingleData.nameErr=!1,a.currentanalogProduct.spotSingleData.cname="",a.currentanalogProduct.spotSingleData.volumeErr=!1,a.currentanalogProduct.spotSingleData.volume="",a.currentanalogProduct.spotSingleData.volamtErr=!1,a.currentanalogProduct.spotSingleData.volamt="",a.currentanalogProduct.spotSingleData.lastErr=!1,a.currentanalogProduct.spotSingleData.last="",a.currentanalogProduct.spotSingleData.dateErr=!1,a.currentanalogProduct.spotSingleData.date=b.toLocaleDateString().replace(/\//g,"-"))},a.cspManageAddSpotDataCancel=function(){1===a.productType?a.currentProduct.spotadd=!1:a.currentanalogProduct.spotadd=!1},a.cspManageAddSpotDataSure=function(){var b=/^(\d{1,14})+(\.\d+)?$/,c=/^(\d{1,11})$/,d=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,f=!1,g={};1===a.productType?(console.log(a.currentProduct.spotSingleData.cname,a.currentProduct.spotSingleData.volume),void 0!==a.currentProduct.spotSingleData.date&&d.test(a.currentProduct.spotSingleData.date)||(f=!0,a.currentProduct.spotSingleData.dateErr=!0),void 0!==a.currentProduct.spotSingleData.code&&""!==a.currentProduct.spotSingleData.code||(f=!0,a.currentProduct.spotSingleData.codeErr=!0),void 0!==a.currentProduct.spotSingleData.cname&&""!==a.currentProduct.spotSingleData.cname||(f=!0,a.currentProduct.spotSingleData.nameErr=!0,console.log(a.currentProduct.spotSingleData.nameErr)),void 0!==a.currentProduct.spotSingleData.volume&&c.test(a.currentProduct.spotSingleData.volume)||(f=!0,a.currentProduct.spotSingleData.volumeErr=!0),void 0!==a.currentProduct.spotSingleData.volamt&&b.test(a.currentProduct.spotSingleData.volamt)||(f=!0,a.currentProduct.spotSingleData.volamtErr=!0),void 0!==a.currentProduct.spotSingleData.last&&b.test(a.currentProduct.spotSingleData.last)||(f=!0,a.currentProduct.spotSingleData.lastErr=!0),g.data=a.currentProduct.spotSingleData,g.proid=a.currentProduct.id):(void 0!==a.currentanalogProduct.spotSingleData.date&&d.test(a.currentanalogProduct.spotSingleData.date)||(f=!0,a.currentanalogProduct.spotSingleData.dateErr=!0),void 0!==a.currentanalogProduct.spotSingleData.code&&""!==a.currentanalogProduct.spotSingleData.code||(f=!0,a.currentanalogProduct.spotSingleData.codeErr=!0),void 0!==a.currentanalogProduct.spotSingleData.cname&&""!==a.currentanalogProduct.spotSingleData.cname||(f=!0,a.currentanalogProduct.spotSingleData.nameErr=!0),void 0!==a.currentanalogProduct.spotSingleData.volume&&c.test(a.currentanalogProduct.spotSingleData.volume)||(f=!0,a.currentanalogProduct.spotSingleData.volumeErr=!0),void 0!==a.currentanalogProduct.spotSingleData.volamt&&b.test(a.currentanalogProduct.spotSingleData.volamt)||(f=!0,a.currentanalogProduct.spotSingleData.volamtErr=!0),void 0!==a.currentanalogProduct.spotSingleData.last&&b.test(a.currentanalogProduct.spotSingleData.last)||(f=!0,a.currentanalogProduct.spotSingleData.lastErr=!0),g.data=a.currentanalogProduct.spotSingleData,g.proid=a.currentanalogProduct.id),f===!1&&(g.protype=a.productType,e.cspManageSpotInsertSingleData(g,function(b){if("succeed"===b.result){var c={};1===a.productType?(a.currentProduct.spotadd=!1,c.proid=a.currentProduct.id):(a.currentanalogProduct.spotadd=!1,c.proid=a.currentanalogProduct.id),c.protype=a.productType,a.spotCurrentPage=1,c.page=a.spotCurrentPage,c.pageCount=a.pageCount,e.cspManageGetSpot(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")}))},a.cspManageHideSpotError=function(){1===a.productType?(""!==a.currentProduct.spotSingleData.code&&(a.currentProduct.spotSingleData.codeErr=!1),""!==a.currentProduct.spotSingleData.cname&&(a.currentProduct.spotSingleData.nameErr=!1),""!==a.currentProduct.spotSingleData.volume&&(a.currentProduct.spotSingleData.volumeErr=!1),""!==a.currentProduct.spotSingleData.volamt&&(a.currentProduct.spotSingleData.volamtErr=!1),""!==a.currentProduct.spotSingleData.last&&(a.currentProduct.spotSingleData.lastErr=!1),""!==a.currentProduct.spotSingleData.date&&(a.currentProduct.spotSingleData.dateErr=!1)):(""!==a.currentanalogProduct.spotSingleData.code&&(a.currentanalogProduct.spotSingleData.codeErr=!1),""!==a.currentanalogProduct.spotSingleData.cname&&(a.currentanalogProduct.spotSingleData.nameErr=!1),""!==a.currentanalogProduct.spotSingleData.volume&&(a.currentanalogProduct.spotSingleData.volumeErr=!1),""!==a.currentanalogProduct.spotSingleData.volamt&&(a.currentanalogProduct.spotSingleData.volamtErr=!1),""!==a.currentanalogProduct.spotSingleData.last&&(a.currentanalogProduct.spotSingleData.lastErr=!1),""!==a.currentanalogProduct.spotSingleData.date&&(a.currentanalogProduct.spotSingleData.dateErr=!1))},a.cspManageCheckAllSpots=function(){if(1===a.productType)if(a.currentProduct.spotcheckall===!1){a.currentProduct.spotcheckall=!0;for(var b=0;b<a.currentProduct.spots.length;b++)a.currentProduct.spots[b].checked=!0}else{a.currentProduct.spotcheckall=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].checked=!1}else if(a.currentanalogProduct.spotcheckall===!1){a.currentanalogProduct.spotcheckall=!0;for(var b=0;b<a.currentanalogProduct.spots.length;b++)a.currentanalogProduct.spots[b].checked=!0}else{a.currentanalogProduct.spotcheckall=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].checked=!1}},a.cspManageMultipleDeleteSpots=function(){var b={},c=[];if(1===a.productType)for(var d=0;d<a.currentProduct.spots.length;d++)a.currentProduct.spots[d].checked===!0&&c.push(a.currentProduct.spots[d].ID);else for(var d=0;d<a.currentanalogProduct.spots.length;d++)a.currentanalogProduct.spots[d].checked===!0&&c.push(a.currentanalogProduct.spots[d].ID);c.length>0&&(b.count=c.length,b.data=c,e.cspManageMultipleDeleteSpots(b,function(b){if("succeed"===b.result){var c={};1===a.productType?(c.proid=a.currentProduct.id,c.protype=a.productType):(c.proid=a.currentanalogProduct.id,c.protype=a.productType),a.spotCurrentPage=1,c.page=a.spotCurrentPage,c.pageCount=a.pageCount,e.cspManageGetSpot(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}else alert("删除失败")}))},a.cspManageDeleteSpotDate=function(b){var c={},d=[];1===a.productType?d.push(a.currentProduct.spots[b].ID):d.push(a.currentanalogProduct.spots[b].ID),c.count=1,c.data=d,e.cspManageMultipleDeleteSpots(c,function(b){if("succeed"===b.result){var c={};1===a.productType?(c.proid=a.currentProduct.id,c.protype=a.productType):(c.proid=a.currentanalogProduct.id,c.protype=a.productType),a.spotCurrentPage=1,c.page=a.spotCurrentPage,c.pageCount=a.pageCount,e.cspManageGetSpot(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}else alert("删除失败")})},a.cspManageSpotCheckClick=function(){if(1===a.productType){a.currentProduct.spotcheckall=!0;for(var b=0;b<a.currentProduct.spots.length;b++)a.currentProduct.spots[b].checked===!1&&(a.currentProduct.spotcheckall=!1)}else{a.currentanalogProduct.spotcheckall=!0;for(var b=0;b<a.currentanalogProduct.spots.length;b++)a.currentanalogProduct.spots[b].checked===!1&&(a.currentanalogProduct.spotcheckall=!1)}},a.cspManageEditSpotDate=function(b){1===a.productType?(a.currentProduct.spots[b].edit=!0,a.currentProduct.spots[b].editspot={},a.currentProduct.spots[b].editspot.ID=a.currentProduct.spots[b].ID,a.currentProduct.spots[b].editspot.date=a.currentProduct.spots[b].time,a.currentProduct.spots[b].editspot.code=a.currentProduct.spots[b].code,a.currentProduct.spots[b].editspot.cname=a.currentProduct.spots[b].cname,a.currentProduct.spots[b].editspot.volume=a.currentProduct.spots[b].volume,a.currentProduct.spots[b].editspot.volamt=a.currentProduct.spots[b].volamt,a.currentProduct.spots[b].editspot.last=a.currentProduct.spots[b].last):(a.currentanalogProduct.spots[b].edit=!0,a.currentanalogProduct.spots[b].editspot={},a.currentanalogProduct.spots[b].editspot.ID=a.currentanalogProduct.spots[b].ID,a.currentanalogProduct.spots[b].editspot.date=a.currentanalogProduct.spots[b].time,a.currentanalogProduct.spots[b].editspot.code=a.currentanalogProduct.spots[b].code,a.currentanalogProduct.spots[b].editspot.cname=a.currentanalogProduct.spots[b].cname,a.currentanalogProduct.spots[b].editspot.volume=a.currentanalogProduct.spots[b].volume,a.currentanalogProduct.spots[b].editspot.volamt=a.currentanalogProduct.spots[b].volamt,a.currentanalogProduct.spots[b].editspot.last=a.currentanalogProduct.spots[b].last)},a.cspManageEditSpotDateSave=function(b){var c=/^(\d{1,14})+(\.\d+)?$/,d=/^(\d{1,11})$/,f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g=!1,h={};1===a.productType?(void 0!==a.currentProduct.spots[b].editspot.date&&f.test(a.currentProduct.spots[b].editspot.date)||(g=!0),void 0!==a.currentProduct.spots[b].editspot.code&&""!==a.currentProduct.spots[b].editspot.code||(g=!0),void 0!==a.currentProduct.spots[b].editspot.cname&&""!==a.currentProduct.spots[b].editspot.cname||(g=!0),void 0!==a.currentProduct.spots[b].editspot.volume&&d.test(a.currentProduct.spots[b].editspot.volume)||(g=!0),void 0!==a.currentProduct.spots[b].editspot.volamt&&c.test(a.currentProduct.spots[b].editspot.volamt)||(g=!0),void 0!==a.currentProduct.spots[b].editspot.last&&c.test(a.currentProduct.spots[b].last)||(g=!0),h=a.currentProduct.spots[b].editspot):(void 0!==a.currentanalogProduct.spots[b].editspot.date&&f.test(a.currentanalogProduct.spots[b].editspot.date)||(g=!0),void 0!==a.currentanalogProduct.spots[b].editspot.code&&""!==a.currentanalogProduct.spots[b].editspot.code||(g=!0),void 0!==a.currentanalogProduct.spots[b].editspot.cname&&""!==a.currentanalogProduct.spots[b].editspot.cname||(g=!0),void 0!==a.currentanalogProduct.spots[b].editspot.volume&&d.test(a.currentanalogProduct.spots[b].editspot.volume)||(g=!0),void 0!==a.currentanalogProduct.spots[b].editspot.volamt&&c.test(a.currentanalogProduct.spots[b].editspot.volamt)||(g=!0),void 0!==a.currentanalogProduct.spots[b].editspot.last&&c.test(a.currentanalogProduct.spots[b].last)||(g=!0),h=a.currentanalogProduct.spots[b].editspot),g===!0?alert("数据格式错误！"):e.cspManageUpdateSpot(h,function(b){if("succeed"===b.result){var c={};1===a.productType?(c.proid=a.currentProduct.id,c.protype=a.productType):(c.proid=a.currentanalogProduct.id,c.protype=a.productType),a.spotCurrentPage=1,c.page=a.spotCurrentPage,c.pageCount=a.pageCount,e.cspManageGetSpot(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})},a.cspManageEditSpotDateCancel=function(b){1===a.productType?a.currentProduct.spots[b].edit=!1:a.currentanalogProduct.spots[b].edit=!1},a.cspManagespotLoopToFirst=function(){if(1===a.spotCurrentPage);else{a.spotCurrentPage=1;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.spotCurrentPage,b.pageCount=a.pageCount,e.cspManageGetSpot(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}},a.cspManagespotLoopPrev=function(){if(1===a.spotCurrentPage);else{a.spotCurrentPage=a.spotCurrentPage-1;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.spotCurrentPage,b.pageCount=a.pageCount,e.cspManageGetSpot(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}},a.cspManagespotLoopToPage=function(b){if(b===a.spotCurrentPage);else{a.spotCurrentPage=b.num;var c={};1===a.productType?(c.proid=a.currentProduct.id,c.protype=a.productType):(c.proid=a.currentanalogProduct.id,c.protype=a.productType),c.page=a.spotCurrentPage,c.pageCount=a.pageCount,e.cspManageGetSpot(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}},a.cspManagespotLoopNext=function(){if(a.spotCurrentPage===a.spotTotalPage);else{a.spotCurrentPage=a.spotCurrentPage+1;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.spotCurrentPage,b.pageCount=a.pageCount,e.cspManageGetSpot(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}},a.cspManagespotLoopLast=function(){if(a.spotCurrentPage===a.spotTotalPage);else{a.spotCurrentPage=a.spotTotalPage;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.spotCurrentPage,b.pageCount=a.pageCount,e.cspManageGetSpot(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.spots=b.data,a.currentProduct.checkallspot=!1;for(var c=0;c<a.currentProduct.spots.length;c++)a.currentProduct.spots[c].edit=!1,a.currentProduct.spots[c].checked=!1;0===b.data.length?a.currentProduct.showLoadSpot=!0:a.currentProduct.showLoadSpot=!1}else{a.currentanalogProduct.spots=b.data,a.currentanalogProduct.checkallspot=!1;for(var c=0;c<a.currentanalogProduct.spots.length;c++)a.currentanalogProduct.spots[c].edit=!1,a.currentanalogProduct.spots[c].checked=!1;0===b.data.length?a.currentanalogProduct.showLoadSpot=!0:a.currentanalogProduct.showLoadSpot=!1}console.log(b.count),a.spotTotalPage=Math.ceil(b.count/a.pageCount),a.spotPages=[];var d=1;a.spotCurrentPage<=Math.ceil(a.itemCount/2)||a.spotTotalPage<=a.itemCount?d=1:(d=a.spotCurrentPage-Math.ceil(a.itemCount/2)+1,a.spotTotalPage-d+1<a.itemCount&&(d=a.spotTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.spotTotalPage||a.spotTotalPage<=1);e++){var f={};f.num=e,e===a.spotCurrentPage?f.select=!0:f.select=!1,a.spotPages.push(f)}a.spotTotalPage<=1?(a.spotShowPrev=!1,a.spotShowNext=!1):(a.spotShowPrev=!0,a.spotShowNext=!0)}else alert("获取数据失败")})}},a.cspManageLoadNetCancel=function(){a.currentProduct.importNet=!1;var b=document.getElementById("csp_manage_product_net_info_div").offsetTop;window.scrollTo(0,b)},a.cspManageLoadanalogNetCancel=function(){a.currentanalogProduct.importanalogNet=!1;var b=document.getElementById("csp_manage_analogProduct_import_analogNet_div").offsetTop;window.scrollTo(0,b)},a.cspManageLoadSpotCancel=function(){1===a.productType?a.currentProduct.spotload=!1:a.currentanalogProduct.spotload=!1;var b=document.getElementById("csp_manage_spot_load_data_div").offsetTop;window.scrollTo(0,b)},a.cspManageAddFuturesSingleData=function(){var b=new Date;1===a.productType?(a.currentProduct.futuresadd=!0,a.currentProduct.futuresload=!1,a.currentProduct.futuresSingleData={},a.currentProduct.futuresSingleData.codeErr=!1,a.currentProduct.futuresSingleData.code="",a.currentProduct.futuresSingleData.nameErr=!1,a.currentProduct.futuresSingleData.fname="",a.currentProduct.futuresSingleData.volumeErr=!1,a.currentProduct.futuresSingleData.dealtypejson=a.futuresDealTypes[0],a.currentProduct.futuresSingleData.volume="",a.currentProduct.futuresSingleData.volamtErr=!1,a.currentProduct.futuresSingleData.volamt="",a.currentProduct.futuresSingleData.lastErr=!1,a.currentProduct.futuresSingleData.last="",a.currentProduct.futuresSingleData.dateErr=!1,a.currentProduct.futuresSingleData.date=b.toLocaleDateString().replace(/\//g,"-")):(a.currentanalogProduct.futuresadd=!0,a.currentanalogProduct.futuresload=!1,a.currentanalogProduct.futuresSingleData={},a.currentanalogProduct.futuresSingleData.codeErr=!1,a.currentanalogProduct.futuresSingleData.code="",a.currentanalogProduct.futuresSingleData.nameErr=!1,a.currentanalogProduct.futuresSingleData.fname="",a.currentanalogProduct.futuresSingleData.volumeErr=!1,a.currentanalogProduct.futuresSingleData.dealtypejson=a.futuresDealTypes[0],a.currentanalogProduct.futuresSingleData.volume="",a.currentanalogProduct.futuresSingleData.volamtErr=!1,a.currentanalogProduct.futuresSingleData.volamt="",a.currentanalogProduct.futuresSingleData.lastErr=!1,a.currentanalogProduct.futuresSingleData.last="",a.currentanalogProduct.futuresSingleData.dateErr=!1,a.currentanalogProduct.futuresSingleData.date=b.toLocaleDateString().replace(/\//g,"-"))},a.cspManageAddFuturesDataCancel=function(){1===a.productType?a.currentProduct.futuresadd=!1:a.currentanalogProduct.futuresadd=!1},a.cspManageAddFuturesDataSure=function(){var b=/^(\d{1,14})+(\.\d+)?$/,c=/^(\d{1,11})$/,d=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,f=!1,g={};1===a.productType?(console.log(a.currentProduct.futuresSingleData.fname,a.currentProduct.futuresSingleData.volume),void 0!==a.currentProduct.futuresSingleData.date&&d.test(a.currentProduct.futuresSingleData.date)||(f=!0,a.currentProduct.futuresSingleData.dateErr=!0),void 0!==a.currentProduct.futuresSingleData.code&&""!==a.currentProduct.futuresSingleData.code||(f=!0,a.currentProduct.futuresSingleData.codeErr=!0),void 0!==a.currentProduct.futuresSingleData.fname&&""!==a.currentProduct.futuresSingleData.fname||(f=!0,a.currentProduct.futuresSingleData.nameErr=!0,console.log(a.currentProduct.futuresSingleData.nameErr)),void 0!==a.currentProduct.futuresSingleData.volume&&c.test(a.currentProduct.futuresSingleData.volume)||(f=!0,a.currentProduct.futuresSingleData.volumeErr=!0),void 0!==a.currentProduct.futuresSingleData.volamt&&b.test(a.currentProduct.futuresSingleData.volamt)||(f=!0,a.currentProduct.futuresSingleData.volamtErr=!0),void 0!==a.currentProduct.futuresSingleData.last&&b.test(a.currentProduct.futuresSingleData.last)||(f=!0,a.currentProduct.futuresSingleData.lastErr=!0),void 0!==a.currentProduct.futuresSingleData.deposit&&b.test(a.currentProduct.futuresSingleData.deposit)||(f=!0,a.currentProduct.futuresSingleData.depositErr=!0),g.data=a.currentProduct.futuresSingleData,g.proid=a.currentProduct.id):(void 0!==a.currentanalogProduct.futuresSingleData.date&&d.test(a.currentanalogProduct.futuresSingleData.date)||(f=!0,a.currentanalogProduct.futuresSingleData.dateErr=!0),void 0!==a.currentanalogProduct.futuresSingleData.code&&""!==a.currentanalogProduct.futuresSingleData.code||(f=!0,a.currentanalogProduct.futuresSingleData.codeErr=!0),void 0!==a.currentanalogProduct.futuresSingleData.fname&&""!==a.currentanalogProduct.futuresSingleData.fname||(f=!0,a.currentanalogProduct.futuresSingleData.nameErr=!0),void 0!==a.currentanalogProduct.futuresSingleData.volume&&c.test(a.currentanalogProduct.futuresSingleData.volume)||(f=!0,a.currentanalogProduct.futuresSingleData.volumeErr=!0),void 0!==a.currentanalogProduct.futuresSingleData.volamt&&b.test(a.currentanalogProduct.futuresSingleData.volamt)||(f=!0,a.currentanalogProduct.futuresSingleData.volamtErr=!0),void 0!==a.currentanalogProduct.futuresSingleData.last&&b.test(a.currentanalogProduct.futuresSingleData.last)||(f=!0,a.currentanalogProduct.futuresSingleData.lastErr=!0),void 0!==a.currentanalogProduct.futuresSingleData.deposit&&b.test(a.currentanalogProduct.futuresSingleData.deposit)||(f=!0,a.currentanalogProduct.futuresSingleData.depositErr=!0),g.data=a.currentanalogProduct.futuresSingleData,g.proid=a.currentanalogProduct.id),f===!1&&(g.protype=a.productType,e.cspManageFuturesInsertSingleData(g,function(b){if("succeed"===b.result){var c={};1===a.productType?(a.currentProduct.futuresadd=!1,c.proid=a.currentProduct.id):(a.currentanalogProduct.futuresadd=!1,c.proid=a.currentanalogProduct.id),c.protype=a.productType,a.futuresCurrentPage=1,c.page=a.futuresCurrentPage,c.pageCount=a.pageCount,e.cspManageGetFutures(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];
0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")}))},a.cspManageHideFuturesError=function(){1===a.productType?(""!==a.currentProduct.futuresSingleData.code&&(a.currentProduct.futuresSingleData.codeErr=!1),""!==a.currentProduct.futuresSingleData.fname&&(a.currentProduct.futuresSingleData.nameErr=!1),""!==a.currentProduct.futuresSingleData.volume&&(a.currentProduct.futuresSingleData.volumeErr=!1),""!==a.currentProduct.futuresSingleData.volamt&&(a.currentProduct.futuresSingleData.volamtErr=!1),""!==a.currentProduct.futuresSingleData.last&&(a.currentProduct.futuresSingleData.lastErr=!1),""!==a.currentProduct.futuresSingleData.deposit&&(a.currentProduct.futuresSingleData.depositErr=!1),""!==a.currentProduct.futuresSingleData.date&&(a.currentProduct.futuresSingleData.dateErr=!1)):(""!==a.currentanalogProduct.futuresSingleData.code&&(a.currentanalogProduct.futuresSingleData.codeErr=!1),""!==a.currentanalogProduct.futuresSingleData.fname&&(a.currentanalogProduct.futuresSingleData.nameErr=!1),""!==a.currentanalogProduct.futuresSingleData.volume&&(a.currentanalogProduct.futuresSingleData.volumeErr=!1),""!==a.currentanalogProduct.futuresSingleData.volamt&&(a.currentanalogProduct.futuresSingleData.volamtErr=!1),""!==a.currentanalogProduct.futuresSingleData.last&&(a.currentanalogProduct.futuresSingleData.lastErr=!1),""!==a.currentanalogProduct.futuresSingleData.deposit&&(a.currentanalogProduct.futuresSingleData.depositErr=!1),""!==a.currentanalogProduct.futuresSingleData.date&&(a.currentanalogProduct.futuresSingleData.dateErr=!1))},a.cspManageLoadFutures=function(){1===a.productType?(a.currentProduct.futuresload=!0,a.currentProduct.futuresadd=!1,a.currentProduct.loadfutures={},a.currentProduct.loadfutures.loading=!1,a.currentProduct.loadfutures.fileRight=!1,a.currentProduct.loadfutures.fileError=!1,a.currentProduct.loadfutures.errorTip="",a.currentProduct.loadfutures.futureses=[]):(a.currentanalogProduct.futuresload=!0,a.currentanalogProduct.futuresadd=!1,a.currentanalogProduct.loadfutures={},a.currentanalogProduct.loadfutures.loading=!1,a.currentanalogProduct.loadfutures.fileRight=!1,a.currentanalogProduct.loadfutures.fileError=!1,a.currentanalogProduct.loadfutures.errorTip="",a.currentanalogProduct.loadfutures.futureses=[]),a.timePromise=void 0;var b=1;a.timePromise=c(function(){if(b<=0){c.cancel(a.timePromise),a.timePromise=void 0;var d=document.getElementById("csp_manage_product_futures_load_div").offsetTop;window.scrollTo(0,d-300)}else b--},1,1e3)},a.cspManageLoadFuturesCancel=function(){1===a.productType?a.currentProduct.futuresload=!1:a.currentanalogProduct.futuresload=!1;var b=document.getElementById("csp_manage_product_futures_info_div").offsetTop;window.scrollTo(0,b)},a.cspManageEditFuturesDate=function(b){1===a.productType?(a.currentProduct.futureses[b].edit=!0,a.currentProduct.futureses[b].editfutures={},a.currentProduct.futureses[b].editfutures.fid=a.currentProduct.futureses[b].fid,a.currentProduct.futureses[b].editfutures.date=a.currentProduct.futureses[b].time,a.currentProduct.futureses[b].editfutures.code=a.currentProduct.futureses[b].code,a.currentProduct.futureses[b].editfutures.fname=a.currentProduct.futureses[b].fname,a.currentProduct.futureses[b].editfutures.dealtypejson=a.currentProduct.futureses[b].dealtypejson,a.currentProduct.futureses[b].editfutures.volume=a.currentProduct.futureses[b].volume,a.currentProduct.futureses[b].editfutures.volamt=a.currentProduct.futureses[b].volamt,a.currentProduct.futureses[b].editfutures.last=a.currentProduct.futureses[b].last,a.currentProduct.futureses[b].editfutures.deposit=a.currentProduct.futureses[b].deposit):(a.currentanalogProduct.futureses[b].edit=!0,a.currentanalogProduct.futureses[b].editfutures={},a.currentanalogProduct.futureses[b].editfutures.fid=a.currentanalogProduct.futureses[b].fid,a.currentanalogProduct.futureses[b].editfutures.date=a.currentanalogProduct.futureses[b].time,a.currentanalogProduct.futureses[b].editfutures.code=a.currentanalogProduct.futureses[b].code,a.currentanalogProduct.futureses[b].editfutures.fname=a.currentanalogProduct.futureses[b].fname,a.currentanalogProduct.futureses[b].editfutures.dealtypejson=a.currentanalogProduct.futureses[b].dealtypejson,a.currentanalogProduct.futureses[b].editfutures.volume=a.currentanalogProduct.futureses[b].volume,a.currentanalogProduct.futureses[b].editfutures.volamt=a.currentanalogProduct.futureses[b].volamt,a.currentanalogProduct.futureses[b].editfutures.last=a.currentanalogProduct.futureses[b].last,a.currentanalogProduct.futureses[b].editfutures.deposit=a.currentanalogProduct.futureses[b].deposit)},a.cspManageEditFuturesDateSave=function(b){console.log(b);var c=/^(\d{1,14})+(\.\d+)?$/,d=/^(\d{1,11})$/,f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g=!1,h={};1===a.productType?(void 0!==a.currentProduct.futureses[b].editfutures.date&&f.test(a.currentProduct.futureses[b].editfutures.date)||(g=!0),void 0!==a.currentProduct.futureses[b].editfutures.code&&""!==a.currentProduct.futureses[b].editfutures.code||(g=!0),void 0!==a.currentProduct.futureses[b].editfutures.fname&&""!==a.currentProduct.futureses[b].editfutures.fname||(g=!0),void 0!==a.currentProduct.futureses[b].editfutures.volume&&d.test(a.currentProduct.futureses[b].editfutures.volume)||(g=!0),void 0!==a.currentProduct.futureses[b].editfutures.volamt&&c.test(a.currentProduct.futureses[b].editfutures.volamt)||(g=!0),void 0!==a.currentProduct.futureses[b].editfutures.last&&c.test(a.currentProduct.futureses[b].editfutures.last)||(g=!0),void 0!==a.currentProduct.futureses[b].editfutures.deposit&&c.test(a.currentProduct.futureses[b].editfutures.deposit)||(g=!0),h=a.currentProduct.futureses[b].editfutures):(void 0!==a.currentanalogProduct.futureses[b].editfutures.date&&f.test(a.currentanalogProduct.futureses[b].editfutures.date)||(g=!0),void 0!==a.currentanalogProduct.futureses[b].editfutures.code&&""!==a.currentanalogProduct.futureses[b].editfutures.code||(g=!0),void 0!==a.currentanalogProduct.futureses[b].editfutures.fname&&""!==a.currentanalogProduct.futureses[b].editfutures.fname||(g=!0),void 0!==a.currentanalogProduct.futureses[b].editfutures.volume&&d.test(a.currentanalogProduct.futureses[b].editfutures.volume)||(g=!0),void 0!==a.currentanalogProduct.futureses[b].editfutures.volamt&&c.test(a.currentanalogProduct.futureses[b].editfutures.volamt)||(g=!0),void 0!==a.currentanalogProduct.futureses[b].editfutures.last&&c.test(a.currentanalogProduct.futureses[b].editfutures.last)||(g=!0),void 0!==a.currentanalogProduct.futureses[b].editfutures.deposit&&c.test(a.currentanalogProduct.futureses[b].editfutures.deposit)||(g=!0),h=a.currentanalogProduct.futureses[b].editfutures),console.log(g),g===!1&&e.cspManageUpdateFutures(h,function(c){if("succeed"===c.result){var d={};1===a.productType?(a.currentProduct.futureses[b].edit=!1,d.proid=a.currentProduct.id):(a.currentanalogProduct.futureses[b].edit=!1,d.proid=a.currentanalogProduct.id),d.protype=a.productType,d.page=a.futuresCurrentPage,d.pageCount=a.pageCount,e.cspManageGetFutures(d,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")})},a.cspManageEditFuturesDateCancel=function(b){1===a.productType?a.currentProduct.futureses[b].edit=!1:a.currentanalogProduct.futureses[b].edit=!1},a.cspManageDeleteFuturesDate=function(b){var c={};c.count=1,1===a.productType?c.data=a.currentProduct.futureses[b].fid:c.data=a.currentanalogProduct.futureses[b].fid,e.cspManageMultipleDeleteFutureses(c,function(b){if("succeed"===b.result){var c={};1===a.productType?c.proid=a.currentProduct.id:c.proid=a.currentanalogProduct.id,c.protype=a.productType,a.futuresCurrentPage=1,c.page=a.futuresCurrentPage,c.pageCount=a.pageCount,e.cspManageGetFutures(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}else alert("删除失败")})},a.cspManageCheckAllFutureses=function(){if(1===a.productType)if(a.currentProduct.checkallfutures===!1){a.currentProduct.checkallfutures=!0;for(var b=0;b<a.currentProduct.futureses.length;b++)a.currentProduct.futureses[b].checked=!0}else{a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].checked=!1}else if(a.currentanalogProduct.checkallfutures===!1){a.currentanalogProduct.checkallfutures=!0;for(var b=0;b<a.currentanalogProduct.futureses.length;b++)a.currentanalogProduct.futureses[b].checked=!0}else{a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].checked=!1}},a.cspManageFuturesCheckClick=function(){if(1===a.productType){a.currentProduct.checkallfutures=!0;for(var b=0;b<a.currentProduct.futureses.length;b++)a.currentProduct.futureses[b].checked===!1&&(a.currentProduct.checkallfutures=!1)}else{a.currentanalogProduct.checkallfutures=!0;for(var b=0;b<a.currentanalogProduct.futureses.length;b++)a.currentanalogProduct.futureses[b].checked===!1&&(a.currentanalogProduct.checkallfutures=!1)}},a.cspManageMultipleDeleteFutureses=function(){var b={},c=[];if(1===a.productType)for(var d=0;d<a.currentProduct.futureses.length;d++)a.currentProduct.futureses[d].checked===!0&&c.push(a.currentProduct.futureses[d].fid);else for(var d=0;d<a.currentanalogProduct.futureses.length;d++)a.currentanalogProduct.futureses[d].checked===!0&&c.push(a.currentanalogProduct.futureses[d].fid);c.length>0&&(b.count=c.length,b.data=c,e.cspManageMultipleDeleteFutureses(b,function(b){if("succeed"===b.result){var c={};1===a.productType?c.proid=a.currentProduct.id:c.proid=a.currentanalogProduct.id,c.protype=a.productType,a.futuresCurrentPage=1,c.page=a.futuresCurrentPage,c.pageCount=a.pageCount,e.cspManageGetFutures(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}else alert("删除失败")}))},a.cspManageFuturesLoadDataSelectFile=function(){1===a.productType?(a.currentProduct.loadfutures.fileError=!1,a.currentProduct.loadfutures.errorTip="",document.getElementById("csp_manage_futures_file_load_form").reset(),document.getElementById("csp_manage_futures_file_load_input").click()):(a.currentanalogProduct.loadfutures.fileError=!1,a.currentanalogProduct.loadfutures.errorTip="",document.getElementById("csp_manage_futures_file_load_form").reset(),document.getElementById("csp_manage_futures_file_load_input").click())},a.cspManageFuturesFileError=function(){1===a.productType?(a.currentproduct.loadfutures.fileError=!0,a.currentproduct.loadfutures.errorTip="文件格式错误"):(a.currentanalogProduct.loadfutures.fileError=!0,a.currentanalogProduct.loadfutures.errorTip="文件格式错误")},a.cspManageFuturesLoadFileReady=function(){if(1===a.productType){a.currentProduct.loadfutures.loading=!0;var b=new FormData,c=document.getElementById("csp_manage_futures_file_load_input").files[0];b.append("file",c),e.cspManageFuturesLoadFile(b,function(b){if(a.currentProduct.loadfutures.loading=!1,"succeed"===b.result)if(b.file===!0){a.currentProduct.loadfutures.fileRight=!0;for(var c=0;c<b.data.length;c++)a.currentProduct.loadfutures.futureses.push(b.data[c])}else a.currentProduct.loadfutures.fileError=!0,a.currentProduct.loadfutures.errorTip="文件内容格式错误";else a.currentProduct.loadfutures.fileError=!0,a.currentProduct.loadfutures.errorTip="文件上传失败"})}else{a.currentanalogProduct.loadfutures.loading=!0;var b=new FormData,c=document.getElementById("csp_manage_futures_file_load_input").files[0];b.append("file",c),e.cspManageFuturesLoadFile(b,function(b){if(a.currentanalogProduct.loadfutures.loading=!1,"succeed"===b.result)if(b.file===!0){a.currentanalogProduct.loadfutures.fileRight=!0;for(var c=0;c<b.data.length;c++)a.currentanalogProduct.loadfutures.futureses.push(b.data[c])}else a.currentanalogProduct.loadfutures.fileError=!0,a.currentanalogProduct.loadfutures.errorTip="文件内容格式错误";else a.currentanalogProduct.loadfutures.fileError=!0,a.currentanalogProduct.loadfutures.errorTip="文件上传失败"})}},a.cspManageLoadFuturesClearTable=function(){1===a.productType?(a.currentProduct.loadfutures.fileRight=!1,a.currentProduct.loadfutures.futureses=[]):(a.currentanalogProduct.loadfutures.fileRight=!1,a.currentanalogProduct.loadfutures.futureses=[])},a.cspManageFuturesLoadDeleteData=function(b){1===a.productType?(a.currentProduct.loadfutures.futureses.splice(b,1),0===a.currentProduct.loadfutures.futureses.length&&(a.currentProduct.loadfutures.fileRight=!1)):(a.currentanalogProduct.loadfutures.futureses.splice(b,1),0===a.currentanalogProduct.loadfutures.futureses.length&&(a.currentanalogProduct.loadfutures.fileRight=!1))},a.cspManageLoadFuturesLoadTable=function(){var b=!1,c=/^(\d{1,14})+(\.\d+)?$/,d=/^(\d{1,11})$/,f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g={};if(1===a.productType){var h=0;for(h=0;h<a.currentProduct.loadfutures.futureses.length;h++)for(h=0;h<a.currentProduct.loadfutures.futureses.length;h++){if(void 0===a.currentProduct.loadfutures.futureses[h].date||!f.test(a.currentProduct.loadfutures.futureses[h].date)){b=!0;break}if(void 0===a.currentProduct.loadfutures.futureses[h].code||a.currentProduct.loadfutures.futureses[h].code.length<=0||a.currentProduct.loadfutures.futureses[h].code.length>32){b=!0;break}if(void 0===a.currentProduct.loadfutures.futureses[h].fname||a.currentProduct.loadfutures.futureses[h].fname.length<=0||a.currentProduct.loadfutures.futureses[h].fname.length>50){b=!0;break}if("1"!=a.currentProduct.loadfutures.futureses[h].dealtype&&"0"!=a.currentProduct.loadfutures.futureses[h].dealtype){b=!0;break}if(void 0===a.currentProduct.loadfutures.futureses[h].volume||!d.test(a.currentProduct.loadfutures.futureses[h].volume)){b=!0;break}if(void 0===a.currentProduct.loadfutures.futureses[h].volamt||!c.test(a.currentProduct.loadfutures.futureses[h].volamt)){b=!0;break}if(void 0===a.currentProduct.loadfutures.futureses[h].last||!c.test(a.currentProduct.loadfutures.futureses[h].last)){b=!0;break}if(void 0===a.currentProduct.loadfutures.futureses[h].deposit||!c.test(a.currentProduct.loadfutures.futureses[h].deposit)){b=!0;break}}g.count=a.currentProduct.loadfutures.futureses.length,g.futureses=a.currentProduct.loadfutures.futureses,g.proid=a.currentProduct.id}else{var h=0;for(h=0;h<a.currentanalogProduct.loadfutures.futureses.length;h++)for(h=0;h<a.currentanalogProduct.loadfutures.futureses.length;h++){if(void 0===a.currentanalogProduct.loadfutures.futureses[h].date||!f.test(a.currentanalogProduct.loadfutures.futureses[h].date)){b=!0;break}if(void 0===a.currentanalogProduct.loadfutures.futureses[h].code||a.currentanalogProduct.loadfutures.futureses[h].code.length<=0||a.currentanalogProduct.loadfutures.futureses[h].code.length>32){b=!0;break}if(void 0===a.currentanalogProduct.loadfutures.futureses[h].fname||a.currentanalogProduct.loadfutures.futureses[h].fname.length<=0||a.currentanalogProduct.loadfutures.futureses[h].fname.length>50){b=!0;break}if("1"!=a.currentanalogProduct.loadfutures.futureses[h].dealtype&&"0"!=a.currentanalogProduct.loadfutures.futureses[h].dealtype){b=!0;break}if(void 0===a.currentanalogProduct.loadfutures.futureses[h].volume||!d.test(a.currentanalogProduct.loadfutures.futureses[h].volume)){b=!0;break}if(void 0===a.currentanalogProduct.loadfutures.futureses[h].volamt||!c.test(a.currentanalogProduct.loadfutures.futureses[h].volamt)){b=!0;break}if(void 0===a.currentanalogProduct.loadfutures.futureses[h].last||!c.test(a.currentanalogProduct.loadfutures.futureses[h].last)){b=!0;break}if(void 0===a.currentanalogProduct.loadfutures.futureses[h].deposit||!c.test(a.currentanalogProduct.loadfutures.futureses[h].deposit)){b=!0;break}}g.count=a.currentanalogProduct.loadfutures.futureses.length,g.futureses=a.currentanalogProduct.loadfutures.futureses,g.proid=a.currentanalogProduct.id}b===!0?1===a.productType?(a.currentProduct.loadfutures.fileError=!0,a.currentProduct.loadfutures.errorTip="请检查数据格式是否正确"):(a.currentanalogProduct.loadfutures.fileError=!0,a.currentanalogProduct.loadfutures.errorTip="请检查数据格式是否正确"):(g.protype=a.productType,e.cspManageLoadFuturesToDb(g,function(b){if("succeed"===b.result){var c={};1===a.productType?(a.currentProduct.futuresload=!1,c.proid=a.currentProduct.id):(a.currentanalogProduct.futuresload=!1,c.proid=a.currentanalogProduct.id);var d=document.getElementById("csp_manage_product_futures_info_div").offsetTop;window.scrollTo(0,d),c.protype=a.productType,a.futuresCurrentPage=1,c.page=a.futuresCurrentPage,c.pageCount=a.pageCount,e.cspManageGetFutures(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}else alert("数据库异常")}))},a.cspManagefuturesLoopToFirst=function(){if(1===a.futuresCurrentPage);else{a.futuresCurrentPage=1;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.futuresCurrentPage,b.pageCount=a.pageCount,e.cspManageGetFutures(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}},a.cspManagefuturesLoopPrev=function(){if(1===a.futuresCurrentPage);else{a.futuresCurrentPage=a.futuresCurrentPage-1;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.futuresCurrentPage,b.pageCount=a.pageCount,e.cspManageGetFutures(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}},a.cspManagefuturesLoopToPage=function(b){if(b===a.futuresCurrentPage);else{a.futuresCurrentPage=b.num;var c={};1===a.productType?(c.proid=a.currentProduct.id,c.protype=a.productType):(c.proid=a.currentanalogProduct.id,c.protype=a.productType),c.page=a.futuresCurrentPage,c.pageCount=a.pageCount,e.cspManageGetFutures(c,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}},a.cspManagefuturesLoopNext=function(){if(a.futuresCurrentPage===a.futuresTotalPage);else{a.futuresCurrentPage=a.futuresCurrentPage+1;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.futuresCurrentPage,b.pageCount=a.pageCount,e.cspManageGetFutures(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,
a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}},a.cspManagefuturesLoopLast=function(){if(a.futuresCurrentPage===a.futuresTotalPage);else{a.futuresCurrentPage=a.futuresTotalPage;var b={};1===a.productType?(b.proid=a.currentProduct.id,b.protype=a.productType):(b.proid=a.currentanalogProduct.id,b.protype=a.productType),b.page=a.futuresCurrentPage,b.pageCount=a.pageCount,e.cspManageGetFutures(b,function(b){if("succeed"===b.result){if(1===a.productType){a.currentProduct.futureses=b.data,a.currentProduct.checkallfutures=!1;for(var c=0;c<a.currentProduct.futureses.length;c++)a.currentProduct.futureses[c].edit=!1,a.currentProduct.futureses[c].checked=!1,a.currentProduct.futureses[c].dealtypejson={},0==a.currentProduct.futureses[c].dealtype?a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentProduct.showLoadFutures=!0:a.currentProduct.showLoadFutures=!1}else{a.currentanalogProduct.futureses=b.data,a.currentanalogProduct.checkallfutures=!1;for(var c=0;c<a.currentanalogProduct.futureses.length;c++)a.currentanalogProduct.futureses[c].edit=!1,a.currentanalogProduct.futureses[c].checked=!1,a.currentanalogProduct.futureses[c].dealtypejson={},0==a.currentanalogProduct.futureses[c].dealtype?a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[0]:a.currentanalogProduct.futureses[c].dealtypejson=a.futuresDealTypes[1];0===b.data.length?a.currentanalogProduct.showLoadFutures=!0:a.currentanalogProduct.showLoadFutures=!1}console.log(b.count),a.futuresTotalPage=Math.ceil(b.count/a.pageCount),a.futuresPages=[];var d=1;a.futuresCurrentPage<=Math.ceil(a.itemCount/2)||a.futuresTotalPage<=a.itemCount?d=1:(d=a.futuresCurrentPage-Math.ceil(a.itemCount/2)+1,a.futuresTotalPage-d+1<a.itemCount&&(d=a.futuresTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.futuresTotalPage||a.futuresTotalPage<=1);e++){var f={};f.num=e,e===a.futuresCurrentPage?f.select=!0:f.select=!1,a.futuresPages.push(f)}a.futuresTotalPage<=1?(a.futuresShowPrev=!1,a.futuresShowNext=!1):(a.futuresShowPrev=!0,a.futuresShowNext=!0)}else alert("获取数据失败")})}},a.cspManageProductCheckClick=function(c){if(0!=a.products[c].priority)d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var f={};f.protype=1,f.priority=a.products[c].priority,e.cspManageDeleteShowProduct(f,function(b){if("succeed"==b.result){for(var d=0;d<a.homeProducts.length;d++)if(a.homeProducts[d].proid==a.products[c].id){a.homeProducts[d].proid=-1,a.homeProducts[d].piclink="images/addpro.png",a.homeProducts[d].caption="请选择产品";break}a.products[c].priority=0,a.homeProductsThree=!1}else alert("操作失败")})}else b.go("home")});else{var f=0;for(f=0;f<3&&a.homeProducts[f].proid!=-1;f++);console.log("key",f);var g={};g.protype=1,g.proid=a.products[c].id,g.priority=a.homeProducts[f].priority,e.cspManageAddShowProduct(g,function(b){if("succeed"==b.result){a.products[c].priority=f+1,a.homeProducts[f].proid=a.products[c].id,a.homeProducts[f].caption=a.products[c].caption,a.homeProducts[f].piclink=a.products[c].piclink,a.homeProductsThree=!0;for(var d=0;d<3;d++)if(a.homeProducts[d].proid==-1){a.homeProductsThree=!1;break}}else alert("操作失败")})}},a.cspManageDeleteShowProduct=function(c){a.homeProducts[c].proid==-1||d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var f={};f.protype=a.homeProducts[c].protype,f.priority=a.homeProducts[c].priority,e.cspManageDeleteShowProduct(f,function(b){if("succeed"==b.result){for(var d=0;d<a.products.length;d++)if(a.products[d].id==a.homeProducts[c].proid){a.products[d].priority=0;break}a.homeProducts[c].proid=-1,a.homeProducts[c].piclink="images/addpro.png",a.homeProducts[c].caption="请选择产品",a.homeProductsThree=!1}else alert("操作失败")})}else b.go("home")})},a.cspManageDeleteAnalogShowProduct=function(c){console.log("dslfkjl"),a.homeAnalogProducts[c].proid==-1||d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var f={};f.protype=a.homeAnalogProducts[c].protype,f.priority=a.homeAnalogProducts[c].priority,console.log(f),e.cspManageDeleteShowProduct(f,function(b){if("succeed"==b.result){for(var d=0;d<a.analogProducts.length;d++)if(a.analogProducts[d].id==a.homeAnalogProducts[c].proid){a.analogProducts[d].priority=0;break}a.homeAnalogProducts[c].proid=-1,a.homeAnalogProducts[c].piclink="images/addpro.png",a.homeAnalogProducts[c].caption="请选择产品",a.homeAnalogProductsThree=!1}else alert("操作失败")})}else b.go("home")})},a.cspManageAnalogProductCheckClick=function(c){if(0!=a.analogProducts[c].priority)d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var f={};f.protype=2,f.priority=a.analogProducts[c].priority,e.cspManageDeleteShowProduct(f,function(b){if("succeed"==b.result){for(var d=0;d<a.homeAnalogProducts.length;d++)if(a.homeAnalogProducts[d].proid==a.analogProducts[c].id){a.homeAnalogProducts[d].proid=-1,a.homeAnalogProducts[d].piclink="images/addpro.png",a.homeAnalogProducts[d].caption="请选择产品";break}a.analogProducts[c].priority=0,a.homeAnalogProductsThree=!1}else alert("操作失败")})}else b.go("home")});else{var f=0;for(f=0;f<3&&a.homeAnalogProducts[f].proid!=-1;f++);console.log("key",f);var g={};g.protype=2,g.proid=a.analogProducts[c].id,g.priority=a.homeAnalogProducts[f].priority,e.cspManageAddShowProduct(g,function(b){if("succeed"==b.result){a.analogProducts[c].priority=f+1,a.homeAnalogProducts[f].proid=a.analogProducts[c].id,a.homeAnalogProducts[f].caption=a.analogProducts[c].caption,a.homeAnalogProducts[f].piclink=a.analogProducts[c].piclink,a.homeAnalogProductsThree=!0;for(var d=0;d<3;d++)if(a.homeAnalogProducts[d].proid==-1){a.homeAnalogProductsThree=!1;break}}else alert("操作失败")})}},a.cspManageRefreshSeries=function(b){a.seriesLoading.loading=!1,a.seriesLoading.error=!1,a.seriesLoading.errorString="",a.newSeries=!1,a.seriesCurrentPage=b;var c={};c.page=a.seriesCurrentPage,c.pageCount=a.pageCount,e.cspManageGetPageSeries(c,function(b){if("succeed"==b.result){a.series.splice(0,a.series.length),a.series=b.data;for(var c=0;c<a.series.length;c++)a.series[c].edit=!1,a.series[c].editname=a.series[c].name,a.series[c].editdesc=a.series[c].description;a.seriesTotalPage=Math.ceil(b.count/a.pageCount),a.seriesPages.splice(0,a.seriesPages.length);var d=1;a.seriesCurrentPage<=Math.ceil(a.itemCount/2)||a.seriesTotalPage<=a.itemCount?d=1:(d=a.seriesCurrentPage-Math.ceil(a.itemCount/2)+1,a.seriesTotalPage-d+1<a.itemCount&&(d=a.seriesTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.seriesTotalPage||a.seriesTotalPage<=1);e++){var f={};f.num=e,e===a.seriesCurrentPage?f.select=!0:f.select=!1,a.seriesPages.push(f)}a.seriesTotalPage<=1?(a.seriesShowPrev=!1,a.seriesShowNext=!1):(a.seriesShowPrev=!0,a.seriesShowNext=!0)}else alert("获取数据失败")})},a.cspManageNewSeries=function(){a.newSeries=!0,a.nowSeries.name="",a.nowSeries.description=""},a.cspManageNewSeriesOk=function(){var f=1;a.seriesLoading.loading=!0,a.seriesLoading.error=!1,a.seriesLoading.errorString="正在提交，请稍候...",""==a.nowSeries.name||"undefined"==typeof a.nowSeries.name?(a.seriesLoading.error=!0,a.seriesLoading.errorString="系列名称不能为空",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):f--},500,100)):""==a.nowSeries.description||"undefined"==typeof a.nowSeries.description?(a.seriesLoading.error=!0,a.seriesLoading.errorString="系列说明不能为空",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):f--},500,100)):d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var g={};g.name=a.nowSeries.name,g.description=a.nowSeries.description,e.cspManageAddSeries(g,function(b){"succeed"==b.result?(a.newSeries=!1,a.seriesLoading.error=!0,a.seriesLoading.errorString="操作成功",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1,a.cspManageRefreshSeries(1)):f--},500,100)):(a.seriesLoading.error=!0,a.seriesLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):f--},500,100))})}else b.go("home")})},a.cspManageNewSeriesCancel=function(){a.newSeries=!1},a.cspManageEditSeries=function(b){a.series[b].editname=a.series[b].name,a.series[b].editdesc=a.series[b].description,a.series[b].edit=!0},a.cspManageDeleteSeries=function(f){var g=1;a.seriesLoading.loading=!0,a.seriesLoading.error=!1,a.seriesLoading.errorString="正在提交，请稍候...",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var h={};h.id=a.series[f].id,e.cspManageDeleteSeries(h,function(b){"succeed"==b.result?(a.newSeries=!1,a.seriesLoading.error=!0,a.seriesLoading.errorString="操作成功",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1,a.cspManageRefreshSeries(1)):g--},500,100)):(a.seriesLoading.error=!0,a.seriesLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):g--},500,100))})}else b.go("home")})},a.cspManageEditSeriesOk=function(f){var g=1;a.seriesLoading.loading=!0,a.seriesLoading.error=!1,a.seriesLoading.errorString="正在提交，请稍候...",""==a.series[f].editname||"undefined"==typeof a.series[f].editname?(a.seriesLoading.error=!0,a.seriesLoading.errorString="系列名称不能为空",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):g--},500,100)):""==a.series[f].editdesc||"undefined"==typeof a.series[f].editdesc?(a.seriesLoading.error=!0,a.seriesLoading.errorString="系列说明不能为空",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):g--},500,100)):d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var h={};h.id=a.series[f].id,h.name=a.series[f].editname,h.description=a.series[f].editdesc,e.cspManageUpdateSeries(h,function(b){"succeed"==b.result?(a.newSeries=!1,a.seriesLoading.error=!0,a.seriesLoading.errorString="操作成功",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1,a.cspManageRefreshSeries(1)):g--},500,100)):(a.seriesLoading.error=!0,a.seriesLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.seriesLoading.loading=!1):g--},500,100))})}else b.go("home")})},a.cspManageEditSeriesCancel=function(b){a.series[b].edit=!1},a.cspManageSeriesLoopToFirst=function(){1==a.seriesCurrentPage||a.cspManageRefreshSeries(1)},a.cspManageSeriesLoopPrev=function(){1==a.seriesCurrentPage||a.cspManageRefreshSeries(a.seriesCurrentPage-1)},a.cspManageSeriesLoopToPage=function(b){a.seriesCurrentPage==b.num||a.cspManageRefreshSeries(b.num)},a.cspManageSeriesLoopNext=function(){a.seriesCurrentPage==a.seriesTotalPage||a.cspManageRefreshSeries(a.seriesCurrentPage+1)},a.cspManageSeriesLoopLast=function(){a.seriesCurrentPage==a.seriesTotalPage||a.cspManageRefreshSeries(a.seriesTotalPage)},a.cspManageGetPageNotices=function(b,c,d,f){a.noticeCurrentPage=f,a.noticeLoading.loading=!1,a.noticeLoading.error=!1,a.noticeLoading.errorString="",a.noticeModal=!1,a.noticeDeleteLoading.loading=!1,a.noticeDeleteLoading.error=!1,a.noticeDeleteLoading.errorString="",a.notices.splice(0,a.notices.length);var g={};g.protype=b,g.proid=c,g.page=f,g.seriesid=d,g.pageCount=a.pageCount,e.cspManageGetPageNotices(g,function(b){if("succeed"==b.result){a.notices=b.data,a.noticeTotalPage=Math.ceil(b.count/a.pageCount),a.noticePages.splice(0,a.noticePages.length);var c=1;a.noticeCurrentPage<=Math.ceil(a.itemCount/2)||a.noticeTotalPage<=a.itemCount?c=1:(c=a.noticeCurrentPage-Math.ceil(a.itemCount/2)+1,a.noticeTotalPage-c+1<a.itemCount&&(c=a.noticeTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.noticeTotalPage||a.noticeTotalPage<=1);d++){var e={};e.num=d,d===a.noticeCurrentPage?e.select=!0:e.select=!1,a.noticePages.push(e)}a.noticeTotalPage<=1?(a.noticeShowPrev=!1,a.noticeShowNext=!1):(a.noticeShowPrev=!0,a.noticeShowNext=!0)}else alert("获取数据失败，请刷新重试")})},a.cspManageRefreshNotice=function(){0==a.noticeSelect.protype?jQuery("#csp_manage_notice_series_dropdown").dropdown("restore default value"):jQuery("#csp_manage_notice_proid_dropdown").dropdown("clear"),a.cspManageGetPageNotices(a.noticeSelect.protype,0,-1,1)},a.cspManageNewNotice=function(){a.currentNotice.proid=a.noticeSelect.proid,a.currentNotice.protype=0==a.noticeSelect.protype?1:a.noticeSelect.protype,a.currentNotice.name="",a.currentNotice.filename="",a.currentNotice.path="",a.noticeLoading.loading=!1,a.noticeLoading.error=!1,a.noticeLoading.errorString="";var b={};b.protype=a.currentNotice.protype,e.cspManageGetNoticeProduct(b,function(b){"succeed"==b.result?(a.noticeselectproduct.splice(0,a.noticeselectproduct.length),a.noticeselectproduct=b.data,a.noticeModalPath="tpls/managecenter/newnotice.html",a.noticestate=1,a.noticeModal=!0):alert("获取数据失败，请刷新重试")})},a.cspManageNoticeLoad=function(){switch(a.noticestate){case 1:jQuery("#csp_manage_newnotice_proid_dropdown").dropdown("restore defaults"),jQuery("#csp_manage_newnotice_proid_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.currentNotice.proid=b)},on:"click"}),jQuery("#csp_manage_newnotice_protype_dropdown").dropdown({onChange:function(b,c,d){if(console.log("change protype",b),""!=b){a.currentNotice.protype=0,a.currentNotice.protype=b;var f={};f.protype=b,e.cspManageGetNoticeProduct(f,function(b){"succeed"==b.result?(a.noticeselectproduct.splice(0,a.noticeselectproduct.length),a.noticeselectproduct=b.data,jQuery("#csp_manage_newnotice_proid_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.currentNotice.proid=b)},on:"click"})):alert("获取数据失败，请刷新重试")})}},on:"click"});break;case 2:}},a.cspManageNewNoticeOk=function(){var f=1;a.noticeLoading.loading=!0,a.noticeLoading.error=!1,a.noticeLoading.errorString="正在提交，请稍候...",""==a.currentNotice.name?(a.noticeLoading.error=!0,a.noticeLoading.errorString="公告标题不能为空",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)):0==a.currentNotice.proid||0==a.currentNotice.protype?(a.noticeLoading.error=!0,a.noticeLoading.errorString="请选择公告对应的产品",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)):""==a.currentNotice.filename?(a.noticeLoading.error=!0,a.noticeLoading.errorString="请上传公告附件",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)):d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{a.noticeLoading.errorString="正在上传附件..";var g=new FormData,h=document.getElementById("csp_manage_newnotice_file_input").files[0];g.append("file",h),e.cspManageUploadNoticeFile(g,function(b){if("succeed"==b.result){a.currentNotice.path=b.filepath,a.noticeLoading.errorString="正在创建..";var d={};d.protype=a.currentNotice.protype,d.proid=a.currentNotice.proid,d.name=a.currentNotice.name,d.path=a.currentNotice.path,e.cspManageAddNotice(d,function(d){"succeed"==d.result?(a.noticeLoading.error=!0,a.noticeLoading.errorString="创建成功",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1,a.noticeModal=!1,a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,1)):f--},500,100)):(a.noticeLoading.error=!0,a.noticeLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100))})}else a.noticeLoading.error=!0,a.noticeLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)})}else b.go("home")})},a.cspManageNewNoticeCancel=function(){a.noticeModal=!1,a.noticeModalPath="",a.noticestate=0},a.cspManageNewNoticeSelectFile=function(){document.getElementById("csp_manage_notice_file_form").reset(),console.log(document.getElementById("csp_manage_newnotice_file_input").value),document.getElementById("csp_manage_newnotice_file_input").click()},a.cspManageNewNoticeUploadFile=function(){filename=document.getElementById("csp_manage_newnotice_file_input").value,a.currentNotice.filename=filename.substring(12,filename.length)},a.cspManageNewNoticeDeleteFile=function(){a.currentNotice.filename=""},a.cspManageEditNotice=function(b){a.currentNotice.proid=a.notices[b].proid,a.currentNotice.caption=a.notices[b].caption,a.currentNotice.protype=a.notices[b].protype,a.currentNotice.name=a.notices[b].name,a.currentNotice.filename=a.notices[b].path.substring(6),a.currentNotice.path="",a.currentNotice.id=a.notices[b].id,a.currentNotice.oldpath=a.notices[b].path,a.noticeLoading.loading=!1,a.noticeLoading.error=!1,a.noticeLoading.errorString="",a.noticeModal=!0,a.noticeModalPath="tpls/managecenter/editnotice.html",a.noticestate=2},a.cspManageEditNoticeOk=function(){var f=1;a.noticeLoading.loading=!0,a.noticeLoading.error=!1,a.noticeLoading.errorString="正在提交，请稍候...",""==a.currentNotice.name?(a.noticeLoading.error=!0,a.noticeLoading.errorString="公告标题不能为空",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)):""==a.currentNotice.filename?(a.noticeLoading.error=!0,a.noticeLoading.errorString="请上传公告附件",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)):d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{a.noticeLoading.errorString="正在上传附件..";var g=new FormData,h=document.getElementById("csp_manage_newnotice_file_input").files[0];g.append("file",h),e.cspManageUploadNoticeFile(g,function(b){if("succeed"==b.result){a.currentNotice.path=b.filepath,a.noticeLoading.errorString="正在更新..";var d={};d.id=a.currentNotice.id,d.oldpath=a.currentNotice.oldpath,d.path=a.currentNotice.path,d.name=a.currentNotice.name,e.cspManageUpdateNotice(d,function(d){"succeed"==d.result?(a.noticeLoading.error=!0,a.noticeLoading.errorString="修改成功",a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1,a.noticeModal=!1,a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,a.noticeCurrentPage)):f--},500,100)):(a.noticeLoading.error=!0,a.noticeLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100))})}else a.noticeLoading.error=!0,a.noticeLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeLoading.loading=!1):f--},500,100)})}else b.go("home")})},a.cspManageDeleteNotice=function(f){var g=1;a.noticeDeleteLoading.loading=!0,a.noticeDeleteLoading.error=!1,a.noticeDeleteLoading.errorString="正在提交...",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var h={};h.id=a.notices[f].id,h.path=a.notices[f].path,e.cspManageDeleteNotice(h,function(b){"succeed"==b.result?(a.noticeDeleteLoading.error=!0,a.noticeDeleteLoading.errorString="操作成功",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeDeleteLoading.loading=!1,a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,1)):g--},500,100)):(a.noticeDeleteLoading.error=!0,a.noticeDeleteLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.noticeDeleteLoading.loading=!1):g--},500,100))})}else b.go("home")})},a.cspManageNoticeLoopToFirst=function(){1!=a.noticeCurrentPage&&a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,1)},a.cspManageNoticeLoopPrev=function(){1!=a.noticeCurrentPage&&a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,a.noticeCurrentPage-1)},a.cspManageNoticeLoopToPage=function(b){a.noticeCurrentPage!=b.num&&a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,b.num)},a.cspManageNoticeLoopNext=function(){a.noticeCurrentPage!=a.noticeTotalPage&&a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,a.noticeCurrentPage+1)},a.cspManageNoticeLoopLast=function(){a.noticeCurrentPage!=a.noticeTotalPage&&a.cspManageGetPageNotices(a.noticeSelect.protype,a.noticeSelect.proid,a.noticeSelect.seriesid,a.noticeTotalPage)},a.cspManageImportUser=function(){a.cspManageLoadPath="tpls/managecenter/loaduser.html",a.cspManageState=12},a.cspManageLoadUserBack=function(){a.cspManageMenuChange(a.cspManageMenuState.userLoad,a.cspManageMenuState.userManage)},a.cspManageShowLoadUserTips=function(){a.showloadUserTips=!0},a.cspManageHideLoadUserTips=function(){a.showloadUserTips=!1},a.cspManageCloseLoadUserMessage=function(){a.loadUserResInfo.loading=!1},a.cspManageLoadUserSelectFile=function(){a.showloadUserTips=!1,document.getElementById("csp_manage_load_user_file_form").reset(),a.loadUserResInfo.loading=!1,document.getElementById("csp_manage_loaduser_file_load_input").click()},a.cspManageLoadUserFileError=function(){a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString="请选择csv、xls、xlsx类型的文件"},a.cspManageLoadUserLoadFileReady=function(){var c=new FormData,f=document.getElementById("csp_manage_loaduser_file_load_input").files[0];c.append("file",f),a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="正在上传文件",a.loadUserOperInfo.loading=!0,a.loadUserOperInfo.fileRight=!1,d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){"succeed"==d.result?1==d.gorisk?b.go("risklevel"):e.cspManageLoadUserUpLoadFile(c,function(b){if("succeed"==b.result)if(1==b.file){a.loadUserOperInfo.loading=!1,a.loadUserOperInfo.fileRight=!0,a.loadUserOperInfo.check=!1,a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!1,a.loadUsers=b.data,a.loadUserCheckAll=!1,a.loadUserCheckOnce=!1;for(var c=0;c<b.data.length;c++){a.loadUsers[c].selected=!1;var d=0;for(d=0;d<a.conlevelInfo.length;d++)if(a.loadUsers[c].conlevel==a.conlevelInfo[d].id){a.loadUsers[c].conName=a.conlevelInfo[d].name;break}d>=a.conlevelInfo.length&&(a.loadUsers[c].conName="错误数据")}}else a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString=b.reason,a.loadUserOperInfo.loading=!1,a.loadUserOperInfo.fileRight=!1;else a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString=b.reason,a.loadUserOperInfo.loading=!1,a.loadUserOperInfo.fileRight=!1}):b.go("home")})},a.cspManageLoadUserSelectAll=function(){if(!a.loadUserOperInfo.check&&!a.loadUserOperInfo.import)if(a.loadUserResInfo.loading=!1,1==a.loadUserCheckAll){for(var b=0;b<a.loadUsers.length;b++)a.loadUsers[b].selected=!1;a.loadUserCheckAll=!1}else{for(var b=0;b<a.loadUsers.length;b++)a.loadUsers[b].selected=!0;a.loadUserCheckAll=!0}},a.cspManageLoadUserCheckOne=function(){if(!a.loadUserOperInfo.check&&!a.loadUserOperInfo.import){a.loadUserResInfo.loading=!1,a.loadUserCheckAll=!0;for(var b=0;b<a.loadUsers.length;b++)if(0==a.loadUsers[b].selected){a.loadUserCheckAll=!1;break}}},a.cspManageLoadUserMultipleDeleteLocal=function(){if(!a.loadUserOperInfo.check&&!a.loadUserOperInfo.import){a.loadUserResInfo.loading=!1;for(var b=0;b<a.loadUsers.length;b++)1==a.loadUsers[b].selected&&(a.loadUsers.splice(b,1),b--);0==a.loadUsers.length&&(a.loadUserOperInfo.fileRight=!1)}},a.cspManageLoadUserClearLocal=function(){a.loadUserOperInfo.check||a.loadUserOperInfo.import||(a.loadUserResInfo.loading=!1,a.loadUsers.splice(0,a.loadUsers.length),a.loadUserOperInfo.fileRight=!1)},a.cspManageLoadUserCheckRepeat=function(){if(0==a.loadUserOperInfo.import){a.loadUserOperInfo.check=!0,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="开始检查数据格式(若数据过多，等待的时间可能较长)";for(var c=/^1[34578]\d{9}$/,f=0;f<a.loadUsers.length;f++)c.test(a.loadUsers[f].phone)&&e.cspManageCheckIdcard(a.loadUsers[f].idcard)&&"错误数据"!=a.loadUsers[f].conName||(a.loadUsers.splice(f,1),f--);if(0==a.loadUsers.length)a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString="去重完成，本地数据格式错误，请重新选择文件",a.loadUserOperInfo.fileRight=!1;else{a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="数据格式检查完成，开始进行重复性检查";for(var g=0;g<a.loadUsers.length-1;g++)for(var h=g+1;h<a.loadUsers.length;h++)a.loadUsers[h].phone==a.loadUsers[g].phone&&(a.loadUsers.splice(h,1),h--);a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="本地数据去重完成，开始与服务器数据库比对",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){"succeed"==c.result?1==c.gorisk?b.go("risklevel"):e.cspManageGetSimpleUserInfo({},function(b){if("succeed"==b.result){for(var c=(b.data,0);c<b.data.length;c++)for(var d=0;d<a.loadUsers.length;d++)b.data[c].tel==a.loadUsers[d].phone&&(a.loadUsers.splice(d,1),d--);0==a.loadUsers.length?(a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString="去重完成，所有数据均不可用，请重新选择文件",a.loadUserOperInfo.fileRight=!1):(a.loadUserOperInfo.check=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserCheckOnce=!0,a.loadUserResInfo.errorString="去重完成，您可以立即导入数据库或者删除部分数据再导入")}else a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString="服务器异常",a.loadUserOperInfo.check=!1}):b.go("home")})}}},a.cspManageLoadUserSure=function(){if(0==a.loadUserOperInfo.check){var c={};if(c.count=a.loadUsers.length,c.users=a.loadUsers,1==a.loadUserCheckOnce)a.loadUserOperInfo.import=!0,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="开始导入，请稍候",e.cspManageMultipleLoadUser(c,function(b){"succeed"==b.result?(a.cspManageLoadPath="tpls/managecenter/usermanage.html",a.cspManageState=4):(a.loadUserCheckOnce=!1,a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString=b.reason)});else{a.loadUserOperInfo.import=!0,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="开始检查数据格式(若数据过多，等待的时间可能较长)";for(var f=/^1[34578]\d{9}$/,g=0;g<a.loadUsers.length;g++)if(!f.test(a.loadUsers[g].phone)||!e.cspManageCheckIdcard(a.loadUsers[g].idcard)||"错误数据"==a.loadUsers[g].conName)return a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,void(a.loadUserResInfo.errorString="数据格式存在错误，建议您先一键去重");a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="数据格式检查完成，开始进行重复性检查";for(var h=0;h<a.loadUsers.length-1;h++)for(var i=h+1;i<a.loadUsers.length;i++)if(a.loadUsers[i].phone==a.loadUsers[h].phone)return a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,void(a.loadUserResInfo.errorString="本地数据存在重复，建议您先一键去重");a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="本地数据重复性检查完成，开始与服务器数据库比对",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){"succeed"==d.result?1==d.gorisk?b.go("risklevel"):e.cspManageGetSimpleUserInfo({},function(b){if("succeed"==b.result){for(var d=(b.data,0);d<b.data.length;d++)for(var f=0;f<a.loadUsers.length;f++)if(b.data[d].tel==a.loadUsers[f].phone)return a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,void(a.loadUserResInfo.errorString="本地数据与服务器数据库数据冲突，建议您先一键去重");a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!1,a.loadUserResInfo.errorString="与数据库对比完成，开始导入",e.cspManageMultipleLoadUser(c,function(b){"succeed"==b.result?(a.cspManageLoadPath="tpls/managecenter/usermanage.html",a.cspManageState=4):(a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString=b.reason)})}else a.loadUserOperInfo.import=!1,a.loadUserResInfo.loading=!0,a.loadUserResInfo.error=!0,a.loadUserResInfo.errorString="服务器异常"}):b.go("home")})}}},a.cspManageToLoadBoughtData=function(){var f=1;a.boughtShowModal=!0,a.boughtNextInfo.loading=!0,a.boughtNextInfo.error=!1,a.boughtNextInfo.errorString="正在加载产品信息",a.boughtNextInfo.proid=0,a.boughtNextInfo.protype=1,a.boughtNextInfo.caption="",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{a.simpleProducts.splice(0,a.simpleProducts.length);var g={};g.protype=1,e.cspManageGetSimpleProducts(g,function(b){"succeed"==b.result?(a.simpleProducts=b.data,a.boughtNextInfo.loading=!1):(a.boughtNextInfo.error=!0,a.boughtNextInfo.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){f<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtNextInfo.loading=!1):f--},500,100))})}else b.go("home")}),jQuery("#csp_manage_bought_load_product_dropdown").dropdown("clear"),jQuery("#csp_manage_bought_load_product_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.boughtNextInfo.proid=b,a.boughtNextInfo.caption=jQuery("#csp_manage_bought_load_product_dropdown").dropdown("get text"))},on:"click"})},a.cspManageBoughtCloseLoadModal=function(){a.boughtShowModal=!1},a.cspManageBoughtLoadNext=function(){if(0==a.boughtNextInfo.proid){var b=1;a.boughtNextInfo.loading=!0,a.boughtNextInfo.error=!0,a.boughtNextInfo.errorString="请选择一个产品",a.loadingtime=void 0,a.loadingtime=c(function(){b<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtNextInfo.loading=!1):b--},500,100)}else a.boughtShowModal=!1,a.cspManageState=a.cspManageMenuState.boughtLoad,a.cspManageLoadPath="tpls/managecenter/loadbought.html",a.loadBoughtCheckAll=!1,a.loadBoughtCheckOnce=!1,a.loadBoughtOperInfo.loading=!1,a.loadBoughtOperInfo.fileRight=!1,a.loadBoughtOperInfo.check=!1,a.loadBoughtOperInfo.import=!1,a.loadBoughtResInfo.loading=!1,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="",a.showloadBoughtTips=!1,a.loadBoughtRoleInfo.showModal=!1,a.loadBoughtRoleInfo.role=-1},a.cspManageLoadBoughtBack=function(){a.cspManageMenuChange(a.cspManageMenuState.boughtLoad,a.cspManageMenuState.boughtManage)},a.cspManageCloseLoadBoughtMessage=function(){a.loadBoughtResInfo.loading=!1},a.cspManageShowLoadBoughtTips=function(){a.showloadBoughtTips=!0},a.cspManageHideLoadBoughtTips=function(){a.showloadBoughtTips=!1},a.cspManageLoadBoughtSelectFile=function(){a.showloadBoughtTips=!1,document.getElementById("csp_manage_load_bought_file_form").reset(),document.getElementById("csp_manage_loadbought_file_load_input").click()},a.cspManageLoadBoughtLoadFileReady=function(){var c=new FormData,f=document.getElementById("csp_manage_loadbought_file_load_input").files[0];c.append("file",f),a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="正在上传文件",a.loadBoughtOperInfo.loading=!0,a.loadBoughtOperInfo.fileRight=!1,a.loadBoughts.splice(0,a.loadBoughts.length),d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){"succeed"==d.result?1==d.gorisk?b.go("risklevel"):e.cspManageLoadBoughtUpLoadFile(c,function(b){"succeed"==b.result&&1==b.file?(a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="文件上传成功,正在匹配用户",
e.cspManageGetSimpleUserInfo({},function(c){if(a.loadBoughts=b.data,"succeed"==c.result){for(var d=0;d<a.loadBoughts.length;d++){var e=0;for(e=0;e<c.data.length;e++)if(a.loadBoughts[d].phone==c.data[e].tel){a.loadBoughts[d].uid=c.data[e].uid,a.loadBoughts[d].name=c.data[e].name;break}e>=c.data.length&&(a.loadBoughts[d].uid="",a.loadBoughts[d].name="无匹配项"),a.loadBoughts[d].selected=!1}a.loadBoughtResInfo.loading=!1,a.loadBoughtOperInfo.loading=!1,a.loadBoughtOperInfo.fileRight=!0,a.loadBoughtCheckAll=!1,a.loadBoughtCheckOnce=!1}else a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="匹配用户失败，无法进行导入",a.loadBoughts.splice(0,a.loadBoughts.length),a.loadBoughtOperInfo.loading=!1,a.loadBoughtOperInfo.fileRight=!1})):(a.loadBoughtOperInfo.loading=!1,a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="文件内容格式错误",a.loadBoughtOperInfo.fileRight=!1)}):b.go("home")})},a.cspManageLoadBoughtFileError=function(){a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="请选择.csv、.xls、.xlsx类型的文件"},a.cspManageLoadBoughtSelectAll=function(){if(!a.loadBoughtOperInfo.check&&!a.loadBoughtOperInfo.import)if(a.loadBoughtResInfo.loading=!1,a.loadBoughtCheckAll){for(var b=0;b<a.loadBoughts.length;b++)a.loadBoughts[b].selected=!1;a.loadBoughtCheckAll=!1}else{for(var b=0;b<a.loadBoughts.length;b++)a.loadBoughts[b].selected=!0;a.loadBoughtCheckAll=!0}},a.cspManageLoadBoughtCheckOne=function(){if(!a.loadBoughtOperInfo.check&&!a.loadBoughtOperInfo.import){a.loadBoughtResInfo.loading=!1,a.loadBoughtCheckAll=!0;for(var b=0;b<a.loadBoughts.length;b++)if(0==a.loadBoughts[b].selected){a.loadBoughtCheckAll=!1;break}}},a.cspManageLoadBoughtMultipleDeleteLocal=function(){if(!a.loadBoughtOperInfo.check&&!a.loadBoughtOperInfo.import){for(var b=0;b<a.loadBoughts.length;b++)1==a.loadBoughts[b].selected&&(a.loadBoughts.splice(b,1),b--);0==a.loadBoughts.length&&(a.loadBoughtOperInfo.fileRight=!1)}},a.cspManageLoadBoughtClearLocal=function(){a.loadBoughtOperInfo.check||a.loadBoughtOperInfo.import||(a.loadBoughts.splice(0,a.loadBoughts.length),a.loadBoughtOperInfo.fileRight=!1)},a.cspManageLoadBoughtCheckRepeat=function(){if(!a.loadBoughtOperInfo.import&&!a.loadBoughtCheckOnce){a.loadBoughtOperInfo.check=!0,a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="开始检查数据格式(若数据过多，等待的时间可能较长)";for(var b=/^1[34578]\d{9}$/,c=/^(([1-9][0-9]{0,13})|0)(.(([1-9][0-9]?)|[0-9]?[1-9]))?$/,d=0;d<a.loadBoughts.length;d++)b.test(a.loadBoughts[d].phone)&&c.test(a.loadBoughts[d].amount)&&""!=a.loadBoughts[d].uid||(a.loadBoughts.splice(d,1),d--);if(0==a.loadBoughts.length)a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="去重完成，本地数据格式错误，请重新选择文件",a.loadBoughtOperInfo.fileRight=!1;else{a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="数据格式检查完成，开始进行重复性检查";for(var e=0;e<a.loadBoughts.length-1;e++)for(var f=e+1;f<a.loadBoughts.length;f++)a.loadBoughts[f].phone==a.loadBoughts[e].phone&&(a.loadBoughts.splice(f,1),f--);a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="一键去重完成，您可以选择立即导入或删除部分数据再导入",a.loadBoughtOperInfo.check=!1,a.loadBoughtCheckOnce=!0}}},a.cspManageLoadBoughtSure=function(){a.loadBoughtOperInfo.check||(a.loadBoughtResInfo.loading=!1,a.loadBoughtRoleInfo.showModal=!0,a.loadBoughtRoleInfo.role==-1&&(a.loadBoughtRoleInfo.role=1))};a.cspManageLoadBoughtRoleChange=function(b){a.loadBoughtRoleInfo.role=b};a.cspManageLoadBoughtRoleCancel=function(){a.loadBoughtRoleInfo.showModal=!1},a.cspManageLoadBoughtRoleNext=function(){a.loadBoughtRoleInfo.showModal=!1;var c={};if(c.protype=a.boughtNextInfo.protype,c.proid=a.boughtNextInfo.proid,c.count=a.loadBoughts.length,c.boughts=a.loadBoughts,c.role=a.loadBoughtRoleInfo.role,1==a.loadBoughtCheckOnce)console.log("直接导入"),e.cspManageMultipleLoadBoughts(c,function(b){console.log(b),"succeed"==b.result?a.cspManageMenuChange(a.cspManageMenuState.boughtLoad,a.cspManageMenuState.boughtManage):(a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString=b.reason,a.loadBoughtOperInfo.import=!1,a.loadBoughtCheckOnce=!1)});else{a.loadBoughtOperInfo.import=!0,a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="开始检查数据格式(若数据过多，等待的时间可能较长)";for(var f=/^1[34578]\d{9}$/,g=/^(([1-9][0-9]{0,13})|0)(.(([1-9][0-9]?)|[0-9]?[1-9]))?$/,h=0;h<a.loadBoughts.length;h++)if(!f.test(a.loadBoughts[h].phone)||!g.test(a.loadBoughts[h].amount)||""==a.loadBoughts[h].uid)return a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="数据格式错误，建议您先一键去重",void(a.loadBoughtOperInfo.import=!1);a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="数据格式检查完成，开始进行重复性检查";for(var i=0;i<a.loadBoughts.length-1;i++)for(var j=i+1;j<a.loadBoughts.length;j++)if(a.loadBoughts[j].phone==a.loadBoughts[i].phone)return a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString="数据存在重复，建议您先一键去重",void(a.loadBoughtOperInfo.import=!1);a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!1,a.loadBoughtResInfo.errorString="数据检查完成，开始导入到数据库",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){"succeed"==d.result?1==d.gorisk?b.go("risklevel"):e.cspManageMultipleLoadBoughts(c,function(b){"succeed"==b.result?a.cspManageMenuChange(a.cspManageMenuState.boughtLoad,a.cspManageMenuState.boughtManage):(a.loadBoughtResInfo.loading=!0,a.loadBoughtResInfo.error=!0,a.loadBoughtResInfo.errorString=b.reason,a.loadBoughtOperInfo.import=!1)}):b.go("home")})}},a.cspManageSelectBoughts=function(){console.log(a.boughtSearch.userinfo),a.boughtSearch.seriesid==-1&&0==a.boughtSearch.proid&&""==a.boughtSearch.userinfo||(console.log("查询"),a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,1))},a.cspManageGetPageBoughts=function(c,f,g,h,i){a.boughtCurrentPage=i;var j={};j.type=c,j.seriesid=f,j.proid=g,j.userinfo=h,j.page=i,j.pageCount=a.pageCount,d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(c){"succeed"==c.result?1==c.gorisk?b.go("risklevel"):e.cspManageGetPageBoughts(j,function(b){if("succeed"==b.result){a.boughts.splice(0,a.boughts.length),a.boughts=b.data;for(var c=0;c<a.boughts.length;c++)a.boughts[c].edit=!1,a.boughts[c].editAmount=a.boughts[c].amount;a.boughtTotalPage=Math.ceil(b.count/a.pageCount),a.boughtPages.splice(0,a.boughtPages.length);var d=1;a.boughtCurrentPage<=Math.ceil(a.itemCount/2)||a.boughtTotalPage<=a.itemCount?d=1:(d=a.boughtCurrentPage-Math.ceil(a.itemCount/2)+1,a.boughtTotalPage-d+1<a.itemCount&&(d=a.boughtTotalPage-a.itemCount+1));for(var e=d;e<d+a.itemCount&&!(e>a.boughtTotalPage||a.boughtTotalPage<=1);e++){var f={};f.num=e,e===a.boughtCurrentPage?f.select=!0:f.select=!1,a.boughtPages.push(f)}a.boughtTotalPage<=1?(a.boughtShowPrev=!1,a.boughtShowNext=!1):(a.boughtShowPrev=!0,a.boughtShowNext=!0)}else alert("获取数据失败")}):b.go("home")})},a.cspManageEditBought=function(b){a.boughts[b].edit=!0,a.boughts[b].editAmount=a.boughts[b].amount},a.cspManageDeleteBought=function(f){var g=1;a.boughtDeleteLoading.loading=!0,a.boughtDeleteLoading.error=!1,a.boughtDeleteLoading.errorString="正在删除..",d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var h={};h.protype=a.boughts[f].protype,h.proid=a.boughts[f].proid,h.uid=a.boughts[f].uid,e.cspManageDeleteBought(h,function(b){"succeed"==b.result?(a.boughtDeleteLoading.error=!0,a.boughtDeleteLoading.errorString="操作成功",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtDeleteLoading.loading=!1,a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,1)):g--},500,100)):(a.boughtDeleteLoading.error=!1,a.boughtDeleteLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtDeleteLoading.loading=!1):g--},500,100))})}else b.go("home")})},a.cspManageEditBoughtSave=function(f){var g=1;a.boughtDeleteLoading.loading=!0,a.boughtDeleteLoading.error=!1,a.boughtDeleteLoading.errorString="正在保存..";var h=/^(([1-9][0-9]{0,13})|0)(.(([1-9][0-9]?)|[0-9]?[1-9]))?$/;h.test(a.boughts[f].editAmount)?d.cspUserCheckAndLoginByCookie(a.cookieInfo,function(d){if("succeed"==d.result)if(1==d.gorisk)b.go("risklevel");else{var h={};h.protype=a.boughts[f].protype,h.proid=a.boughts[f].proid,h.uid=a.boughts[f].uid,h.amount=a.boughts[f].editAmount,e.cspManageUpdateBought(h,function(b){"succeed"==b.result?(a.boughtDeleteLoading.error=!0,a.boughtDeleteLoading.errorString="操作成功",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtDeleteLoading.loading=!1,a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,1)):g--},500,100)):(a.boughtDeleteLoading.error=!1,a.boughtDeleteLoading.errorString=b.reason,a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtDeleteLoading.loading=!1):g--},500,100))})}else b.go("home")}):(a.boughtDeleteLoading.error=!1,a.boughtDeleteLoading.errorString="购买金额必须为17位浮点数或14位以内整数",a.loadingtime=void 0,a.loadingtime=c(function(){g<=0?(c.cancel(a.loadingtime),a.loadingtime=void 0,a.boughtDeleteLoading.loading=!1):g--},500,100))},a.cspManageEditBoughtCancel=function(b){a.boughts[b].edit=!1},a.cspManageBoughtLoopToFirst=function(){1!=a.boughtCurrentPage&&a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,1)},a.cspManageBoughtLoopPrev=function(){1!=a.boughtCurrentPage&&a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,a.boughtCurrentPage-1)},a.cspManageBoughtLoopToPage=function(b){a.boughtCurrentPage!=b.num&&a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,b.num)},a.cspManageBoughtLoopNext=function(){a.boughtCurrentPage!=a.boughtTotalPage&&a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,a.boughtCurrentPage+1)},a.cspManageBoughtLoopLast=function(){a.boughtCurrentPage!=a.boughtTotalPage&&a.cspManageGetPageBoughts(a.boughtSearch.type,a.boughtSearch.seriesid,a.boughtSearch.proid,a.boughtSearch.userinfo,a.boughtTotalPage)}}),cspCtrls.controller("cspOperLoginCtrl",function(a,b,c,d){a.timePromise=void 0,a.loginInfo={},a.cspOperLoginInit=function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",document.cookie||navigator.cookieEnabled?d.cspOperCheckLogin({},function(e){if("succeed"==e.result&&1==e.loginState)b.go("allocateStock");else{for(var f,g=!1,h="cspOperLoginInfo=",i=document.cookie.split(";"),j=0;j<i.length;j++){var k=i[j].trim();if(0==k.indexOf(h)){g=!0,f=JSON.parse(unescape(k.substring(h.length,k.length)));break}}if(g){a.loginInfo.maid=f.maid,a.loginInfo.oid=f.oid,a.loginInfo.password=f.password,a.loginInfo.logining=!0,a.loginInfo.loadState="正在登录",a.loginInfo.error=!1,a.loginInfo.save=f.save;var l={};l.login_maid=a.loginInfo.maid,l.login_oid=a.loginInfo.oid,l.login_pass=a.loginInfo.password,d.cspOperLogin(l,function(d){if("succeed"==d.result)a.loginInfo.loadState="登录成功",b.go("allocateStock");else{var e=2;a.loginInfo.error=!0,a.loginInfo.loadState=d.reason,a.timePromise=void 0,a.timePromise=c(function(){e<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.loginInfo.logining=!1):e--},500,100)}})}else a.loginInfo.maid="",a.loginInfo.oid="",a.loginInfo.password="",a.loginInfo.logining=!1,a.loginInfo.loadState="正在登录",a.loginInfo.error=!1,a.loginInfo.save=!1}}):alert("浏览器未开启cookie,网站可能无法正常使用")},a.cspOperLoginClick=function(){var e=1;if(a.loginInfo.logining=!0,a.loginInfo.error=!1,a.loginInfo.loadState="正在登录",a.loginInfo.error=!1,""==a.loginInfo.maid)a.loginInfo.error=!0,a.loginInfo.loadState="请输入资产管理人编号",a.timePromise=void 0,a.timePromise=c(function(){e<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.loginInfo.logining=!1):e--},500,100);else if(""==a.loginInfo.oid)a.loginInfo.error=!0,a.loginInfo.loadState="请输入操作员账号",a.timePromise=void 0,a.timePromise=c(function(){e<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.loginInfo.logining=!1):e--},500,100);else if(""==a.loginInfo.password)a.loginInfo.error=!0,a.loginInfo.loadState="请输入密码",a.timePromise=void 0,a.timePromise=c(function(){e<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.loginInfo.logining=!1):e--},500,100);else{var f={};f.login_maid=a.loginInfo.maid,f.login_oid=a.loginInfo.oid,f.login_pass=a.loginInfo.password,d.cspOperLogin(f,function(d){if("succeed"==d.result){if(a.loginInfo.loadState="登录成功",console.log(a.loginInfo.save),1==a.loginInfo.save){var f={};f.maid=a.loginInfo.maid,f.oid=a.loginInfo.oid,f.password=a.loginInfo.password,f.save=a.loginInfo.save;var g=JSON.stringify(f),h=new Date;h.setTime(h.getTime()+6048e5);var i="cspOperLoginInfo="+escape(g)+";expires="+h.toGMTString();document.cookie=i}else{var j="cspOperLoginInfo=",h=new Date;h.setTime(h.getTime());for(var k=document.cookie.split(";"),l=0;l<k.length;l++){var m=k[l].trim();if(0==m.indexOf(j)){document.cookie=m+";expires="+h.toGMTString();break}}}b.go("allocateStock")}else a.loginInfo.error=!0,a.loginInfo.loadState=d.reason,a.timePromise=void 0,a.timePromise=c(function(){e<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.loginInfo.logining=!1):e--},500,100)})}}}),cspCtrls.controller("cspOperLoginOutCtrl",function(a,b,c,d){a.cspOperLoginOutLoad=function(){d.cspOperLoginOut({},function(a){if(document.cookie||navigator.cookieEnabled){var c="cspOperLoginInfo=",d=new Date;d.setTime(d.getTime()),document.cookie=c+";expires="+d.toGMTString()}b.go("operlogin")})}}),cspCtrls.controller("cspOperManageCtrl",function(a,b,c,d,e){a.cookieinfo={},a.menustate=-1,a.maidList=[],a.oidList=[],a.currentMaid="",a.currentShowMaid="",a.menupath="",a.pageCount=10,a.itemCount=10,a.oidPages=[],a.oidTotalPage=1,a.oidCurrentPage=1,a.oidShowPrev=!1,a.oidShowNext=!1,a.newOperMaidList=[],a.newOperStatList=[],a.newOper={},a.editOper={},a.editOid="",a.timePromise=void 0,a.showModal=!1,a.operModalPath="",a.modalState=0,a.resetOperInfo={},a.authorizeOperInfo={},a.authorizeCaidList=[],a.authorizeTridList=[],a.cspOperManageInit=function(){if(document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",document.cookie||navigator.cookieEnabled){a.cookieinfo.exist=!1;for(var c="cspOperLoginInfo=",e=document.cookie.split(";"),f=0;f<e.length;f++){var g=e[f].trim();if(0==g.indexOf(c)){a.cookieinfo.cookieExist=!0;var h=JSON.parse(unescape(g.substring(c.length,g.length)));a.cookieinfo.login_maid=h.maid,a.cookieinfo.login_oid=h.oid,a.cookieinfo.login_pass=h.password;break}}a.newOperStatList.push({stat:"0",des:"立即启用"}),a.newOperStatList.push({stat:"0",des:"暂不启用"}),console.log("开始自动登录"),d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?(a.menustate=0,a.menupath="../tpls/operManage/opermanage.html"):b.go("operlogin")})}else alert("浏览器未开启cookie,网站可能无法正常使用"),b.go("operlogin")},a.cspOperManageLoadReady=function(){switch(a.menustate){case 0:d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?(a.oidList=[],e.cspOperManageGetAllMaid({},function(b){"succeed"==b.result?(a.maidList=[],a.maidList=b.data):alert("获取数据失败，请刷新页面重试")})):b.go("operlogin")}),$("#csp_oper_manage_maid_dropdown").dropdown({onChange:function(b,c,d){a.currentMaid=b},on:"hover"});break;case 1:if($(window).resize(function(a){if(document.documentElement.clientWidth>800){var b=document.getElementById("csp_oper_manage_basic_info_div").offsetHeight;document.getElementById("csp_oper_manage_help_info_div").style.height=b+"px"}else document.getElementById("csp_oper_manage_help_info_div").style.height="auto"}),document.documentElement.clientWidth>800){var c=document.getElementById("csp_oper_manage_basic_info_div").offsetHeight;document.getElementById("csp_oper_manage_help_info_div").style.height=c+"px"}else document.getElementById("csp_oper_manage_help_info_div").style.height="auto";d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?e.cspOperManageGetAllMaid({},function(b){"succeed"==b.result?(a.newOperMaidList=[],a.newOperMaidList=b.data):alert("获取数据失败，请刷新页面重试")}):b.go("operlogin")}),$("#csp_oper_manage_newoper_maid_dropdown").dropdown({onChange:function(b,c,d){a.newOper.maid=b},on:"click"}),$("#csp_oper_manage_newoper_stat_dropdown").dropdown({onChange:function(b,c,d){a.newOper.stat=b},on:"click"}),a.newOper={},a.newOper.maid="",a.newOper.oid="",a.newOper.oidShowTip=!1,a.newOper.oidError=!1,a.newOper.oidErrorString="",a.newOper.oname="",a.newOper.opass="",a.newOper.opassShowTip=!1,a.newOper.opassError=!1,a.newOper.opassErrorString="",a.newOper.opassrep="",a.newOper.opassrepShowTip=!1,a.newOper.opassrepError=!1,a.newOper.opassrepErrorString="",a.newOper.phone="",a.newOper.phoneShowTip=!1,a.newOper.phoneError=!1,a.newOper.phoneErrorString="",a.newOper.email="",a.newOper.emailShowTip=!1,a.newOper.emailError=!1,a.newOper.emailErrorString="",a.newOper.idcard="",a.newOper.idcardShowTip=!1,a.newOper.idcardError=!1,a.newOper.idcardErrorString="",a.newOper.stat="",a.newOper.loading=!1,a.newOper.error=!1,a.newOper.errorString="创建中，请稍候..";break;case 2:a.editOper.maid="",a.editOper.maname="",a.editOper.oid="",a.editOper.oname="",a.editOper.phone="",a.editOper.phoneShowTip=!1,a.editOper.phoneError=!1,a.editOper.phoneErrorString="",a.editOper.email="",a.editOper.emailShowTip=!1,a.editOper.emailError=!1,a.editOper.emailErrorString="",a.editOper.idcard="",a.editOper.idcardShowTip=!1,a.editOper.idcardError=!1,a.editOper.idcardErrorString="",a.editOper.stat="",a.editOper.loading=!1,a.editOper.error=!1,a.editOper.errorString="正在保存..",d.cspOperCheckAndLogin(a.cookieinfo,function(c){if("succeed"==c.result){var d={};d.oid=a.editOid,e.cspOperManageGetOperByOid(d,function(b){"succeed"==b.result&&1==b.exist?(a.editOper.maid=b.oper.maid,a.editOper.maname=b.oper.maname,a.editOper.oid=b.oper.oid,a.editOper.oname=b.oper.oname,a.editOper.phone=b.oper.phone,a.editOper.email=b.oper.email,a.editOper.idcard=b.oper.idcard,a.editOper.stat=b.oper.stat):alert("获取数据失败，请刷新页面")})}else b.go("operlogin")})}},a.cspOperManageSelectOper=function(){if(""!=a.currentMaid){a.currentShowMaid=a.currentMaid;var c={};c.maid=a.currentShowMaid,a.oidCurrentPage=1,c.page=a.oidCurrentPage,c.pageCount=a.pageCount,d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspOperManageGetOidByMaid(c,function(b){if("succeed"==b.result){a.oidList=[],a.oidList=b.data,a.oidTotalPage=Math.ceil(b.count/a.pageCount),a.oidPages=[];var c=1;a.oidCurrentPage<=Math.ceil(a.itemCount/2)||a.oidTotalPage<=a.itemCount?c=1:(c=a.oidCurrentPage-Math.ceil(a.itemCount/2)+1,a.oidTotalPage-c+1<a.itemCount&&(c=a.oidTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.oidTotalPage||a.oidTotalPage<=1);d++){var e={};e.num=d,d===a.oidCurrentPage?e.select=!0:e.select=!1,a.oidPages.push(e)}a.oidTotalPage<=1?(a.oidShowPrev=!1,a.oidShowNext=!1):(a.oidShowPrev=!0,a.oidShowNext=!0)}else alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})}},a.cspOperManageOidLoopToFirst=function(){if(1===a.oidCurrentPage);else if(window.scrollTo(0,0),""!=a.currentShowMaid){var c={};c.maid=a.currentShowMaid,a.oidCurrentPage=1,c.page=a.oidCurrentPage,c.pageCount=a.pageCount,d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspOperManageGetOidByMaid(c,function(b){if("succeed"==b.result){a.oidList=[],a.oidList=b.data,a.oidTotalPage=Math.ceil(b.count/a.pageCount),a.oidPages=[];var c=1;a.oidCurrentPage<=Math.ceil(a.itemCount/2)||a.oidTotalPage<=a.itemCount?c=1:(c=a.oidCurrentPage-Math.ceil(a.itemCount/2)+1,a.oidTotalPage-c+1<a.itemCount&&(c=a.oidTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.oidTotalPage||a.oidTotalPage<=1);d++){var e={};e.num=d,d===a.oidCurrentPage?e.select=!0:e.select=!1,a.oidPages.push(e)}a.oidTotalPage<=1?(a.oidShowPrev=!1,a.oidShowNext=!1):(a.oidShowPrev=!0,a.oidShowNext=!0)}else alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})}},a.cspOperManageOidLoopPrev=function(){if(1===a.oidCurrentPage);else if(window.scrollTo(0,0),""!=a.currentShowMaid){var c={};c.maid=a.currentShowMaid,a.oidCurrentPage=a.oidCurrentPage-1,c.page=a.oidCurrentPage,c.pageCount=a.pageCount,d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspOperManageGetOidByMaid(c,function(b){if("succeed"==b.result){a.oidList=[],a.oidList=b.data,a.oidTotalPage=Math.ceil(b.count/a.pageCount),a.oidPages=[];var c=1;a.oidCurrentPage<=Math.ceil(a.itemCount/2)||a.oidTotalPage<=a.itemCount?c=1:(c=a.oidCurrentPage-Math.ceil(a.itemCount/2)+1,a.oidTotalPage-c+1<a.itemCount&&(c=a.oidTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.oidTotalPage||a.oidTotalPage<=1);d++){var e={};e.num=d,d===a.oidCurrentPage?e.select=!0:e.select=!1,a.oidPages.push(e)}a.oidTotalPage<=1?(a.oidShowPrev=!1,a.oidShowNext=!1):(a.oidShowPrev=!0,a.oidShowNext=!0)}else alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})}},a.cspOperManageOidLoopToPage=function(c){if(c.select===!0);else if(window.scrollTo(0,0),""!=a.currentShowMaid){var f={};f.maid=a.currentShowMaid,a.oidCurrentPage=c.num,f.page=a.oidCurrentPage,f.pageCount=a.pageCount,d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?e.cspOperManageGetOidByMaid(f,function(b){if("succeed"==b.result){a.oidList=[],a.oidList=b.data,a.oidTotalPage=Math.ceil(b.count/a.pageCount),a.oidPages=[];var c=1;a.oidCurrentPage<=Math.ceil(a.itemCount/2)||a.oidTotalPage<=a.itemCount?c=1:(c=a.oidCurrentPage-Math.ceil(a.itemCount/2)+1,a.oidTotalPage-c+1<a.itemCount&&(c=a.oidTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.oidTotalPage||a.oidTotalPage<=1);d++){var e={};e.num=d,d===a.oidCurrentPage?e.select=!0:e.select=!1,a.oidPages.push(e)}a.oidTotalPage<=1?(a.oidShowPrev=!1,a.oidShowNext=!1):(a.oidShowPrev=!0,a.oidShowNext=!0)}else alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})}},a.cspOperManageOidLoopNext=function(){if(a.oidCurrentPage===a.oidTotalPage);else if(window.scrollTo(0,0),""!=a.currentShowMaid){var c={};c.maid=a.currentShowMaid,a.oidCurrentPage=a.oidCurrentPage+1,c.page=a.oidCurrentPage,c.pageCount=a.pageCount,d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspOperManageGetOidByMaid(c,function(b){if("succeed"==b.result){a.oidList=[],a.oidList=b.data,a.oidTotalPage=Math.ceil(b.count/a.pageCount),a.oidPages=[];var c=1;a.oidCurrentPage<=Math.ceil(a.itemCount/2)||a.oidTotalPage<=a.itemCount?c=1:(c=a.oidCurrentPage-Math.ceil(a.itemCount/2)+1,a.oidTotalPage-c+1<a.itemCount&&(c=a.oidTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.oidTotalPage||a.oidTotalPage<=1);d++){var e={};e.num=d,d===a.oidCurrentPage?e.select=!0:e.select=!1,a.oidPages.push(e)}a.oidTotalPage<=1?(a.oidShowPrev=!1,a.oidShowNext=!1):(a.oidShowPrev=!0,a.oidShowNext=!0)}else alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})}},a.cspOperManageOidLoopLast=function(){if(a.oidCurrentPage===a.oidTotalPage);else if(window.scrollTo(0,0),""!=a.currentShowMaid){var c={};c.maid=a.currentShowMaid,a.oidCurrentPage=a.oidTotalPage,c.page=a.oidCurrentPage,c.pageCount=a.pageCount,d.cspOperCheckAndLogin(a.cookieinfo,function(d){"succeed"==d.result?e.cspOperManageGetOidByMaid(c,function(b){if("succeed"==b.result){a.oidList=[],a.oidList=b.data,a.oidTotalPage=Math.ceil(b.count/a.pageCount),a.oidPages=[];var c=1;a.oidCurrentPage<=Math.ceil(a.itemCount/2)||a.oidTotalPage<=a.itemCount?c=1:(c=a.oidCurrentPage-Math.ceil(a.itemCount/2)+1,a.oidTotalPage-c+1<a.itemCount&&(c=a.oidTotalPage-a.itemCount+1));for(var d=c;d<c+a.itemCount&&!(d>a.oidTotalPage||a.oidTotalPage<=1);d++){var e={};e.num=d,d===a.oidCurrentPage?e.select=!0:e.select=!1,a.oidPages.push(e)}a.oidTotalPage<=1?(a.oidShowPrev=!1,a.oidShowNext=!1):(a.oidShowPrev=!0,a.oidShowNext=!0)}else alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})}},a.cspOperManageRefresh=function(){a.oidPages=[],a.oidTotalPage=1,a.oidCurrentPage=1,a.oidShowPrev=!1,a.oidShowNext=!1,a.maidList=[],a.oidList=[],a.currentMaid="",a.currentShowMaid="",$("#csp_oper_manage_maid_dropdown").dropdown("restore defaults"),d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?e.cspOperManageGetAllMaid({},function(b){"succeed"==b.result?(a.maidList=[],a.maidList=b.data):alert("获取数据失败，请刷新页面重试")}):b.go("operlogin")})},a.cspOperManageNewOid=function(){a.menustate=1,a.menupath="../tpls/operManage/opermanagenewoper.html"},a.cspOperManageBack=function(){a.menustate=0,a.menupath="../tpls/operManage/opermanage.html"},a.cspOperManageNewOperOidBlur=function(){if(""!=a.newOper.oid){var b=/^[0-9]{1,7}$/;b.test(a.newOper.oid)||(a.newOper.oidShowTip=!0,a.newOper.oidError=!0,a.newOper.oidErrorString="操作员账号格式错误")}else a.newOper.oidShowTip=!1,a.newOper.oidError=!1,a.newOper.oidErrorString=""},a.cspOperManageNewOperOpassBlur=function(){if(""!=a.newOper.opass){var b=/^[0-9A-Za-z!@#\$%,._-]{6,16}$/;b.test(a.newOper.opass)?(a.newOper.opassShowTip=!0,a.newOper.opassError=!1,a.newOper.opassErrorString=""):(a.newOper.opassShowTip=!0,a.newOper.opassError=!0,a.newOper.opassErrorString="操作员密码格式错误")}else a.newOper.opassShowTip=!1,a.newOper.opassError=!1,a.newOper.opassErrorString=""},a.cspOperManageNewOperOpassrepBlur=function(){""!=a.newOper.opassrep?a.newOper.opassrep!=a.newOper.opass?(a.newOper.opassrepShowTip=!0,a.newOper.opassrepError=!0,a.newOper.opassrepErrorString="两次密码不一致"):(a.newOper.opassrepShowTip=!0,a.newOper.opassrepError=!1,a.newOper.opassrepErrorString=""):(a.newOper.opassrepShowTip=!1,a.newOper.opassrepError=!1,a.newOper.opassrepErrorString="")},a.cspOperManageNewOperPhoneBlur=function(){if(""!=a.newOper.phone){var b=/^1[34578]\d{9}$/;b.test(a.newOper.phone)||(a.newOper.phoneShowTip=!0,a.newOper.phoneError=!0,a.newOper.phoneErrorString="手机号码格式错误")}else a.newOper.phoneShowTip=!1,a.newOper.phoneError=!1,a.newOper.phoneErrorString=""},a.cspOperManageNewOperEmailBlur=function(){if(""!=a.newOper.email){var b=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;b.test(a.newOper.email)||(a.newOper.emailShowTip=!0,a.newOper.emailError=!0,a.newOper.emailErrorString="邮件地址格式错误")}else a.newOper.emailShowTip=!1,a.newOper.emailError=!1,a.newOper.emailErrorString=""},a.cspOperManageNewOperIdcardBlur=function(){""!=a.newOper.idcard?d.cspOperCheckIdcard(a.newOper.idcard)||(a.newOper.idcardShowTip=!0,a.newOper.idcardError=!0,a.newOper.idcardErrorString="身份证号码格式错误"):(a.newOper.idcardShowTip=!1,a.newOper.idcardError=!1,a.newOper.idcardErrorString="")},a.cspOperManageNewOperSave=function(){var f=1;a.newOper.loading=!0,a.newOper.error=!1,a.newOper.errorString="创建中，请稍候..";return""==a.newOper.maid?(a.newOper.error=!0,a.newOper.errorString="请选择资产管理人",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):/^[0-9]{1,7}$/.test(a.newOper.oid)?""==a.newOper.oname?(a.newOper.error=!0,a.newOper.errorString="请填写操作员姓名",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):/^[0-9A-Za-z!@#\$%,._-]{6,16}$/.test(a.newOper.opass)?a.newOper.opass!=a.newOper.opassrep?(a.newOper.error=!0,a.newOper.errorString="两次密码不一致",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):""==a.newOper.phone||/^1[34578]\d{9}$/.test(a.newOper.phone)?""==a.newOper.email||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(a.newOper.email)?""==a.newOper.idcard||d.cspOperCheckIdcard(a.newOper.idcard)?""==a.newOper.stat?(a.newOper.error=!0,a.newOper.errorString="请设置启用状态",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):void d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){var g={};g.maid=a.newOper.maid,g.oid=a.newOper.oid,g.oname=a.newOper.oname,g.opass=a.newOper.opass,g.phone=a.newOper.phone,g.email=a.newOper.email,g.idcard=a.newOper.idcard,g.stat=a.newOper.stat,e.cspOperManageAddOper(g,function(b){"succeed"==b.result?(a.newOper.error=!0,a.newOper.errorString="创建成功",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100),a.menustate=0,a.menupath="../tpls/operManage/opermanage.html"):(a.newOper.error=!0,a.newOper.errorString=b.reason,a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))})}else b.go("operlogin")}):(a.newOper.error=!0,a.newOper.errorString="身份证号码错误",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):(a.newOper.error=!0,a.newOper.errorString="邮箱地址不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):(a.newOper.error=!0,a.newOper.errorString="手机号码不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):(a.newOper.error=!0,a.newOper.errorString="操作员密码不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100))):(a.newOper.error=!0,a.newOper.errorString="操作员账号不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.newOper.loading=!1):f--},500,100)))},a.cspOperManageEditOper=function(b){a.editOid=a.oidList[b].oid,a.menustate=2,a.menupath="../tpls/operManage/opermanageeditoper.html"},a.cspOperManageEditOperPhoneBlur=function(){if(""!=a.editOper.phone){var b=/^1[34578]\d{9}$/;b.test(a.editOper.phone)?(a.editOper.phoneShowTip=!0,a.editOper.phoneError=!1,a.editOper.phoneErrorString=""):(a.editOper.phoneShowTip=!0,a.editOper.phoneError=!0,a.editOper.phoneErrorString="手机号码格式错误")}else a.editOper.phoneShowTip=!1,a.editOper.phoneError=!1,a.editOper.phoneErrorString=""},a.cspOperManageEditOperEmailBlur=function(){if(""!=a.editOper.email){var b=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;b.test(a.editOper.email)?(a.editOper.emailShowTip=!0,a.editOper.emailError=!1,a.editOper.emailErrorString=""):(a.editOper.emailShowTip=!0,a.editOper.emailError=!0,a.editOper.emailErrorString="邮件地址格式错误")}else a.editOper.emailShowTip=!1,a.editOper.emailError=!1,a.editOper.emailErrorString=""},a.cspOperManageEditOperIdcardBlur=function(){""!=a.editOper.idcard?d.cspOperCheckIdcard(a.editOper.idcard)?(a.editOper.idcardShowTip=!0,a.editOper.idcardError=!1,a.editOper.idcardErrorString=""):(a.editOper.idcardShowTip=!0,a.editOper.idcardError=!0,a.editOper.idcardErrorString="身份证号码格式错误"):(a.editOper.idcardShowTip=!1,a.editOper.idcardError=!1,a.editOper.idcardErrorString="")},a.cspOperManageEditOperSave=function(){var f=1;return a.editOper.loading=!0,a.editOper.error=!1,a.editOper.errorString="正在保存修改..",""==a.editOper.oname?(a.editOper.error=!0,a.editOper.errorString="请填写操作员姓名",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.editOper.loading=!1):f--},500,100))):""==a.editOper.phone||/^1[34578]\d{9}$/.test(a.editOper.phone)?""==a.editOper.email||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(a.editOper.email)?""==a.editOper.idcard||d.cspOperCheckIdcard(a.editOper.idcard)?void d.cspOperCheckAndLogin(a.cookieinfo,function(d){
if("succeed"==d.result){var g={};g.oid=a.editOper.oid,g.oname=a.editOper.oname,g.phone=a.editOper.phone,g.email=a.editOper.email,g.idcard=a.editOper.idcard,e.cspOperManageUpdateOper(g,function(b){"succeed"==b.result?(a.editOper.error=!0,a.editOper.errorString="修改成功",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.editOper.loading=!1):f--},500,100),a.menustate=0,a.menupath="../tpls/operManage/opermanage.html"):(a.editOper.error=!0,a.editOper.errorString=addres.reason,a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.editOper.loading=!1):f--},500,100))})}else b.go("operlogin")}):(a.editOper.error=!0,a.editOper.errorString="身份证号码错误",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.editOper.loading=!1):f--},500,100))):(a.editOper.error=!0,a.editOper.errorString="邮箱地址不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.editOper.loading=!1):f--},500,100))):(a.editOper.error=!0,a.editOper.errorString="手机号码不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.editOper.loading=!1):f--},500,100)))},a.cspOperManageChangeOperStat=function(c){d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){var f={};f.oid=a.oidList[c].oid;var g;g="0"==a.oidList[c].stat?"1":"0",f.stat=g,e.cspOperManageChangeOperStat(f,function(b){"succeed"==b.result?a.oidList[c].stat=g:alert("操作失败，请刷新界面重试")})}else b.go("operlogin")})},a.cspOperManageModalPathLoad=function(){switch(a.modalState){case 1:break;case 2:$("#csp_oper_manage_authorize_caid_dropdown").dropdown({onChange:function(c,f,g){""!=c&&(a.authorizeOperInfo.caid=c,a.authorizeOperInfo.trid="",a.authorizeTridList.splice(0,a.authorizeTridList.length),$("#csp_oper_manage_authorize_trid_dropdown").dropdown("clear"),d.cspOperCheckAndLogin(a.cookieinfo,function(c){if("succeed"==c.result){var d={};d.caid=a.authorizeOperInfo.caid,e.cspOperManageGetTridByCaid(d,function(b){"succeed"==b.result?a.authorizeTridList=b.data:alert("获取数据失败,请刷新页面重试")})}else b.go("operlogin")}))},on:"click"}),$("#csp_oper_manage_authorize_trid_dropdown").dropdown({onChange:function(b,c,d){""!=b&&(a.authorizeOperInfo.trid=b)},on:"click"}),$("#csp_oper_manage_authorize_stat_dropdown").dropdown({onChange:function(b,c,d){a.authorizeOperInfo.stat=b},on:"click"})}},a.cspOperManageResetPass=function(b){a.showModal=!0,a.operModalPath="../tpls/operManage/opermanageresetpass.html",a.modalState=1,a.resetOperInfo.loading=!1,a.resetOperInfo.error=!1,a.resetOperInfo.errorString="",a.resetOperInfo.oid=a.oidList[b].oid,a.resetOperInfo.opass="",a.resetOperInfo.opassrep=""},a.cspOperManageHideReset=function(){a.showModal=!1},a.cspOperManageResetPassSure=function(){var f=1;return a.resetOperInfo.loading=!0,a.resetOperInfo.error=!1,a.resetOperInfo.errorString="正在提交..",/^[0-9A-Za-z!@#\$%,._-]{6,16}$/.test(a.resetOperInfo.opass)?a.resetOperInfo.opass!=a.resetOperInfo.opassrep?(a.resetOperInfo.error=!0,a.resetOperInfo.errorString="两次密码不一致",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.resetOperInfo.loading=!1):f--},500,100))):void d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){var g={};g.oid=a.resetOperInfo.oid,g.opass=a.resetOperInfo.opass,e.cspOperManageResetPass(g,function(b){"succeed"==b.result?(a.resetOperInfo.error=!0,a.resetOperInfo.errorString="操作成功",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.resetOperInfo.loading=!1,a.showModal=!1):f--},500,100)):(a.resetOperInfo.error=!0,a.resetOperInfo.errorString=b.reason,a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.resetOperInfo.loading=!1):f--},500,100))})}else b.go("operlogin")}):(a.resetOperInfo.error=!0,a.resetOperInfo.errorString="新密码不符合规则",a.timePromise=void 0,void(a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.resetOperInfo.loading=!1):f--},500,100)))},a.cspOperManageAuthorizeOper=function(c){a.showModal=!0,a.modalState=2,a.operModalPath="../tpls/operManage/opermanageauthorize.html",a.authorizeOperInfo.maid=a.oidList[c].maid,a.authorizeOperInfo.oid=a.oidList[c].oid,a.authorizeOperInfo.caid="",a.authorizeOperInfo.trid="",a.authorizeOperInfo.bp="",a.authorizeOperInfo.bp_heaver="",a.authorizeOperInfo.stat=0,a.authorizeOperInfo.loading=!1,a.authorizeOperInfo.error=!1,a.authorizeOperInfo.errorString="";var f={};f.maid=a.authorizeOperInfo.maid,a.authorizeCaidList.splice(0,a.authorizeCaidList.length),a.authorizeTridList.splice(0,a.authorizeTridList.length),d.cspOperCheckAndLogin(a.cookieinfo,function(c){"succeed"==c.result?e.cspOperManageGetCaidByMaid(f,function(b){"succeed"==b.result?a.authorizeCaidList=b.data:alert("获取数据失败,请刷新页面重试")}):b.go("operlogin")})},a.cspOperManageAuthorizeSure=function(){var f=1,g=/^[0-9]{1,14}$/;a.authorizeOperInfo.loading=!0,a.authorizeOperInfo.error=!1,a.authorizeOperInfo.errorString="正在提交..",""==a.authorizeOperInfo.trid?(a.authorizeOperInfo.error=!0,a.authorizeOperInfo.errorString="请选择交易单元",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.authorizeOperInfo.loading=!1):f--},500,100)):g.test(a.authorizeOperInfo.bp)?g.test(a.authorizeOperInfo.bp_heaver)?d.cspOperCheckAndLogin(a.cookieinfo,function(d){if("succeed"==d.result){var g={};g.traderid=a.authorizeOperInfo.trid+"."+a.authorizeOperInfo.oid.split(".")[1],g.trid=a.authorizeOperInfo.trid,g.oid=a.authorizeOperInfo.oid,g.bp=a.authorizeOperInfo.bp,g.bp_heaver=a.authorizeOperInfo.bp_heaver,g.stat=a.authorizeOperInfo.stat,e.cspOperManageAddTrader(g,function(b){"succeed"==b.result?(a.authorizeOperInfo.error=!0,a.authorizeOperInfo.errorString="操作成功",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.authorizeOperInfo.loading=!1,a.showModal=!1,a.modalState=0,a.operModalPath=""):f--},500,100)):(a.authorizeOperInfo.error=!0,a.authorizeOperInfo.errorString=b.reason,a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.authorizeOperInfo.loading=!1):f--},500,100))})}else b.go("operlogin")}):(a.authorizeOperInfo.error=!0,a.authorizeOperInfo.errorString="请输入交易员杠杆",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.authorizeOperInfo.loading=!1):f--},500,100)):(a.authorizeOperInfo.error=!0,a.authorizeOperInfo.errorString="请输入交易员bp",a.timePromise=void 0,a.timePromise=c(function(){f<=0?(c.cancel(a.timePromise),a.timePromise=void 0,a.authorizeOperInfo.loading=!1):f--},500,100))},a.cspOperManageAuthorizeCancel=function(){a.showModal=!1,a.operModalPath="",a.modalState=0}}),cspCtrls.controller("cspOperManageMenuCtrl",function(a,b,c,d){a.showMenu=!1,a.cspOperManageMenuInit=function(){a.showMenu=!1},a.cspOperMenuShowMenu=function(){a.showMenu=!0,document.getElementById("cspOperManageMenuHtml").style.width="100%",document.getElementById("cspOperManageMenuHtml").style.height="100%"},a.cspOperMenuHideMenu=function(){a.showMenu=!1,document.getElementById("cspOperManageMenuHtml").style.width="50px",document.getElementById("cspOperManageMenuHtml").style.height="50px"}}),cspCtrls.controller("orderCtrl",function(a,b,c,d,e,f){a.product={},a.userInfo={},a.orderAmount="",a.$on("userBuyProduct",function(b,c){console.log("orderCtrl",c),document.getElementById("errorDiv").style.display="none",document.getElementById("successDiv").style.display="none",document.getElementById("submitBtn").disabled="",document.getElementById("amountInput").disabled="",document.getElementById("telInput").disabled="",a.orderAmount="",d.getProductDetails("",function(b){return b===!1?void console.log("获取当前产品失败"):(a.product=b,void console.log("getProductDetails",b))}),e.getUserInfo("",function(b){console.log("getUserInfo",b),b!==!1&&(a.userInfo=b)})}),a.submitOrder=function(){if(document.getElementById("errorDiv").style.display="none",document.getElementById("successDiv").style.display="none",console.log(typeof a.orderAmount,a.orderAmount,Number(a.orderAmount)),isNaN(a.orderAmount))return document.getElementById("errorDiv").style.display="",void(document.getElementById("errorInfo").innerHTML="请输入正确的数字");if(a.orderAmount<100)return document.getElementById("errorDiv").style.display="",void(document.getElementById("errorInfo").innerHTML="您订购的金额必须大于100万元");if(!/^1[34578]\d{9}$/.test(a.userInfo.tel))return console.log("请输入正确的手机号码"),document.getElementById("errorDiv").style.display="",void(document.getElementById("errorInfo").innerText="请输入正确的手机号码");var b={};b.orderAmount=a.orderAmount,b.tel=a.userInfo.tel,f.submitOrder(b,function(a){console.log(a),a.result!==!1&&(document.getElementById("errorDiv").style.display="none",document.getElementById("successDiv").style.display="",document.getElementById("submitBtn").disabled="disabled",document.getElementById("amountInput").disabled="disabled",document.getElementById("telInput").disabled="disabled")})},a.hideModal=function(){jQuery("#orderModal").modal("hide"),jQuery("#allPro_orderModal").modal("hide")},jQuery(document).ready(function(){})}),cspCtrls.controller("ownedProductsCtrl",function(a,b,c,d,e,f){a.maxPageSize=3,a.pageRows=10,a.productAmount=0,a.allPage=0,a.currentpage=1,a.pageArr=[],a.filterCondition={pageRows:a.pageRows,page:1},jQuery(document).ready(function(){console.log("进入了我的订单"),a.getOwnedProductAmount()}),a.getOwnedProducts=function(){d.getOwnedProducts(a.filterCondition,function(b){b.result!==!1&&(a.ownedProducts=b,console.log("getOwnedProducts",b))})},a.getOwnedProductAmount=function(){d.getOwnedProductAmount("option",function(b){console.log("getOwnedProductAmount",b),0!=b.result&&(a.productAmount=b.productAmount,a.productAmount>0?(document.getElementById("pageList").style.display="",a.filterCondition.page=1,a.currentpage=1,a.allPage=Math.ceil(a.productAmount/a.pageRows),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.getOwnedProducts()):document.getElementById("pageList").style.display="none")})},a.gotoPage=function(b){a.currentpage=b,console.log("$scope.currentpage",a.currentpage),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=b,a.getOwnedProducts(a.filterCondition)},a.goFirstPage=function(){a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=1,a.getOwnedProducts(a.filterCondition)},a.goLastPage=function(){a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.allPage,a.getOwnedProducts(a.filterCondition)},a.goPreviousPage=function(){a.currentpage>1?a.currentpage-=1:a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getOwnedProducts(a.filterCondition)},a.goNextPage=function(){a.currentpage<a.allPage?a.currentpage+=1:a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getOwnedProducts(a.filterCondition)},a.getProductsByPage=function(b){a.filterCondition.page=b,a.getOwnedProducts(a.filterCondition)}}),cspCtrls.controller("ProductCtrl",function(a,b,c,d,e,f,g){var h=0,i=0,j=0,k=0;g.load("lib/echarts.js").then(function(){a.categoryChartsInit(),a.getNetProduct()}),a.myproduct=a,a.uid="",a.chartsData={},a.chartsData.date=[],a.chartsData.categoryNetData=[],a.chartsData.categoryTotalNetData=[],a.productDetails={},a.netProductDatas={},a.productSpots={},a.productNotices={},a.NetAssetValue={},a.infoLoadPath="",a.showData=[],jQuery(document).ready(function(){document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label ",document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",$("html,body").scrollTop(0),a.getProductDetails()}),a.getProductDetails=function(){d.getProductDetails("",function(b){return"undefined"==typeof b.result||b.result===!1?void console.log("查询产品信息失败"):(console.log("getProductDetails",b),"undefined"==typeof b.netdate||""==b.netdate||"0000-00-00"==b.netdate||"1970-01-01"==b.netdate?b.netdate="":(b.netdate=new Date(b.netdate).Format("yyyy-MM-dd"),a.getNetAssetValue(b.id,b.netdate)),b.releasetime=new Date(b.releasetime).Format("yyyy-MM-dd"),b.subscribe_rate=(100*b.subscribe_rate).toFixed(2)+"%",b.manage_rate=(100*b.manage_rate).toFixed(2)+"%",b.redeem_rate=(100*b.redeem_rate).toFixed(2)+"%",b.merit_pay=(100*b.merit_pay).toFixed(2)+"%",a.getTactics(b.tsid),a.productDetails=b,void(document.getElementById("product_image").src=b.piclink))})},a.getFutures=function(){d.getFutures("",function(b){if(0!=b){for(var c=0;c<b.length;c++)b[c].date=new Date(b[c].date).Format("yyyy-MM-dd"),b[c].marketValue=(b[c].last*b[c].volume).toFixed(2),b[c].volamt=b[c].volamt.toFixed(2),b[c].last=b[c].last.toFixed(2),b[c].deposit=b[c].deposit.toFixed(2),0==b[c].dealtype?b[c].dealtype="买入":b[c].dealtype="卖出";console.log("getFutures",b),a.futures=b}})},a.setHeaderName=function(b){f.getUserInfo(b,function(b){0!=b&&(7!=b.conlevel&&2!=b.conlevel&&1!=b.conlevel||(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display="",document.getElementById("diamondMember").style.display="",a.getProductSpot(),a.getFutures()),document.getElementById("header_username").innerHTML=b.tel)})},a.getTactics=function(b){var c={};c.tacticsIDs=b,d.getTactics(c,function(b){if(b.result===!1)console.log("获取产品策略失败");else{console.log("获取产品策略成功",b);for(var c="",d=0;d<b.length;d++)c=c+b[d].tsname+",";c.length>0&&(c=c.substring(0,c.length-1)),a.productDetails.productTactics=c}})},a.getRiskLevelInfo=function(b){var c={};c.risklevelid=b,d.getRiskLevelInfo(c,function(b){b.result===!1?console.log("获取产品风险信息失败"):(console.log("获取产品风险信息成功",b),a.productDetails.risklevelInfo=b)})},a.getSeriesInfo=function(b){var c={};c.seriesid=b,d.getSeriesInfo(c,function(b){b.result===!1?console.log("获取产品系列失败"):(console.log("获取产品系列成功",b),a.productDetails.seriesInfo=b)})},a.getNetAssetValue=function(b,c){if("undefined"!=typeof b&&""!=b&&"undefined"!=typeof c){var e={};e.productID=b,e.netdate=c,d.getNetAssetValue(e,function(b){return b.result===!1?void console.log("getNetAssetValue failed"):(b.date=new Date(b.date).Format("yyyy-MM-dd"),console.log("getNetAssetValue",b),isNaN(b.net)||(b.net=b.net.toFixed(3)),void(a.NetAssetValue=b))})}},a.setContent=function(){a.getProductDetails()},a.categoryChartsInit=function(){a.myCategoryEcharts=echarts.init(document.getElementById("myCategoryEcharts"));var b={baseOption:{title:{text:"净值走势图"},tooltip:{trigger:"axis"},legend:{data:["净值","累计净值"]},grid:{left:80,right:80},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},dataZoom:[{type:"inside",xAxisIndex:0,start:0,end:100},{start:0,end:10,handleIcon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"60%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2},left:80,right:80}],series:[{name:"净值",type:"line",data:[]},{name:"累计净值",type:"line",data:[]}]},media:[{option:{grid:{left:80,right:80}}},{query:{maxWidth:750},option:{grid:{left:40,right:40},yAxis:{}}}]};a.myCategoryEcharts.setOption(b),window.onresize=a.myCategoryEcharts.resize,a.myCategoryEcharts.on("datazoom",function(b){console.log(b,typeof b.start);var c=0,d=0;"undefined"!=typeof b.start?(c=Math.floor(b.start/100*a.showData.length),d=Math.ceil(b.end/100*a.showData.length)):"undefined"!=typeof b.batch&&(c=Math.floor(b.batch[0].start*a.showData.length/100),d=Math.ceil(b.batch[0].end*a.showData.length/100)),++d,d=d>a.showData.length?a.showData.length:d;var e=a.showData.slice(c,d),f=getMaximum(e);if("undefined"==typeof f||f<=0)var g={max:1,interval:.2};else var g=getMaxAndInterval(f);a.myCategoryEcharts.setOption({yAxis:{max:g.max,interval:g.interval}})}),a.myCategoryEcharts.on("legendselectchanged",function(b){var c=[];a.showData=[];for(x in b.selected)switch(console.log("x in params.selected",x),x){case"净值":if(b.selected[x]){for(var d=0;d<a.chartsData.categoryNetData.length;d++)a.showData.push(a.chartsData.categoryNetData[d]);c.push(h),c.push(j)}break;case"累计净值":if(b.selected[x]){for(var d=0;d<a.chartsData.categoryTotalNetData.length;d++)a.showData.push(a.chartsData.categoryTotalNetData[d]);c.push(i),c.push(k)}}var e=getMaximum(a.showData);if(console.log("$scope.showData",a.showData),"undefined"==typeof e||e<=0)var f={max:1,interval:.2};else var f=getMaxAndInterval(e);console.log("max",e,h,j,i,k,c),a.myCategoryEcharts.setOption({yAxis:{max:f.max,interval:f.interval}})})},a.getProductSpot=function(){var b={};b.protype=1,d.getProductSpot(b,function(b){if(b===!1)console.log("产品界面获取productID失败");else{for(var c=0;c<b.length;c++)b[c].marketValue=b[c].volamt*b[c].volume,b[c].marketValue=b[c].marketValue.toFixed(2),b[c].volamt=b[c].volamt.toFixed(2),b[c].last=b[c].last.toFixed(2);a.productSpots=b,console.log(a.productSpots)}})},a.getNetProduct=function(){d.getProductID("",function(b){if(b===!1)console.log("产品界面获取productID失败");else{var c={};c.productID=b.productID,d.getNetProduct(c,function(b){if(b===!1)console.log("查询netProduct失败");else{if(a.netProductDatas=b,!(a.netProductDatas.length>0))return void(a.accReturnRate="--");if(a.accReturnRate=(100*(a.netProductDatas[0].totalnet-1)).toFixed(2)+"%",console.log("getNetProduct",b),!(b.length>0))return;h=b[0].net,i=b[0].totalnet,j=b[0].net,k=b[0].totalnet;for(var c=a.netProductDatas.length-1;c>=0;--c){h>b[c].net&&(h=b[c].net),j<b[c].net&&(j=b[c].net),i>b[c].totalnet&&(i=b[c].totalnet),k<b[c].totalnet&&(k=b[c].totalnet),a.netProductDatas[c].netStr=a.netProductDatas[c].net.toFixed(3),a.netProductDatas[c].totalnetStr=a.netProductDatas[c].totalnet.toFixed(3),a.netProductDatas[c].accrateStr=(100*(a.netProductDatas[c].totalnet-1)).toFixed(2)+"%",a.netProductDatas[c].yearrateStr=(100*a.netProductDatas[c].yearrate).toFixed(2)+"%";var d=new Date(a.netProductDatas[c].datetime.replace(/-/g,"/")),e=[d.getFullYear(),d.getMonth()+1,d.getDate()].join("/");a.chartsData.date.push(e),a.chartsData.categoryNetData.push(a.netProductDatas[c].net),a.chartsData.categoryTotalNetData.push(a.netProductDatas[c].totalnet),a.showData.push(a.netProductDatas[c].net),a.showData.push(a.netProductDatas[c].totalnet)}var f=j>k?j:k;if("undefined"==typeof f||f<=0)var g={max:1,interval:.2};else var g=getMaxAndInterval(f);console.log(g),a.myCategoryEcharts.setOption({xAxis:{data:a.chartsData.date},yAxis:{max:g.max,interval:g.interval},series:[{name:"净值",data:a.chartsData.categoryNetData},{name:"累计净值",data:a.chartsData.categoryTotalNetData}]})}})}})},a.productViewInit=function(){e.cspCheckLoginState("",function(c){return c.loginState!==!0?($("#loginModal").remove(),void b.go("home")):(console.log("cspCheckLoginState",c.uid),a.uid=c.uid,a.setHeaderName(c),e.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||(event.preventDefault(),b.go("risklevel"))}),void 0)})},a.divOnLoad=function(){console.log("divOnLoad"),$("#contentDiv").find("img").css({"max-width":"100%"})},a.goPerformance=function(b){a.infoLoadPath="",document.getElementById("productPerf").style.display="",$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.goSubscribeInfo=function(b){document.getElementById("productPerf").style.display="none",a.infoLoadPath="/tpls/productView/subscribeInfo.html",a.getRiskLevelInfo(a.productDetails.risklevelid),a.getSeriesInfo(a.productDetails.seriesid),$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.goNotice=function(b){document.getElementById("productPerf").style.display="none",a.infoLoadPath="/tpls/productView/productNotice.html",a.getProductNotices(a.productDetails.id),$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.goIntroduction=function(b){document.getElementById("productPerf").style.display="none",a.infoLoadPath=a.productDetails.contents,$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.getProductNotices=function(b){var c={};c.productID=b,d.getProductNotices(c,function(b){0==b.result&&reuturn;for(var c=0;c<b.length;c++)b[c].filename=b[c].path.substring(6);a.productNotices=b,console.log(b)})}}),cspCtrls.controller("productView2Ctrl",function(a,b,c,d,e,f,g){var h=0,i=0,j=0,k=0;g.load("lib/echarts.js").then(function(){a.categoryChartsInit(),a.getNetProduct()}),a.uid="",a.chartsData={},a.chartsData.date=[],a.chartsData.categoryNetData=[],a.chartsData.categoryTotalNetData=[],a.productDetails={},a.netProductDatas={},a.productSpots={},a.productTactics={},a.NetAssetValue={},a.showData=[],jQuery(document).ready(function(){document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label ",document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",$("html,body").scrollTop(0),a.getProductDetails()}),a.getProductDetails=function(){d.getProductDetails("",function(b){return"undefined"==typeof b.result||b.result===!1?void console.log("查询产品信息失败"):(console.log("getProductDetails",b,b.netdate),"undefined"==typeof b.netdate||""==b.netdate||"0000-00-00"==b.netdate||"1970-01-01"==b.netdate?b.netdate="":(b.netdate=new Date(b.netdate).Format("yyyy-MM-dd"),a.getNetAssetValue(b.id,b.netdate)),b.releasetime=new Date(b.releasetime).Format("yyyy-MM-dd"),a.getTactics(b.tsid),a.productDetails=b,void(document.getElementById("product_image").src=b.piclink))})},a.getFutures=function(){d.getFutures("",function(b){if(0!=b){for(var c=0;c<b.length;c++)b[c].date=new Date(b[c].date).Format("yyyy-MM-dd"),b[c].marketValue=(b[c].last*b[c].volume).toFixed(2),b[c].volamt=b[c].volamt.toFixed(2),b[c].last=b[c].last.toFixed(2),b[c].deposit=b[c].deposit.toFixed(2),0==b[c].dealtype?b[c].dealtype="买入":b[c].dealtype="卖出";console.log("getFutures",b),a.futures=b}})},a.setHeaderName=function(c){f.getUserInfo(c,function(c){0!=c&&(7==c.conlevel||2==c.conlevel||1==c.conlevel?(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display="",document.getElementById("diamondMember").style.display="",a.getProductSpot(),a.getFutures()):($("#loginModal").remove(),b.go("home")),document.getElementById("header_username").innerHTML=c.tel)})},a.getTactics=function(a){var b={};b.tacticsIDs=a,d.getTactics(b,function(a){if(a.result===!1)console.log("获取产品策略失败");else{console.log("获取产品策略成功",a);for(var b="",c=0;c<a.length;c++)b=b+a[c].tsname+",";b.length>0&&(b=b.substring(0,b.length-1)),document.getElementById("productTactics").innerText=b}})},a.getRiskLevelInfo=function(b){var c={};c.risklevelid=b,d.getRiskLevelInfo(c,function(b){b.result===!1?console.log("获取产品风险信息失败"):(console.log("获取产品风险信息成功",b),a.productDetails.risklevelInfo=b)})},a.getSeriesInfo=function(b){var c={};c.seriesid=b,d.getSeriesInfo(c,function(b){b.result===!1?console.log("获取产品系列失败"):(console.log("获取产品系列成功",b),a.productDetails.seriesInfo=b)})},a.getNetAssetValue=function(b,c){if("undefined"!=typeof b&&""!=b&&"undefined"!=typeof c){var e={};e.productID=b,e.netdate=c,d.getNetAssetValue(e,function(b){return b.result===!1?void console.log("getNetAssetValue failed"):(b.date=new Date(b.date).Format("yyyy-MM-dd"),console.log("getNetAssetValue",b),isNaN(b.net)||(b.net=b.net.toFixed(3)),void(a.NetAssetValue=b))})}},a.setContent=function(){a.getProductDetails()},a.categoryChartsInit=function(){a.myCategoryEcharts=echarts.init(document.getElementById("myCategoryEcharts"));var b={baseOption:{title:{text:"净值走势图"},tooltip:{trigger:"axis"},legend:{data:["净值","累计净值"]},grid:{left:80,right:80},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},dataZoom:[{type:"inside",xAxisIndex:0,start:0,end:100},{start:0,end:10,handleIcon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"80%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2},left:80,right:80}],series:[{name:"净值",type:"line",data:[]},{name:"累计净值",type:"line",data:[]}]},media:[{option:{grid:{left:80,right:80}}},{query:{maxWidth:750},option:{grid:{left:40,right:40},yAxis:{}}}]};a.myCategoryEcharts.setOption(b),window.onresize=a.myCategoryEcharts.resize,a.myCategoryEcharts.on("datazoom",function(b){if(console.log(b),"undefined"!=typeof b.start)var c=Math.floor(b.start*a.showData.length/100),d=Math.ceil(b.end*a.showData.length/100);else{if("undefined"==typeof b.batch)return;var c=Math.floor(b.batch[0].start*a.showData.length/100),d=Math.ceil(b.batch[0].end*a.showData.length/100)}++d,d=d>a.showData.length?a.showData.length:d;var e=a.showData.slice(c,d),f=getMaximum(e);if("undefined"==typeof f||f<=0)var g={max:1,interval:.2};else var g=getMaxAndInterval(f);a.myCategoryEcharts.setOption({yAxis:{max:g.max,interval:g.interval}})}),a.myCategoryEcharts.on("legendselectchanged",function(b){var c=[];a.showData=[];for(x in b.selected)switch(console.log("x in params.selected",x),x){case"净值":if(b.selected[x]){for(var d=0;d<a.chartsData.categoryNetData.length;d++)a.showData.push(a.chartsData.categoryNetData[d]);c.push(h),c.push(j)}break;case"累计净值":if(b.selected[x]){for(var d=0;d<a.chartsData.categoryTotalNetData.length;d++)a.showData.push(a.chartsData.categoryTotalNetData[d]);c.push(i),c.push(k)}}var e=getMaximum(a.showData);if(console.log("max",e,a.showData),"undefined"==typeof e||e<=0)var f={max:1,interval:.2};else var f=getMaxAndInterval(e);console.log("max",e,h,j,i,k,c),a.myCategoryEcharts.setOption({yAxis:{max:f.max,interval:f.interval}})})},a.getProductSpot=function(){var b={};b.protype=2,d.getProductSpot(b,function(b){if(b===!1)console.log("产品界面获取productID失败");else{for(var c=0;c<b.length;c++)b[c].marketValue=b[c].volamt*b[c].volume,b[c].marketValue=b[c].marketValue.toFixed(2),b[c].volamt=b[c].volamt.toFixed(2),b[c].last=b[c].last.toFixed(2);a.productSpots=b,console.log(a.productSpots)}})},a.getNetProduct=function(){d.getProductID("",function(b){if(b===!1)console.log("产品界面获取productID失败");else{var c={};c.productID=b.productID,d.getNetProduct(c,function(b){if(b===!1)console.log("查询netProduct失败");else{if(a.netProductDatas=b,!(a.netProductDatas.length>0))return void(a.accReturnRate="--");if(a.accReturnRate=(100*(a.netProductDatas[0].totalnet-1)).toFixed(2)+"%",console.log("getNetProduct",b),!(b.length>0))return;h=b[0].net,i=b[0].totalnet,j=b[0].net,k=b[0].totalnet;for(var c=a.netProductDatas.length-1;c>=0;--c){h>b[c].net&&(h=b[c].net),j<b[c].net&&(j=b[c].net),i>b[c].totalnet&&(i=b[c].totalnet),k<b[c].totalnet&&(k=b[c].totalnet),a.netProductDatas[c].netStr=a.netProductDatas[c].net.toFixed(3),a.netProductDatas[c].totalnetStr=a.netProductDatas[c].totalnet.toFixed(3),a.netProductDatas[c].accrateStr=(100*a.netProductDatas[c].accrate).toFixed(2)+"%",a.netProductDatas[c].yearrateStr=(100*a.netProductDatas[c].yearrate).toFixed(2)+"%";var d=new Date(a.netProductDatas[c].datetime.replace(/-/g,"/")),e=[d.getFullYear(),d.getMonth()+1,d.getDate()].join("/");a.chartsData.date.push(e),a.chartsData.categoryNetData.push(a.netProductDatas[c].net),a.chartsData.categoryTotalNetData.push(a.netProductDatas[c].totalnet),a.showData.push(a.netProductDatas[c].net),a.showData.push(a.netProductDatas[c].totalnet)}var f=j>k?j:k;if("undefined"==typeof f||f<=0)var g={max:1,interval:.2};else var g=getMaxAndInterval(f);console.log(g),a.myCategoryEcharts.setOption({xAxis:{data:a.chartsData.date},yAxis:{max:g.max,interval:g.interval},series:[{name:"净值",data:a.chartsData.categoryNetData},{name:"累计净值",data:a.chartsData.categoryTotalNetData}]})}})}})},a.productViewInit=function(){e.cspCheckLoginState("",function(c){return c.loginState!==!0?($("#loginModal").remove(),void b.go("home")):(console.log("cspCheckLoginState",c.uid),a.uid=c.uid,a.setHeaderName(c),e.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||(event.preventDefault(),b.go("risklevel"))}),void 0)})},a.goPerformance=function(b){a.infoLoadPath="",document.getElementById("productPerf").style.display="",$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.goSubscribeInfo=function(b){document.getElementById("productPerf").style.display="none",a.infoLoadPath="/tpls/productView/subscribeInfo.html",a.getRiskLevelInfo(a.productDetails.risklevelid),a.getSeriesInfo(a.productDetails.seriesid),$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.goNotice=function(b){document.getElementById("productPerf").style.display="none",a.infoLoadPath="/tpls/productView/productNotice.html",a.getProductNotices(a.productDetails.id),$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.goIntroduction=function(b){document.getElementById("productPerf").style.display="none",a.infoLoadPath=a.productDetails.contents,$("#productShowOption .item").removeClass("active"),$(b.target).addClass("active")},a.getProductNotices=function(b){var c={};c.productID=b,d.getProductNotices(c,function(b){0==b.result&&reuturn;for(var c=0;c<b.length;c++)b[c].filename=b[c].path.substring(6);a.productNotices=b,console.log(b)})}}),cspCtrls.controller("randomCtrl",function(a,b,c,d,e){function f(b,c){if(console.log("分券trid",b),b){var d={trid:"",maid:""};d.maid="1",d.trid=b,e.unitRandmDiv(d,function(f){if(f.successOr){console.log("分券成功",f.successOr),e.deleWishList(d,function(a){a.delWish&&console.log("上一次的心愿清单清除")});var g={trid:"",valueStr:""};if(g.trid=b,f.UnitWish.length>0){for(var h="",j=0;j<f.UnitWish.length;j++)for(var k=0;k<f.UnitWish[j].children.length;k++)h+='("',h+=f.UnitWish[j].gid,h+='","',h+=f.UnitWish[j].children[k].cindex,h+='","',h+=f.UnitWish[j].children[k].cid,h+='","',h+=f.UnitWish[j].children[k].cname,h+='","',h+=f.UnitWish[j].children[k].amount,h+='","',h+=f.UnitWish[j].children[k].post_allocated_amount,h+='","',h+=f.UnitWish[j].children[k].allocated_value,h+='","',h+=b,h+='"),';h.length>0&&(g.valueStr=h.substring(0,h.length-1)),g.valueStr+="ON DUPLICATE KEY UPDATE post_allocated_amount = values(post_allocated_amount),post_allocated_value = values(post_allocated_value), amount=amount+values(amount)",e.writeResults(g,function(b){if(b.writeS){console.log("分券结果数据插入成功",b.writeS),i(c),a.currentSelectTid=c;var d={gid:a.currentSelectTid};e.getTname(d,function(b){a.currentSelectTidName=b.title,$(".js_tid").text(a.currentSelectTidName)}),e.randomOver(d,function(a){a.randomOverFlag?(console.log("该轮分券完毕，总券还有剩余，可继续进行下一轮分券"),csp.notify("notice",{msg:"该轮分券完毕，总券还有剩余，可继续进行下一轮分券",delay:15e3})):(console.log("该单元总券已全部分配完。您可点击小组查看最终分券结果。"),csp.notify("notice",{msg:"该单元总券已全部分配完。您可点击小组查看最终分券结果。",delay:15e3}))})}})}}})}else jQuery(".js-choose-random-trid").modal("show")}function g(a,b){jQuery("."+a).modal(b)}function h(a,b){var c;return!isNaN(parseFloat(a))&&isFinite(a)?(a=Number(a),a=("undefined"!=typeof b?a.toFixed(b):a).toString(),c=a.split("."),c[0]=c[0].toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),c.join(".")):NaN}function i(b){var c={gid:""};c.gid=b,e.getRandmR(c,function(b){a.randmR=b,jQuery(".js-random-output").attr("disabled",!1),console.log("显示当前tid的分券结果信息",c.gid),
e.getTname(c,function(b){a.currentSelectTidName=b.title,$(".js_tid").text(a.currentSelectTidName)}),e.getInfobyGid(c,function(a){$(".js-tid-bp").html(" 小组杠杆bp:"+h(a.t_bp,2)),$(".js-tid-allocated-value").html("分券市值:"+h(a.t_allocated_bp,2))})})}a.currentSelectTrid="",a.currentSelectTridName="",a.currentSelectTid=0,a.currentSelectTidName="",a.randomInit=function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",window.scrollTo(0,0)},$(document).ready(function(){var b={maid:""};b.maid=1,d.getModel(b,function(b){a.model=b,a.model.length>5?a.isActive=!0:a.isActive=!1,$(".js-trid").dropdown({onChange:function(b,c,d){a.$apply(function(){a.currentSelectTrid=b.split("(")[1].replace(")",""),a.currentSelectTridName=b})},on:"hover"})})}),a.$watch("currentSelectTrid",function(){if(console.log("$scope.currentSelectTrid",a.currentSelectTrid),a.currentSelectTrid){var b={trid:""};b.trid=a.currentSelectTrid,c.getTidModel(b,function(b){a.tidModel=b,0==b.length?(a.currentSelectTid="",a.currentSelectTidName="单元小组",$(".js_tid").text(a.currentSelectTidName)):(b.length>5?a.isTidActive=!0:a.isTidActive=!1,$(".js-tid").dropdown({onChange:function(b,c,d){a.$apply(function(){console.log(b),a.currentSelectTid=b.split("(")[1].split(")")[0],console.log("$scope.currentSelectTid",a.currentSelectTid)})},on:"hover"}))})}}),a.$watch("currentSelectTid",function(){if(a.currentSelectTid){i(a.currentSelectTid);var b={gid:a.currentSelectTid};e.getTname(b,function(b){a.currentSelectTidName=b.title,$(".js_tid").text(a.currentSelectTidName)})}}),a.randomDivOnBtn=function(){a.currentSelectTrid?jQuery(".js-random-allocated-comfirm").modal("show"):jQuery(".js-choose-random-trid").modal("show")},a.randomAllocatedConfirm=function(){g("js-random-allocated-comfirm","hide");var b={trid:""};b.trid=a.currentSelectTrid,e.getWishTid(b,function(b){"undefined"!=typeof b[0]?(a.currentSelectTid=b[0].gid,f(a.currentSelectTrid,a.currentSelectTid),$(".js-wait-random-div").addClass("active"),setTimeout(function(){$(".js-wait-random-div").removeClass("active")},3e3)):(csp.notify("notice",{msg:"该小组无人有心愿清单，无从分券",delay:5e3}),console.log("该小组无人有心愿清单，无从分券"))})},a.clearRandom=function(){a.currentSelectTrid?jQuery(".js-clear-random").modal("show"):jQuery(".js-choose-clear-trid").modal("show")},a.clearTrid=function(){var b={maid:"",trid:""};b.maid="1",b.trid=a.currentSelectTrid,e.recoverStock(b,function(a){a.recoverStock?console.log("总券剩余数量恢复了"):console.log("总券剩余数量恢复出错")}),e.deleResults(b,function(b){b.deleteR&&(i(-1),a.currentSelectTidName="单元小组",$(".js_tid").text(a.currentSelectTidName),console.log("清零成功，可以重新分券啦～"),csp.notify("notice",{msg:"清零成功，可以重新分券啦～",delay:5e3}))})},a.noWishGo=function(){console.log("是否有小组没有心愿清单--->get");var b={trid:""};b.trid=a.currentSelectTrid,e.noWishList(b,function(b){console.log("0为全有心愿清单，1为有人没有心愿清单",b.noWish),1==b.noWish?jQuery(".js-someone-no-wishlist").modal("show"):b.noWish==-1?jQuery(".js-all-no-wish").modal("show"):a.randomAllocatedConfirm()})},a.randomOutput=function(){if(a.currentSelectTid){var b=a.currentSelectTid,c="/random/exportExcel/"+b;window.location=c}else csp.notify("notice",{msg:"请选择导出的小组",delay:5e3})}}),cspCtrls.controller("regCtrl",function(a,b){a.toLogin=function(){b.go("home.login")}}),cspCtrls.controller("csp_resetCtrl",function(a,b,c){a.timePromise=void 0,a.cspResetInit=function(){a.loadpath="tpls/resetpass/resetpass.html",document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label "},a.cspResetPassLoadReady=function(){if("tpls/resetpass/resetpass.html"===a.loadpath){var b=.8*document.documentElement.clientHeight-20,c=b+"px";document.getElementById("csp_reset_form").style.minHeight=c}else{var b=.8*document.documentElement.clientHeight-20,c=b+"px";document.getElementById("csp_reset_success_container").style.minHeight=c}},a.cspResetPhoneFocus=function(){document.getElementById("csp_reset_phone_tips").style.display="none",document.getElementById("csp_reset_phone_br").style.display="block"},a.cspResetPhoneBlur=function(a){void 0!==a&&""!==a||(document.getElementById("csp_reset_phone_tips").style.display="block",document.getElementById("csp_reset_phone_tips").style.visibility="visible",document.getElementById("csp_reset_phone_label").innerHTML="手机号码不能为空",document.getElementById("csp_reset_phone_br").style.display="none")},a.cspResetImgCodeFocus=function(){document.getElementById("csp_reset_imgcode_tips").style.display="none",document.getElementById("csp_reset_imgcode_br").style.display="block"},a.cspResetImgCodeBlur=function(a){void 0!==a&&""!==a||(document.getElementById("csp_reset_imgcode_tips").style.display="block",document.getElementById("csp_reset_imgcode_tips").style.visibility="visible",document.getElementById("csp_reset_imgcode_label").innerHTML="图片验证码不能为空",document.getElementById("csp_reset_imgcode_br").style.display="none")},a.cspResetRefreshImgCode=function(){var a=10*Math.random();document.getElementById("csp_reset_imgcode_id").src="/resetcode?width=120&height=40&time="+a,document.getElementById("csp_reset_imgcode_tips").style.display="none",document.getElementById("csp_reset_imgcode_br").style.display="block"},a.cspResetCodeFocus=function(){document.getElementById("csp_reset_code_tips").style.display="none",document.getElementById("csp_reset_code_br").style.display="block"},a.cspResetCodeBlur=function(a){void 0!==a&&""!==a||(document.getElementById("csp_reset_code_tips").style.display="block",document.getElementById("csp_reset_code_tips").style.visibility="visible",document.getElementById("csp_reset_code_label").innerHTML="手机验证码不能为空",document.getElementById("csp_reset_code_br").style.display="none")},a.cspResetPassFocus=function(){document.getElementById("csp_reset_pass_tips").style.display="none",document.getElementById("csp_reset_pass_br").style.display="block"},a.cspResetPassBlur=function(a){void 0===a||""===a?(document.getElementById("csp_reset_pass_tips").style.display="block",document.getElementById("csp_reset_pass_tips").style.visibility="visible",document.getElementById("csp_reset_pass_label").innerHTML="新密码不能为空",document.getElementById("csp_reset_pass_br").style.display="none"):/^[a-zA-Z0-9]{6,20}$/.test(a)||(document.getElementById("csp_reset_pass_tips").style.display="block",document.getElementById("csp_reset_pass_tips").style.visibility="visible",document.getElementById("csp_reset_pass_label").innerHTML="密码必须为6-20位字母或数字",document.getElementById("csp_reset_pass_br").style.display="none")},a.cspResetPassrepFocus=function(){document.getElementById("csp_reset_passrep_tips").style.display="none",document.getElementById("csp_reset_passrep_br").style.display="block"},a.cspResetPassrepBlur=function(a,b){void 0===b||""===b?(document.getElementById("csp_reset_passrep_tips").style.display="block",document.getElementById("csp_reset_passrep_tips").style.visibility="visible",document.getElementById("csp_reset_passrep_label").innerHTML="确认密码不能为空",document.getElementById("csp_reset_passrep_br").style.display="none"):void 0===a||""===a?(document.getElementById("csp_reset_passrep_tips").style.display="block",document.getElementById("csp_reset_passrep_tips").style.visibility="visible",document.getElementById("csp_reset_passrep_label").innerHTML="请先输入密码",document.getElementById("csp_reset_passrep_br").style.display="none"):a!==b&&(document.getElementById("csp_reset_passrep_tips").style.display="block",document.getElementById("csp_reset_passrep_tips").style.visibility="visible",document.getElementById("csp_reset_passrep_label").innerHTML="两次密码不一致",document.getElementById("csp_reset_passrep_br").style.display="none")},a.cspResetGetCode=function(d,e){if(void 0===d||""===d)document.getElementById("csp_reset_phone_tips").style.display="block",document.getElementById("csp_reset_phone_tips").style.visibility="visible",document.getElementById("csp_reset_phone_label").innerHTML="请先输入正确的手机号码",document.getElementById("csp_reset_phone_br").style.display="none";else if(void 0===e||""===e)document.getElementById("csp_reset_imgcode_tips").style.display="block",document.getElementById("csp_reset_imgcode_tips").style.visibility="visible",document.getElementById("csp_reset_imgcode_label").innerHTML="图片验证码不能为空",document.getElementById("csp_reset_imgcode_br").style.display="none";else{var f={};f.imgcode=e,c.cspCheckImgCode(f,function(e){if("succeed"===e.result){var f={};f.phone=d,c.cspResetCheckPhone(f,function(d){"succeed"===d.result?c.cspResetGetCode(f,function(c){if("succeed"===c.result){var e=60;a.timePromise=void 0,a.timePromise=b(function(){if(e<=0)b.cancel(a.timePromise),a.timePromise=void 0,e=60,document.getElementById("csp_reset_code_button_label").innerHTML="获取验证码",document.getElementById("csp_reset_code_button").removeAttribute("disabled");else{e--;var c=e+1;document.getElementById("csp_reset_code_button_label").innerHTML=c+"秒后重新获取",document.getElementById("csp_reset_code_button").disabled="disabled"}},1e3,100),alert("我们已经向您的手机发送了验证码，5分钟有效")}else document.getElementById("csp_reset_code_tips").style.display="block",document.getElementById("csp_reset_code_tips").style.visibility="visible",document.getElementById("csp_reset_code_label").innerHTML=d.reason,document.getElementById("csp_reset_code_br").style.display="none"}):(document.getElementById("csp_reset_code_tips").style.display="block",document.getElementById("csp_reset_code_tips").style.visibility="visible",document.getElementById("csp_reset_code_label").innerHTML=d.reason,document.getElementById("csp_reset_code_br").style.display="none")})}else document.getElementById("csp_reset_imgcode_tips").style.display="block",document.getElementById("csp_reset_imgcode_tips").style.visibility="visible",document.getElementById("csp_reset_imgcode_label").innerHTML="图片验证码错误",document.getElementById("csp_reset_imgcode_br").style.display="none"})}},a.cspResetPassSubmit=function(d,e,f,g,h){if(void 0===e||""===e)document.getElementById("csp_reset_imgcode_tips").style.display="block",document.getElementById("csp_reset_imgcode_tips").style.visibility="visible",document.getElementById("csp_reset_imgcode_label").innerHTML="图片验证码不能为空",document.getElementById("csp_reset_imgcode_br").style.display="none";else{var i=0,j=0,k=0,l=0;if(document.getElementById("csp_reset_phone_tips").style.display="none",document.getElementById("csp_reset_phone_br").style.display="block",document.getElementById("csp_reset_imgcode_tips").style.display="none",document.getElementById("csp_reset_imgcode_br").style.display="block",document.getElementById("csp_reset_code_tips").style.display="none",document.getElementById("csp_reset_code_br").style.display="block",document.getElementById("csp_reset_pass_tips").style.display="none",document.getElementById("csp_reset_pass_br").style.display="block",document.getElementById("csp_reset_passrep_tips").style.display="none",document.getElementById("csp_reset_passrep_br").style.display="block",void 0!==d&&""!==d||(document.getElementById("csp_reset_phone_tips").style.display="block",document.getElementById("csp_reset_phone_tips").style.visibility="visible",document.getElementById("csp_reset_phone_label").innerHTML="请先输入正确的手机号码",document.getElementById("csp_reset_phone_br").style.display="none",i=1),void 0===g||""===g?(document.getElementById("csp_reset_pass_tips").style.display="block",document.getElementById("csp_reset_pass_tips").style.visibility="visible",document.getElementById("csp_reset_pass_label").innerHTML="新密码不能为空",document.getElementById("csp_reset_pass_br").style.display="none",k=1):/^[a-zA-Z0-9]{6,20}$/.test(g)||(document.getElementById("csp_reset_pass_tips").style.display="block",document.getElementById("csp_reset_pass_tips").style.visibility="visible",document.getElementById("csp_reset_pass_label").innerHTML="密码必须为6-20位字母或数字",document.getElementById("csp_reset_pass_br").style.display="none",k=1),void 0===h||""===h?(document.getElementById("csp_reset_passrep_tips").style.display="block",document.getElementById("csp_reset_passrep_tips").style.visibility="visible",document.getElementById("csp_reset_passrep_label").innerHTML="确认密码不能为空",document.getElementById("csp_reset_passrep_br").style.display="none",l=1):void 0===g||""===g?(document.getElementById("csp_reset_passrep_tips").style.display="block",document.getElementById("csp_reset_passrep_tips").style.visibility="visible",document.getElementById("csp_reset_passrep_label").innerHTML="请先输入密码",document.getElementById("csp_reset_passrep_br").style.display="none",l=1):g!==h&&(document.getElementById("csp_reset_passrep_tips").style.display="block",document.getElementById("csp_reset_passrep_tips").style.visibility="visible",document.getElementById("csp_reset_passrep_label").innerHTML="两次密码不一致",document.getElementById("csp_reset_passrep_br").style.display="none",l=1),void 0===f||""===f)document.getElementById("csp_reset_code_tips").style.display="block",document.getElementById("csp_reset_code_tips").style.visibility="visible",document.getElementById("csp_reset_code_label").innerHTML="手机验证码不能为空",document.getElementById("csp_reset_code_br").style.display="none";else{var m={};m.phone=d,m.code=f,c.cspCheckCode(m,function(e){if("succeed"===e.result){if(i+j+k+l===0){var f={};f.phone=d,f.pass=g,c.cspUpdateUser(f,function(d){if("succeed"===d.result){b.cancel(a.timePromise),a.timePromise=void 0,c.cspDeleteSession(),a.loadpath="tpls/resetpass/resetsuccess.html";var e=5;a.timePromise=void 0,a.timePromise=b(function(){e<=0?(b.cancel(a.timePromise),a.timePromise=void 0,e=5,window.location.href="../",console.log("sfsd")):(e--,document.getElementById("csp_reset_success_time_label").innerHTML=e+1)},1e3,100)}else alert("数据库异常，请稍候重试!")})}}else document.getElementById("csp_reset_code_tips").style.display="block",document.getElementById("csp_reset_code_tips").style.visibility="visible",document.getElementById("csp_reset_code_label").innerHTML=e.reason,document.getElementById("csp_reset_code_br").style.display="none"})}}},a.cspResetSuccessHref=function(){b.cancel(a.timePromise),a.timePromise=void 0}}),cspCtrls.controller("csp_riskCtrl",function(a,b,c,d){a.cspRisklevelInit=function(){console.log("进入了风险评测111"),a.score0=5,a.score1=5,a.score2=5,a.score3=5,a.score4=5,a.score5=5,a.score6=5,a.score7=5,a.score8=5,a.score9=5,a.csp_risk_idtype="1",a.riskloadpath="tpls/risklevel/risklevel.html",a.riskkind="",a.riskcontent="",a.riskstate=0,document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label "},a.cspUserMenuMouseMove=function(){$(".menu.csp_risk_user_menu").show()},a.cspUserMenuMouseOut=function(){$(".menu.csp_risk_user_menu").hide()},a.cspRiskChangeAnswer=function(b,c){switch(b){case 0:a.score0=c;break;case 1:a.score1=c;break;case 2:a.score2=c;break;case 3:a.score3=c;break;case 4:a.score4=c;break;case 5:a.score5=c;break;case 6:a.score6=c;break;case 7:a.score7=c;break;case 8:a.score8=c;break;case 9:a.score9=c}},a.cspRiskCommit=function(b,d,e){var f=a.score0+a.score1+a.score2+a.score3+a.score4+a.score5+a.score6+a.score7+a.score8+a.score9,g=0,h=0;if(void 0!==b&&""!==b||(g=1,document.getElementById("csp_risk_userinfo_left_label_1").style.color="red"),void 0===e||""===e)h=1,document.getElementById("csp_risk_userinfo_right_label_2").style.color="red";else{var i={};i.idnumber=e,c.cspRiskCheckId(i)||(h=1,document.getElementById("csp_risk_userinfo_right_label_2").style.color="red")}if(g+h===0){var j=0;j=f<=22?1:f<=44?2:f<=66?3:f<=88?4:5;var k={};k.name=b,k.phone=d,k.idnumber=e,k.riskcode=j,c.cspRiskCommit(k,function(b){if("succeed"===b.result){switch(a.riskloadpath="tpls/risklevel/risksuccess.html",j){case 1:a.riskkind="保守型——低风险级别产品",a.riskcontent="您的风险承担能力水平比较低，您关注资产的安全性远超于资产的收益性，所以低风险 、高流动性的投资品种比较适合您，这类投资的收益相对偏低。";break;case 2:a.riskkind="稳健型——较低风险级别产品",a.riskcontent="您有比较有限的风险承受能力，对投资收益比较敏感，期望通过短期、持续、渐进的投资获得高于定期存款的回报。所以较低等级风险的产品如保本保息的固定收益类，比较适合您，适当回避风险的同时保证收益，跑赢通胀。";break;case 3:a.riskkind="平衡型——中等风险级别产品",a.riskcontent="您有一定的风险承受能力，对投资收益比较敏感，期望通过长期且持续的投资获得高于平均水平的回报，通常更注重十年甚至更长期限内的平均收益。所以中等风险收益的投资品种比较适合您，回避风险的同时有一定的收益保证。";break;case 4:a.riskkind="积极型——较高风险级别产品",a.riskcontent="您有中高的风险承受能力，愿意承担可预见的投资风险去获取更多的收益，一般倾向于进行中短期投资。所以中高等级的风险收益投资品种比较适合您，以一定的可预见风险换取超额收益。";break;case 5:a.riskkind="激进型——高风险级别产品",a.riskcontent="您有较高的风险承受能力，是富有冒险精神的积极型选手。在投资收益波动的情况下，仍然保持积极进取的投资理念。短期内投资收益的下跌被您视为加注投资的利好机会。您适合从事灵活、风险与报酬都比较高的投资，不过要注意不要因一时的高报酬获利而将全部资金投入高风险操作，务必做好风险管理与资金调配工作。"}a.riskstate=1,window.scrollTo(0,0)}else alert("插入数据库失败")})}else{var l=document.getElementById("csp_risk_userinfo_div").offsetTop;window.scrollTo(0,l-170)}},a.cspRiskNameFocus=function(){document.getElementById("csp_risk_userinfo_left_label_1").style.color="black"},a.cspRiskIdnumberFocus=function(){document.getElementById("csp_risk_userinfo_right_label_2").style.color="black"},a.cspRiskLoad=function(){0===a.riskstate&&c.cspRiskGetPhone({},function(b){"succeed"===b.result?(a.csp_risk_phone=b.data.tel,a.csp_risk_name=b.data.name,a.csp_risk_idnumber=b.data.number,""!==b.data.name?a.nameread=!0:a.nameread=!1,""!==b.data.number?a.numberread=!0:a.numberread=!1):window.location.href="../"}),1===a.riskstate&&(document.getElementById("csp_risk_success_kind").innerHTML=a.riskkind,document.getElementById("csp_risk_success_content").innerHTML=a.riskcontent)},a.cspRiskReriskMove=function(){document.getElementById("csp_risk_rerisk_label").style.color="#0d357f"},a.cspRiskReriskOut=function(){document.getElementById("csp_risk_rerisk_label").style.color="rgb(205,127,50)"},a.cspRiskRerisk=function(){a.score0=5,a.score1=5,a.score2=5,a.score3=5,a.score4=5,a.score5=5,a.score6=5,a.score7=5,a.score8=5,a.score9=5,a.csp_risk_idtype="1",a.riskloadpath="tpls/risklevel/risklevel.html",c.cspRiskGetPhone({},function(b){"succeed"===b.result?a.csp_risk_phone=b.phone:window.location.href="../"}),a.riskkind="",a.riskcontent="",a.riskstate=0},a.cspRiskNextMove=function(){document.getElementById("csp_risk_next_label").style.color="#0d357f"},a.cspRiskNextOut=function(){document.getElementById("csp_risk_next_label").style.color="rgb(205,127,50)"},a.cspRiskNext=function(){$("#loginModal").remove(),d.go("home")}}),cspCtrls.controller("sendMessageCtrl",function(a,b,c,d,e,f){a.allGroup=[],a.selectedCustomers=[],a.allMessage=[],a.selectMessage={},a.editMessage={},a.selectedMessageIndex=0,a.messageLoadPath="",a.sendingMessage=!1,$(document).ready(function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",f.getMessageType("",function(b){"editMessage"==b.messageType?a.messageLoadPath="tpls/sendMessage/manageMessage.html":(a.messageLoadPath="tpls/sendMessage/sendMessage.html",console.log("已选中的人员",e.selectedCustomers),a.getCustomersFromID(e.selectedCustomers),a.getAllGroup())}),a.getAllMessage()}),a.getAllGroup=function(){e.getAllGroup("",function(b){if(0!=b){console.log("getAllGroup",b),a.allGroup=b;var c={};c.gid=-1,c.gname="未分组",e.getUngroupedAmount("",function(b){console.log("getAllGroup",b,0==b.result),0!=b.result&&(c.customerAmount=b.customerAmount,a.allGroup.push(c))})}})},a.getCustomersFromID=function(b){var c={};c.customerIDs=b,0!=b.length&&(1==b.length&&(c.single=!0),e.getCustomersFromID(c,function(b){0!=b.result&&(a.selectedCustomers=b)}))},a.messageCtrlInit=function(){d.cspCheckLoginState({},function(c){"succeed"===c.result&&c.loginState?d.cspCheckAuth({},function(c){"succeed"===c.result?a.cspCustomerLoadPath="tpls/customerGroup/cspusers.html":b.go("usercenter")}):($("#loginModal").remove(),b.go("home"))})},a.getCustomersToDetail=function(b){for(var c=0;c<a.allGroup.length;c++)if(a.allGroup[c].gid==b){if(1==a.allGroup[c].show)return void(a.allGroup[c].show=!1);a.allGroup[c].show=!0;break}if(!a.allGroup[c].haveData){var d={gid:b};e.getCustomers(d,function(c){if(0!=c)for(var d=0;d<a.allGroup.length;d++)if(a.allGroup[d].gid==b){a.allGroup[d].customers=[];for(var e=0;e<c.length;e++)a.allGroup[d].customers.push(c[e]);a.allGroup[d].haveData=!0;break}})}},a.overGroup=function(a){a.showAdd=!0},a.outGroup=function(a){a.showAdd=!1},a.addSelectedGroup=function(b,c){c.stopPropagation();var d={};d.gid=b,console.log(d,b),e.getCustomers(d,function(b){if(0!=b.result)for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.selectedCustomers.length;e++)if(a.selectedCustomers[e].customerid==b[c].customerid){d=!0;break}d||a.selectedCustomers.push(b[c])}})},a.addSelectedCustomer=function(b){for(var c=0;c<a.selectedCustomers.length;c++)if(a.selectedCustomers[c].customerid==b.customerid)return;a.selectedCustomers.push(b)},a.deleteSelectedCustomer=function(b){for(var c=0;c<a.selectedCustomers.length;c++)if(a.selectedCustomers[c].customerid==b)return void a.selectedCustomers.splice(c,1)},a.changeSelectMessage=function(){},a.getAllMessage=function(){f.getAllMessage("",function(b){if(0!=b.result){if(a.allMessage=b,"undefined"!=typeof a.selectMessage.id)for(var c=0;c<a.allMessage.length;c++)if(a.selectMessage.id==a.allMessage[c].id){a.selectedMessageIndex=c;break}a.allMessage[a.selectedMessageIndex].active=!0,a.selectMessage=a.allMessage[a.selectedMessageIndex],a.editMessage=$.extend({},a.allMessage[a.selectedMessageIndex]),console.log("getAllMessage",a.selectedMessageIndex,b)}})},a.sendMessage=function(b){var c={};c.tels=[];for(var d=0;d<a.selectedCustomers.length;d++)c.tels.push(a.selectedCustomers[d].tel);c.tels.length<2&&(c.single=!0),c.msgid=b.msgid,console.log("sendMessage2",c,b),f.sendMessage(c,function(b){return 0==b.result?void a.showError(b.reason):void console.log("sendMessage",b)})},a.cancelSend=function(){e.selectedCustomers=[],a.selectedCustomers=[]},a.editMessageBtn=function(b){a.selectMessage=b,a.getAllMessage();var c={};c.messageType="editMessage",f.setMessageType(c,function(b){0!=b.result&&(a.sendingMessage=!0,a.messageLoadPath="tpls/sendMessage/manageMessage.html")})},a.clickMessageTemplate=function(b,c,d){console.log("clickMessageTemplate",d),a.selectedMessageIndex=d,a.editMessage=$.extend({},b),document.getElementById("createMsgBtn").style.display="none",document.getElementById("editMsgBtn").style.display="",document.getElementById("deleteMsgBtn").style.display="",document.getElementById("editMessageHeader").innerHTML="编辑短信模板",$(".messagediv").removeClass("active"),$(".messagediv").slice(d,d+1).addClass("active")},a.createMessage=function(){a.editMessage={},a.editMessage.mname="",a.editMessage.msgid="",a.editMessage.mcontent="",document.getElementById("createMsgBtn").style.display="",document.getElementById("editMsgBtn").style.display="none",document.getElementById("deleteMsgBtn").style.display="none",document.getElementById("editMessageHeader").innerHTML="新建短信模板"},a.saveCreateMessage=function(){f.saveCreateMessage(a.editMessage,function(b){return 0==b.result?void a.showError(b.reason):(a.getAllMessage(),void console.log("saveCreateMessage",b))})},a.saveEditMessage=function(){f.saveEditMessage(a.editMessage,function(b){return 0==b.result?void a.showError(b.reason):(a.getAllMessage(),void console.log("saveEditMessage",b))})},a.showError=function(b){$("html,body").scrollTop(0),document.getElementById("errorReason").innerHTML=b,document.getElementById("errorMessage").style.display="",a.timeout&&c.cancel(a.timeout),a.timeout=c(function(){document.getElementById("errorMessage").style.display="none"},5e3)},a.cancelEditMessage=function(){document.getElementById("createMsgBtn").style.display="none",document.getElementById("editMsgBtn").style.display="",document.getElementById("deleteMsgBtn").style.display="",document.getElementById("editMessageHeader").innerHTML="编辑短信模板";for(var b=0;b<a.allMessage.length;b++)if(a.allMessage[b].id==a.editMessage.id){a.editMessage.msgid=a.allMessage[b].msgid,a.editMessage.mname=a.allMessage[b].mname,a.editMessage.mcontent=a.allMessage[b].mcontent;break}},a.deleteMessage=function(){var b={};b.id=a.editMessage.id,f.deleteMessage(b,function(b){return 0==b.result?void a.showError(b.reason):(a.getAllMessage(),void console.log("deleteMessage",b))})},a.returnCustomerGroup=function(){b.go("managecenter")},a.goSendMessage=function(){a.getAllGroup();var b={messageType:"sendMessage"};f.setMessageType(b,function(b){a.messageLoadPath="tpls/sendMessage/sendMessage.html"})}}),cspCtrls.controller("allProductsCtrl",function(a,b,c,d,e,f,g){a.products=[],a.NetAssetValue,a.allTactics=[],a.allProRiskLevel=[],a.allProductSeries=[],a.currProRiskLevel=[],a.currProductSeries=[],a.maxPageSize=3,a.pageRows=10,a.filterCondition={pageRows:a.pageRows,page:1,tacticsID:-1,riskLevelID:-1,seriesID:-1},a.searchProductName="",a.productAmount=0,a.allPage=0,a.currentpage=1,a.pageArr=[],a.showAll=!1,a.getProducts=function(){e.getProducts("",function(b){b.result===!1&&console.log(b.reason),console.log("getProducts",b);for(var c=0;c<b.length;c++)b[c].releasetime=new Date(b[c].releasetime).Format("yyyy-MM-dd"),b[c].netdate=new Date(b[c].netdate).Format("yyyy-MM-dd"),b[c].number=(c+1).toString(),a.getProductLatestNet(b[c].id);a.products=b})},a.setHeaderName=function(a){g.getUserInfo(a,function(a){0!=a&&(7!=a.conlevel&&2!=a.conlevel&&1!=a.conlevel||(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display=""),document.getElementById("header_username").innerHTML=a.tel)})},a.overList=function(a){$(a.target).addClass("overList")},a.outList=function(a){$(a.target).removeClass("overList")},a.getProductAmount=function(b){e.getProductAmount(b,function(c){if(0!=c.result){if(console.log("getProductAmount",c,b),a.productAmount=c.productAmount,0==c.productAmount)return document.getElementById("pageList").style.display="none",void(a.products=[]);document.getElementById("pageList").style.display="",a.getProductsByFilter(b),a.allPage=Math.ceil(a.productAmount/a.pageRows),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize)}})},a.gotoPage=function(b){a.currentpage=b,console.log("$scope.currentpage",a.currentpage),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=b,a.getProductsByFilter(a.filterCondition)},a.goFirstPage=function(){a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=1,a.getProductsByFilter(a.filterCondition)},a.goLastPage=function(){a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.allPage,a.getProductsByFilter(a.filterCondition)},a.goPreviousPage=function(){a.currentpage>1?a.currentpage-=1:a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getProductsByFilter(a.filterCondition)},a.goNextPage=function(){a.currentpage<a.allPage?a.currentpage+=1:a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getProductsByFilter(a.filterCondition)},a.getProductsByPage=function(b){a.filterCondition.page=b,a.getProductsByFilter(a.filterCondition)},a.getProductsByFilter=function(b){e.getProductsByFilterWithLatestNet(b,function(b){b.result===!1&&console.log(b.reason),console.log("getProductsByFilter",b);for(var c=0;c<b.length;c++)b[c].releasetime=new Date(b[c].releasetime).Format("yyyy-MM-dd"),b[c].netdate=new Date(b[c].netdate).Format("yyyy-MM-dd"),b[c].number=(c+1).toString(),"undefined"==typeof b[c].net||null==b[c].net?(b[c].lastNet="--",b[c].accReturnRate="--",b[c].yearrateStr="--",b[c].lastNetValue=0,b[c].accReturnRateValue=0,b[c].yearrateValue=0):(b[c].lastNet=b[c].net.toFixed(3).toString(),b[c].accReturnRate=(100*(b[c].totalnet-1)).toFixed(2)+"%",b[c].yearrateStr=(100*b[c].yearrate).toFixed(2)+"%",b[c].lastNetValue=b[c].net,b[c].accReturnRateValue=b[c].totalnet-1,b[c].yearrateValue=b[c].yearrate);a.products=b})},a.allProductsInit=function(){f.cspCheckLoginState("",function(c){return c.loginState!==!0?($("#loginModal").remove(),void b.go("home")):(console.log("cspCheckLoginState",c.uid),a.uid=c.uid,a.setHeaderName(c),f.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||(event.preventDefault(),b.go("risklevel"))}),void 0)})},a.tableOver=function(a){console.log(a.target),$(a.target).addClass("trOverColor")},a.tableOut=function(a){$(a.target).removeClass("trOverColor")},a.getProductLatestNet=function(b){var c={};c.productID=b,e.getProductLatestNet(c,function(b){if(b.result===!1)return void console.log("getProductLatestNet failed");for(var c=0;c<a.products.length;c++)if(a.products[c].id==b.proid){"undefined"==typeof b.net?(a.products[c].lastNet="--",a.products[c].accReturnRate="--",a.products[c].yearrate="--",a.products[c].lastNetValue=0,a.products[c].accReturnRateValue=0,a.products[c].yearrateValue=0):(a.products[c].lastNet=b.net.toFixed(3).toString(),a.products[c].accReturnRate=(100*b.accrate).toFixed(2)+"%",a.products[c].yearrate=(100*b.yearrate).toFixed(2)+"%",a.products[c].lastNetValue=b.net,a.products[c].accReturnRateValue=b.accrate,a.products[c].yearrateValue=b.yearrate);break}})},a.getNetAssetValue=function(b,c){if("undefined"!=typeof b&&""!=b&&"undefined"!=typeof c){var d={};d.productID=b,d.netdate=c,e.getNetAssetValue(d,function(b){if(b.result===!1)return void console.log("getNetAssetValue failed");for(var c=0;c<a.products.length;c++)if(a.products[c].id==b.proid){"undefined"==typeof b.net||""==b.net?a.products[c].net="--":a.products[c].net=b.net.toString();break}})}},a.consultProduct=function(b){var c={};c.productID=b,e.setProductID(c,function(b){b.result===!1?console.log("产品界面设置当前productid失败"):(a.$broadcast("userBuyProduct","name"),jQuery("#orderModal").remove(),jQuery("#allPro_orderModal").modal("show"))})},a.goProductView=function(a){console.log("productID",a);var c={};c.productID=a,e.setProductID(c,function(a){a.result===!1?console.log("产品界面设置当前productid失败"):b.go("productView")})},a.getAllProRiskLevel=function(){e.getAllProRiskLevel("",function(b){b.result===!1?console.log("获取所有产品风险等级失败"):(console.log("获取所有产品风险等级成功",b),a.allProRiskLevel=b)})},a.getAllProductSeries=function(){e.getAllProductSeries("",function(b){b.result===!1?console.log("获取所有产品风险等级失败"):(console.log("获取所有产品风险等级成功",b),a.allProductSeries=b)})},a.getAllTactics=function(){e.getAllTactics("",function(b){b.result===!1?console.log("获取所有产品策略失败"):(console.log("获取所有产品策略成功",b),a.allTactics=b)})},a.goSpecifyTactics=function(b,c){delete a.filterCondition.productname,a.searchProductName="",$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),$("#tacticsList .item").removeClass("active"),$(c.target).addClass("active"),a.filterCondition.tacticsID=b,a.filterCondition.page=1,a.currentpage=1,a.getProductAmount(a.filterCondition)},a.goSpecifyRiskLevel=function(b,c){delete a.filterCondition.productname,a.searchProductName="",$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),$("#riskLevelDiv .item").removeClass("active"),$(c.target).addClass("active"),a.filterCondition.riskLevelID=b,a.filterCondition.page=1,a.currentpage=1,console.log("goSpecifyRiskLevel",a.filterCondition),a.getProductAmount(a.filterCondition)},a.goSpecifySeries=function(b,c){delete a.filterCondition.productname,a.searchProductName="",$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),$("div#seriesList .item").removeClass("active"),$(c.target).addClass("active"),a.filterCondition.seriesID=b,a.filterCondition.page=1,a.currentpage=1,a.getProductAmount(a.filterCondition);
},a.searchProduct=function(){""!==a.searchProductName&&(a.filterCondition.productname=a.searchProductName,console.log("searchProduct",a.filterCondition),a.getProductAmount(a.filterCondition))},a.sortProductTable=function(b){var c,d,e;"I"==b.target.tagName?(c=$(b.target),e=b.target.className,d=$(b.target).parent(":first").attr("data-sort"),console.log("$event.target.tagName==I",c,e,d)):(c=$(b.target).children("i:first"),d=b.target.getAttribute("data-sort"),e=c[0].className,console.log(c,e,d)),$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),e.indexOf("descending")!=-1?(c.addClass("ascending"),a.products.sort(function(a,b){return"number"==typeof b[d]?b[d]<a[d]:a[d].localeCompare(b[d])})):(c.addClass("descending"),a.products.sort(function(a,b){return"number"==typeof b[d]?b[d]>a[d]:b[d].localeCompare(a[d])})),c.show()},a.showAllTactics=function(){a.showAll?(document.getElementById("tacticsDiv").style.height="38px",document.getElementById("tacticsBtn").innerHTML="更多>",a.showAll=!1):(document.getElementById("tacticsDiv").style.height="auto",document.getElementById("tacticsBtn").innerHTML="收起>",a.showAll=!0)},a.showAllRiskLevel=function(){a.showAll?(document.getElementById("riskLevelDiv").style.height="38px",document.getElementById("riskLevelBtn").innerHTML="更多>",a.showAll=!1):(document.getElementById("riskLevelDiv").style.height="auto",document.getElementById("riskLevelBtn").innerHTML="收起>",a.showAll=!0)},a.showAllSeries=function(){a.showAll?(document.getElementById("seriesDiv").style.height="38px",document.getElementById("seriesBtn").innerHTML="更多>",a.showAll=!1):(document.getElementById("seriesDiv").style.height="auto",document.getElementById("seriesBtn").innerHTML="收起>",a.showAll=!0)},jQuery(document).ready(function(){console.log("进入了所有产品中心"),$("html,body").scrollTop(0);var b=a.$watch("allTactics",function(a,c,e){d(function(){40<$("#tacticsList").height()?document.getElementById("tacticsBtn").style.display="":document.getElementById("tacticsBtn").style.display="none",b()},50),console.log("watch",$("#tacticsList").height())},!0),c=a.$watch("allProRiskLevel",function(a,b,e){d(function(){40<$("#riskLevelList").height()?document.getElementById("riskLevelBtn").style.display="":document.getElementById("riskLevelBtn").style.display="none",c()},50),console.log("watch",$("#riskLevelList").height())},!0),e=a.$watch("allProductSeries",function(a,b,c){d(function(){40<$("#seriesList").height()?document.getElementById("seriesBtn").style.display="":document.getElementById("seriesBtn").style.display="none",e()},50),console.log("watch",$("#seriesList").height())},!0);$(window).resize(function(){40<$("#tacticsList").height()?document.getElementById("tacticsBtn").style.display="":document.getElementById("tacticsBtn").style.display="none",40<$("#riskLevelList").height()?document.getElementById("riskLevelBtn").style.display="":document.getElementById("riskLevelBtn").style.display="none",40<$("#seriesList").height()?document.getElementById("seriesBtn").style.display="":document.getElementById("seriesBtn").style.display="none"}),document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",document.getElementById("homeSpaceDiv_37px").style.display="block",document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label csp_header_active_label",document.getElementById("csp_header_comment_label2").className="csp_header_label2",document.getElementById("csp_header_home_label2").className="csp_header_label2",document.getElementById("csp_header_product0_label2").className="csp_header_label2",document.getElementById("csp_header_product_label2").className="csp_header_label2 csp_header_active_label2";var f=.8*document.documentElement.clientHeight;f+="px",document.getElementById("productsContents").style.minHeight=f,a.getAllTactics(),a.getAllProRiskLevel(),a.getAllProductSeries(),a.currentpage=1,a.getProductAmount(a.filterCondition)})}),cspCtrls.controller("allProductsCtrl0",function(a,b,c,d,e,f,g){a.products={},a.NetAssetValue,a.allTactics=[],a.allProRiskLevel=[],a.allProductSeries=[],a.currProRiskLevel=[],a.currProductSeries=[],a.maxPageSize=3,a.pageRows=10,a.filterCondition={pageRows:a.pageRows,page:1,tacticsID:-1,riskLevelID:-1,seriesID:-1},a.searchProductName="",a.productAmount=0,a.allPage=0,a.currentpage=1,a.pageArr=[],a.showAll=!1,a.getProducts=function(){e.getProducts("",function(b){b.result===!1&&console.log(b.reason),console.log("getProducts",b);for(var c=0;c<b.length;c++)b[c].releasetime=new Date(b[c].releasetime).Format("yyyy-MM-dd"),b[c].netdate=new Date(b[c].netdate).Format("yyyy-MM-dd"),b[c].number=(c+1).toString(),a.getProductLatestNet(b[c].id);a.products=b})},a.setHeaderName=function(a){g.getUserInfo(a,function(a){0!=a&&(7==a.conlevel||2==a.conlevel||1==a.conlevel?(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display=""):($("#loginModal").remove(),b.go("home")),document.getElementById("header_username").innerHTML=a.tel)})},a.overList=function(a){$(a.target).addClass("overList")},a.outList=function(a){$(a.target).removeClass("overList")},a.getProductAmount=function(b){e.getProductAmount(b,function(c){if(0!=c.result){if(console.log("getProductAmount",c),a.productAmount=c.productAmount,0==c.productAmount)return document.getElementById("pageList").style.display="none",void(a.products=[]);document.getElementById("pageList").style.display="",a.getProductsByFilter(b),a.allPage=Math.ceil(a.productAmount/a.pageRows),a.pageArr=h(a.currentpage,a.allPage,a.maxPageSize)}})},a.gotoPage=function(b){a.currentpage=b,console.log("$scope.currentpage",a.currentpage),a.pageArr=h(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=b,a.getProductsByFilter(a.filterCondition)},a.goFirstPage=function(){a.currentpage=1,a.pageArr=h(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=1,a.getProductsByFilter(a.filterCondition)},a.goLastPage=function(){a.currentpage=a.allPage,a.pageArr=h(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.allPage,a.getProductsByFilter(a.filterCondition)},a.goPreviousPage=function(){a.currentpage>1?a.currentpage-=1:a.currentpage=1,a.pageArr=h(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getProductsByFilter(a.filterCondition)},a.goNextPage=function(){a.currentpage<a.allPage?a.currentpage+=1:a.currentpage=a.allPage,a.pageArr=h(a.currentpage,a.allPage,a.maxPageSize),a.filterCondition.page=a.currentpage,a.getProductsByFilter(a.filterCondition)};var h=function(a,b,c){var d=[],e=Math.round(a-c/2),f=Math.round(a+c/2);console.log("start",e,"end",f),e<1&&(e=1),f!=e+c-1&&(f=e+c-1),f>b&&(f=b),f-c+1<e&&(e=f-c+1>0?f-c+1:1);for(var g=e;g<=f;g++){var h={};h.page=g,g==a?h.select=!0:h.select=!1,d.push(h)}return console.log(d),d};a.getProductsByPage=function(b){a.filterCondition.page=b,a.getProductsByFilter(a.filterCondition)},a.getProductsByFilter=function(b){e.getProductsByFilterWithLatestNet(b,function(b){b.result===!1&&console.log(b.reason),console.log("getProducts",b);for(var c=0;c<b.length;c++)b[c].releasetime=new Date(b[c].releasetime).Format("yyyy-MM-dd"),b[c].netdate=new Date(b[c].netdate).Format("yyyy-MM-dd"),b[c].number=(c+1).toString(),b[c].lastNet="--","undefined"==typeof b[c].net||null==b[c].net?(b[c].lastNet="--",b[c].accReturnRate="--",b[c].yearrateStr="--",b[c].lastNetValue=0,b[c].accReturnRateValue=0,b[c].yearrateValue=0):(b[c].lastNet=b[c].net.toFixed(3).toString(),b[c].accReturnRate=(100*(b[c].totalnet-1)).toFixed(2)+"%",b[c].yearrateStr=(100*b[c].yearrate).toFixed(2)+"%",b[c].lastNetValue=b[c].net,b[c].accReturnRateValue=b[c].totalnet-1,b[c].yearrateValue=b[c].yearrate);a.products=b})},a.allProductsInit=function(){f.cspCheckLoginState("",function(c){return c.loginState!==!0?($("#loginModal").remove(),void b.go("home")):(console.log("cspCheckLoginState",c.uid),a.uid=c.uid,a.setHeaderName(c),f.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||(event.preventDefault(),b.go("risklevel"))}),void 0)})},a.tableOver=function(a){console.log(a.target),$(a.target).addClass("trOverColor")},a.tableOut=function(a){$(a.target).removeClass("trOverColor")},a.getProductLatestNet=function(b){var c={};c.productID=b,e.getProductLatestNet(c,function(b){if(b.result===!1)return void console.log("getProductLatestNet failed");for(var c=0;c<a.products.length;c++)if(a.products[c].id==b.proid){"undefined"==typeof b.net?(a.products[c].lastNet="--",a.products[c].accReturnRate="--",a.products[c].yearrate="--",a.products[c].lastNetValue=0,a.products[c].accReturnRateValue=0,a.products[c].yearrateValue=0):(a.products[c].lastNet=b.net.toFixed(3).toString(),a.products[c].accReturnRate=(100*b.accrate).toFixed(2)+"%",a.products[c].yearrate=(100*b.yearrate).toFixed(2)+"%",a.products[c].lastNetValue=b.net,a.products[c].accReturnRateValue=b.accrate,a.products[c].yearrateValue=b.yearrate);break}})},a.getNetAssetValue=function(b,c){if("undefined"!=typeof b&&""!=b&&"undefined"!=typeof c){var d={};d.productID=b,d.netdate=c,e.getNetAssetValue(d,function(b){if(b.result===!1)return void console.log("getNetAssetValue failed");for(var c=0;c<a.products.length;c++)if(a.products[c].id==b.proid){"undefined"==typeof b.net||""==b.net?a.products[c].net="--":a.products[c].net=b.net.toString();break}})}},a.consultProduct=function(b){var c={};c.productID=b,productService.setProductID(c,function(b){b.result===!1?console.log("产品界面设置当前productid失败"):(a.$broadcast("userBuyProduct","name"),jQuery("#orderModal").modal("show"))})},a.goProductView=function(a){console.log("productID",a);var c={};c.productID=a,e.setProductID(c,function(a){a.result===!1?console.log("产品界面设置当前productid失败"):b.go("productView0")})},a.getAllProRiskLevel=function(){e.getAllProRiskLevel("",function(b){b.result===!1?console.log("获取所有产品风险等级失败"):(console.log("获取所有产品风险等级成功",b),a.allProRiskLevel=b)})},a.getAllProductSeries=function(){e.getAllProductSeries("",function(b){b.result===!1?console.log("获取所有产品风险等级失败"):(console.log("获取所有产品风险等级成功",b),a.allProductSeries=b)})},a.getAllTactics=function(){e.getAllTactics("",function(b){b.result===!1?console.log("获取所有产品策略失败"):(console.log("获取所有产品策略成功",b),a.allTactics=b)})},a.goSpecifyTactics=function(b,c){delete a.filterCondition.productname,a.searchProductName="",$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),$("div#tacticsList .item").removeClass("active"),$(c.target).addClass("active"),a.filterCondition.tacticsID=b,a.filterCondition.page=1,a.currentpage=1,a.getProductAmount(a.filterCondition)},a.goSpecifyRiskLevel=function(b,c){delete a.filterCondition.productname,a.searchProductName="",$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),$("#riskLevelDiv .item").removeClass("active"),$(c.target).addClass("active"),a.filterCondition.riskLevelID=b,a.filterCondition.page=1,a.currentpage=1,a.getProductAmount(a.filterCondition)},a.goSpecifySeries=function(b,c){delete a.filterCondition.productname,a.searchProductName="",$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),$("div#seriesList .item").removeClass("active"),$(c.target).addClass("active"),a.filterCondition.seriesID=b,a.filterCondition.page=1,a.currentpage=1,a.getProductAmount(a.filterCondition)},a.searchProduct=function(){""!==a.searchProductName&&(a.filterCondition.productname=a.searchProductName,console.log("searchProduct",a.filterCondition),a.getProductAmount(a.filterCondition))},a.sortProductTable=function(b){var c,d,e;"I"==b.target.tagName?(c=$(b.target),e=b.target.className,d=$(b.target).parent(":first").attr("data-sort"),console.log("$event.target.tagName==I",c,e,d)):(c=$(b.target).children("i:first"),d=b.target.getAttribute("data-sort"),e=c[0].className,console.log(c,e,d)),$("table#allProductsTable i").hide(),$("table#allProductsTable i").removeClass("ascending"),$("table#allProductsTable i").removeClass("descending"),e.indexOf("descending")!=-1?(c.addClass("ascending"),a.products.sort(function(a,b){return"number"==typeof b[d]?b[d]>a[d]:a[d].localeCompare(b[d])})):(c.addClass("descending"),a.products.sort(function(a,b){return"number"==typeof b[d]?b[d]<a[d]:b[d].localeCompare(a[d])})),c.show()},a.showAllTactics=function(){a.showAll?(document.getElementById("tacticsDiv").style.height="27px",document.getElementById("tacticsBtn").innerHTML="更多>",a.showAll=!1):(document.getElementById("tacticsDiv").style.height="auto",document.getElementById("tacticsBtn").innerHTML="收起>",a.showAll=!0)},a.showAllRiskLevel=function(){a.showAll?(document.getElementById("riskLevelDiv").style.height="27px",document.getElementById("riskLevelBtn").innerHTML="更多>",a.showAll=!1):(document.getElementById("riskLevelDiv").style.height="auto",document.getElementById("riskLevelBtn").innerHTML="收起>",a.showAll=!0)},a.showAllSeries=function(){a.showAll?(document.getElementById("seriesDiv").style.height="27px",document.getElementById("seriesBtn").innerHTML="更多>",a.showAll=!1):(document.getElementById("seriesDiv").style.height="auto",document.getElementById("seriesBtn").innerHTML="收起>",a.showAll=!0)},jQuery(document).ready(function(){console.log("进入了所有产品中心"),$("html,body").scrollTop(0);var b=a.$watch("allTactics",function(a,c,e){d(function(){40<$("#tacticsList").height()?document.getElementById("tacticsBtn").style.display="":document.getElementById("tacticsBtn").style.display="none",b()},50),console.log("watch",$("#tacticsList").height())},!0),c=a.$watch("allProRiskLevel",function(a,b,e){d(function(){40<$("#riskLevelList").height()?document.getElementById("riskLevelBtn").style.display="":document.getElementById("riskLevelBtn").style.display="none",c()},50),console.log("watch",$("#riskLevelList").height())},!0),e=a.$watch("allProductSeries",function(a,b,c){d(function(){40<$("#seriesList").height()?document.getElementById("seriesBtn").style.display="":document.getElementById("seriesBtn").style.display="none",e()},50),console.log("watch",$("#seriesList").height())},!0);$(window).resize(function(){40<$("#tacticsList").height()?document.getElementById("tacticsBtn").style.display="":document.getElementById("tacticsBtn").style.display="none",40<$("#riskLevelList").height()?document.getElementById("riskLevelBtn").style.display="":document.getElementById("riskLevelBtn").style.display="none",40<$("#seriesList").height()?document.getElementById("seriesBtn").style.display="":document.getElementById("seriesBtn").style.display="none"}),document.getElementById("homeSpaceDiv_37px").style.display="block",document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label csp_header_active_label",document.getElementById("csp_header_comment_label2").className="csp_header_label2",document.getElementById("csp_header_home_label2").className="csp_header_label2",document.getElementById("csp_header_product_label2").className="csp_header_label2",document.getElementById("csp_header_product0_label2").className="csp_header_label2 csp_header_active_label2";var f=.8*document.documentElement.clientHeight;f+="px",document.getElementById("productsContents").style.minHeight=f,a.getAllTactics(),a.getAllProRiskLevel(),a.getAllProductSeries(),a.currentpage=1,a.getProductAmount(a.currTactics)})}),cspCtrls.controller("tradeTeamManageCtrl",function(a,b,c){a.currentSelectTrid="",a.currentTridTeam="",a.currentSelectTridName="",a.editGid="",a.delGid="",a.tridUnitHeaverBp=0,a.tridUnitValue=0,a.selectedTraders=[],a.selectedLead=[],a.teamName="",a.status=0,a.allocateStockCtrlInit=function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",window.scrollTo(0,0)},$(document).ready(function(){a.cspTradeTeamManageLoadPath="tpls/allocateStock/tradeTeamManage.html",a.status=0}),a.cspTradeTeamManageLoadReady=function(){if(a.status){if(1==a.status){var b={maid:""};b.maid=1,c.getModel(b,function(b){a.model=b,$(".js-trid-add-new-team").dropdown({onChange:function(b,c,d){a.$apply(function(){a.currentTridTeam=b.split("(")[1].replace(")","")}),console.log("trid-changed:",b),console.log("$scope.currentTridTeam:",a.currentTridTeam)},on:"hover"})})}}else{var b={maid:""};b.maid=1,a.editGid="",a.currentSelectTrid&&$(".js_trid").text(a.currentSelectTridName),c.getModel(b,function(b){a.model=b,$(".js-trid").dropdown({onChange:function(b,c,d){a.$apply(function(){a.currentSelectTrid=b.split("(")[1].replace(")",""),a.currentSelectTridName=b}),console.log("trid-changed:",b),console.log("$scope.currentSelectTrid:",a.currentSelectTrid)},on:"hover"}),console.log("99999",b)})}},a.refreshTeam=function(){a.currentSelectTrid&&(jQuery(".js-update-view").addClass("active"),setTimeout(a.teamsInfo(),1e3))},a.addNewTeam=function(){a.currentTridTeam="",a.selectedTraders=[],a.selectedLead=[],a.cspTradeTeamManageLoadPath="tpls/allocateStock/addNewTeam.html",a.status=1},a.editTeam=function(b,c){var b=b,c=c;a.editGid=b,console.log("uuuuuuuuuu",b,c),a.teamName=c,a.cspTradeTeamManageLoadPath="tpls/allocateStock/editTeam.html",a.status=3,a.getTradersForEdit(a.currentSelectTrid,b)},a.getTradersNotInTeams=function(){if(console.log("$scope.currentTridTeam",a.currentTridTeam),a.currentTridTeam){var b={trid:""};b.trid=a.currentTridTeam,console.log("$scope.currentTridTeambbbbb",a.currentTridTeam),c.getTradersNotInTeams(b,function(b){a.traders=b,jQuery(".js-update-view").removeClass("active"),console.log("99999",b)})}},a.getTradersForEdit=function(b,d){if(a.selectedTraders=[],a.selectedLead=[],b){var e={trid:"",gid:""};e.trid=b,e.gid=d,c.getTradersForEdit(e,function(b){a.traders=b;var d={gid:""};d.gid=e.gid,c.getTeamTraders(d,function(b){for(var c=0;c<b.length;c++)a.selectedTraders.push(b[c].traderid),1==b[c].leader&&a.selectedLead.push(b[c].traderid)})})}},a.teamsInfo=function(){if(console.log("$scope.currentSelectTrid",a.currentSelectTrid),jQuery(".js-update-view").removeClass("active"),a.currentSelectTrid){var b={trid:""};b.trid=a.currentSelectTrid,c.teamsInfo(b,function(b){a.teams=b,a.tridUnitHeaverBp=0;for(var c=0;c<b.length;c++)a.tridUnitHeaverBp=a.tridUnitHeaverBp+b[c].bp_max;console.log("99999",b)})}},a.$watch("currentTridTeam",function(){a.selectedTraders=[],a.selectedLead=[],a.teamName="",a.getTradersNotInTeams()}),a.$watch("currentSelectTrid",function(){a.selectedTraders=[],a.selectedLead=[],a.teamName="",a.teamsInfo()}),a.isChecked=function(b){return a.selectedTraders.indexOf(b)>=0},a.updateSelection=function(b,c){var d=b.target,e=d.checked;if(e)a.selectedTraders.push(c);else{var f=a.selectedTraders.indexOf(c);a.selectedTraders.splice(f,1)}},a.isLeaderChecked=function(b){return a.selectedLead.indexOf(b)>=0},a.updateSelectionLeader=function(b,c){var d=b.target,e=d.checked;if(e)a.selectedLead.push(c);else{var f=a.selectedLead.indexOf(c);a.selectedLead.splice(f,1)}},a.noCreateandBack=function(){a.currentTridTeam="",a.selectedTraders=[],a.selectedLead=[],a.cspTradeTeamManageLoadPath="tpls/allocateStock/tradeTeamManage.html",a.status=0},a.editTeamConfirm=function(b){if(console.log("teamName",b),b)if(a.selectedTraders.length)if(a.selectedLead.length)if(a.selectedLead.length>1)$(".creat_team_tips").css("display","block"),a.creatTeamTips="每个小组只能选一人为小组组长",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else if(a.selectedTraders.indexOf(a.selectedLead[0])<0)$(".creat_team_tips").css("display","block"),a.creatTeamTips="小组组长只能在小组成员中选择",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else{var d={trid:"",gname:"",gid:"",traderid:[],leaderid:[],traderLength:""};d.trid=a.currentSelectTrid,d.gname=b,d.gid=a.editGid,d.traderid=a.selectedTraders,d.leaderid=a.selectedLead,d.traderLength=a.selectedTraders.length,c.editTeamConfirm(d,function(b){$(".creat_team_tips").css("display","block"),a.creatTeamTips="编辑小组成功.重新编辑小组或通过取消按钮返回",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},5e3)})}else $(".creat_team_tips").css("display","block"),a.creatTeamTips="请为该小组选择组长",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else $(".creat_team_tips").css("display","block"),a.creatTeamTips="请选择小组成员",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else $(".creat_team_tips").css("display","block"),a.creatTeamTips="请输入小组名称",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3)},a.createTeamConfirm=function(b){if(console.log("teamName",b),b)if(a.selectedTraders.length)if(a.selectedLead.length)if(a.selectedLead.length>1)$(".creat_team_tips").css("display","block"),a.creatTeamTips="每个小组只能选一人为小组组长",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else if(a.selectedTraders.indexOf(a.selectedLead[0])<0)$(".creat_team_tips").css("display","block"),a.creatTeamTips="小组组长只能在小组成员中选择",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else{var d={trid:"",gname:"",traderid:[],leaderid:[],traderLength:""};d.trid=a.currentTridTeam,d.gname=b,d.traderid=a.selectedTraders,d.leaderid=a.selectedLead,d.traderLength=a.selectedTraders.length,c.addNewTeam(d,function(b){a.selectedTraders=[],a.selectedLead=[],a.teamName="",a.getTradersNotInTeams(),$(".creat_team_tips").css("display","block"),a.creatTeamTips="新建小组成功.再新建一个小组或通过取消按钮返回",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},5e3)})}else $(".creat_team_tips").css("display","block"),a.creatTeamTips="请为该小组选择组长",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else $(".creat_team_tips").css("display","block"),a.creatTeamTips="请选择小组成员",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3);else $(".creat_team_tips").css("display","block"),a.creatTeamTips="请输入小组名称",setTimeout(function(){a.creatTeamTips="",$(".creat_team_tips").css("display","none")},1e3)},a.updateModalState=function(a,b){jQuery("."+a).modal(b)},a.delTeam=function(b){a.delGid=b,a.updateModalState("js-team-del-page","toggle")},a.delTeamConfirm=function(){var b={gid:""};b.gid=a.delGid,c.delGid(b,function(b){a.delGid=""})},a.teamDetail=function(b,c){var b=b,c=c;a.teamName=c,a.cspTradeTeamManageLoadPath="tpls/allocateStock/tradeTeamDetail.html",a.status=4,a.getTradersForEdit(a.currentSelectTrid,b)}}),cspCtrls.controller("unitManageCtrl",function(a,b,c,d,e,f){function g(b,c){if(1===b.type){for(var d=c;d>=0;d--)if(a.allUnits[d].maid<b.maid)return d+1;return 0}if(2===b.type){var e=b.caid.split(".");e=e[e.length-1],console.log("currID",e);for(var d=c;d>=0;d--)if("undefined"!=typeof a.allUnits[d].caid){var f=a.allUnits[d].caid.split(".");if(f=f[f.length-1],f<e)return d+1}else if(a.allUnits[d].maid===b.maid)return d+1;return 0}if(3===b.type){var e=b.trid.split(".");e=e[e.length-1],console.log("currID",e);for(var d=c;d>=0;d--)if("undefined"!=typeof a.allUnits[d].trid){var f=a.allUnits[d].trid.split(".");if(f=f[f.length-1],f<e)return d+1}else if(a.allUnits[d].caid===b.caid)return d+1;return 0}}a.assetManagers=[],a.allUnits=[],a.modalLoadPath="",a.allState=[{desc:"可用",stat:"0"},{desc:"冻结",stat:"1"}],a.selectState=a.allState[0],a.unitName="",a.currOperateUnit={},a.currSelecetedUnit={},a.unitManage=a,a.editingManager=!0,a.editingAssetUnit=!0,a.editingTradeUnit=!0,a.cookieinfo={},a.searchField="",$(document).ready(function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",document.getElementById("uiView").style.minHeight="100%",console.log("unitManageCtrl ready"),a.getAllAssetManagers()}),a.unitManageInit=function(){if(document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",document.cookie||navigator.cookieEnabled){a.cookieinfo.exist=!1;for(var c="cspOperLoginInfo=",d=document.cookie.split(";"),e=0;e<d.length;e++){var g=d[e].trim();if(0==g.indexOf(c)){a.cookieinfo.cookieExist=!0;var h=JSON.parse(unescape(g.substring(c.length,g.length)));a.cookieinfo.login_maid=h.maid,a.cookieinfo.login_oid=h.oid,a.cookieinfo.login_pass=h.password;break}}console.log("开始自动登录"),f.cspOperCheckAndLogin(a.cookieinfo,function(a){"succeed"==a.result||b.go("operlogin")})}else alert("浏览器未开启cookie,网站可能无法正常使用"),b.go("operlogin")},a.showError=function(b){document.getElementById("errorReason").innerHTML=b,document.getElementById("errorMessage").style.display="",a.timeout&&c.cancel(a.timeout),a.timeout=c(function(){document.getElementById("errorMessage").style.display="none"},5e3)},a.getAllAssetManagers=function(){e.getAllAssetManagers("",function(b){if(0!=b.result){a.allUnits=b;for(var c=0;c<b.length;c++)b[c].id=b[c].maid,b[c].name=b[c].maname,b[c].type=1,b[c].haveData=!0,b[c].show=!0,b[c].showChild=!1;a.getAllAssetUnits()}})},a.getAllAssetUnits=function(){e.getAllAssetUnits("",function(b){if(b.result!==!1){a.allAssetUnits=b;for(var c=0,d=0;d<a.allUnits.length;d++){for(;c<b.length&&(b[c].id=b[c].caid,b[c].name=b[c].caname,b[c].type=2,b[c].haveData=!0,b[c].show=!1,b[c].showChild=!1,a.allUnits[d].maid===b[c].maid);c++)a.allUnits.splice(++d,0,b[c]);var e={};e.type=2,e.addAssetUnit=!0,e.maid=a.allUnits[d].maid,e.show=!1,a.allUnits.splice(++d,0,e)}a.getAllAssetTraders()}})},a.getAllAssetTraders=function(){e.getAllAssetTraders("",function(b){if(0!=b.result){a.allTraderUnits=b,console.log("getAllAssetTraders",b);for(var c=0,d=0;d<a.allUnits.length;d++){for(;c<b.length&&(b[c].id=b[c].trid,b[c].name=b[c].trname,b[c].type=3,b[c].haveData=!0,b[c].show=!1,b[c].showChild=!1,a.allUnits[d].maid===b[c].maid&&a.allUnits[d].caid===b[c].caid&&a.allUnits[d].addAssetUnit!==!0);c++)a.allUnits.splice(++d,0,b[c]);if("undefined"!=typeof a.allUnits[d].caid&&a.allUnits[d].addAssetUnit!==!0){var e={};e.type=3,e.addTradeUnit=!0,e.caid=a.allUnits[d].caid,e.maid=a.allUnits[d].maid,e.show=!1,a.allUnits.splice(++d,0,e)}}}})},a.getAssetUnitFromCapManager=function(b){for(var c=0;c<a.allUnits.length;c++)if(a.allUnits[c].maid==b){if(1==a.allUnits[c].showChild)for(var d=c+1;d<a.allUnits.length&&(a.allUnits[d].maid==b&&a.allUnits[d].type>1);d++)a.allUnits[d].showChild=!1,a.allUnits[d].show=!1;else for(var d=c+1;d<a.allUnits.length;d++)a.allUnits[d].maid==b&&2==a.allUnits[d].type&&(a.allUnits[d].show=!0);a.allUnits[c].showChild=!a.allUnits[c].showChild;break}},a.getTransUnitFromAssetUnit=function(b){for(var c=0;c<a.allUnits.length;c++)if(a.allUnits[c].caid==b){a.allUnits[c].showChild=!a.allUnits[c].showChild;for(var d=c+1;d<a.allUnits.length&&(a.allUnits[d].caid==b&&3==a.allUnits[d].type);d++)a.allUnits[d].show=!a.allUnits[d].show;break}},a.clickUnit=function(b){console.log("clickUnit",b),1==b.type?a.getAssetUnitFromCapManager(b.id):2==b.type?b.addAssetUnit?console.log("添加资产单元"):a.getTransUnitFromAssetUnit(b.id):3==b.type&&(b.addTradeUnit?console.log("添加交易单元"):console.log("点击交易单元"))},a.frozenAssetManager=function(b){var c={};c.maid=b,e.frozenAssetManager(c,function(c){if(0!=c.result)for(var d=0;d<a.allUnits.length;d++)if(1==a.allUnits[d].type&&a.allUnits[d].maid==b){a.allUnits[d].stat="1";break}})},a.frozenAssetUnit=function(b){var c={};c.caid=b,e.frozenAssetUnit(c,function(c){if(0!=c.result)for(var d=0;d<a.allUnits.length;d++)if(2==a.allUnits[d].type&&a.allUnits[d].caid==b){a.allUnits[d].stat="1";break}})},a.frozenTradeUnit=function(b){var c={};c.trid=b,e.frozenTradeUnit(c,function(c){if(0!=c.result)for(var d=0;d<a.allUnits.length;d++)if(3==a.allUnits[d].type&&a.allUnits[d].trid==b){a.allUnits[d].stat="1";break}})},a.unfreezeAssetManager=function(b){var c={};c.maid=b,console.log("unfreezeAssetManager",a.allUnits,b),e.unfreezeAssetManager(c,function(c){if(0!=c.result)for(var d=0;d<a.allUnits.length;d++)if(1==a.allUnits[d].type&&a.allUnits[d].maid==b){a.allUnits[d].stat="0";break}})},a.unfreezeAssetUnit=function(b){var c={};c.caid=b,e.unfreezeAssetUnit(c,function(c){if(0!=c.result)for(var d=0;d<a.allUnits.length;d++)if(2==a.allUnits[d].type&&a.allUnits[d].caid==b){a.allUnits[d].stat="0";break}})},a.unfreezeTradeUnit=function(b){var c={};c.trid=b,e.unfreezeTradeUnit(c,function(c){if(0!=c.result)for(var d=0;d<a.allUnits.length;d++)if(3==a.allUnits[d].type&&a.allUnits[d].trid==b){a.allUnits[d].stat="0";break}})},a.frozen=function(b){1==b.type?a.frozenAssetManager(b.maid):2==b.type?a.frozenAssetUnit(b.caid):3==b.type&&a.frozenTradeUnit(b.trid)},a.unfreeze=function(b){1==b.type?(console.log(b),a.unfreezeAssetManager(b.id)):2==b.type?a.unfreezeAssetUnit(b.id):3==b.type&&a.unfreezeTradeUnit(b.id)},a.addManager=function(){a.currOperateUnit.maid="",a.unitName="",a.editingManager=!1,a.currSelecetedUnit={},a.selectState=a.allState[0],a.modalLoadPath="tpls/unitManage/assetManager.html",$("#unitManageModal").modal("show")},a.addAssetUnit=function(b,c){console.log("addAssetUnit",b),a.currOperateUnit.maid=b.maid,a.currOperateUnit.caid="",a.unitName="",a.editingAssetUnit=!1,a.currSelecetedUnit=b,a.currSelecetedUnit.index=c,a.selectState=a.allState[0],a.modalLoadPath="tpls/unitManage/assetUnit.html",$("#unitManageModal").modal("show")},a.addTradeUnit=function(b,c){console.log("addTradeUnit",c),a.currOperateUnit.maid=b.maid,a.currOperateUnit.caid=b.caid,a.currOperateUnit.trid="",a.unitName="",a.editingTradeUnit=!1,a.currSelecetedUnit=b,a.currSelecetedUnit.index=c,a.selectState=a.allState[0],a.modalLoadPath="tpls/unitManage/tradeUnit.html",$("#unitManageModal").modal("show")},a.editUnit=function(b){a.currSelecetedUnit=b,$.extend(a.currOperateUnit,a.currSelecetedUnit),a.unitName=a.currSelecetedUnit.name;var c=parseInt(a.currSelecetedUnit.stat);switch(a.selectState=a.allState[c],console.log(c,a.selectState,a.allState),b.type){case 1:a.editingManager=!0,a.modalLoadPath="tpls/unitManage/assetManager.html";break;case 2:a.editingAssetUnit=!0,a.modalLoadPath="tpls/unitManage/assetUnit.html";break;case 3:a.editingTradeUnit=!0,a.modalLoadPath="tpls/unitManage/tradeUnit.html"}$("#unitManageModal").modal("show")},a.saveOperateManager=function(b){var c=/^\d+$/;if(!c.test(a.currOperateUnit.maid))return void a.showError("资产管理人id必须全为数字");if(""==a.unitName)return void a.showError("名称不能为空");if(a.currOperateUnit.maid<1)return void a.showError("单元编号必须大于0");var d={};d.stat=b.stat,d.maname=a.unitName,d.maid=a.currOperateUnit.maid,a.editingManager?(d.maid=a.currSelecetedUnit.maid,e.saveEditAssetManager(d,function(b){return 0==b.result?void a.showError(b.reason):(a.currSelecetedUnit.stat=d.stat,a.currSelecetedUnit.maname=a.unitName,a.currSelecetedUnit.name=a.unitName,void $("#unitManageModal").modal("hide"))})):e.createAssetManager(d,function(b){if(0==b.result)return void a.showError(b.reason);var c={};c.id=b.maid,c.maid=b.maid,c.stat=d.stat,c.type=1,c.name=d.maname,c.show=!0,c.showChild=!1;var e={};e.type=2,e.addAssetUnit=!0,e.maid=b.maid,e.show=!1;var f=g(c,a.allUnits.length-1);a.allUnits.splice(f,0,c,e),$("#unitManageModal").modal("hide"),
console.log("createAssetManager success",d,a.unitName)})},a.cancelOperatedManager=function(){if(a.editingManager){a.unitName=a.currSelecetedUnit.name;var b=parseInt(a.currSelecetedUnit.stat);a.selectState=a.allState[b],console.log(a.selectState,a.allState,a.currSelecetedUnit.stat,b)}else a.unitName="",a.selectState=a.allState[0],console.log(a.selectState,a.allState)},a.saveOperateAssetUnit=function(b){var c=/^\d+$/;if(!c.test(a.currOperateUnit.caid))return void a.showError("资产单元id必须全为数字");if(""==a.unitName)return void a.showError("名称不能为空");if(a.currOperateUnit.caid<1)return void a.showError("单元编号必须大于0");var d={};d.stat=b.stat,d.caname=a.unitName,d.maid=a.currOperateUnit.maid,d.caid=a.currOperateUnit.maid+"."+a.currOperateUnit.caid,a.editingAssetUnit?e.saveEditAssetUnit(d,function(b){return 0==b.result?void a.showError(b.reason):(a.currSelecetedUnit.stat=d.stat,a.currSelecetedUnit.caname=a.unitName,a.currSelecetedUnit.name=a.unitName,void $("#unitManageModal").modal("hide"))}):(console.log(d),e.createAssetUnit(d,function(b){if(0==b.result)return void a.showError(b.reason);var c={};c.id=b.caid,c.maid=b.maid,c.caid=b.caid,c.stat=d.stat,c.type=2,c.name=d.caname,c.caname=d.caname,c.show=!0,c.showChild=!1;var e={};e.type=3,e.addTradeUnit=!0,e.maid=b.maid,e.caid=b.caid,e.show=!1;var f=g(c,a.currSelecetedUnit.index-1);console.log("index",f),a.allUnits.splice(f,0,c,e),$("#unitManageModal").modal("hide"),console.log("createAssetManager success",d,a.unitName)}))},a.cancelOperatedAssetUnit=function(){if(a.editingManager){a.unitName=a.currSelecetedUnit.name;var b=parseInt(a.currSelecetedUnit.stat);a.selectState=a.allState[b],console.log(a.selectState,a.allState,a.currSelecetedUnit.stat,b)}else a.unitName="",a.selectState=a.allState[0],console.log(a.selectState,a.allState)},a.saveOperateTradeUnit=function(b){var c=/^\d+$/;if(!c.test(a.currOperateUnit.trid))return void a.showError("交易单元id必须全为数字");if(""==a.unitName)return void a.showError("名称不能为空");if(a.currOperateUnit.trid<1)return void a.showError("单元编号必须大于0");var d={};d.stat=b.stat,d.trname=a.unitName,d.maid=a.currOperateUnit.maid,d.caid=a.currOperateUnit.caid,d.trid=a.currOperateUnit.caid+"."+a.currOperateUnit.trid,console.log(d),a.editingTradeUnit?e.saveEditTradeUnit(d,function(b){return 0==b.result?void a.showError(b.reason):(a.currSelecetedUnit.stat=d.stat,a.currSelecetedUnit.trname=a.unitName,a.currSelecetedUnit.name=a.unitName,void $("#unitManageModal").modal("hide"))}):e.createTradeUnit(d,function(b){if(0==b.result)return void a.showError(b.reason);var c={};c.id=b.trid,c.maid=d.maid,c.caid=d.caid,c.trid=d.trid,c.stat=d.stat,c.type=3,c.name=d.trname,c.trname=d.trname,c.show=!0,c.showChild=!1;var e=g(c,a.currSelecetedUnit.index-1);console.log("index",e,a.currSelecetedUnit.index),a.allUnits.splice(e,0,c),$("#unitManageModal").modal("hide"),console.log("createAssetManager success",d,a.unitName)})},a.cancelOperated=function(){document.getElementById("errorMessage").style.display="none",a.modalLoadPath="",a.editingManager=!0,a.editingAssetUnit=!0,a.editingTradeUnit=!0,$("#unitManageModal").modal("hide")},a.enterSearch=function(b){var c=window.event?b.keyCode:b.which;if(""==a.searchField)for(var d=0;d<a.allUnits.length;d++)a.allUnits[d].find=!1;if(13===c){console.log("enterSearch");for(var d=0;d<a.allUnits.length;d++)if(!a.allUnits[d].addAssetUnit&&!a.allUnits[d].addTradeUnit){var e=a.allUnits[d].id.toLowerCase();e.indexOf(a.searchField)===-1?(e=a.allUnits[d].name.toLowerCase(),e.indexOf(a.searchField)!==-1&&(a.allUnits[d].find=!0)):a.allUnits[d].find=!0}}},a.refresh=function(){a.getAllAssetManagers(),a.searchField=""}}),cspCtrls.controller("usercenterCtrl",function(a,b,c,d,e,f,g,h,i){a.maxPageSize=3,a.pageRows=10,a.includePath="",a.orderAmount=0,a.allPage=0,a.currentpage=1,a.pageArr=[],a.currOrderState={osid:-1,osdesc:"全部"},a.modifyCenterData={messageCode:"",newPhoneNumber:"",newEmail:"",modifyType:"modifyPhone"},a.passwordObject={oldPassword:"",firstNewPassword:"",secondNewPassword:"",uid:""},a.userInfo={uid:"",username:"",tel:"",email:"",openid:"",unionid:"",last_logintm:"",risklevel_code:"",stat:"",tname:"",idnumber:"",conlevel:"",wechatname:""},a.setRiskLevel=function(b){console.log("risklevel",b),h.getRiskLevel("",function(c){if(c.result===!1)console.log("getRiskLevel fail "+c.reason);else{console.log(c);for(var d=0;d<c.length;d++)if(c[d].risklevel_code==b){a.userInfo.risklevel_code=c[d].risklevel_name;break}}})},a.overList=function(a){$(a.target).addClass("overList")},a.outList=function(a){$(a.target).removeClass("overList")},a.setUserType=function(b){switch(h.getConLevel("",function(c){if(c.result===!1)console.log("getConLevel fail "+c.reason);else{console.log(c);for(var d=0;d<c.length;d++)if(c[d].id==b){a.userInfo.conlevel=c[d].name;break}}}),b){case 1:$("#user_adminbutton").show();break;case 2:$("#user_adminbutton").show();break;default:$("#user_adminbutton").hide()}},a.getUserInfo=function(){"undefined"!=typeof a.userInfo.uid&&g.getUserInfo(a.userInfo,function(c){0!=c.result?(a.userInfo=c,a.setRiskLevel(c.risklevel_code),a.setUserType(c.conlevel),0===c.risklevel_code&&b.go("risklevel"),console.log("$scope.userInfo.unionid",a.userInfo.unionid,typeof a.userInfo.unionid),"undefined"==typeof a.userInfo.unionid||0==a.userInfo.unionid.length?document.getElementById("user_wechatBtn").innerText="绑定微信":document.getElementById("user_wechatBtn").innerText="修改微信"):(a.userInfo.username="",a.userInfo.tel="",a.userInfo.email="",console.log("没查找到数据",c))})},a.getOrder=function(b){i.getOrder(b,function(b){if(b.result!==!1){for(var c=0;c<b.length;c++)b[c].subtime=new Date(b[c].subtime).Format("yyyy-MM-dd hh:mm:ss");a.orders=b,console.log("getOrder",b)}})},a.getOrderState=function(){i.getOrderState("",function(b){b.result!==!1&&(a.orderState=b,console.log("getOrderState",b))})},a.setUserInfo=function(b){g.setUserInfo(b,function(b){b.result===!0?(console.log("查找到了数据",b),a.userInfo.username=b.username,a.userInfo.tel=b.tel,a.userInfo.email=b.email,a.userInfo.openid=b.openid,a.userInfo.last_logintm=b.last_logintm,a.userInfo.stat=b.stat,a.userInfo.tname=b.tname,a.userInfo.idnumber=b.idnumber,a.userInfo.wechatname=b.wechatname,a.setRiskLevel(b.risklevel_code),a.setUserType(b.conlevel)):(a.userInfo.username="",a.userInfo.tel="",a.userInfo.email="",console.log("没查找到数据",b))})},a.cancelChage=function(){a.getUserInfo()},a.saveModifyData=function(){document.getElementById("modifyMessageDiv").style.display="none";var b={};b.phone=a.userInfo.tel,b.code=a.modifyCenterData.messageCode,g.checkUserCenterCode(b,function(b){if(b.result===!1)document.getElementById("modifyMessageDiv").style.display="",document.getElementById("modifyMessagePara").innerText="您输入的验证码不正确,请重新输入";else if("modifyEmail"===a.modifyCenterData.modifyType){if("undefined"==typeof a.modifyCenterData.newEmail||""==a.modifyCenterData.newEmail)return document.getElementById("modifyMessageDiv").style.display="",void(document.getElementById("modifyMessagePara").innerText="您输入的邮箱格式不正确,请重新输入");var c={};c.newEmail=a.modifyCenterData.newEmail,g.setEmail(c,function(b){b.result===!1?(console.log("修改邮箱失败"),document.getElementById("modifyMessageDiv").style.display="",document.getElementById("modifyMessagePara").innerText="修改邮箱失败"):(console.log("修改邮箱成功"),a.getUserInfo(),jQuery("#wechat_modal").modal("hide"))})}else if("modifyPhone"===a.modifyCenterData.modifyType){if(!/^1[34578]\d{9}$/.test(a.modifyCenterData.newPhoneNumber))return console.log("请输入正确的手机号码"),document.getElementById("modifyMessageDiv").style.display="",void(document.getElementById("modifyMessagePara").innerText="请输入正确的手机号码");var c={};c.newPhoneNumber=a.modifyCenterData.newPhoneNumber,g.setPhone(c,function(b){console.log("setPhone",b,typeof b),b.result===!1?(document.getElementById("modifyMessageDiv").style.display="",document.getElementById("modifyMessagePara").innerText="修改Phone失败"):(console.log("修改Phone成功"),a.getUserInfo(),jQuery("#wechat_modal").modal("hide"))})}})},a.setPassword=function(b){return console.log("setUserPass"),document.getElementById("user_passmessageDiv").style.display="none",document.getElementById("user_passSuccMessage").style.display="none",0==b.oldPassword.length||0==b.firstNewPassword.length||0==b.secondNewPassword.length?(document.getElementById("user_passmessageContent").innerHTML="您还有密码没有输入完成,请输入完成后重试",void(document.getElementById("user_passmessageDiv").style.display="")):b.firstNewPassword!==b.secondNewPassword?(document.getElementById("user_passmessageContent").innerHTML="两次输入的密码不一致,请重新输入",void(document.getElementById("user_passmessageDiv").style.display="")):(b.uid=a.userInfo.uid,void g.setPassword(b,function(b){b.result===!0?(console.log("修改密码成功"),a.passwordObject.oldPassword="",a.passwordObject.firstNewPassword="",a.passwordObject.secondNewPassword="",document.getElementById("user_passSuccMessage").style.display=""):(document.getElementById("user_passmessageContent").innerHTML=b.reason,document.getElementById("user_passmessageDiv").style.display="")}))},a.cancelSetPass=function(){console.log("cancelSetPass"),a.passwordObject.oldPassword="",a.passwordObject.firstNewPassword="",a.passwordObject.secondNewPassword="",document.getElementById("user_passmessageDiv").style.display="none",document.getElementById("user_passSuccMessage").style.display="none"},a.cancelModify=function(){document.getElementById("modifyMessageDiv").style.display="none",a.modifyCenterData.messageCode="",a.modifyCenterData.newPhoneNumber="",a.modifyCenterData.newEmail="",jQuery("#wechat_modal").modal("hide")},a.goUserData=function(){a.getUserInfo(),document.getElementById("user_dataform").style.display="",document.getElementById("user_passform").style.display="none",a.includePath=""},a.goModifyPass=function(){a.passwordObject.oldPassword="",a.passwordObject.firstNewPassword="",a.passwordObject.secondNewPassword="",document.getElementById("user_dataform").style.display="none",a.includePath="",document.getElementById("user_passform").style.display=""},a.goManageOrder=function(){a.getOrderAmount(),a.passwordObject.oldPassword="",a.passwordObject.firstNewPassword="",a.passwordObject.secondNewPassword="",document.getElementById("user_dataform").style.display="none",document.getElementById("user_passform").style.display="none",a.includePath="tpls/usercenter/order.html"},a.goOwnedProduct=function(){a.passwordObject.oldPassword="",a.passwordObject.firstNewPassword="",a.passwordObject.secondNewPassword="",document.getElementById("user_dataform").style.display="none",document.getElementById("user_passform").style.display="none",a.includePath="tpls/usercenter/ownedProducts.html"},a.goOrder=function(){document.getElementById("user_dataform").style.display="none",document.getElementById("user_passform").style.display="none",document.getElementById("user_orderDiv").style.display=""},a.goAdmin=function(){b.go("managecenter")},a.goToUserPage=function(c,d){document.getElementById("user_passmessageDiv").style.display="none",document.getElementById("user_passSuccMessage").style.display="none",$("#userlist .item").removeClass("active"),$(d.target).addClass("active");var e={};e.centerData={},e.centerData.page=c,g.setCenterData(e,function(d){d.result===!1?console.log("切换页面失败 "):1===c?a.goModifyPass():2===c?b.go("managecenter"):3===c?a.goManageOrder():4===c?b.go("allocateStock"):5===c?a.goOwnedProduct():a.goUserData()})},a.setWeChatAccount=function(b){g.setWeChatAccount(b,function(b){b.result===!1?(console.log("修改微信失败"),document.getElementById("user_datamessageDiv").style.display="",document.getElementById("user_datamessageContent").innerText=b.reason):(console.log("修改微信成功"),a.getUserInfo())})},a.hideDataMessageDiv=function(){document.getElementById("user_datamessageDiv").style.display="none"},a.goModifyPhone=function(){a.modifyCenterData.modifyType="modifyPhone",a.modifyCenterData.messageCode="",a.modifyCenterData.newPhoneNumber="",a.modifyCenterData.newEmail="",document.getElementById("modifyMessageDiv").style.display="none",document.getElementById("user_modifyCenterHeader").innerText="修改手机",document.getElementById("user_currentPhone").style.display="",document.getElementById("user_currentCode").style.display="",document.getElementById("user_modifyPhone").style.display="",document.getElementById("user_modifyEmail").style.display="none",document.getElementById("user_modifyControl").style.display="",document.getElementById("user_modifyWeChat").style.display="none",jQuery("#wechat_modal").modal("show")},a.goModifyEmail=function(){a.modifyCenterData.modifyType="modifyEmail",a.modifyCenterData.messageCode="",a.modifyCenterData.newPhoneNumber="",a.modifyCenterData.newEmail="",document.getElementById("modifyMessageDiv").style.display="none",document.getElementById("user_modifyCenterHeader").innerText="修改邮箱",document.getElementById("user_currentPhone").style.display="",document.getElementById("user_currentCode").style.display="",document.getElementById("user_modifyPhone").style.display="none",document.getElementById("user_modifyEmail").style.display="",document.getElementById("user_modifyControl").style.display="",document.getElementById("user_modifyWeChat").style.display="none",jQuery("#wechat_modal").modal("show")},a.goModifyWeChat=function(){a.modifyCenterData.modifyType="modifyWeChat",a.modifyCenterData.messageCode="",a.modifyCenterData.newPhoneNumber="",a.modifyCenterData.newEmail="",document.getElementById("user_modifyWeChat").style.display="",a.getWeChatQRCode(""),"undefined"==typeof a.userInfo.unionid||0==a.userInfo.unionid.length?(document.getElementById("user_modifyCenterHeader").innerText="绑定微信",document.getElementById("user_currentPhone").style.display="none",document.getElementById("user_currentCode").style.display="none"):document.getElementById("user_modifyCenterHeader").innerText="修改微信",document.getElementById("modifyMessageDiv").style.display="none",document.getElementById("user_modifyPhone").style.display="none",document.getElementById("user_modifyEmail").style.display="none",document.getElementById("user_modifyControl").style.display="none";var b={};b.centerData={},b.centerData.page=0,b.centerData.unionid=a.userInfo.unionid,b.centerData.phone=a.userInfo.tel,b.centerData.messageCode=a.modifyCenterData.messageCode,g.setCenterData(b,function(a){return a===!1?void console.log("修改或绑定微信失败"):void jQuery("#wechat_modal").modal("show")})},a.getWeChatQRCode=function(a){new WxLogin({id:"wechatQRcode",appid:"wxaec09771f7c5323d",scope:"snsapi_login",redirect_uri:encodeURIComponent("http://csp.smartalpha.cn/#/usercenter"),state:a,style:"black",href:"https://csp.smartalpha.cn:5679/wechatLogin.css"});$("iframe").css("height","230px")},a.getUserCenterCode=function(){if(document.getElementById("modifyMessageDiv").style.display="none",1==a.starTime)return document.getElementById("modifyMessageDiv").style.display="",void(document.getElementById("modifyMessagePara").innerText="短信已发送,请等待");a.starTime=!0;var b=60,c={};c.phone=a.userInfo.tel,g.sendUserCenterCode(c,function(c){c.result===!1?(console.log("sendUserCenter",c),document.getElementById("modifyMessageDiv").style.display="",document.getElementById("modifyMessagePara").innerText="短信已发送,请等待",a.starTime=!1,f.cancel(a.timePromise)):(document.getElementById("user_codeBtn").innerHTML="60秒后重新获取",a.timePromise=f(function(){b<=0?(f.cancel(a.timePromise),a.starTime=!1,document.getElementById("user_codeBtn").innerHTML="获取验证码"):(document.getElementById("user_codeBtn").innerHTML=b+"秒后重新获取",b--)},1e3))})},a.goTestRiskLevel=function(){b.go("risklevel")},a.setHeaderName=function(a){g.getUserInfo(a,function(a){0!=a&&(7!=a.conlevel&&2!=a.conlevel&&1!=a.conlevel||(document.getElementById("product0Btn").style.display="",document.getElementById("product0BigBtn").style.display=""),document.getElementById("header_username").innerText=a.tel)})},a.setOrderState=function(b,c){var d={};d.orderID=b,d.orderState=c,i.setOrderState(d,function(b){0!=b.result&&a.getOrderAmount()})},a.getAllOrderState=function(){i.getAllOrderState("",function(b){if(0!=b.result){a.allOrderState=[];var c={osid:-1,osdesc:"全部"};a.currOrderState=c,a.allOrderState.push(c);for(var d=0;d<b.length;d++)2!=b[d].osid&&a.allOrderState.push(b[d])}})},a.getOrderAmount=function(){var b={};b.orderState=a.currOrderState.osid,i.getOrderAmount(b,function(b){if(0!=b.result){if(a.orderAmount=b.orderAmount,console.log(a.orderAmount),0==a.orderAmount)return document.getElementById("pageList").style.display="none",a.pageArr=[],void(a.orders=[]);document.getElementById("pageList").style.display="",a.allPage=Math.ceil(a.orderAmount/a.pageRows),a.currentpage>a.allPage&&(a.currentpage=a.allPage),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize);var c={};c.page=a.currentpage,c.orderState=a.currOrderState.osid,c.pageRows=a.pageRows,a.getOrder(c)}})},a.gotoPage=function(b){a.currentpage=b,console.log("$scope.currentpage",a.currentpage),a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize);var c={};c.page=b,c.orderState=a.currOrderState.osid,c.pageRows=a.pageRows,a.getOrder(c)},a.goFirstPage=function(){a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize);var b={};b.page=a.currentpage,b.orderState=a.currOrderState.osid,b.pageRows=a.pageRows,a.getOrder(b)},a.goLastPage=function(){a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize);var b={};b.page=a.currentpage,b.orderState=a.currOrderState.osid,b.pageRows=a.pageRows,a.getOrder(b)},a.goPreviousPage=function(){a.currentpage>1?a.currentpage-=1:a.currentpage=1,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize);var b={};b.page=a.currentpage,b.orderState=a.currOrderState.osid,b.pageRows=a.pageRows,a.getOrder(b)},a.goNextPage=function(){a.currentpage<a.allPage?a.currentpage+=1:a.currentpage=a.allPage,a.pageArr=calculateIndexes(a.currentpage,a.allPage,a.maxPageSize);var b={};b.page=a.currentpage,b.orderState=a.currOrderState.osid,b.pageRows=a.pageRows,a.getOrder(b)},a.selectOrderState=function(b){a.currOrderState=b,console.log("selectOrderState",a.currOrderState)},a.findOrder=function(){a.currentpage=1,a.getOrderAmount()},a.userCenterInit=function(){h.cspCheckLoginState("",function(c){return c.loginState?(console.log("cspCheckLoginState",c.uid),a.userInfo.uid=c.uid,a.setHeaderName(c),h.cspCheckRiskState({},function(a){"succeed"===a.result&&a.riskstate===!0||(event.preventDefault(),b.go("risklevel"))}),void 0):($("#loginModal").remove(),void b.go("home"))})},jQuery(document).ready(function(){console.log("进入了用户中心"),$("html,body").scrollTop(0),document.getElementById("csp_header_containter").style.display="block",document.getElementById("csp_footer").style.display="block",document.getElementById("homeSpaceDiv_37px").style.display="block",document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label ",$("#user_codeInput").bind("input propertychange",function(){console.log("user_codeInput",a.modifyCenterData.messageCode),"modifyWeChat"===a.modifyCenterData.modifyType&&a.getWeChatQRCode(a.modifyCenterData.messageCode)});var b=.8*document.documentElement.clientHeight,c=b+"px";document.getElementById("userSegment").style.minHeight=c,a.getUserInfo(),g.getCenterData("",function(b){if(console.log("getCenterData",b,typeof b),b.result===!1)console.log("getCenterData 失败");else if(1===b.page)a.goModifyPass(),document.getElementById("user_databutton").className="item",document.getElementById("user_passbutton").className="active item";else if(3===b.page)a.goManageOrder(),document.getElementById("user_databutton").className="item",document.getElementById("user_orderbutton").className="active item";else if(5===b.page)a.goOwnedProduct(),document.getElementById("user_databutton").className="item",document.getElementById("user_ownedProductbutton").className="active item";else{a.goUserData();var c={};if(c.code=e.search().code,b.messageCode=e.search().state,console.log("wechatCode.code",c.code,b),"undefined"==typeof c.code||0==c.code.length)return void console.log("没有code就表示没有使用修改微信");if("undefined"!=typeof b.unionid&&0!=b.unionid.length){var d={};d.phone=b.phone,d.code=b.messageCode,g.checkUserCenterCode(d,function(b){console.log("checkUserCenterCode",b),b.result===!1?(document.getElementById("user_datamessageDiv").style.display="",document.getElementById("user_datamessageContent").innerText="修改微信出错,验证码不正确"):(console.log("验证码正确"),h.cspCheckWechatCode(c,function(b){if(b.result===!1)return console.log("获取微信数据失败"),document.getElementById("user_datamessageDiv").style.display="",void(document.getElementById("user_datamessageContent").innerText="获取微信数据失败,请重试");console.log("获取微信数据成功",b);var c={};c.uid=a.userInfo.uid,c.openid=b.openid,c.unionid=b.unionid,c.nickname=b.nickname,a.setWeChatAccount(c)}))})}else console.log("之前没有绑定微信,直接绑"),h.cspCheckWechatCode(c,function(b){if(b.result===!1)return console.log("获取微信数据失败"),document.getElementById("user_datamessageDiv").style.display="",void(document.getElementById("user_datamessageContent").innerText="获取微信数据失败,请重试");console.log("获取微信数据成功",b);var c={};c.uid=a.userInfo.uid,c.openid=b.openid,c.unionid=b.unionid,c.nickname=b.nickname,a.setWeChatAccount(c)})}})})}),cspCtrls.controller("cspWchatRegCtrl",function(a,b,c,d){a.timePromise=void 0,a.cspWchatRegInit=function(){document.getElementById("csp_header_comment_label").className="csp_header_label",document.getElementById("csp_header_home_label").className="csp_header_label",document.getElementById("csp_header_product_label").className="csp_header_label",document.getElementById("csp_header_product0_label").className="csp_header_label ",a.wchatstatepath="tpls/usercenter/checkphone.html",a.wchatRegState=1,c.cspCheckWchatState({},function(a){"succeed"!==a.result&&($("#loginModal").remove(),d.go("home"))})},a.cspwchatregPhoneFocus=function(){document.getElementById("csp_wchatreg_phone_tips").style.display="none",document.getElementById("csp_wchatreg_phone_br").style.display="block"},a.cspwchatregPhoneBlur=function(a){void 0!==a&&""!==a||(document.getElementById("csp_wchatreg_phone_tips").style.display="block",document.getElementById("csp_wchatreg_phone_tips").style.visibility="visible",document.getElementById("csp_wchatreg_phone_label").innerHTML="手机号码不能为空",document.getElementById("csp_wchatreg_phone_br").style.display="none")},a.cspwchatregImgCodeFocus=function(){document.getElementById("csp_wchatreg_imgcode_tips").style.display="none",document.getElementById("csp_wchatreg_imgcode_br").style.display="block"},a.cspwchatregImgCodeBlur=function(a){void 0!==a&&""!==a||(document.getElementById("csp_wchatreg_imgcode_tips").style.display="block",document.getElementById("csp_wchatreg_imgcode_tips").style.visibility="visible",document.getElementById("csp_wchatreg_imgcode_label").innerHTML="图片验证码不能为空",document.getElementById("csp_wchatreg_imgcode_br").style.display="none")},a.cspwchatregRefreshImgCode=function(){var a=10*Math.random();document.getElementById("csp_wchatreg_imgcode_id").src="/wchatregcode?width=120&height=40&time="+a,document.getElementById("csp_wchatreg_imgcode_tips").style.display="none",document.getElementById("csp_wchatreg_imgcode_br").style.display="block"},a.cspwchatregCodeFocus=function(){document.getElementById("csp_wchatreg_code_tips").style.display="none",document.getElementById("csp_wchatreg_code_br").style.display="block"},a.cspwchatregCodeBlur=function(a){void 0!==a&&""!==a||(document.getElementById("csp_wchatreg_code_tips").style.display="block",document.getElementById("csp_wchatreg_code_tips").style.visibility="visible",document.getElementById("csp_wchatreg_code_label").innerHTML="手机验证码不能为空",document.getElementById("csp_wchatreg_code_br").style.display="none")},a.cspwchatregGetCode=function(d,e){if(void 0!==d&&""!==d&&/^1[34578]\d{9}$/.test(d))if(void 0===e||""===e)document.getElementById("csp_wchatreg_imgcode_tips").style.display="block",document.getElementById("csp_wchatreg_imgcode_tips").style.visibility="visible",document.getElementById("csp_wchatreg_imgcode_label").innerHTML="图片验证码不能为空",document.getElementById("csp_wchatreg_imgcode_br").style.display="none";else{var f={};f.imgcode=e,c.cspCheckWchatImgCode(f,function(e){if("succeed"===e.result)if(e.error===!1){var f={};f.phone=d,c.cspWchatRegSendCode(f,function(c){if("succeed"===c.result)if(c.error===!1){var d=60;a.timePromise=void 0,a.timePromise=b(function(){d<=0?(b.cancel(a.timePromise),a.timePromise=void 0,d=60,document.getElementById("csp_wchatreg_code_button_label").innerHTML="获取验证码",document.getElementById("csp_wchatreg_code_button").removeAttribute("disabled")):(document.getElementById("csp_wchatreg_code_button_label").innerHTML=d+"秒后重新获取",document.getElementById("csp_wchatreg_code_button").disabled="disabled",d--)},1e3,100),alert("我们已经向您的手机发送了验证码，5分钟有效")}else document.getElementById("csp_wchatreg_code_tips").style.display="block",document.getElementById("csp_wchatreg_code_tips").style.visibility="visible",document.getElementById("csp_wchatreg_code_label").innerHTML="短信验证码发送失败，请更换手机号或重试",document.getElementById("csp_wchatreg_code_br").style.display="none";else document.getElementById("csp_wchatreg_code_tips").style.display="block",document.getElementById("csp_wchatreg_code_tips").style.visibility="visible",document.getElementById("csp_wchatreg_code_label").innerHTML="短信验证码发送失败，请更换手机号或重试",document.getElementById("csp_wchatreg_code_br").style.display="none"})}else document.getElementById("csp_wchatreg_imgcode_tips").style.display="block",document.getElementById("csp_wchatreg_imgcode_tips").style.visibility="visible",document.getElementById("csp_wchatreg_imgcode_label").innerHTML="图片验证码错误",document.getElementById("csp_wchatreg_imgcode_br").style.display="none";else document.getElementById("csp_wchatreg_imgcode_tips").style.display="block",document.getElementById("csp_wchatreg_imgcode_tips").style.visibility="visible",document.getElementById("csp_wchatreg_imgcode_label").innerHTML="图片验证码错误",document.getElementById("csp_wchatreg_imgcode_br").style.display="none"})}else document.getElementById("csp_wchatreg_phone_tips").style.display="block",document.getElementById("csp_wchatreg_phone_tips").style.visibility="visible",document.getElementById("csp_wchatreg_phone_label").innerHTML="请先输入正确的手机号码",document.getElementById("csp_wchatreg_phone_br").style.display="none"},a.cspwchatregPassSubmit=function(d,e,f){if(void 0===e||""===e)document.getElementById("csp_wchatreg_imgcode_tips").style.display="block",document.getElementById("csp_wchatreg_imgcode_tips").style.visibility="visible",document.getElementById("csp_wchatreg_imgcode_label").innerHTML="图片验证码不能为空",document.getElementById("csp_wchatreg_imgcode_br").style.display="none";else if(document.getElementById("csp_wchatreg_phone_tips").style.display="none",document.getElementById("csp_wchatreg_phone_br").style.display="block",document.getElementById("csp_wchatreg_imgcode_tips").style.display="none",document.getElementById("csp_wchatreg_imgcode_br").style.display="block",document.getElementById("csp_wchatreg_code_tips").style.display="none",document.getElementById("csp_wchatreg_code_br").style.display="block",void 0===d||""===d)document.getElementById("csp_wchatreg_phone_tips").style.display="block",document.getElementById("csp_wchatreg_phone_tips").style.visibility="visible",document.getElementById("csp_wchatreg_phone_label").innerHTML="请先输入正确的手机号码",document.getElementById("csp_wchatreg_phone_br").style.display="none";else if(void 0===f||""===f)document.getElementById("csp_wchatreg_code_tips").style.display="block",document.getElementById("csp_wchatreg_code_tips").style.visibility="visible",document.getElementById("csp_wchatreg_code_label").innerHTML="手机验证码不能为空",document.getElementById("csp_wchatreg_code_br").style.display="none";else{var g={};g.phone=d,g.code=f,c.cspWchatRegCheckCode(g,function(d){"succeed"===d.result&&d.match===!0?c.cspWchatRegDB(g,function(c){"succeed"===c.result?(b.cancel(a.timePromise),a.timePromise=void 0,a.wchatstatepath="tpls/usercenter/wchatregsuccess.html",a.wchatRegState=2):alert("数据库异常，请稍候重试!")}):(document.getElementById("csp_wchatreg_code_tips").style.display="block",document.getElementById("csp_wchatreg_code_tips").style.visibility="visible",document.getElementById("csp_wchatreg_code_label").innerHTML="验证码错误",document.getElementById("csp_wchatreg_code_br").style.display="none")})}},a.cspWchatRegLoad=function(){if(2===a.wchatRegState){console.log("dfjfldsljfd");var e=1;a.timePromise=void 0,a.timePromise=b(function(){switch(e%5){case 1:document.getElementById("csp_wchatreg_success_time_label").innerHTML="。";break;case 2:document.getElementById("csp_wchatreg_success_time_label").innerText="。。";break;case 3:document.getElementById("csp_wchatreg_success_time_label").innerText="。。。";break;case 4:document.getElementById("csp_wchatreg_success_time_label").innerText="。。。。";break;default:document.getElementById("csp_wchatreg_success_time_label").innerText=""}e++},1e3,100),c.cspWchatAutoLogin({},function(c){b.cancel(a.timePromise),a.timePromise=void 0,a.wchatRegState=1,console.log(c),"succeed"===c.result&&(console.log("跳转了"),$("#loginModal").remove(),d.go("home"))})}}}),cspCtrls.controller("wechatCtrl",function(a,b,c,d,e,f){jQuery(document).ready(function(){document.getElementById("treatyCheckBox").checked||(document.getElementById("login_container2").style.display="none",document.getElementById("wechatLoginCheckBoxTips").style.display=""),console.log("login_container2");new WxLogin({id:"login_container2",appid:"wxaec09771f7c5323d",scope:"snsapi_login",redirect_uri:encodeURIComponent("http://csp.smartalpha.cn/#/home"),state:"STATE",style:"black",href:"https://csp.smartalpha.cn:5679/wechatLogin.css"})}),$("iframe:first").css("height","230px"),console.log("iframe first",$("iframe:first"),$("iframe:first").contents().find(".qrcode:first")),$("iframe:first").contents().find(".qrcode").css("width","50px")}),cspCtrls.controller("wishListCtrl",function(a,b,c,d,c){function e(){this.stockIndex="",this.stockNo="",this.stockName="",this.stockNum="",this.marketVal=""}a.currentSelectTrid="",a.currentSelectTridName="",a.currentSelectTid=0,a.currentSelectTidName="";var f="",g=!1;a.surplusBp=0,a.marketPrice=0,a.BPvalue=0,a.wishListCtrlInit=function(){document.getElementById("csp_header_containter").style.display="none",document.getElementById("csp_footer").style.display="none",document.getElementById("homeSpaceDiv_37px").style.display="none",window.scrollTo(0,0)},$(document).ready(function(){var b={maid:""};b.maid=1,d.getModel(b,function(b){a.model=b,$(".js-trid").dropdown({onChange:function(b,c,d){a.$apply(function(){a.currentSelectTrid=b.split("(")[1].replace(")",""),a.currentSelectTridName=b})},on:"hover"})}),a.tableOperator(),$(".js-table-container,.group-wish-list-table").droppable({drop:function(b,c){if(console.log("drapingId-------------",f),void 0!==f&&""!==f&&null!==f&&g){console.log("isAddrow",g);var d=$("#left"+f);console.log("leftRowObj------",d);var e=$("#right"+f);if(e.length>0)return console.log("exist"),void csp.notify("notice",{msg:"该股票已存在于心愿清单，可进行数量更改或删除操作",delay:5e3});var h=$(".js-surplusBp-value").text().split(":")[1];a.surplusBP=a.unformat(h),console.log(a.surplusBP,h);var i=a.calCurMarketValue(f,100,a.surplusBP),j=a.calCurUnitAmount(f,100);if(i){var k=0,l=$(d).children();k=j?100:$(l[5]).html();var m=$(l[1]).html(),n=$(l[2]).html(),o=a.formatNumber(100*a.calStockUnitPrice(m.split(".")[0]),2),p="right"+f,q='<tr class="js-right-row" id="'+p+'"><td>0</td><td>'+m+"</td><td>"+n+'</td><td class="js-amount-right"><div class="ui icon input js-stock-num"><input type="text" value="'+k+'" ><div class="js-num-change"><i class="caret up link icon"></i><i class="caret down link icon"></i></div></div></td><td class="js-num-right">'+o+'</td><td><i class="trash outline big link icon" data-content="移除"></i></td></tr>',r=$(this).children(),s=r[0],t=$(s).children(),u=t[0],v=t[1],w=$(u).next().children();
w.length>0?$(v).append(q):$(u).next().append(q),a.updateCurMaketValue()}else csp.notify("notice",{msg:"超出剩余杠杆BP,无法添加进心愿清单",delay:5e3})}a.tableOperator(),a.dealRightTableNo()}})}),a.$watch("currentSelectTrid",function(){if(console.log("$scope.currentSelectTrid",a.currentSelectTrid),a.currentSelectTrid){var b={trid:""};b.trid=a.currentSelectTrid,a.refreshUnitStocks(a.currentSelectTrid),c.getTidModel(b,function(b){a.tidModel=b,0==b.length?(a.currentSelectTid="",a.currentSelectTidName="交易单元小组",$(".js_tid").text(a.currentSelectTidName)):$(".js-tid").dropdown({onChange:function(b,c,d){a.$apply(function(){console.log(b),a.currentSelectTid=b.split("(")[1].split(")")[0],console.log("$scope.currentSelectTid",a.currentSelectTid)})},on:"hover"})})}}),a.$watch("currentSelectTid",function(){a.currentSelectTid&&(a.refreshBP(a.currentSelectTid),a.refreshGroupWish(a.currentSelectTrid,a.currentSelectTid))}),a.clearTable=function(a){try{for(var b=document.getElementById(a),c=b.getElementsByTagName("tr"),d=c.length-1;d>0;d--)b.deleteRow(d)}catch(a){}},a.dragLeftTable=function(){$(".js-left-table").draggable({cursor:"move",cursorAt:{top:-2,left:-2},helper:"clone",start:function(){var a=$(this).children(),b=$(a[1]).html();f=b.split(".")[0],g=!0}})},a.refreshUnitStocks=function(b){var d={trid:""};d.trid=b,c.getUnitStocks(d,function(b){if(a.clearTable("left-table"),b.length>=0){for(var c="",d=0;d<b.length;d++){var e=d+1,f=b[d].cid,g=b[d].cname,h=a.formatNumber(b[d].totalsa),i="left"+b[d].cid.split(".")[0],j=a.formatNumber(b[d].preclose,2),k=a.formatNumber(b[d].totalsa-b[d].allocatedsa),l=a.formatNumber((b[d].totalsa-b[d].allocatedsa)*b[d].preclose,2),m='<tr class="js-left-table ui-widget-content" id="'+i+'"><td>'+e+"</td><td>"+f+"</td><td>"+g+'</td><td class="js-num-left">'+h+'</td><td class="js-num-left">'+j+'</td><td class="js-num-left">'+k+'</td><td class="js-num-left">'+l+"</td></tr>";c+=m}c.length>0&&($(".js-left-tbody").append(c),a.dragLeftTable())}$(".groupWish-view").removeClass("active")})},a.formatNumber=function(a,b){var c;return!isNaN(parseFloat(a))&&isFinite(a)?(a=Number(a),a=("undefined"!=typeof b?a.toFixed(b):a).toString(),c=a.split("."),c[0]=c[0].toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),c.join(".")):NaN},a.unformat=function(a){var b=a.split(","),c=+b.join("");return c},a.updateCurMaketValue=function(){for(var b=0,c=$(".js-right-table").children(),d=0;d<c.length;d++){var e=$(c[d]).children(),f=e[4],g=a.unformat($(f).text());b+=parseFloat(g);var h=e[2];$(h).text()}a.marketPrice=b.toFixed(2);var i="市值:"+a.formatNumber(b,2);$(".js-market-value").html(i)},a.calStockUnitAmount=function(b){var c=$("#left"+b),d=$(c).children(),e=a.unformat($(d[5]).text());return e},a.calCurUnitAmount=function(b,c){var d=!1,e=a.calStockUnitAmount(b);return d=!(c>e)},a.calStockUnitPrice=function(b){var c=$("#left"+b),d=$(c).children(),e=a.unformat($(d[4]).text());return e},a.calCurMarketValue=function(b,c,d){for(var e=!1,f=a.calStockUnitPrice(b),g=0,h=$(".js-right-table").children(),i=0;i<h.length;i++){var j=$(h[i]).children();if(console.log("rows[1].text()",$(j[1]).text()),b!==$(j[1]).text().split(".")[0]){var k=j[4],l=a.unformat($(k).text());g+=parseFloat(l)}}return console.log(g,c,f,d),e=!(g+c*f>d)},a.dealRightTableNo=function(){for(var a=$(".js-right-table").children(),b=0;b<a.length;b++){var c=$(a[b]).children(),d=c[0];$(d).text(b+1)}},a.delayInputDeal=function(b){var c=$(b).val(),d=$(b).attr("value");if(/^\d+$/.test(c)){var e=c.replace(/\D/g,"");$(b).val(e);var f=$(b).parent().parent().prev().prev().text(),g=e,h=$(".js-surplusBp-value").text().split(":")[1];a.surplusBP=a.unformat(h);var i=a.calCurUnitAmount(f.split(".")[0],parseInt(g));if(i){var j=a.calCurMarketValue(f.split(".")[0],parseInt(g),a.surplusBP);j?$(b).attr("value",e):($(b).val(d),csp.notify("notice",{msg:"超出剩余杠杆BP，请重新确认数量",delay:5e3}),console.log("超出剩余杠杆BP_input"))}else $(b).val(d),csp.notify("notice",{msg:"超出券表中该支证券数量,请重新确认数量",delay:5e3}),console.log("超出券表中该支证券数量");var k=a.calStockUnitPrice(f.split(".")[0]);g=$(b).val();var l=a.formatNumber(g*k,2);$(b).parent().parent().next().html(l),a.updateCurMaketValue()}else $(b).val(d),csp.notify("notice",{msg:"请输入正确格式数量",delay:5e3})},a.tableOperator=function(){a.dragLeftTable(),$(".js-right-row").draggable({cursor:"move",cursorAt:{top:-2,left:-2},helper:"clone",start:function(){var a=$(this).children(),b=$(a[1]).html();f=b.split(".")[0],g=!1}}),$(".caret.up.link").unbind("click").click(function(){var b=$(this).parent().prev().val();null!=b&&void 0!=b&&""!=b||(b="0");var c=$(this).parent().parent().parent().prev().prev().html(),d=$(this).parent().prev().val();console.log("curNumStr",b),console.log("stockNo",c),console.log("stockInput",d);var e=$(".js-surplusBp-value").text().split(":")[1];a.surplusBP=a.unformat(e),console.log("input",a.surplusBP,e);var f=a.calCurMarketValue(c.split(".")[0],parseInt(d)+100,a.surplusBP),g=a.calCurUnitAmount(c.split(".")[0],parseInt(d)+100);if(g)if(f){var h=0;h=parseInt(b)+100,$(this).parent().prev().val(h),$(this).parent().prev().attr("value",h);var i=a.calStockUnitPrice(c.split(".")[0]),j=a.formatNumber(h*i,2);$(this).parent().parent().parent().next().html(j)}else csp.notify("notice",{msg:"超出剩余杠杆BP，请重新确认心愿清单",delay:5e3}),console.log("数量增加失败-->",c);else csp.notify("notice",{msg:"超出券表中该支证券数量,请重新确认数量",delay:5e3}),console.log("超出券表中该支证券数量");a.updateCurMaketValue()}),$(".caret.down.link").unbind("click").click(function(){var b=$(this).parent().parent().parent().prev().prev().html(),c=$(this).parent().prev().val(),d=0;if(d=parseInt(c)-100,d>=0){$(this).parent().prev().val(d),$(this).parent().prev().attr("value",d);var e=a.calStockUnitPrice(b.split(".")[0]),f=a.formatNumber(d*e,2);$(this).parent().parent().parent().next().html(f)}else d>=-100&&($(this).parent().prev().val(0),$(this).parent().prev().attr("value",0),$(this).parent().parent().parent().next().html(formatNumber(0,2)));a.updateCurMaketValue()}),$("input").focus(function(){var b=this,c=$(b);c.attr("value");c.off("keyup").on("keyup",function(a){"13"==a.keyCode&&c.blur()}),c.unbind("blur").blur(function(){a.delayInputDeal(b)})}),$(".input").on("mouseenter mouseleave",function(a){$(this);"mouseenter"==a.type?$(this).children(".js-num-change").show():"mouseleave"==a.type&&$(this).children(".js-num-change").hide()}),$(".trash, .outline").on("click",function(){$(this).parent().parent().remove(),a.dealRightTableNo(),a.updateCurMaketValue()}),$(".js-right-row").droppable({accept:".js-right-row ",drop:function(b,c){if(void 0!==f&&""!==f&&null!==f){var d=$("#right"+f),e=($(d).html(),$(d).children()),g=$(e[1]).html(),h=$(e[2]).html(),i=$(e[3]).children(),j=$(i[0]).children(),k=$(j[0]).val(),l=$(e[4]).html(),m="right"+f,n='<tr class="js-right-row" id="'+m+'"><td>0</td><td>'+g+"</td><td>"+h+'</td><td class="js-amount-right"><div class="ui icon input js-stock-num"><input type="text" value="'+k+'" ><div class="js-num-change"><i class="caret up link icon"></i><i class="caret down link icon"></i></div></div></td><td class="js-num-right">'+l+'</td><td><i class="trash outline big link icon" data-content="移除"></i></td></tr>',o=this,p=$(o),q=$(p).attr("id");if(console.log("----->",q),console.log("--->","right"+f),void 0==q||""==q||null==q||q==="right"+f)return;$(o).before(n),$(d).remove(),a.tableOperator(),a.dealRightTableNo()}}})},a.saveWishLists=function(){var b=$(".js-surplusBp-value").text().split(":")[1],d=a.unformat(b);if(console.log("hhhhhh",b,d),0===a.currentSelectTid)csp.notify("notice",{msg:"请先选择小组",delay:5e3});else if(a.marketPrice-d>0)console.log(a.marketPrice,d),csp.notify("notice",{msg:"心愿清单市值超过剩余杠杆BP值，不能进行该操作",delay:5e3});else{for(var f=new Array,g="",h=new Date,i=$(".js-right-table").children(),j=0;j<i.length;j++){var k=new e,l=$(i[j]).children();k.stockIndex=$(l[0]).text(),k.stockNo=$(l[1]).text(),k.stockName=$(l[2]).text();var m=$(l[3]).children(),n=$(m[0]).children(),o=$(n[0]),p=a.calStockUnitAmount(k.stockNo.split(".")[0]);if(k.stockNum=$(o).val(),p<k.stockNum)return void csp.notify("notice",{msg:"心愿清单中存在证券数量超过券表中其对应数量的",delay:5e3});console.log("stockNumObj--->",k.stockNum),f.push(k)}if(f.length>0){for(var q="",j=0;j<f.length;j++)q+='("',q+=f[j].stockIndex,q+='","',q+=f[j].stockNo,q+='","',q+=f[j].stockName,q+='","',q+=f[j].stockNum,q+='","',q+=h,q+='","',q+=a.currentSelectTid,q+='","',q+=a.currentSelectTrid,q+='"),';q.length>0&&(g=q.substring(0,q.length-1))}var r={valueStr:"",gid:""};r.valueStr=g,r.gid=a.currentSelectTid,c.submitWishList(r,function(a){csp.notify("notice",{msg:"保存成功",delay:5e3})})}},a.refreshBP=function(b){console.log("curBP tid-->",b);var d={gid:""};d.gid=b,c.getGroupBpValue(d,function(b){var c=b.bpData,d=b.surplusHeaverBP;a.BPvalue=parseFloat(c).toFixed(2),a.surplusBP=parseFloat(d).toFixed(2),console.log("获取BP值成功",a.surplusBP),$(".js-bp-value").html("BP:"+a.formatNumber(a.BPvalue,2)),$(".js-surplusBp-value").html("剩余杠杆BP:"+a.formatNumber(a.surplusBP,2))})},a.refreshGroupWish=function(b,d){var e={gid:"",trid:""};e.gid=d,e.trid=b,c.getGroupWishList(e,function(b){var c=b.groupWishListdata;if(a.clearTable("right-table"),c.length>=0){for(var d="",e=0;e<c.length;e++){var f=c[e].cid,g=c[e].cname,h=c[e].amount,i=c[e].cindex,j=a.formatNumber(h*c[e].preclose,2),k="right"+c[e].cid.split(".")[0],l='<tr class="js-right-row" id="'+k+'"><td>'+i+"</td><td>"+f+"</td><td>"+g+'</td><td class="js-amount-right"><div class="ui icon input js-stock-num"><input type="text" value="'+h+'" ><div class="js-num-change"><i class="caret up link icon"></i><i class="caret down link icon"></i></div></div></td><td class="js-num-right">'+j+'</td><td><i class="trash outline big link icon" data-content="移除"></i></td></tr>';d+=l}d.length>0&&($(".js-right-table").append(d),a.tableOperator()),$(".groupWish-view").removeClass("active")}a.updateCurMaketValue()})}});var cspFilters=angular.module("cspFilters",[]);cspFilters.filter("",function(){}),Date.prototype.Format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a};var getMaxAndInterval=function(a){var b=5,c=a/b,d=c,e=0;if(c<1)for(var e=1;c<1;)c=10*c,e-=1;else for(;c>=1;)c/=10,e+=1;console.log("n",e),d=Math.ceil(d/Math.pow(10,e-1))*Math.pow(10,e-1),e=Math.abs(e)+1<=20?Math.abs(e)+1:20,d=parseFloat(d.toFixed(e)),a>=d*b-.5*d?(a=d*(b+1),b+=1):a=d*b,a=parseFloat(a.toFixed(e));var f={};return f.max=a,f.interval=d,f},cspRouters=angular.module("cspRouters",["ui.router"]);cspRouters.config(function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",views:{"":{templateUrl:"tpls/home/index.html"}}}).state("comment",{url:"/comment",views:{"":{templateUrl:"tpls/comment/index.html"}}}).state("usercenter",{url:"/usercenter",views:{"":{templateUrl:"tpls/usercenter/index.html"}},controller:"usercenterCtrl"}).state("wchatreg",{url:"/wchatreg",views:{"":{templateUrl:"tpls/usercenter/wchatregister.html"}}}).state("productView",{url:"/productView",views:{"":{templateUrl:"tpls/productView/index.html"}},controller:"productcontroller"}).state("productView0",{url:"/productView0",views:{"":{templateUrl:"tpls/productView0/index.html"}},controller:"productcontroller"}).state("allProducts",{url:"/allProducts",views:{"":{templateUrl:"tpls/allProducts/index.html"}}}).state("allProducts0",{url:"/allProducts0",views:{"":{templateUrl:"tpls/allProducts0/index.html"}}}).state("resetpass",{url:"/resetpass",views:{"":{templateUrl:"tpls/resetpass/index.html"}}}).state("risklevel",{url:"/risklevel",views:{"":{templateUrl:"tpls/risklevel/index.html"}}}).state("loginout",{url:"/loginout",views:{"":{templateUrl:"tpls/loginout/index.html"}}}).state("managecenter",{url:"/managecenter",views:{"":{templateUrl:"tpls/managecenter/index.html"}}}).state("customerGroup",{url:"/customerGroup",views:{"":{templateUrl:"tpls/customerGroup/index.html"}}}).state("sendMessage",{url:"/sendMessage",views:{"":{templateUrl:"tpls/sendMessage/index.html"}}}).state("operlogin",{url:"/operlogin",views:{"":{templateUrl:"tpls/securitiesManage/operLogin.html"}}}).state("allocateStock",{url:"/allocateStock",views:{"":{templateUrl:"tpls/allocateStock/index.html"}}}).state("tradeTeamManage",{url:"/tradeTeamManage",views:{"":{templateUrl:"tpls/allocateStock/tradeTeamManageIndex.html"}}}).state("opermanage",{url:"/opermanage",views:{"":{templateUrl:"tpls/operManage/index.html"}}}).state("layoutmanage",{url:"/layoutmanage",views:{"":{templateUrl:"tpls/layoutmanage/index.html"}}}).state("unitManage",{url:"/unitManage",views:{"":{templateUrl:"tpls/unitManage/index.html"}}}).state("wishList",{url:"/wishList",views:{"":{templateUrl:"tpls/wishList/index.html"}}}).state("groupexchange",{url:"/groupexchange",views:{"":{templateUrl:"tpls/groupexchange/index.html"}}}).state("random",{url:"/random",views:{"":{templateUrl:"tpls/random/index.html"}}}).state("importStockData",{url:"/importStockData",views:{"":{templateUrl:"tpls/importStockData/index.html"}}}).state("operloginout",{url:"/operloginout",views:{"":{templateUrl:"tpls/operloginout/index.html"}}})});var cspServices=angular.module("cspServices",[]);cspServices.factory("CommentService",function(a){var b={};return b.cspCommentSelectOpionByModule=function(b,c){a({url:"/comment/selectopionbymodule",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspCommentGetReplysByTid=function(b,c){a({url:"comment/getreplysbytid",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspModuleAddReply=function(b,c){a({url:"comment/addreply",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspCommentSelectOpionsByVersion=function(b,c){a({url:"/comment/selectopionbyversion",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspCommentUploadFile=function(b,c){a({method:"POST",url:"/comment/fileload",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspCommentDeleteFile=function(b,c){a({url:"/comment/deletefile",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspCommentAddOpion=function(b,c){a({url:"/comment/addopion",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspCommentAddLike=function(b,c){a({url:"/comment/addlike",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspCommentCancelLike=function(b,c){a({url:"/comment/cancellike",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b}),cspServices.factory("HomeService",["$http",function(a){var b=function(b,c,d){return a({url:b,params:c,method:d})};return{userCheck:function(a,c){b("/home/userCheck",a,"POST").success(function(a){c(a)}).error(function(a){console.log("前端请求失败",a)})},reset:function(a,b){var c=typeof a;if("object"==c)for(var d in a)a[d]=0;return a[b]=1,a},athen:function(a,c){b("/home/athen",a,"POST").success(function(a){if("undefined"===a[0]||"[]"===JSON.stringify(a))c(a);else{var b={};b.uid=a[0].uid,b.username=a[0].username,b.tel=a[0].tel,b.email=a[0].email,console.log("看看user是什么",b),c(b)}}).error(function(a){console.log("前端请求失败",a)})},lastLoginTime:function(a,c){b("/home/lastLoginTime",a,"POST").success(function(a){c(a)}).error(function(a){c(a)})},sessionUid:function(a){b("/home/sessionUid",a,"POST").success(function(a){}).error(function(a){})}}}]),cspServices.factory("UserInfoService",function(a){var b={};return b.cspCheckLoginState=function(b,c){a({url:"userinfo/checkloginstate",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspCheckWechatCode=function(b,c){a({url:"userinfo/checkWechatCode",params:b,method:"POST"}).success(function(a){console.log("cspCheckWechatCode service",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",console.log("cspCheckWechatCode",a),c(b)})},b.WechatLogin=function(b,c){a({url:"userinfo/WechatLogin",params:b,method:"POST"}).success(function(a){console.log("WechatLogin",a),c(a)}).error(function(a){var b={};b.res=a,b.result=!1,b.reason="请求失败",c(b)})},b.cspCheckRiskState=function(b,c){a({url:"userinfo/checkriskstate",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspLoginOut=function(b,c){a({url:"userinfo/loginout",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspCheckAuth=function(b,c){a({url:"userinfo/checkauth",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetAllProduct=function(b,c){a({url:"userinfo/getallproduct",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.getConLevel=function(b,c){a({url:"userinfo/getConLevel",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getRiskLevel=function(b,c){a({url:"userinfo/getRiskLevel",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.checkAutoLogin=function(b,c){a({url:"userinfo/checkAutoLogin",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.setAutoLoginState=function(b,c){console.log("setAutoLoginState",b),a({url:"userinfo/setAutoLoginState",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.cspUserCheckAndLoginByCookie=function(b,c){a({url:"userinfo/checkandloginbycookie",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b}),cspServices.factory("allocateStockService",function(a){var b={};return b.getModel=function(b,c){a({url:"/tradeTeamManage/getModel",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取交易单元失败",c(b)})},b.getTradersNotInTeams=function(b,c){a({url:"/tradeTeamManage/getTradersNotInTeams",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取指定交易单元下未被分组的交易员失败",c(b)})},b.getTradersForEdit=function(b,c){a({url:"/tradeTeamManage/getTradersForEdit",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取getTradersForEdit交易员失败",c(b)})},b.getTeamTraders=function(b,c){a({url:"/tradeTeamManage/getTeamTraders",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取指定小组的小组成员及小组组长信息失败",c(b)})},b.addNewTeam=function(b,c){a({url:"/tradeTeamManage/addNewTeam",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="新建小组数据插入失败",c(b)})},b.teamsInfo=function(b,c){a({url:"/tradeTeamManage/teamsInfo",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取交易单元下小组详细信息",c(b)})},b.editTeamConfirm=function(b,c){a({url:"/tradeTeamManage/editTeamConfirm",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="确认编辑小组失败",c(b)})},b.delGid=function(b,c){a({url:"/tradeTeamManage/delGid",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="确认删除小组信息失败",c(b)})},b}),cspServices.factory("customerGroupService",function(a){var b={};return b.selectedCustomers=[],console.log("customerGroupService初始化"),b.createGroup=function(b,c){a({url:"/customerGroup/createGroup",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="创建分组失败",c(b)})},b.saveEditGroup=function(b,c){a({url:"/customerGroup/saveEditGroup",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="编辑分组失败",c(b)})},b.removeGroup=function(b,c){a({url:"/customerGroup/removeGroup",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="删除分组失败",c(b)})},b.getAllGroup=function(b,c){a({url:"/customerGroup/getAllGroup",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有分组失败",c(b)})},b.getUngroupedAmount=function(b,c){a({url:"/customerGroup/getUngroupedAmount",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取未分组分组失败",c(b)})},b.getGroupinfo=function(b,c){a({url:"/customerGroup/getGroupinfo",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取指定分组失败",c(b)})},b.getCustomers=function(b,c){a({url:"/customerGroup/getCustomers",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取指定分组客户失败",c(b)})},b.getCustomersFromID=function(b,c){a({url:"/customerGroup/getCustomersFromID",params:b,method:"post"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="后台数据获取失败",c(b)})},b.delCustomer=function(b,c){a({url:"/customerGroup/delCustomer",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="删除客户信息失败",c(getCusInfo)})},b.customerImport=function(b,c){a({method:"POST",url:"/customerGroup/customerImport",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.getSpecialGroupCus=function(b,c){a({url:"/customerGroup/getSpecialGroupCus",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="获取指定群客户信息失败",c(getCusInfo)})},b.getCustomerInfo=function(b,c){a({url:"/customerGroup/getCustomerInfo",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="后台数据获取失败",c(b)})},b.editCustomerSure=function(b,c){a({url:"/customerGroup/editCustomerSure",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="修改客户信息失败",c(b)})},b.deleteCustomerGroupInfo=function(b,c){a({url:"/customerGroup/deleteCustomerGroupInfo",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="删除客户群组信息失败",c(b)})},b.addNewCustomerSure=function(b,c){a({url:"/customerGroup/addNewCustomerSure",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="新客户添加失败",c(b)})},b.addNewCustomerGroup=function(b,c){a({url:"/customerGroup/addNewCustomerGroup",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="新客户添加分组失败",c(b)})},b.getNewestCustomerid=function(b,c){a({url:"/customerGroup/getNewestCustomerid",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="获取最新的新增客户id失败",c(b)})},b.getEditCustomerInfo=function(b,c){a({url:"/customerGroup/getEditCustomerInfo",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="获取单个客户信息失败",c(b)})},b.getEditCustomerGroupInfo=function(b,c){a({url:"/customerGroup/getEditCustomerGroupInfo",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.info="获取单个客户所在分组失败",c(b)})},b}),cspServices.factory("groupExchangeService",function(a){var b={};return b.cspGroupExchangeGetGroupInfoAndStock=function(b,c){a({url:"/groupexchange/getgroupinfoandstock",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="无法连接到服务器",c(b)})},b.cspGroupExchangeGetGroupStock=function(b,c){a({url:"/groupexchange/getgroupstock",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="无法连接到服务器",c(b)})},b.writedb=function(b,c){a({url:"/groupexchange/writedb",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspGroupExchangeAddExchange=function(b,c){a({url:"/groupexchange/addexchange",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="无法连接到服务器",c(b)})},b.cspGroupExchangeDeleteExchange=function(b,c){a({url:"/groupexchange/deleteexchange",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="无法连接到服务器",c(b)})},b.cspGroupExchangeAddAskExchange=function(b,c){a({url:"/groupexchange/addaskexchange",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="无法连接到服务器",c(b)})},b.cspGroupExchangeGetExchangeNews=function(b,c){a({url:"/groupexchange/getexchangenews",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="无法连接到服务器",c(b)})},b}),cspServices.factory("LayoutManageService",function(a){var b={};return b.cspLayoutManageGetShowProduct=function(b,c){a({url:"/layoutmanage/getshowproduct",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspLayoutManageGetAllProducts=function(b,c){a({url:"/layoutmanage/getallproducts",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspLayoutManageUpdateLayout=function(b,c){a({url:"/layoutmanage/updatelayout",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b}),cspServices.factory("ManageService",function(a){var b={};return b.cspManageUploadFile=function(b,c){a({method:"POST",url:"/manage/fileload",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageDeleteFile=function(b,c){a({url:"/manage/deletefile",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",c(b)})},b.cspAddProduct=function(b,c){a({method:"POST",url:"/manage/addproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspUpdateProduct=function(b,c){a({method:"POST",url:"/manage/updateproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspAddTactics=function(b,c){a({method:"POST",url:"/manage/addtactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetAllTactics=function(b,c){a({method:"GET",url:"/manage/getalltactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspDeleteTactics=function(b,c){a({method:"POST",url:"/manage/deletetactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspUpdateTactics=function(b,c){a({method:"POST",url:"/manage/updatetactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetAllProduct=function(b,c){a({method:"GET",url:"/manage/getallproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetNetByProductId=function(b,c){a({method:"GET",url:"/manage/getnetbyproductid",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspDeleteProduct=function(b,c){a({method:"POST",url:"/manage/deleteproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspAddSingleNet=function(b,c){a({method:"POST",url:"/manage/addsinglenet",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspUpdateSingleNet=function(b,c){a({method:"POST",url:"/manage/updatesinglenet",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspDeleteSingleNet=function(b,c){a({method:"POST",url:"/manage/deletesinglenet",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageImportLoadFile=function(b,c){a({method:"POST",url:"/manage/importloadfile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageImportInsertToDb=function(b,c){a({method:"POST",url:"/manage/importinserttodb",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetCheckUser=function(b,c){a({method:"GET",url:"/manage/getcheckuser",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetAllUser=function(b,c){a({method:"GET",url:"/manage/getalluser",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetMemberLevel=function(b,c){a({method:"GET",url:"/manage/getmemberlevel",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageChangeUserLevel=function(b,c){a({method:"POST",url:"/manage/changeuserlevel",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageChangeUserCheckState=function(b,c){a({method:"POST",url:"/manage/changeusercheckstate",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageCheckNetExist=function(b,c){a({method:"POST",url:"/manage/checknetexist",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageMultipleDeleteNets=function(b,c){a({method:"POST",url:"/manage/multipledeletenets",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetProductDes=function(b,c){a({method:"GET",url:"/manage/getproductdes",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspAddanalogProduct=function(b,c){a({method:"POST",url:"/manage/addanalogProduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspUpdateanalogProduct=function(b,c){a({method:"POST",url:"/manage/updateanalogProduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspAddanalogTactics=function(b,c){a({method:"POST",url:"/manage/addanalogTactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetAllanalogTactics=function(b,c){a({method:"GET",url:"/manage/getallanalogTactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspDeleteanalogTactics=function(b,c){a({method:"POST",url:"/manage/deleteanalogTactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspUpdateanalogTactics=function(b,c){
a({method:"POST",url:"/manage/updateanalogTactics",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetAllanalogProduct=function(b,c){a({method:"GET",url:"/manage/getallanalogproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspGetanalogNetByanalogProductId=function(b,c){a({method:"GET",url:"/manage/getanalogNetbyanalogProductid",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspDeleteanalogProduct=function(b,c){a({method:"POST",url:"/manage/deleteanalogProduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspAddSingleanalogNet=function(b,c){a({method:"POST",url:"/manage/addsingleanalogNet",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspUpdateSingleanalogNet=function(b,c){a({method:"POST",url:"/manage/updatesingleanalogNet",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspDeleteSingleanalogNet=function(b,c){a({method:"POST",url:"/manage/deletesingleanalogNet",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageImportanalogLoadFile=function(b,c){a({method:"POST",url:"/manage/importanalogloadfile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageImportInsertToDb=function(b,c){a({method:"POST",url:"/manage/importinserttodb",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageCheckanalogNetExist=function(b,c){a({method:"POST",url:"/manage/checkanalogNetexist",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageMultipleDeleteanalogNets=function(b,c){a({method:"POST",url:"/manage/multipledeleteanalogNets",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetanalogProductDes=function(b,c){a({method:"GET",url:"/manage/getanalogProductdes",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageImportanalogInsertToDb=function(b,c){a({method:"POST",url:"/manage/importanaloginserttodb",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetAllOrder=function(b,c){a({method:"GET",url:"/manage/getallorder",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUpdateOrder=function(b,c){a({method:"POST",url:"/manage/updateorder",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetSpot=function(b,c){a({method:"GET",url:"/manage/getspot",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageSpotLoadFile=function(b,c){a({method:"POST",url:"/manage/spotloadfile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageLoadSpotToDb=function(b,c){a({method:"POST",url:"/manage/loadspottodb",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageSpotCheckDate=function(b,c){a({method:"POST",url:"/manage/spotcheckdate",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageSpotInsertSingleData=function(b,c){a({method:"POST",url:"/manage/spotinsertsingledata",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageMultipleDeleteSpots=function(b,c){a({method:"POST",url:"/manage/multipledeletespots",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUpdateSpot=function(b,c){a({method:"POST",url:"/manage/updatespot",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetFutures=function(b,c){a({method:"GET",url:"/manage/getfutures",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageFuturesInsertSingleData=function(b,c){a({method:"POST",url:"/manage/futuresinsertsingledata",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUpdateFutures=function(b,c){a({method:"POST",url:"/manage/updatefutures",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageMultipleDeleteFutureses=function(b,c){a({method:"POST",url:"/manage/multipledeletefutureses",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageFuturesLoadFile=function(b,c){a({method:"POST",url:"/manage/futuresloadfile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageLoadFuturesToDb=function(b,c){a({method:"POST",url:"/manage/loadfuturestodb",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetShowProducts=function(b,c){a({method:"GET",url:"/manage/getshowproducts",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageDeleteShowProduct=function(b,c){a({method:"POST",url:"/manage/deleteshowproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageAddShowProduct=function(b,c){a({method:"POST",url:"/manage/addshowproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetAllSeries=function(b,c){a({method:"GET",url:"/manage/getallseries",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetPageSeries=function(b,c){a({method:"GET",url:"/manage/getpageseries",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageAddSeries=function(b,c){a({method:"POST",url:"/manage/addseries",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUpdateSeries=function(b,c){a({method:"POST",url:"/manage/updateseries",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageDeleteSeries=function(b,c){a({method:"POST",url:"/manage/deleteseries",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetPageNotices=function(b,c){a({method:"GET",url:"/manage/getpagenotices",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetNoticeProduct=function(b,c){a({method:"GET",url:"/manage/getnoticeproduct",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUploadNoticeFile=function(b,c){a({method:"POST",url:"/manage/uploadnoticefile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageAddNotice=function(b,c){a({method:"POST",url:"/manage/addnotice",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUpdateNotice=function(b,c){a({method:"POST",url:"/manage/updatenotice",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageDeleteNotice=function(b,c){a({method:"POST",url:"/manage/deletenotice",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageLoadUserUpLoadFile=function(b,c){a({method:"POST",url:"/manage/loaduseruploadfile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageCheckIdcard=function(a){var b=a,c={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},d=0;if(!/^\d{17}(\d|x)$/i.test(b))return!1;if(b=b.replace(/x$/i,"a"),null==c[parseInt(b.substr(0,2))])return!1;var e=b.substr(6,4)+"-"+Number(b.substr(10,2))+"-"+Number(b.substr(12,2)),f=new Date(e.replace(/-/g,"/"));if(e!=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate())return!1;for(var g=17;g>=0;g--)d+=Math.pow(2,g)%11*parseInt(b.charAt(17-g),11);return d%11==1},b.cspManageGetSimpleUserInfo=function(b,c){a({method:"GET",url:"/manage/getsimpleuserinfo",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageMultipleLoadUser=function(b,c){a({method:"POST",url:"/manage/multipleloaduser",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetConlevel=function(b,c){a({method:"GET",url:"/manage/getconlevel",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetSimpleProducts=function(b,c){a({method:"GET",url:"/manage/getsimpleproducts",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageLoadBoughtUpLoadFile=function(b,c){a({method:"POST",url:"/manage/loadboughtuploadfile",data:b,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetRepeatLoadBought=function(b,c){a({method:"GET",url:"/manage/getrepeatloadbought",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetPageBoughts=function(b,c){a({method:"GET",url:"/manage/getpageboughts",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageMultipleLoadBoughts=function(b,c){a({method:"POST",url:"/manage/multipleloadboughts",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageUpdateBought=function(b,c){a({method:"POST",url:"/manage/updatebought",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageDeleteBought=function(b,c){a({method:"POST",url:"/manage/deletebought",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetProductRisklevels=function(b,c){a({method:"GET",url:"/manage/getproductrisklevels",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspManageGetPageProducts=function(b,c){a({method:"GET",url:"/manage/getpageproducts",params:b}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b}),cspServices.factory("messageService",function(a){var b={};return b.getAllMessage=function(b,c){a({url:"/messageService/getAllMessage",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有短信信息失败",c(b)})},b.sendMessage=function(b,c){a({url:"/messageService/sendMessage",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="发送短信失败",c(b)})},b.saveCreateMessage=function(b,c){a({url:"/messageService/saveCreateMessage",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="创建短信模板失败",c(b)})},b.saveEditMessage=function(b,c){a({url:"/messageService/saveEditMessage",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="编辑短信模板失败",c(b)})},b.deleteMessage=function(b,c){a({url:"/messageService/deleteMessage",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="删除短信模板失败",c(b)})},b.setMessageType=function(b,c){a({url:"/messageService/setMessageType",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="设置短信界面失败",c(b)})},b.getMessageType=function(b,c){a({url:"/messageService/getMessageType",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取短信界面失败",c(b)})},b}),cspServices.factory("operLoginService",function(a){var b={};return b.cspOperCheckLogin=function(b,c){a({url:"/operlogin/checklogin",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperLogin=function(b,c){a({url:"/operlogin/login",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperCheckAndLogin=function(b,c){a({url:"/operlogin/checkandlogin",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperCheckIdcard=function(a){var b=a,c={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},d=0;if(!/^\d{17}(\d|x)$/i.test(b))return!1;if(b=b.replace(/x$/i,"a"),null==c[parseInt(b.substr(0,2))])return!1;var e=b.substr(6,4)+"-"+Number(b.substr(10,2))+"-"+Number(b.substr(12,2)),f=new Date(e.replace(/-/g,"/"));if(e!=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate())return!1;for(var g=17;g>=0;g--)d+=Math.pow(2,g)%11*parseInt(b.charAt(17-g),11);return d%11==1},b.cspOperCheckGroupAndGetList=function(b,c){a({url:"/operlogin/checkgroupandgetlist",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperLoginOut=function(b,c){a({url:"/operlogin/loginout",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b}),cspServices.factory("operManageService",function(a){var b={};return b.cspOperManageGetAllMaid=function(b,c){a({url:"/opermanage/getallmaid",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageGetOidByMaid=function(b,c){a({url:"/opermanage/getoidbymaid",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageGetOperByOid=function(b,c){a({url:"/opermanage/getoperbyoid",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageAddOper=function(b,c){a({url:"/opermanage/addoper",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageUpdateOper=function(b,c){a({url:"/opermanage/updateoper",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageChangeOperStat=function(b,c){a({url:"/opermanage/changeoperstat",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageResetPass=function(b,c){a({url:"/opermanage/resetpass",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageGetCaidByMaid=function(b,c){a({url:"/opermanage/getcaidbymaid",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageGetTridByCaid=function(b,c){a({url:"/opermanage/gettridbycaid",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b.cspOperManageAddTrader=function(b,c){a({url:"/opermanage/addtrader",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="服务器连接失败",c(b)})},b}),cspServices.factory("orderService",function(a){var b={};return b.submitOrder=function(b,c){a({url:"/order/submitOrder",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="提交表单失败",c(b)})},b.getOrder=function(b,c){a({url:"/order/getOrder",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="提交表单失败",c(b)})},b.getOwnedProducts=function(b,c){a({url:"/order/getOwnedProducts",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="提交表单失败",c(b)})},b.getAllOrderState=function(b,c){a({url:"/order/getAllOrderState",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有预约订单失败",c(b)})},b.setOrderState=function(b,c){a({url:"/order/setOrderState",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="设置订单状态失败",c(b)})},b.getOrderAmount=function(b,c){a({url:"/order/getOrderAmount",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取订单数量失败",c(b)})},b.getOwnedProductAmount=function(b,c){a({url:"/order/getOwnedProductAmount",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取订单数量失败",c(b)})},b}),cspServices.factory("productService",function(a){var b={};return b.getProductDetails=function(b,c){a({url:"/productView/getProductDetails",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取产品信息失败",c(b)})},b.setProductID=function(b,c){a({url:"/productView/setProductID",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="设置product id失败",c(b)})},b.getFutures=function(b,c){a({url:"/productView/getFutures",params:b,method:"POST"}).success(function(a){console.log("getFutures",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取 getFutures 失败",c(b)})},b.getProductAmount=function(b,c){a({url:"/productView/getProductAmount",params:b,method:"POST"}).success(function(a){console.log("getProductAmount",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取 product id失败",c(b)})},b.getProductID=function(b,c){a({url:"/productView/getProductID",params:b,method:"POST"}).success(function(a){console.log("getProductID",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取 product id失败",c(b)})},b.getTactics=function(b,c){a({url:"productView/getTactics",params:b,method:"POST"}).success(function(a){console.log("Tactics",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getRiskLevelInfo=function(b,c){a({url:"productView/getRiskLevelInfo",params:b,method:"POST"}).success(function(a){console.log("getRiskLevelInfo",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getSeriesInfo=function(b,c){a({url:"productView/getSeriesInfo",params:b,method:"POST"}).success(function(a){console.log("getSeriesInfo",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getAllTactics=function(b,c){a({url:"productView/getAllTactics",params:b,method:"POST"}).success(function(a){console.log("getAllTactics",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProducts=function(b,c){a({url:"productView/getProducts",params:b,method:"POST"}).success(function(a){console.log("products",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductsByFilter=function(b,c){a({url:"productView/getProductsByFilter",params:b,method:"POST"}).success(function(a){console.log("getProductsByFilter service",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getCardsProduct=function(b,c){a({url:"productView/getCardsProduct",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getAllProductSeries=function(b,c){a({url:"productView/getAllProductSeries",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getAllProRiskLevel=function(b,c){a({url:"productView/getAllProRiskLevel",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductsWithLatestNet=function(b,c){a({url:"productView/getProductsWithLatestNet",params:b,method:"POST"}).success(function(a){console.log("products",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductsByFilterWithLatestNet=function(b,c){a({url:"productView/getProductsByFilterWithLatestNet",params:b,method:"POST"}).success(function(a){console.log("getProductsByFilter service",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductLatestNet=function(b,c){a({url:"productView/getProductLatestNet",params:b,method:"POST"}).success(function(a){console.log("getProductLatestNet",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getNetAssetValue=function(b,c){a({url:"productView/getNetAssetValue",params:b,method:"POST"}).success(function(a){console.log("NetAssetValue",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductSpot=function(b,c){a({url:"productView/getProductSpot",params:b,method:"POST"}).success(function(a){console.log("netProduct",typeof a,a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getNetProduct=function(b,c){a({url:"productView/getNetProduct",params:b,method:"POST"}).success(function(a){console.log("netProduct",typeof a,a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductNotices=function(b,c){a({url:"productView/getProductNotices",params:b,method:"POST"}).success(function(a){console.log("getProductNotices",typeof a,a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b}),cspServices.factory("productService0",function(a){var b={};return b.getProductDetails=function(b,c){a({url:"/productView0/getProductDetails",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取产品信息失败",c(b)})},b.setProductID=function(b,c){a({url:"/productView0/setProductID",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="设置product id失败",c(b)})},b.getFutures=function(b,c){a({url:"/productView0/getFutures",params:b,method:"POST"}).success(function(a){console.log("getFutures",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取 getFutures 失败",c(b)})},b.getProductAmount=function(b,c){a({url:"/productView0/getProductAmount",params:b,method:"POST"}).success(function(a){console.log("getProductAmount",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取 product id失败",c(b)})},b.getProductID=function(b,c){a({url:"/productView0/getProductID",params:b,method:"POST"}).success(function(a){console.log("getProductID",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取 product id失败",c(b)})},b.getTactics=function(b,c){a({url:"productView0/getTactics",params:b,method:"POST"}).success(function(a){console.log("Tactics",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getRiskLevelInfo=function(b,c){a({url:"productView0/getRiskLevelInfo",params:b,method:"POST"}).success(function(a){console.log("getRiskLevelInfo",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getSeriesInfo=function(b,c){a({url:"productView0/getSeriesInfo",params:b,method:"POST"}).success(function(a){console.log("getSeriesInfo",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getAllTactics=function(b,c){a({url:"productView0/getAllTactics",params:b,method:"POST"}).success(function(a){console.log("getAllTactics",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getAllProductSeries=function(b,c){a({url:"productView0/getAllProductSeries",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getAllProRiskLevel=function(b,c){a({url:"productView0/getAllProRiskLevel",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProducts=function(b,c){a({url:"productView0/getProducts",params:b,method:"POST"}).success(function(a){console.log("products",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductsByFilter=function(b,c){a({url:"productView0/getProductsByFilter",params:b,method:"POST"}).success(function(a){console.log("getProductsByFilter0 service",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getCardsProduct=function(b,c){a({url:"productView0/getCardsProduct",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductsByFilterWithLatestNet=function(b,c){a({url:"productView0/getProductsByFilterWithLatestNet",params:b,method:"POST"}).success(function(a){console.log("getProductsByFilter service",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductLatestNet=function(b,c){a({url:"productView0/getProductLatestNet",params:b,method:"POST"}).success(function(a){console.log("getProductLatestNet0",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getNetAssetValue=function(b,c){a({url:"productView0/getNetAssetValue",params:b,method:"POST"}).success(function(a){console.log("NetAssetValue",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductSpot=function(b,c){a({url:"productView0/getProductSpot",params:b,method:"POST"}).success(function(a){console.log("netProduct",typeof a,a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getNetProduct=function(b,c){a({url:"productView0/getNetProduct",params:b,method:"POST"}).success(function(a){console.log("netProduct",typeof a,a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.getProductNotices=function(b,c){a({url:"productView0/getProductNotices",params:b,method:"POST"}).success(function(a){console.log("getProductNotices",typeof a,a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b}),cspServices.factory("randomService",function(a){var b={};return b.getWishTid=function(b,c){a({url:"/random/getWishTid",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取交易单元下的小组失败",c(b)})},b.unitRandmDiv=function(b,c){a({url:"/random/unitRandmDiv",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="分券失败",c(b)})},b.deleResults=function(b,c){a({url:"/random/deleResults",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="清除分券结果失败",c(b)})},b.writeResults=function(b,c){a({url:"/random/writeResults",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="写入分券结果失败",c(b)})},b.writeSec=function(b,c){a({url:"/random/writeSec",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="更改总券失败",c(b)})},b.recoverStock=function(b,c){a({url:"/random/recoverStock",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="恢复总券失败",c(b)})},b.noWishList=function(b,c){a({url:"/random/noWishList",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取是否所有小组均没有心愿清单失败",c(b)})},b.deleWishList=function(b,c){a({url:"/random/deleWishList",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="分券完毕后删除心愿清单失败",c(b)})},b.getRandmR=function(b,c){a({url:"/random/getRandmR",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="分券完毕后获取分券结果失败",c(b)})},b.randomOver=function(b,c){a({url:"/random/randomOver",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="分券完毕后检查总券是否有剩余券失败",c(b)})},b.getTname=function(b,c){a({url:"/random/getTname",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="根据小组gid获取小组名称失败",c(b)})},b.getInfobyGid=function(b,c){a({url:"/random/getInfobyGid",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="根据小组gid获取小组杠杆/分券市值失败",c(b)})},b}),cspServices.factory("RegisterService",function(a){var b={};return b.cspRegisterCheckPhone=function(b,c){a({url:"/register/checkPhone",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspRegisterSendCode=function(b,c){a({url:"/register/sendCheckCode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspRegisterCommit=function(b,c){a({url:"register/toRegister",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspRegisterDeleteSession=function(b,c){a({url:"register/toDeleteSession",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b}),cspServices.factory("ResetpassService",function(a){var b={};return b.cspResetCheckPhone=function(b,c){a({url:"/resetpass/checkPhone",params:b,method:"POST"}).success(function(a){console.log("请求成功"),console.log(a),c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspResetGetCode=function(b,c){a({url:"/resetpass/sendCheckCode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspCheckCode=function(b,c){a({url:"/resetpass/checkCode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="faile",b.reason="请求失败",c(b)})},b.cspUpdateUser=function(b,c){a({url:"/resetpass/toUpdateUser",params:b,method:"POST"}).success(function(a){console.log("发送成功",a),c(a)}).error(function(a){var b={};b.result="faile",b.reason="请求失败",c(b)})},b.cspDeleteSession=function(b,c){a({url:"/resetpass/toDeleteSession",params:{},method:"GET"})},b.cspCheckImgCode=function(b,c){a({url:"/resetpass/checkimgcode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="faile",b.reason="请求失败",c(b)})},b}),cspServices.factory("RisklevelService",function(a){var b={};return b.cspRiskGetPhone=function(b,c){a({url:"risklevel/getphone",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){
var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspRiskCommit=function(b,c){a({url:"risklevel/riskcommit",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspRiskCheckId=function(a){console.log(a);var b=a.idnumber,c={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},d=0;if(!/^\d{17}(\d|x)$/i.test(b))return!1;if(b=b.replace(/x$/i,"a"),null==c[parseInt(b.substr(0,2))])return!1;var e=b.substr(6,4)+"-"+Number(b.substr(10,2))+"-"+Number(b.substr(12,2)),f=new Date(e.replace(/-/g,"/"));if(e!=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate())return!1;for(var g=17;g>=0;g--)d+=Math.pow(2,g)%11*parseInt(b.charAt(17-g),11);return d%11==1},b}),cspServices.factory("tradeUnitStockService",function(a){var b={};return b.getStocksByTrade=function(b,c){a({url:"/tradeUnitStockService/getStocksByTrade",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产单元失败",c(b)})},b.loadStockFile=function(b,c){a({url:"/tradeUnitStockService/loadStockFile",data:b,method:"POST",headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="上传券表文件失败",c(b)})},b.importStock=function(b,c){a({url:"/tradeUnitStockService/importStock",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产单元失败",c(b)})},b.saveEditStock=function(b,c){a({url:"/tradeUnitStockService/saveEditStock",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="编辑券表数据失败",c(b)})},b.delStock=function(b,c){a({url:"/tradeUnitStockService/delStock",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="删除券表数据失败",c(b)})},b.getStockAmountByTrade=function(b,c){a({url:"/tradeUnitStockService/getStockAmountByTrade",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取券表数量失败",c(b)})},b.createStock=function(b,c){a({url:"/tradeUnitStockService/createStock",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="创建券表数据失败",c(b)})},b.loadStockFileAndImport=function(b,c){a({url:"/tradeUnitStockService/loadStockFileAndImport",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="导入数据失败",c(b)})},b}),cspServices.factory("unitManageService",function(a){var b={};return b.getValidAssetUnit=function(b,c){a({url:"/unitManageService/getValidAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产单元失败",c(b)})},b.getTotalAssetUnit=function(b,c){a({url:"/unitManageService/getTotalAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产单元失败",c(b)})},b.getAssetUnitFromCapManager=function(b,c){a({url:"/unitManageService/getAssetUnitFromCapManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产单元失败",c(b)})},b.getAllValidCapManager=function(b,c){a({url:"/unitManageService/getAllValidCapManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有有效的资产管理人失败",c(b)})},b.getAllCapManager=function(b,c){a({url:"/unitManageService/getAllCapManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产管理人失败",c(b)})},b.saveEditAssetUnit=function(b,c){a({url:"/unitManageService/saveEditAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="编辑资产单元失败",c(b)})},b.createAssetUnit=function(b,c){a({url:"/unitManageService/createAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="创建资产单元失败",c(b)})},b.saveEditAssetManager=function(b,c){a({url:"/unitManageService/saveEditAssetManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="编辑资产管理人失败",c(b)})},b.createAssetManager=function(b,c){a({url:"/unitManageService/createAssetManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="创建资产管理人失败",c(b)})},b.saveEditTradeUnit=function(b,c){a({url:"/unitManageService/saveEditTradeUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="编辑交易单元失败",c(b)})},b.createTradeUnit=function(b,c){a({url:"/unitManageService/createTradeUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="创建交易单元失败",c(b)})},b.getTransUnitFromAssetUnit=function(b,c){a({url:"/unitManageService/getTransUnitFromAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有交易单元失败",c(b)})},b.getAllAssetManagers=function(b,c){a({url:"/unitManageService/getAllAssetManagers",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产管理人失败",c(b)})},b.getAllAssetUnits=function(b,c){a({url:"/unitManageService/getAllAssetUnits",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产管理人失败",c(b)})},b.getAllAssetTraders=function(b,c){a({url:"/unitManageService/getAllAssetTraders",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取所有资产管理人失败",c(b)})},b.frozenAssetManager=function(b,c){a({url:"/unitManageService/frozenAssetManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="冻结资产管理人失败",c(b)})},b.frozenAssetUnit=function(b,c){a({url:"/unitManageService/frozenAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="冻结资产单元失败",c(b)})},b.frozenTradeUnit=function(b,c){a({url:"/unitManageService/frozenTradeUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="冻结交易单元失败",c(b)})},b.unfreezeAssetManager=function(b,c){a({url:"/unitManageService/unfreezeAssetManager",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="解冻资产管理人失败",c(b)})},b.unfreezeAssetUnit=function(b,c){a({url:"/unitManageService/unfreezeAssetUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="解冻资产单元失败",c(b)})},b.unfreezeTradeUnit=function(b,c){a({url:"/unitManageService/unfreezeTradeUnit",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="解冻交易单元失败",c(b)})},b.getNewManagerid=function(b,c){a({url:"/unitManageService/getNewManagerid",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="解冻交易单元失败",c(b)})},b.getNewCaid=function(b,c){a({url:"/unitManageService/getNewCaid",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="解冻交易单元失败",c(b)})},b.getNewTrid=function(b,c){a({url:"/unitManageService/getNewTrid",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="解冻交易单元失败",c(b)})},b}),cspServices.factory("usercenterService",["$http",function(a){var b={};return b.getUserInfo=function(b,c){a({url:"/usercenter/getUserInfo",params:b,method:"POST"}).success(function(a){console.log("getUserInfo,service",a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="执行sql失败",c(b)})},b.setUserInfo=function(b,c){a({url:"/usercenter/setUserInfo",params:b,method:"POST"}).success(function(a){var b={};return a.result===!1?(b.result=!1,b.reason=a.reason,void c(b)):(b=a[0],b.result=!0,void c(b))}).error(function(a){var b={};b.result=!1,b.reason="执行sql失败",c(b)})},b.setPassword=function(b,c){a({url:"/usercenter/setPassword",params:b,method:"POST"}).success(function(a){var b={};b.result=a.result,b.reason=a.reason,c(b)}).error(function(a){var b={};b.result=!1,b.reason="执行sql出错",c(b)})},b.setCurrentPage=function(b,c){a({url:"/usercenter/setCurrentPage",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="执行sql出错",c(b)})},b.getCurrentPage=function(b,c){a({url:"/usercenter/getCurrentPage",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="执行sql出错",c(b)})},b.setCenterData=function(b,c){console.log("setCenterData service",b),a({url:"/usercenter/setCenterData",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="执行sql出错",c(b)})},b.getCenterData=function(b,c){a({url:"/usercenter/getCenterData",params:b,method:"POST"}).success(function(a){console.log("getCenterData service",a,typeof a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="执行sql出错",c(b)})},b.setWeChatAccount=function(b,c){a({url:"/usercenter/setWeChatAccount",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="执行sql出错",c(b)})},b.sendUserCenterCode=function(b,c){a({url:"/usercenter/sendUserCenterCode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.checkUserCenterCode=function(b,c){console.log("checkUserCenterCode",b),a({url:"/usercenter/checkUserCenterCode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.setEmail=function(b,c){console.log("setEmail",b),a({url:"/usercenter/setEmail",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b.setPhone=function(b,c){console.log("setPhone",b),a({url:"/usercenter/setPhone",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result=!1,b.reason="请求失败",c(b)})},b}]),cspServices.factory("WchatRegService",function(a){var b={};return b.cspCheckWchatImgCode=function(b,c){a({url:"wchatreg/checkwchatimgcode",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspCheckWchatState=function(b,c){a({url:"wchatreg/checkwchatregstate",params:b,method:"GET"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspWchatRegSendCode=function(b,c){a({url:"wchatreg/wchatregsendcode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspWchatRegCheckCode=function(b,c){a({url:"wchatreg/wchatregcheckcode",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspWchatRegDB=function(b,c){a({url:"wchatreg/wchatregdb",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b.cspWchatAutoLogin=function(b,c){a({url:"wchatreg/wchatautologin",params:b,method:"POST"}).success(function(a){c(a)}).error(function(a){var b={};b.result="failed",b.reason="请求失败",c(b)})},b}),cspServices.factory("wishListService",function(a){var b={};return b.getTidModel=function(b,c){a({url:"/wishList/getTidModel",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取交易小组失败",c(b)})},b.getUnitStocks=function(b,c){a({url:"/wishList/getUnitStocks",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取交易单元券表失败",c(b)})},b.submitWishList=function(b,c){a({url:"/wishList/submitWishList",params:b,method:"POST"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="保存心愿清单失败",c(b)})},b.getGroupBpValue=function(b,c){a({url:"/wishList/getGroupBpValue",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取小组总BP失败",c(b)})},b.getGroupWishList=function(b,c){a({url:"/wishList/getGroupWishList",params:b,method:"GET"}).success(function(a){console.log(a),c(a)}).error(function(a){var b={};b.result=!1,b.reason="获取小组心愿清单失败",c(b)})},b});